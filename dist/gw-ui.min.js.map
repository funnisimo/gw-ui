{"version":3,"file":"gw-ui.min.js","sources":["../js/selector.js","../js/style.js","../js/widget/widget.js","../js/widget/text.js","../js/widget/button.js","../js/widget/input.js","../js/widget/table.js","../js/widget/box.js","../js/widget/dialog.js","../js/flavor.js","../js/sidebar.js","../js/menu.js","../js/html/style.js","../js/html/element.js","../js/html/parser.js","../js/html/input.js","../js/html/checkbox.js","../js/html/button.js","../js/html/fieldset.js","../js/html/lists.js","../js/html/datalist.js","../js/html/document.js","../js/term/widget.js","../js/term/border.js","../js/term/text.js","../js/term/button.js","../js/term/grid.js","../js/term/table.js","../js/term/menu.js","../js/term/select.js","../js/term/term.js","../js/widget/list.js","../js/message.js","../js/ui.js","../js/viewport.js"],"sourcesContent":["import * as GWU from 'gw-utils';\nexport class Selector {\n    constructor(text) {\n        this.priority = 0;\n        if (text.startsWith(':') || text.startsWith('.')) {\n            text = '*' + text;\n        }\n        this.text = text;\n        this.matchFn = this._parse(text);\n    }\n    _parse(text) {\n        const parts = text.split(/ +/g).map((p) => p.trim());\n        const matches = [];\n        for (let i = 0; i < parts.length; ++i) {\n            let p = parts[i];\n            if (p === '>') {\n                matches.push(this._parentMatch());\n                ++i;\n                p = parts[i];\n            }\n            else if (i > 0) {\n                matches.push(this._ancestorMatch());\n            }\n            matches.push(this._matchElement(p));\n        }\n        return matches.reduce((out, fn) => fn.bind(undefined, out), GWU.TRUE);\n    }\n    _parentMatch() {\n        return function parentM(next, e) {\n            // console.log('parent', e.parent);\n            if (!e.parent)\n                return false;\n            return next(e.parent);\n        };\n    }\n    _ancestorMatch() {\n        return function ancestorM(next, e) {\n            let current = e.parent;\n            while (current) {\n                if (next(current))\n                    return true;\n            }\n            return false;\n        };\n    }\n    _matchElement(text) {\n        const CSS_RE = /(?:(\\w+|\\*|\\$)|#(\\w+)|\\.([^\\.: ]+))|(?::(?:(?:not\\(\\.([^\\)]+)\\))|(?:not\\(:([^\\)]+)\\))|([^\\.: ]+)))/g;\n        const parts = [];\n        const re = new RegExp(CSS_RE, 'g');\n        let match = re.exec(text);\n        while (match) {\n            if (match[1]) {\n                const fn = this._matchTag(match[1]);\n                if (fn) {\n                    parts.push(fn);\n                }\n            }\n            else if (match[2]) {\n                parts.push(this._matchId(match[2]));\n            }\n            else if (match[3]) {\n                parts.push(this._matchClass(match[3]));\n            }\n            else if (match[4]) {\n                parts.push(this._matchNot(this._matchClass(match[4])));\n            }\n            else if (match[5]) {\n                parts.push(this._matchNot(this._matchProp(match[5])));\n            }\n            else {\n                parts.push(this._matchProp(match[6]));\n            }\n            match = re.exec(text);\n        }\n        return (next, e) => {\n            if (!parts.every((fn) => fn(e)))\n                return false;\n            return next(e);\n        };\n    }\n    _matchTag(tag) {\n        if (tag === '*')\n            return null;\n        if (tag === '$') {\n            this.priority += 10000;\n            return null;\n        }\n        this.priority += 10;\n        return (el) => el.tag === tag;\n    }\n    _matchClass(cls) {\n        this.priority += 100;\n        return (el) => el.classes.includes(cls);\n    }\n    _matchProp(prop) {\n        if (prop.startsWith('first')) {\n            return this._matchFirst();\n        }\n        else if (prop.startsWith('last')) {\n            return this._matchLast();\n        }\n        else if (prop === 'invalid') {\n            return this._matchNot(this._matchProp('valid'));\n        }\n        else if (prop === 'optional') {\n            return this._matchNot(this._matchProp('required'));\n        }\n        else if (prop === 'enabled') {\n            return this._matchNot(this._matchProp('disabled'));\n        }\n        else if (prop === 'unchecked') {\n            return this._matchNot(this._matchProp('checked'));\n        }\n        this.priority += 1; // prop\n        return (el) => !!el.prop(prop);\n    }\n    _matchId(id) {\n        this.priority += 1000;\n        return (el) => el.attr('id') === id;\n    }\n    _matchFirst() {\n        this.priority += 1; // prop\n        return (el) => !!el.parent && !!el.parent.children && el.parent.children[0] === el;\n    }\n    _matchLast() {\n        this.priority += 1; // prop\n        return (el) => {\n            if (!el.parent)\n                return false;\n            if (!el.parent.children)\n                return false;\n            return el.parent.children[el.parent.children.length - 1] === el;\n        };\n    }\n    _matchNot(fn) {\n        return (el) => !fn(el);\n    }\n    matches(obj) {\n        return this.matchFn(obj);\n    }\n}\nexport function compile(text) {\n    return new Selector(text);\n}\n","import * as GWU from 'gw-utils';\nimport { Selector } from './selector';\nexport class Style {\n    constructor(selector = '$', init) {\n        this._dirty = false;\n        this.selector = new Selector(selector);\n        if (init) {\n            this.set(init);\n        }\n        this._dirty = false;\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n    get fg() {\n        return this._fg;\n    }\n    get bg() {\n        return this._bg;\n    }\n    // get border(): GWU.color.ColorBase | undefined {\n    //     return this._border;\n    // }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).darken(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).lighten(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this._fg, this._bg] = [this._bg, this._fg];\n        return this;\n    }\n    get align() {\n        return this._align;\n    }\n    get valign() {\n        return this._valign;\n    }\n    // get position(): Position | undefined {\n    //     return this._position;\n    // }\n    // get minWidth(): number | undefined {\n    //     return this._minWidth;\n    // }\n    // get maxWidth(): number | undefined {\n    //     return this._maxWidth;\n    // }\n    // get width(): number | undefined {\n    //     return this._width;\n    // }\n    // get minHeight(): number | undefined {\n    //     return this._minHeight;\n    // }\n    // get maxHeight(): number | undefined {\n    //     return this._maxHeight;\n    // }\n    // get height(): number | undefined {\n    //     return this._height;\n    // }\n    // get x(): number | undefined {\n    //     return this._x;\n    // }\n    // get left(): number | undefined {\n    //     return this._left;\n    // }\n    // get right(): number | undefined {\n    //     return this._right;\n    // }\n    // get y(): number | undefined {\n    //     return this._y;\n    // }\n    // get top(): number | undefined {\n    //     return this._top;\n    // }\n    // get bottom(): number | undefined {\n    //     return this._bottom;\n    // }\n    // get padLeft(): number | undefined {\n    //     return this._padLeft;\n    // }\n    // get padRight(): number | undefined {\n    //     return this._padRight;\n    // }\n    // get padTop(): number | undefined {\n    //     return this._padTop;\n    // }\n    // get padBottom(): number | undefined {\n    //     return this._padBottom;\n    // }\n    // get marginLeft(): number | undefined {\n    //     return this._marginLeft;\n    // }\n    // get marginRight(): number | undefined {\n    //     return this._marginRight;\n    // }\n    // get marginTop(): number | undefined {\n    //     return this._marginTop;\n    // }\n    // get marginBottom(): number | undefined {\n    //     return this._marginBottom;\n    // }\n    get(key) {\n        const id = ('_' + key);\n        return this[id];\n    }\n    set(key, value, setDirty = true) {\n        if (typeof key === 'string') {\n            // if (key === 'padding') {\n            //     if (typeof value === 'number') {\n            //         value = [value];\n            //     } else if (typeof value === 'string') {\n            //         value = value.split(' ');\n            //     }\n            //     value = value.map((v: string | number) => {\n            //         if (typeof v === 'string') return Number.parseInt(v);\n            //         return v;\n            //     });\n            //     if (value.length == 1) {\n            //         this._padLeft =\n            //             this._padRight =\n            //             this._padTop =\n            //             this._padBottom =\n            //                 value[0];\n            //     } else if (value.length == 2) {\n            //         this._padLeft = this._padRight = value[1];\n            //         this._padTop = this._padBottom = value[0];\n            //     } else if (value.length == 3) {\n            //         this._padTop = value[0];\n            //         this._padRight = value[1];\n            //         this._padBottom = value[2];\n            //         this._padLeft = value[1];\n            //     } else if (value.length == 4) {\n            //         this._padTop = value[0];\n            //         this._padRight = value[1];\n            //         this._padBottom = value[2];\n            //         this._padLeft = value[3];\n            //     }\n            // } else if (key === 'margin') {\n            //     if (typeof value === 'number') {\n            //         value = [value];\n            //     } else if (typeof value === 'string') {\n            //         value = value.split(' ');\n            //     }\n            //     value = value.map((v: string | number) => {\n            //         if (typeof v === 'string') return Number.parseInt(v);\n            //         return v;\n            //     });\n            //     if (value.length == 1) {\n            //         this._marginLeft =\n            //             this._marginRight =\n            //             this._marginTop =\n            //             this._marginBottom =\n            //                 value[0];\n            //     } else if (value.length == 2) {\n            //         this._marginLeft = this._marginRight = value[1];\n            //         this._marginTop = this._marginBottom = value[0];\n            //     } else if (value.length == 3) {\n            //         this._marginTop = value[0];\n            //         this._marginRight = value[1];\n            //         this._marginBottom = value[2];\n            //         this._marginLeft = value[1];\n            //     } else if (value.length == 4) {\n            //         this._marginTop = value[0];\n            //         this._marginRight = value[1];\n            //         this._marginBottom = value[2];\n            //         this._marginLeft = value[3];\n            //     }\n            // } else {\n            const field = '_' + key;\n            if (typeof value === 'string') {\n                if (value.match(/^[+-]?\\d+$/)) {\n                    value = Number.parseInt(value);\n                }\n                else if (value === 'true') {\n                    value = true;\n                }\n                else if (value === 'false') {\n                    value = false;\n                }\n            }\n            this[field] = value;\n            // }\n        }\n        else if (key instanceof Style) {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (name === 'selector' || name === '_dirty')\n                    return;\n                if (value !== undefined && value !== null) {\n                    this[name] = value;\n                }\n                else if (value === null) {\n                    this.unset(name);\n                }\n            });\n        }\n        else {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (value === null) {\n                    this.unset(name);\n                }\n                else {\n                    this.set(name, value, setDirty);\n                }\n            });\n        }\n        this.dirty || (this.dirty = setDirty);\n        return this;\n    }\n    unset(key) {\n        const field = key.startsWith('_') ? key : '_' + key;\n        delete this[field];\n        this.dirty = true;\n        return this;\n    }\n    clone() {\n        const other = new this.constructor();\n        other.copy(this);\n        return other;\n    }\n    copy(other) {\n        Object.assign(this, other);\n        return this;\n    }\n}\nexport function makeStyle(style, selector = '$') {\n    const opts = {};\n    const parts = style\n        .trim()\n        .split(';')\n        .map((p) => p.trim());\n    parts.forEach((p) => {\n        const [name, base] = p.split(':').map((p) => p.trim());\n        if (!name)\n            return;\n        const baseParts = base.split(/ +/g);\n        if (baseParts.length == 1) {\n            // @ts-ignore\n            opts[name] = base;\n        }\n        else {\n            // @ts-ignore\n            opts[name] = baseParts;\n        }\n    });\n    return new Style(selector, opts);\n}\n// const NO_BOUNDS = ['fg', 'bg', 'depth', 'align', 'valign'];\n// export function affectsBounds(key: keyof StyleOptions): boolean {\n//     return !NO_BOUNDS.includes(key);\n// }\nexport class ComputedStyle extends Style {\n    // constructor(source: Stylable, sources?: Style[]) {\n    constructor(sources) {\n        super();\n        // obj: Stylable;\n        this.sources = [];\n        // this.obj = source;\n        if (sources) {\n            // sort low to high priority (highest should be this.obj._style, lowest = global default:'*')\n            sources.sort((a, b) => a.selector.priority - b.selector.priority);\n            this.sources = sources;\n        }\n        this.sources.forEach((s) => super.set(s));\n        this._dirty = false; // As far as I know I reflect all of the current source values.\n    }\n    get dirty() {\n        return this._dirty || this.sources.some((s) => s.dirty);\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n}\nexport class Sheet {\n    constructor(parentSheet) {\n        this.rules = [];\n        this._dirty = true;\n        if (parentSheet === undefined) {\n            parentSheet = defaultStyle;\n        }\n        if (parentSheet) {\n            this.rules = parentSheet.rules.slice();\n        }\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (!this._dirty) {\n            this.rules.forEach((r) => (r.dirty = false));\n        }\n    }\n    add(selector, props) {\n        if (selector.includes(',')) {\n            selector\n                .split(',')\n                .map((p) => p.trim())\n                .forEach((p) => this.add(p, props));\n            return this;\n        }\n        if (selector.includes(' '))\n            throw new Error('Hierarchical selectors not supported.');\n        // if 2 '.' - Error('Only single class rules supported.')\n        // if '&' - Error('Not supported.')\n        let rule = new Style(selector, props);\n        const existing = this.rules.findIndex((s) => s.selector.text === rule.selector.text);\n        if (existing > -1) {\n            const current = this.rules[existing];\n            current.set(rule);\n            rule = current;\n        }\n        else {\n            this.rules.push(rule);\n        }\n        // rulesChanged = true;\n        this.dirty = true;\n        return this;\n    }\n    get(selector) {\n        return this.rules.find((s) => s.selector.text === selector) || null;\n    }\n    remove(selector) {\n        const existing = this.rules.findIndex((s) => s.selector.text === selector);\n        if (existing > -1) {\n            this.rules.splice(existing, 1);\n            this.dirty = true;\n        }\n    }\n    computeFor(widget) {\n        const sources = this.rules.filter((r) => r.selector.matches(widget));\n        const widgetStyle = widget.style();\n        if (widgetStyle) {\n            sources.push(widgetStyle);\n        }\n        widgetStyle.dirty = false;\n        return new ComputedStyle(sources);\n    }\n}\nexport const defaultStyle = new Sheet(null);\n","import * as GWU from 'gw-utils';\nexport class Widget {\n    constructor(id, opts) {\n        this.active = false;\n        this.hovered = false;\n        this.tabStop = false;\n        this.depth = 0;\n        this.fg = 0xfff;\n        this.bg = -1;\n        this.activeFg = 0xfff;\n        this.activeBg = -1;\n        this.hoverFg = 0xfff;\n        this.hoverBg = -1;\n        this.text = '';\n        this.align = 'left';\n        this.valign = 'middle';\n        this.bounds = new GWU.xy.Bounds(-1, -1, -1, -1); // nothing set\n        this.id = id;\n        if (opts)\n            this.init(opts);\n        this.reset();\n    }\n    init(opts) {\n        if (opts.x !== undefined)\n            this.bounds.x = opts.x;\n        if (opts.y !== undefined)\n            this.bounds.y = opts.y;\n        if (opts.width !== undefined)\n            this.bounds.width = opts.width;\n        if (opts.height !== undefined)\n            this.bounds.height = opts.height;\n        if (opts.depth !== undefined)\n            this.depth = opts.depth;\n        if (opts.text) {\n            this.text = opts.text;\n            if (this.bounds.width <= 0)\n                this.bounds.width = opts.text.length;\n            if (this.bounds.height <= 0)\n                this.bounds.height = 1;\n        }\n        if (this.bounds.height <= 0)\n            this.bounds.height = 1;\n        if (opts.fg !== undefined) {\n            this.fg = opts.fg;\n            this.activeFg = opts.fg;\n            this.hoverFg = opts.fg;\n        }\n        if (opts.bg !== undefined) {\n            this.bg = opts.bg;\n            this.activeBg = opts.bg;\n            this.hoverBg = opts.bg;\n        }\n        if (opts.activeFg !== undefined) {\n            this.activeFg = opts.activeFg;\n            this.hoverFg = opts.activeFg;\n        }\n        if (opts.activeBg !== undefined) {\n            this.activeBg = opts.activeBg;\n            this.hoverBg = opts.activeBg;\n        }\n        if (opts.hoverFg !== undefined)\n            this.hoverFg = opts.hoverFg;\n        if (opts.hoverBg !== undefined)\n            this.hoverBg = opts.hoverBg;\n        if (opts.tabStop !== undefined)\n            this.tabStop = opts.tabStop;\n        this.action = opts.action || this.id;\n    }\n    reset() { }\n    activate(_reverse = false) {\n        this.active = true;\n    }\n    deactivate() {\n        this.active = false;\n    }\n    contains(x, y) {\n        if (arguments.length == 1)\n            return this.bounds.contains(x);\n        return this.bounds.contains(x, y);\n    }\n    // EVENTS\n    // returns true if mouse is over this widget\n    mousemove(e, _dialog) {\n        this.hovered = this.contains(e);\n        return this.hovered;\n    }\n    tick(_e, _dialog) { }\n    // returns true if click is handled by this widget (stopPropagation)\n    click(_e, _dialog) {\n        return false;\n    }\n    // returns true if key is used by widget and you want to stopPropagation\n    keypress(_e, _dialog) {\n        return false;\n    }\n    // returns true if key is used by widget and you want to stopPropagation\n    dir(_e, _dialog) {\n        return false;\n    }\n    // DRAW\n    draw(buffer) {\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        const textLen = GWU.text.length(this.text);\n        if (this.bounds.width > textLen || this.bounds.height > 1) {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', fg, bg);\n        }\n        let x = this.bounds.x;\n        if (this.align == 'center') {\n            x += Math.floor((this.bounds.width - textLen) / 2);\n        }\n        else if (this.align == 'right') {\n            x += this.bounds.width - textLen;\n        }\n        let y = this.bounds.y; // 'top'\n        if (this.bounds.height > 1) {\n            if (this.valign == 'middle') {\n                y += Math.floor(this.bounds.height / 2);\n            }\n            else if (this.valign == 'bottom') {\n                y += this.bounds.height - 1;\n            }\n        }\n        buffer.drawText(x, y, this.text, fg, bg);\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Text extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        // if (!opts.text)\n        //     throw new Error(\n        //         'Must have text value in config for Text widget - ' + this.id\n        //     );\n        this.text = opts.text || '';\n        if (opts.wrap) {\n            this.wrap = true;\n            opts.width = opts.wrap;\n            this.lines = GWU.text.splitIntoLines(this.text, \n            // @ts-ignore\n            opts.width);\n        }\n        else {\n            const textLen = GWU.text.length(this.text);\n            opts.width = opts.width || textLen || 10;\n            if (opts.width < textLen) {\n                opts.text = GWU.text.truncate(this.text, opts.width);\n            }\n            this.lines = [this.text];\n        }\n        opts.height = Math.max(this.lines.length, opts.height || 1);\n        super.init(opts);\n    }\n    setText(text) {\n        this.text = text;\n        if (this.wrap) {\n            this.lines = GWU.text.splitIntoLines(this.text, this.bounds.width);\n        }\n        else {\n            const textLen = GWU.text.length(this.text);\n            if (textLen > this.bounds.width) {\n                this.text = GWU.text.truncate(this.text, this.bounds.width);\n            }\n            this.lines = [this.text];\n        }\n    }\n    // TODO - get text() {}, set text(v:string) { // do lines stuff }\n    draw(buffer) {\n        const fg = this.active ? this.activeFg : this.fg;\n        const bg = this.active ? this.activeBg : this.bg;\n        this.lines.forEach((line, i) => {\n            buffer.drawText(this.bounds.x, this.bounds.y + i, line, fg, bg, this.bounds.width);\n        });\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Button extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        if (!opts.text)\n            throw new Error('Must have text value in config for Button widget - ' + this.id);\n        opts.tabStop = GWU.first(opts.tabStop, true); // Can receive input (Enter)\n        super.init(opts);\n    }\n    async click(ev, dialog) {\n        if (!this.contains(ev))\n            return false;\n        await dialog.fireAction(this.action, this);\n        return true;\n    }\n    async keypress(ev, dialog) {\n        if (!ev.key)\n            return false;\n        if (ev.key === 'Enter') {\n            await dialog.fireAction(this.action, this);\n            return true;\n        }\n        return false;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Input extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        this.minLength = opts.minLength || 1;\n        if (!opts.width) {\n            opts.width = Math.max(this.minLength, 10);\n        }\n        opts.tabStop = GWU.first(opts.tabStop, true); // Need to receive input\n        super.init(opts);\n        this.default = opts.default || '';\n        this.errorFg = opts.errorFg || this.fg;\n        this.hint = opts.hint || '';\n        this.hintFg = opts.hintFg || this.errorFg;\n        this.numbersOnly = opts.numbersOnly || false;\n        this.min = GWU.first(opts.min, Number.MIN_SAFE_INTEGER);\n        this.max = GWU.first(opts.max, Number.MAX_SAFE_INTEGER);\n        if (this.bounds.width <= 0) {\n            if (this.hint)\n                this.bounds.width = this.hint.length;\n            if (this.default)\n                this.bounds.width = this.default.length;\n        }\n        if (this.bounds.height <= 0) {\n            this.bounds.height = 1;\n        }\n        this.reset();\n    }\n    reset() {\n        this.text = this.default;\n    }\n    isValid() {\n        if (this.numbersOnly) {\n            const val = Number.parseInt(this.text);\n            if (this.min !== undefined && val < this.min)\n                return false;\n            if (this.max !== undefined && val > this.max)\n                return false;\n            return val > 0;\n        }\n        return this.text.length >= this.minLength;\n    }\n    get value() {\n        if (this.numbersOnly)\n            return Number.parseInt(this.text);\n        return this.text;\n    }\n    keypress(ev, dialog) {\n        const textEntryBounds = this.numbersOnly ? ['0', '9'] : [' ', '~'];\n        if (!ev.key)\n            return false;\n        if (ev.key === 'Enter' && this.isValid()) {\n            const r = dialog.fireAction(this.action, this);\n            if (r)\n                return r.then(() => true);\n            return true;\n        }\n        if (ev.key == 'Delete' || ev.key == 'Backspace') {\n            if (this.text.length) {\n                this.text = GWU.text.spliceRaw(this.text, this.text.length - 1, 1);\n            }\n            return true;\n        }\n        else if (ev.key.length > 1) {\n            // ignore other special keys...\n            return false;\n        }\n        // eat/use all other keys\n        if (ev.key >= textEntryBounds[0] && ev.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            if (this.text.length < this.bounds.width) {\n                this.text += ev.key;\n            }\n        }\n        return true;\n    }\n    draw(buffer) {\n        const x = this.bounds.x;\n        const y = this.bounds.y;\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        buffer.fillRect(x, y, this.bounds.width, 1, ' ', fg, bg);\n        if (!this.text.length && this.hint && this.hint.length) {\n            buffer.drawText(x, y, this.hint, this.hintFg);\n        }\n        else {\n            const color = this.isValid() ? fg : this.errorFg;\n            buffer.drawText(x, y, this.text, color);\n        }\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Column {\n    constructor(opts) {\n        this.active = false;\n        this.hovered = false;\n        this.fg = null;\n        this.bg = null;\n        this.activeFg = null;\n        this.activeBg = null;\n        this.hoverFg = null;\n        this.hoverBg = null;\n        this.align = 'left';\n        this.header = '';\n        this.empty = '';\n        this._value = GWU.IDENTITY;\n        // align: Widget.Align = 'left';\n        // valign: Widget.VAlign = 'middle';\n        // hover: HoverType = 'cell';\n        this.x = -1;\n        this.width = -1;\n        this.index = -1;\n        GWU.object.assignOmitting('value', this, opts);\n        if (this.width <= 0) {\n            this.width = this.header.length || 1;\n        }\n        if (typeof opts.value === 'string') {\n            this._value = GWU.text.compile(opts.value);\n        }\n        else {\n            this._value = opts.value || GWU.IDENTITY;\n        }\n        if (opts.align)\n            this.align = opts.align;\n    }\n    value(data, index) {\n        const v = this._value(data, index);\n        return GWU.text.truncate(v, this.width);\n    }\n}\nexport class Table extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.data = null;\n        this.selectedColumn = null;\n        this.selectedIndex = -1;\n    }\n    init(opts) {\n        if (!opts.height)\n            throw new Error('Height is required.');\n        if (!opts.columns || opts.columns.length == 0)\n            throw new Error('Must have at least 1 column.');\n        opts.tabStop = GWU.first(opts.tabStop, true);\n        super.init(opts);\n        this.headers = GWU.first(opts.headers, true);\n        this.letters = GWU.first(opts.letters, true);\n        this.columns = [];\n        this.hoverType = opts.hover || 'row';\n        this.wrapColumns = GWU.first(opts.wrapColumns, opts.wrap, true);\n        this.wrapRows = GWU.first(opts.wrapRows, opts.wrap, true);\n        this.headerFg = opts.headerFg || this.fg;\n        this.headerBg = opts.headerBg || this.bg;\n        let columnWidth = 0;\n        if (opts.letters) {\n            this.columns.push(new Column({\n                width: 2,\n                value: (_data, index) => {\n                    const letter = String.fromCharCode(97 + index);\n                    return letter + ')';\n                },\n            }));\n            columnWidth += 2;\n        }\n        if (opts.columns) {\n            opts.columns.forEach((c) => {\n                const col = new Column(c);\n                this.columns.push(col);\n                columnWidth += col.width;\n            });\n        }\n        this.columns.forEach((c, i) => (c.index = i));\n        // scrolling?  paging?  fixed columns/headers?\n        this.bounds.width =\n            this.bounds.width > 0 ? this.bounds.width : columnWidth;\n    }\n    setData(data) {\n        this.data = data;\n        this.selectedIndex = -1;\n    }\n    selectRow(index) {\n        if (!this.data)\n            return false;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        if (index >= len)\n            return false;\n        if (index < -1)\n            return false;\n        this.selectedIndex = index;\n        return true;\n    }\n    selectNextRow(wrap = true) {\n        if (!this.data)\n            return -1;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        this.selectedIndex = GWU.nextIndex(this.selectedIndex, len, wrap);\n        if (this.selectedIndex > -1 && !this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        return this.selectedIndex;\n    }\n    selectPrevRow(wrap = true) {\n        if (!this.data)\n            return -1;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        this.selectedIndex = GWU.prevIndex(this.selectedIndex, len, wrap);\n        if (this.selectedIndex > -1 && !this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        return this.selectedIndex;\n    }\n    selectNextColumn(wrap = true) {\n        if (!this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        else {\n            let index = GWU.nextIndex(this.selectedColumn.index, this.columns.length, wrap);\n            this.selectedColumn = this.columns[index] || null;\n        }\n        if (this.selectedColumn && this.selectedIndex < 0 && this.data) {\n            this.selectedIndex = 0;\n        }\n        return this.selectedColumn;\n    }\n    selectPrevColumn(wrap = true) {\n        if (!this.selectedColumn) {\n            this.selectedColumn = this.columns[this.columns.length - 1]; // last column\n        }\n        else {\n            let index = GWU.prevIndex(this.selectedColumn.index, this.columns.length, wrap);\n            this.selectedColumn = this.columns[index] || null;\n        }\n        if (this.selectedColumn && this.selectedIndex < 0 && this.data) {\n            this.selectedIndex = 0;\n        }\n        return this.selectedColumn;\n    }\n    get selectedData() {\n        if (!this.data)\n            return null;\n        if (Array.isArray(this.data)) {\n            return this.data[this.selectedIndex] || null;\n        }\n        else {\n            return GWU.list.at(this.data, this.selectedIndex);\n        }\n    }\n    draw(buffer) {\n        const b = this.bounds;\n        buffer.fillRect(b.x, b.y, b.width, b.height, ' ', this.bg, this.bg);\n        let x = b.x;\n        this.columns.forEach((col) => {\n            this.drawColumn(buffer, col, x);\n            x += col.width;\n        });\n    }\n    drawColumn(buffer, column, x) {\n        let y = this.bounds.y;\n        if (column.header) {\n            buffer.fillRect(x, y, column.width, 1, ' ', this.headerFg, this.headerBg);\n            buffer.drawText(x, y, column.header, this.headerFg, this.headerBg, column.width, column.align);\n            ++y;\n        }\n        if (!this.data)\n            return;\n        if (Array.isArray(this.data)) {\n            this.data.forEach((item, index) => {\n                this.drawCell(buffer, column, item, index, x, y);\n                ++y;\n            });\n        }\n        else {\n            GWU.list.forEach(this.data, (item, index) => {\n                this.drawCell(buffer, column, item, index, x, y);\n                ++y;\n            });\n        }\n    }\n    drawCell(buffer, column, data, index, x, y) {\n        if (y > this.bounds.bottom)\n            return;\n        let text = column._value(data, index);\n        if (text.length == 0) {\n            text = column.empty;\n        }\n        // pick color...\n        let fg = this.fg;\n        let bg = this.bg;\n        if (this.hoverType === 'row') {\n            if (index === this.selectedIndex) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        else if (this.hoverType === 'column') {\n            if (column === this.selectedColumn) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        else if (this.hoverType === 'cell') {\n            if (column === this.selectedColumn &&\n                index === this.selectedIndex) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        buffer.fillRect(x, y, column.width, 1, ' ', bg, bg);\n        buffer.drawText(x, y, text, fg, bg, column.width, column.align);\n    }\n    async mousemove(e, dialog) {\n        if (!super.mousemove(e, dialog)) {\n            return false;\n        }\n        const oldColumn = this.selectedColumn;\n        const oldIndex = this.selectedIndex;\n        let x = e.x - this.bounds.x;\n        const column = (this.selectedColumn =\n            this.columns.find((c) => {\n                if (c.width >= x)\n                    return true;\n                x -= c.width;\n                return false;\n            }) || null);\n        let index = -1;\n        if (this.data) {\n            index = e.y - this.bounds.y - (this.headers ? 1 : 0);\n            if (Array.isArray(this.data)) {\n                if (index >= this.data.length)\n                    index = -1;\n            }\n        }\n        this.selectedIndex = index;\n        if (oldColumn !== column || oldIndex !== index) {\n            dialog.fireAction(this.id + '_HOVER', this);\n            dialog.requestRedraw();\n        }\n        return true;\n    }\n    dir(e) {\n        if (!e.dir)\n            return false;\n        if (e.dir[0] > 0) {\n            this.selectNextColumn(this.wrapColumns);\n        }\n        else if (e.dir[0] < 0) {\n            this.selectPrevColumn(this.wrapColumns);\n        }\n        if (e.dir[1] > 0) {\n            this.selectNextRow(this.wrapRows);\n        }\n        else if (e.dir[1] < 0) {\n            this.selectPrevRow(this.wrapRows);\n        }\n        return true;\n    }\n}\nexport function makeTable(id, opts) {\n    return new Table(id, opts);\n}\n","import * as Widget from './widget';\nexport class Box extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, (() => {\n            if (!opts)\n                return opts;\n            if (opts.depth === undefined)\n                opts.depth = -10; // hide behind other widgets\n            if (opts.title)\n                opts.text = opts.title;\n            opts.bg = opts.bg || 'gray';\n            return opts;\n        })());\n    }\n    init(opts) {\n        super.init(opts);\n        this.borderBg = opts.borderBg || null;\n    }\n    // EVENTS\n    // box is completely idle\n    mousemove(_e, _dialog) {\n        return false;\n    }\n    // DRAW\n    draw(buffer) {\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        // Draw dialog\n        if (this.borderBg) {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.borderBg, this.borderBg);\n            buffer.fillRect(this.bounds.x + 1, this.bounds.y + 1, this.bounds.width - 2, this.bounds.height - 2, ' ', bg, bg);\n        }\n        else {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', bg, bg);\n        }\n        if (this.text) {\n            buffer.drawText(this.bounds.x, this.bounds.y, this.text, fg, -1, this.bounds.width, 'center');\n        }\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Box from './box';\nexport class Dialog {\n    constructor(ui, id) {\n        // bounds: GWU.xy.Bounds;\n        this.widgets = [];\n        this.eventHandlers = {};\n        this._activeWidget = null;\n        this.result = null;\n        this.done = false;\n        this.timers = {};\n        this.needsRedraw = true;\n        this.ui = ui;\n        this.id = id || 'DIALOG';\n        // this.bounds = new GWU.xy.Bounds(-1, -1, 0, 0);\n        // if (opts) this.init(opts);\n    }\n    init() {\n        // if (opts.id) this.id = opts.id;\n        // if (opts.x !== undefined) this.bounds.x = opts.x;\n        // if (opts.y !== undefined) this.bounds.y = opts.y;\n        // if (opts.height !== undefined) this.bounds.height = opts.height;\n        // if (opts.width !== undefined) this.bounds.width = opts.width;\n        // if (opts.box) {\n        //     let boxOpts: Box.BoxOptions = {\n        //         fg: 'white',\n        //         bg: 'gray',\n        //         borderBg: 'dark_gray',\n        //         width: this.bounds.width,\n        //         height: this.bounds.height,\n        //         x: this.bounds.x,\n        //         y: this.bounds.y,\n        //     };\n        //     if (opts.box !== true) {\n        //         Object.assign(boxOpts, opts.box);\n        //     }\n        //     const box = new Box.Box(this.id + '_BOX', boxOpts);\n        //     this.widgets.push(box);\n        // }\n        // if (opts.widgets) {\n        //     opts.widgets.forEach((w) => this.widgets.push(w));\n        // }\n        this.widgets.sort((a, b) => (a.depth < b.depth ? -1 : 1));\n    }\n    get activeWidget() {\n        return this._activeWidget;\n    }\n    setActiveWidget(w, reverse = false) {\n        if (w === this._activeWidget)\n            return;\n        if (this._activeWidget) {\n            this._activeWidget.deactivate();\n        }\n        this._activeWidget = w;\n        if (this._activeWidget) {\n            this._activeWidget.activate(reverse);\n        }\n    }\n    // contains(e: GWU.xy.XY): boolean {\n    //     return this.bounds.contains(e);\n    // }\n    requestRedraw() {\n        this.needsRedraw = true;\n    }\n    setTimeout(action, time) {\n        this.timers[action] = time;\n    }\n    clearTimeout(action) {\n        delete this.timers[action];\n    }\n    async fireAction(action, widget) {\n        const handler = this.eventHandlers[action];\n        if (handler) {\n            await handler(action, this, widget);\n        }\n    }\n    // Multiple calls result in adding more handlers\n    setEventHandlers(map) {\n        Object.assign(this.eventHandlers, map);\n    }\n    async show() {\n        this.done = false;\n        // reset any temp data...\n        this.widgets.forEach((w) => w.reset());\n        // first tabStop is the starting active Widget\n        this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n        // start dialog\n        const buffer = this.ui.startLayer();\n        // run input loop\n        await this.ui.loop.run({\n            keypress: this.keypress.bind(this),\n            dir: this.dir.bind(this),\n            mousemove: this.mousemove.bind(this),\n            click: this.click.bind(this),\n            tick: this.tick.bind(this),\n            draw: () => {\n                this.draw(buffer);\n                buffer.render();\n            },\n        }, 100);\n        // stop dialog\n        this.ui.finishLayer();\n        return this.result;\n    }\n    close(returnValue) {\n        this.result = returnValue;\n        this.done = true;\n    }\n    widgetAt(x, y) {\n        return (this.widgets.find((w) => w.contains(x, y) && w.depth >= 0) || null);\n    }\n    getWidget(id) {\n        return this.widgets.find((w) => w.id === id) || null;\n    }\n    nextTabstop() {\n        if (!this.activeWidget) {\n            this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n            return !!this.activeWidget;\n        }\n        const next = GWU.arrayNext(this.widgets, this.activeWidget, (w) => w.tabStop);\n        if (next) {\n            this.setActiveWidget(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabstop() {\n        if (!this.activeWidget) {\n            this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n            return !!this.activeWidget;\n        }\n        const prev = GWU.arrayPrev(this.widgets, this.activeWidget, (w) => w.tabStop);\n        if (prev) {\n            this.setActiveWidget(prev, true);\n            return true;\n        }\n        return false;\n    }\n    async tick(e) {\n        const dt = e.dt;\n        let promises = [];\n        Object.entries(this.timers).forEach(([action, time]) => {\n            time -= dt;\n            if (time <= 0) {\n                delete this.timers[action];\n                promises.push(this.fireAction(action, null));\n            }\n            else {\n                this.timers[action] = time;\n            }\n        });\n        for (let w of this.widgets) {\n            promises.push(w.tick(e, this));\n        }\n        if (promises.length) {\n            return Promise.all(promises).then(() => this.done);\n        }\n        return this.done;\n    }\n    // TODO - async - to allow animations or events on mouseover?\n    async mousemove(e) {\n        // this.setActiveWidget(null);\n        await Promise.all(this.widgets.map(async (w) => {\n            await w.mousemove(e, this);\n            if (w.hovered && w.tabStop) {\n                this.setActiveWidget(w);\n            }\n        }));\n        return this.done;\n    }\n    async click(e) {\n        // this.mousemove(e); // make sure activeWidget is set correctly\n        // if (!this.contains(e)) {\n        //     return false;\n        // }\n        const widget = this.widgetAt(e.x, e.y);\n        let fn = null;\n        if (widget) {\n            if (await widget.click(e, this)) {\n                return this.done;\n            }\n            fn = this.eventHandlers[widget.id];\n        }\n        fn = fn || this.eventHandlers[this.id] || this.eventHandlers.click;\n        if (fn) {\n            await fn(e, this, this.activeWidget);\n        }\n        return this.done;\n    }\n    async keypress(e) {\n        if (!e.key)\n            return false;\n        if (this.activeWidget) {\n            if (await this.activeWidget.keypress(e, this)) {\n                return this.done;\n            }\n        }\n        const fn = this.eventHandlers[e.key] ||\n            this.eventHandlers[e.code] ||\n            this.eventHandlers.keypress;\n        if (fn) {\n            if (await fn(e, this, this.activeWidget)) {\n                return this.done;\n            }\n        }\n        if (e.key === 'Tab') {\n            // Next widget\n            this.nextTabstop();\n            return false; // not done\n        }\n        else if (e.key === 'TAB') {\n            // Prev Widget\n            this.prevTabstop();\n            return false; // not done\n        }\n        return this.done;\n    }\n    async dir(e) {\n        if (this.activeWidget) {\n            if (await this.activeWidget.dir(e, this)) {\n                return this.done;\n            }\n        }\n        const fn = this.eventHandlers.dir || this.eventHandlers.keypress;\n        if (fn) {\n            await fn(e, this, this.activeWidget);\n        }\n        return this.done;\n    }\n    draw(buffer, force = false) {\n        if (!this.needsRedraw && !force)\n            return;\n        this.ui.resetLayerBuffer();\n        this.widgets.forEach((w) => w.draw(buffer));\n    }\n}\nexport class DialogBuilder {\n    constructor(ui, width, height) {\n        this.nextY = 0;\n        this.box = null;\n        this.nextY = 1;\n        this.dialog = new Dialog(ui);\n        this.bounds = new GWU.xy.Bounds(-1, -1, width, height);\n    }\n    with(widget, at) {\n        // widget bounds are set relative to the dialog top left,\n        // if we don't get any, help them out\n        // TODO - Get rid of x, y\n        const bounds = this.bounds;\n        if (at) {\n            if (at.right !== undefined) {\n                bounds.width = Math.max(bounds.width, widget.bounds.width + at.right);\n                widget.bounds.right = bounds.width - at.right - 1;\n            }\n            else {\n                widget.bounds.x = at.x || 0;\n                bounds.width = Math.max(bounds.width, widget.bounds.width + widget.bounds.x);\n            }\n            if (at.bottom !== undefined) {\n                bounds.height = Math.max(bounds.height, widget.bounds.height + at.bottom);\n                widget.bounds.bottom = bounds.height - at.bottom - 1;\n            }\n            else {\n                widget.bounds.y = at.y || 0;\n                bounds.height = Math.max(bounds.height, widget.bounds.height + widget.bounds.y);\n            }\n        }\n        else {\n            bounds.width = Math.max(bounds.width, widget.bounds.right);\n            bounds.height = Math.max(bounds.height, widget.bounds.bottom);\n        }\n        this.dialog.widgets.push(widget);\n        this.nextY = Math.max(this.nextY, widget.bounds.bottom + 1);\n        return this;\n    }\n    center() {\n        const size = this.dialog.ui.buffer;\n        const bounds = this.bounds;\n        bounds.x = Math.floor((size.width - bounds.width) / 2);\n        bounds.y = Math.floor((size.height - bounds.height) / 2);\n        return this;\n    }\n    place(x, y) {\n        const bounds = this.bounds;\n        bounds.x = x;\n        bounds.y = y;\n        return this;\n    }\n    addBox(opts) {\n        this.box = opts || {};\n        return this;\n    }\n    done() {\n        if (this.bounds.x < 0)\n            this.bounds.x = 0;\n        if (this.bounds.y < 0)\n            this.bounds.y = 0;\n        if (this.bounds.right > this.dialog.ui.buffer.width)\n            throw new Error('Dialog is off screen!');\n        if (this.bounds.bottom > this.dialog.ui.buffer.height)\n            throw new Error('Dialog is off screen!');\n        if (this.box) {\n            const padX = this.box.padX || this.box.pad || 1;\n            const padY = this.box.padY || this.box.pad || 1;\n            this.box.x = 0;\n            this.box.y = 0;\n            this.box.width = this.bounds.width + 2 * padX;\n            this.box.height = this.bounds.height + 2 * padY;\n            const widget = new Box.Box(this.dialog.id + '_BOX', this.box);\n            this.dialog.widgets.forEach((w) => {\n                w.bounds.x += padX;\n                w.bounds.y += padY;\n            });\n            this.dialog.widgets.unshift(widget);\n        }\n        // lock in locations\n        this.dialog.widgets.forEach((w) => {\n            w.bounds.x += this.bounds.x;\n            w.bounds.y += this.bounds.y;\n        });\n        return this.dialog;\n    }\n}\nexport function buildDialog(ui, width = 0, height = 0) {\n    return new DialogBuilder(ui, width, height);\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from './widget';\nGWU.color.install('flavorText', 50, 40, 90);\nGWU.color.install('flavorPrompt', 100, 90, 20);\nexport class Flavor extends Widget.Text {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        opts.fg = opts.fg || 'flavorText';\n        opts.bg = opts.bg || 'black';\n        super.init(opts);\n        this.promptFg = GWU.color.from(opts.promptFg || 'flavorPrompt');\n        this.overflow = opts.overflow || false;\n        this.isPrompt = false;\n    }\n    showText(text) {\n        this.text = GWU.text.capitalize(text);\n        const len = GWU.text.length(this.text);\n        if (len > this.bounds.width) {\n            this.lines = GWU.text.splitIntoLines(this.text, this.bounds.width);\n            if (!this.overflow && this.lines.length > this.bounds.height) {\n                if (this.bounds.height == 1) {\n                    this.text = GWU.text.truncate(this.text, this.bounds.width);\n                    this.lines = [this.text];\n                }\n                else {\n                    this.lines.length = this.bounds.height;\n                }\n            }\n        }\n        else {\n            this.lines = [this.text];\n        }\n        this.isPrompt = false;\n    }\n    clear() {\n        this.text = '';\n        this.lines = [''];\n        this.isPrompt = false;\n    }\n    showPrompt(text) {\n        this.showText(text);\n        this.isPrompt = true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.bg, this.bg);\n        super.draw(buffer);\n    }\n    getFlavorText(map, x, y, fov) {\n        const cell = map.cell(x, y); // KNOWLEDGE / MEMORY !!!\n        let buf;\n        // let magicItem;\n        // let standsInTerrain;\n        // let subjectMoving;\n        // let prepositionLocked = false;\n        // let subject;\n        // let verb;\n        // let preposition;\n        let object = '';\n        // let adjective;\n        const isAnyKindOfVisible = fov ? fov.isAnyKindOfVisible(x, y) : true;\n        const isDirectlyVisible = fov ? fov.isDirectlyVisible(x, y) : true;\n        const isRemembered = fov ? fov.isRevealed(x, y) : false;\n        const isMapped = fov ? fov.isMagicMapped(x, y) : false;\n        let intro;\n        if (isDirectlyVisible) {\n            intro = 'you see';\n        }\n        else if (isAnyKindOfVisible) {\n            intro = 'you sense';\n        }\n        else if (isRemembered) {\n            intro = 'you remember';\n        }\n        else if (isMapped) {\n            intro = 'you expect to see';\n        }\n        else {\n            return '';\n        }\n        const actor = cell.hasActor() ? map.actorAt(x, y) : null;\n        // const player = actor?.isPlayer() ? actor : null;\n        const theItem = cell.hasItem() ? map.itemAt(x, y) : null;\n        const standsInTile = cell.hasTileFlag(GWM.flags.Tile.T_STAND_IN_TILE);\n        let needObjectArticle = false;\n        if (actor) {\n            object = actor.getFlavor({\n                color: false,\n                article: true,\n                action: true,\n            });\n            needObjectArticle = true;\n        }\n        else if (theItem) {\n            object = theItem.getFlavor({ color: false, article: true });\n            needObjectArticle = true;\n        }\n        let article = standsInTile ? ' in ' : ' on ';\n        const groundTile = cell.depthTile(GWM.flags.Depth.GROUND) || GWM.tile.tiles.NULL;\n        const surfaceTile = cell.depthTile(GWM.flags.Depth.SURFACE);\n        const liquidTile = cell.depthTile(GWM.flags.Depth.LIQUID);\n        // const gasTile = cell.depthTile(GWM.flags.Depth.GAS);\n        let surface = '';\n        if (surfaceTile) {\n            const tile = surfaceTile;\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' on ';\n            }\n            if (tile.hasTileFlag(GWM.flags.Tile.T_BRIDGE)) {\n                article = ' over ';\n            }\n            surface = surfaceTile.getFlavor() + article;\n        }\n        let liquid = '';\n        if (liquidTile) {\n            liquid = liquidTile.getFlavor() + ' covering ';\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' in ';\n            }\n        }\n        if (needObjectArticle) {\n            needObjectArticle = false;\n            object += ' on ';\n        }\n        let ground = groundTile.getFlavor({ article: true });\n        buf = GWU.text.apply('intro text.', {\n            intro,\n            text: object + surface + liquid + ground,\n        });\n        return buf;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from './widget';\nGWU.color.install('blueBar', 15, 10, 50);\nGWU.color.install('redBar', 45, 10, 15);\nGWU.color.install('purpleBar', 50, 0, 50);\nGWU.color.install('greenBar', 10, 50, 10);\nexport class EntryBase {\n    constructor() {\n        this.dist = 0;\n        this.priority = 0;\n        this.changed = false;\n        this.sidebarY = -1;\n    }\n    draw(_buffer, _bounds) {\n        return 0;\n    }\n}\nexport class ActorEntry extends EntryBase {\n    constructor(actor) {\n        super();\n        this.actor = actor;\n    }\n    get x() {\n        return this.actor.x;\n    }\n    get y() {\n        return this.actor.y;\n    }\n    draw(buffer, bounds) {\n        return this.actor.drawStatus(buffer, bounds);\n    }\n}\nexport class ItemEntry extends EntryBase {\n    constructor(item) {\n        super();\n        this.item = item;\n    }\n    get x() {\n        return this.item.x;\n    }\n    get y() {\n        return this.item.y;\n    }\n    draw(buffer, bounds) {\n        return this.item.drawStatus(buffer, bounds);\n    }\n}\nexport class CellEntry extends EntryBase {\n    constructor(cell) {\n        super();\n        this.cell = cell;\n    }\n    get x() {\n        return this.cell.x;\n    }\n    get y() {\n        return this.cell.y;\n    }\n    draw(buffer, bounds) {\n        return this.cell.drawStatus(buffer, bounds);\n    }\n}\nexport class Sidebar extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.cellCache = [];\n        this.lastX = -1;\n        this.lastY = -1;\n        this.lastMap = null;\n        this.entries = [];\n        this.subject = null;\n        this.highlight = null;\n    }\n    init(opts) {\n        opts.fg = opts.fg || 'purple';\n        opts.bg = opts.bg || 'black';\n        super.init(opts);\n    }\n    reset() {\n        super.reset();\n        this.lastMap = null;\n        this.lastX = -1;\n        this.lastY = -1;\n    }\n    entryAt(e) {\n        return (this.entries.find((entry) => {\n            return entry.sidebarY <= e.y && entry.sidebarY !== -1;\n        }) || null);\n    }\n    mousemove(e, dialog) {\n        super.mousemove(e, dialog);\n        if (this.contains(e)) {\n            return this.highlightRow(e.y);\n        }\n        return this.clearHighlight();\n    }\n    highlightRow(y) {\n        const last = this.highlight;\n        this.highlight = null;\n        // processed in ascending y order\n        this.entries.forEach((e) => {\n            if (e.sidebarY <= y && e.sidebarY !== -1) {\n                this.highlight = e;\n            }\n        });\n        return this.highlight !== last;\n    }\n    clearHighlight() {\n        const result = !!this.highlight;\n        this.highlight = null;\n        return result;\n    }\n    updateCellCache(map) {\n        if (this.lastMap &&\n            map === this.lastMap &&\n            !map.hasMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED)) {\n            return;\n        }\n        this.lastMap = null; // Force us to regather the entries, even if at same location\n        this.cellCache.length = 0;\n        GWU.xy.forRect(map.width, map.height, (x, y) => {\n            const info = map.cell(x, y);\n            if (info.hasEntityFlag(GWM.flags.Entity.L_LIST_IN_SIDEBAR)) {\n                this.cellCache.push(info);\n            }\n        });\n        map.clearMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED);\n    }\n    _makeActorEntry(actor) {\n        return new ActorEntry(actor);\n    }\n    _makeItemEntry(item) {\n        return new ItemEntry(item);\n    }\n    _makeCellEntry(cell) {\n        return new CellEntry(cell);\n    }\n    _getPriority(map, x, y, fov) {\n        if (!fov) {\n            return map.cell(x, y).hasCellFlag(GWM.flags.Cell.STABLE_MEMORY)\n                ? 3\n                : 1;\n        }\n        if (fov.isDirectlyVisible(x, y)) {\n            return 1;\n        }\n        else if (fov.isAnyKindOfVisible(x, y)) {\n            return 2;\n        }\n        else if (fov.isRevealed(x, y)) {\n            return 3;\n        }\n        return -1; // not visible, or revealed\n    }\n    _isDim(entry) {\n        if (entry === this.highlight)\n            return false;\n        return entry.priority > 2 || !!this.highlight;\n    }\n    _addActorEntry(actor, map, x, y, fov) {\n        const priority = this._getPriority(map, actor.x, actor.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeActorEntry(actor);\n        entry.dist = GWU.xy.distanceBetween(x, y, actor.x, actor.y);\n        entry.priority = actor.isPlayer() ? 0 : priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addItemEntry(item, map, x, y, fov) {\n        const priority = this._getPriority(map, item.x, item.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeItemEntry(item);\n        entry.dist = GWU.xy.distanceBetween(x, y, item.x, item.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addCellEntry(cell, map, x, y, fov) {\n        const priority = this._getPriority(map, cell.x, cell.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeCellEntry(cell);\n        entry.dist = GWU.xy.distanceBetween(x, y, cell.x, cell.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    findEntries(map, cx, cy, fov) {\n        if (map === this.lastMap && cx === this.lastX && cy === this.lastY)\n            return;\n        this.clearHighlight(); // If we are moving around the map, then turn off the highlight\n        this.lastMap = map;\n        this.lastX = cx;\n        this.lastY = cy;\n        this.entries.length = 0;\n        const done = GWU.grid.alloc(map.width, map.height);\n        map.eachActor((a) => {\n            const x = a.x;\n            const y = a.y;\n            if (done[x][y])\n                return;\n            if (this._addActorEntry(a, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        map.eachItem((i) => {\n            const x = i.x;\n            const y = i.y;\n            if (done[x][y])\n                return;\n            if (this._addItemEntry(i, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        this.cellCache.forEach((c) => {\n            if (done[c.x][c.y])\n                return;\n            if (this._addCellEntry(c, map, cx, cy, fov)) {\n                done[c.x][c.y] = 1;\n            }\n        });\n        this.entries.sort((a, b) => {\n            if (a.priority != b.priority) {\n                return a.priority - b.priority;\n            }\n            return a.dist - b.dist;\n        });\n        GWU.grid.free(done);\n    }\n    update() {\n        if (!this.subject) {\n            throw new Error('Update requires a subject to follow.');\n        }\n        return this.updateFor(this.subject);\n    }\n    updateFor(subject) {\n        return this.updateAt(subject.memory || subject.map, subject.x, subject.y, subject.fov);\n    }\n    updateAt(map, cx, cy, fov) {\n        this.updateCellCache(map);\n        this.findEntries(map, cx, cy, fov);\n        return true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, 0, 0, this.bg);\n        // clear the row information\n        this.entries.forEach((e) => (e.sidebarY = -1));\n        const drawBounds = this.bounds.clone();\n        let currentEntry;\n        for (let i = 0; i < this.entries.length && drawBounds.height > 0; ++i) {\n            currentEntry = this.entries[i];\n            currentEntry.sidebarY = drawBounds.y;\n            let usedLines = currentEntry.draw(buffer, drawBounds);\n            if (this._isDim(currentEntry)) {\n                buffer.mix(this.bg, 50, drawBounds.x, drawBounds.y, drawBounds.width, usedLines);\n            }\n            if (usedLines) {\n                ++usedLines; // skip a space\n                drawBounds.y += usedLines;\n                drawBounds.height -= usedLines;\n            }\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class MenuButton {\n    constructor(text) {\n        this.hovered = false;\n        this.x = 999;\n        this.text = text;\n    }\n    get width() {\n        return this.text.length;\n    }\n}\nexport class ActionButton extends MenuButton {\n    constructor(text, action) {\n        super(text);\n        this.action = action;\n    }\n}\nexport class DropDownButton extends MenuButton {\n    constructor(menu, parent, text, buttons) {\n        super(text);\n        this.buttons = [];\n        this.parent = null;\n        this.menu = menu;\n        this.parent = parent;\n        this.text = text;\n        this.bounds = new GWU.xy.Bounds(0, 0, 0, 0);\n        Object.entries(buttons).forEach(([text, opts]) => {\n            this.addButton(text, opts);\n        });\n    }\n    addButton(text, config) {\n        // if (this.buttons.length >= this.menu.bounds.height - 1) {\n        //     throw new Error('Too many menu options.');\n        // }\n        let button;\n        if (typeof config === 'string') {\n            button = new ActionButton(text, config);\n        }\n        else {\n            button = new DropDownButton(this.menu, this, text, config);\n        }\n        this.buttons.push(button);\n        ++this.bounds.height;\n        this.bounds.width = Math.max(this.bounds.width, text.length + 2);\n    }\n    setBounds(buffer, px, py, pw) {\n        // vertical reveal\n        const right = px + pw;\n        const totalWidth = buffer.width;\n        if (this.bounds.width < totalWidth - right) {\n            this.bounds.x = right;\n        }\n        else if (this.bounds.width < px) {\n            this.bounds.x = px - this.bounds.width;\n        }\n        else {\n            throw new Error('Menu does not fit - too wide.');\n        }\n        const totalHeight = buffer.height;\n        if (this.bounds.height <= totalHeight - py) {\n            this.bounds.y = py;\n        }\n        else if (this.bounds.height < totalHeight) {\n            this.bounds.y = totalHeight - this.bounds.height - 1;\n        }\n        else {\n            throw new Error('Menu does not fit - too tall.');\n        }\n        // this.buttons.forEach((b) => {\n        //     if (b instanceof DropDownButton) {\n        //         b.setBounds(buffer);\n        //     }\n        // });\n    }\n    contains(e) {\n        return this.bounds.contains(e);\n    }\n    buttonAt(e) {\n        const index = e.y - this.bounds.y;\n        return this.buttons[index] || null;\n    }\n    draw(buffer) {\n        const width = this.bounds.width;\n        const height = this.bounds.height;\n        const x = this.bounds.x;\n        let y = this.bounds.y;\n        buffer.fillRect(x, y, width, height, 0, 0, this.menu.dropBg);\n        // Now draw the individual buttons...\n        this.buttons.forEach((b) => {\n            buffer.drawText(x + 1, y, b.text, b.hovered ? this.menu.activeFg : this.menu.dropFg, b.hovered ? this.menu.activeBg : this.menu.dropBg);\n            ++y;\n        });\n        if (this.parent) {\n            this.parent.draw(buffer);\n        }\n    }\n}\nexport async function showDropDown(dialog, menu, button) {\n    // Start dialog\n    const ui = dialog.ui;\n    const buffer = ui.startLayer();\n    button.buttons.forEach((b) => (b.hovered = false));\n    // button.buttons[0].hovered = true;\n    let activeButton = button;\n    await ui.loop.run({\n        Escape() {\n            return true;\n        },\n        // TODO - Tab\n        Tab() {\n            menu.activeIndex = (menu.activeIndex + 1) % menu.buttons.length;\n            const button = menu.buttons[menu.activeIndex];\n            if (button) {\n                button.hovered = true;\n            }\n            if (activeButton && button instanceof DropDownButton) {\n                activeButton.hovered = false;\n                activeButton = button;\n            }\n            else {\n                activeButton = null; // done.\n            }\n            dialog.requestRedraw();\n            return !activeButton;\n        },\n        // TODO - TAB\n        TAB() {\n            menu.activeIndex =\n                (menu.buttons.length + menu.activeIndex - 1) %\n                    menu.buttons.length;\n            const button = menu.buttons[menu.activeIndex];\n            if (button) {\n                button.hovered = true;\n            }\n            if (activeButton && button instanceof DropDownButton) {\n                activeButton.hovered = false;\n                activeButton = button;\n            }\n            else {\n                activeButton = null; // done.\n            }\n            dialog.requestRedraw();\n            return !activeButton;\n        },\n        mousemove: (e) => {\n            if (!activeButton)\n                return true; // we are done (should not happen)\n            let newActive = activeButton;\n            while (newActive && !newActive.contains(e)) {\n                newActive = newActive.parent;\n            }\n            if (newActive) {\n                activeButton = newActive;\n                const selected = activeButton.buttonAt(e);\n                if (selected) {\n                    activeButton.buttons.forEach((b) => {\n                        b.hovered = false;\n                    });\n                    selected.hovered = true;\n                    if (selected instanceof DropDownButton) {\n                        selected.buttons.forEach((b) => {\n                            b.hovered = false;\n                        });\n                        selected.buttons[0].hovered = true;\n                        selected.setBounds(ui.buffer, activeButton.bounds.x, e.y, activeButton.bounds.width);\n                        activeButton = selected;\n                    }\n                }\n            }\n            else {\n                if (menu.contains(e)) {\n                    if (dialog)\n                        dialog.requestRedraw();\n                    const button = menu.getButtonAt(e.x, e.y);\n                    if (button) {\n                        button.hovered = true;\n                        menu.activeIndex = menu.buttons.indexOf(button);\n                    }\n                    if (button instanceof DropDownButton) {\n                        activeButton.hovered = false;\n                        activeButton = button;\n                    }\n                    else {\n                        activeButton = null; // done.\n                    }\n                    if (dialog)\n                        dialog.requestRedraw();\n                }\n            }\n            return !activeButton; // if no active button we are done (should not happen)\n        },\n        click: async (e) => {\n            if (!activeButton)\n                return true; // we are done (should not happen)\n            if (!activeButton.contains(e)) {\n                menu.clearHighlight();\n                return true; // we are done\n            }\n            const actionButton = activeButton.buttonAt(e);\n            if (!actionButton) {\n                return true; // weird, but we are done.\n            }\n            if (actionButton instanceof ActionButton) {\n                menu.actionButton = actionButton;\n                await dialog.fireAction(actionButton.action, menu);\n                return true;\n            }\n            return false;\n        },\n        dir: async (e) => {\n            if (!activeButton)\n                return true; // should not happen\n            if (!e.dir)\n                return;\n            if (e.dir[1]) {\n                const current = activeButton.buttons.findIndex((b) => b.hovered);\n                if (current < 1 && e.dir[1] < 0) {\n                    activeButton.buttons.forEach((b) => (b.hovered = false));\n                    return true; // close me!\n                }\n                const index = GWU.clamp(current + e.dir[1], 0, activeButton.buttons.length - 1);\n                activeButton.buttons.forEach((b, i) => (b.hovered = i === index));\n                const selected = activeButton.buttons[index];\n                if (selected instanceof DropDownButton) {\n                    selected.buttons.forEach((b) => {\n                        b.hovered = false;\n                    });\n                    selected.buttons[0].hovered = true;\n                    selected.setBounds(ui.buffer, activeButton.bounds.x, e.y, activeButton.bounds.width);\n                    activeButton = selected;\n                }\n            }\n        },\n        draw: () => {\n            if (!activeButton)\n                return;\n            ui.resetLayerBuffer();\n            activeButton.draw(buffer);\n            menu.draw(buffer);\n            buffer.render();\n        },\n    });\n    ui.finishLayer();\n    menu.clearHighlight();\n}\nexport class Menu extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.activeIndex = -1;\n        this.actionButton = null;\n    }\n    init(opts) {\n        opts.fg = GWU.first(opts.fg, 'black');\n        opts.bg = GWU.first(opts.bg, 'light_gray');\n        opts.height = opts.height || 1;\n        opts.tabStop = GWU.first(opts.tabStop, true);\n        super.init(opts);\n        this.dropFg = GWU.color.from(opts.dropFg || this.fg);\n        this.dropBg = GWU.color.from(opts.dropBg || this.bg);\n        this.buttons = [];\n        this.separator = opts.separator || ' | ';\n        this.lead = opts.lead || ' ';\n        Object.entries(opts.buttons).forEach(([text, opts]) => {\n            this._addButton(text, opts);\n        });\n        if (opts.separator) {\n            this.separator = opts.separator;\n        }\n        if (opts.lead !== undefined) {\n            this.lead = opts.lead ? opts.lead : '';\n        }\n    }\n    reset() {\n        super.reset();\n        const onTop = this.bounds.y <= 10;\n        this.buttons.forEach((b) => {\n            if (b instanceof DropDownButton) {\n                if (onTop) {\n                    b.bounds.top = this.bounds.bottom + 1;\n                }\n                else {\n                    b.bounds.bottom = this.bounds.top - 1;\n                }\n            }\n        });\n    }\n    activate(reverse = false) {\n        super.activate(reverse);\n        if (this.activeIndex < 0)\n            this.activeIndex = reverse ? this.buttons.length - 1 : 0;\n    }\n    deactivate() {\n        super.deactivate();\n        this.activeIndex = -1;\n    }\n    mousemove(e, dialog) {\n        // turn off all the hovers\n        this.buttons.forEach((b) => {\n            if (b.hovered) {\n                b.hovered = false;\n            }\n        });\n        if (!super.mousemove(e, dialog))\n            return false;\n        // highlight one of them...\n        if (this.bounds.contains(e)) {\n            let hovered = null;\n            this.buttons.forEach((b) => {\n                b.hovered = false;\n                if (b.x < e.x) {\n                    hovered = b;\n                }\n            });\n            if (hovered) {\n                // @ts-ignore\n                hovered.hovered = true;\n                this.activeIndex = this.buttons.indexOf(hovered);\n            }\n            if (dialog)\n                dialog.requestRedraw();\n            return true; // we handled the message\n        }\n        return false;\n    }\n    clearHighlight() {\n        this.buttons.forEach((b) => {\n            b.hovered = false;\n        });\n    }\n    getButtonAt(x, _y) {\n        return GWU.arrayFindRight(this.buttons, (b) => b.x < x) || null;\n    }\n    async click(e, dialog) {\n        if (this.bounds.contains(e)) {\n            // get active button\n            let activeButton = this.getButtonAt(e.x, e.y);\n            if (!activeButton)\n                return false;\n            this.activeIndex = this.buttons.indexOf(activeButton);\n            if (activeButton instanceof DropDownButton) {\n                await showDropDown(dialog, this, activeButton);\n            }\n            else if (activeButton instanceof ActionButton) {\n                this.actionButton = activeButton;\n                await dialog.fireAction(activeButton.action, this);\n            }\n            return true;\n        }\n        return false;\n    }\n    async keypress(e, dialog) {\n        if (this.active) {\n            if (e.key === 'Tab') {\n                ++this.activeIndex;\n                if (this.activeIndex >= this.buttons.length) {\n                    this.deactivate();\n                    return false; // tabbing away from me, need to process in dialog\n                }\n                return true;\n            }\n            else if (e.key === 'TAB') {\n                --this.activeIndex;\n                if (this.activeIndex < 0) {\n                    this.deactivate();\n                    return false; // shift tabbing away from me, need to process in dialog\n                }\n                return true;\n            }\n            else if (e.key === 'Enter') {\n                const activeButton = this.buttons[this.activeIndex];\n                if (activeButton instanceof DropDownButton) {\n                    await showDropDown(dialog, this, activeButton);\n                }\n                else if (activeButton instanceof ActionButton) {\n                    this.actionButton = activeButton;\n                    await dialog.fireAction(activeButton.action, this);\n                }\n                return true;\n            }\n        }\n        return super.keypress(e, dialog);\n    }\n    _addButton(text, config) {\n        const x = this.buttons.reduce((len, button) => len + button.text.length + this.separator.length, this.lead.length + this.bounds.x);\n        if (x + text.length + this.separator.length > this.bounds.width) {\n            throw new Error('Button makes menu too wide :' + text);\n        }\n        let button;\n        if (typeof config === 'string') {\n            button = new ActionButton(text, config);\n        }\n        else {\n            const dropdown = new DropDownButton(this, null, text, config);\n            dropdown.bounds.x = x - 1; // Hmmm...\n            button = dropdown;\n        }\n        button.x = x;\n        this.buttons.push(button);\n    }\n    draw(buffer) {\n        const bg = this.active ? this.activeBg : this.bg;\n        const fg = this.active ? this.activeFg : this.fg;\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, 1, 0, bg, bg);\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        buffer.drawText(x, y, this.lead, fg);\n        this.buttons.forEach((b, i) => {\n            const hovered = i === this.activeIndex;\n            const color = hovered ? this.hoverFg : fg;\n            const bgColor = hovered ? this.hoverBg : bg;\n            buffer.drawText(b.x, y, b.text, color, bgColor);\n            x = b.x + b.text.length;\n            buffer.drawText(x, y, this.separator, fg);\n        });\n        return true;\n    }\n}\n","import * as BaseStyle from '../style';\nexport class Style extends BaseStyle.Style {\n    constructor(selector = '$', init) {\n        super(selector, init);\n    }\n    get border() {\n        return this._border;\n    }\n    // get depth(): number | undefined {\n    //     return this._depth;\n    // }\n    get position() {\n        return this._position;\n    }\n    get minWidth() {\n        return this._minWidth;\n    }\n    get maxWidth() {\n        return this._maxWidth;\n    }\n    get width() {\n        return this._width;\n    }\n    get minHeight() {\n        return this._minHeight;\n    }\n    get maxHeight() {\n        return this._maxHeight;\n    }\n    get height() {\n        return this._height;\n    }\n    get x() {\n        return this._x;\n    }\n    get left() {\n        return this._left;\n    }\n    get right() {\n        return this._right;\n    }\n    get y() {\n        return this._y;\n    }\n    get top() {\n        return this._top;\n    }\n    get bottom() {\n        return this._bottom;\n    }\n    get padLeft() {\n        return this._padLeft;\n    }\n    get padRight() {\n        return this._padRight;\n    }\n    get padTop() {\n        return this._padTop;\n    }\n    get padBottom() {\n        return this._padBottom;\n    }\n    get marginLeft() {\n        return this._marginLeft;\n    }\n    get marginRight() {\n        return this._marginRight;\n    }\n    get marginTop() {\n        return this._marginTop;\n    }\n    get marginBottom() {\n        return this._marginBottom;\n    }\n    get(key) {\n        const id = ('_' + key);\n        return this[id];\n    }\n    set(key, value, setDirty = true) {\n        if (typeof key === 'string') {\n            if (key === 'padding') {\n                if (typeof value === 'number') {\n                    value = [value];\n                }\n                else if (typeof value === 'string') {\n                    value = value.split(' ');\n                }\n                value = value.map((v) => {\n                    if (typeof v === 'string')\n                        return Number.parseInt(v);\n                    return v;\n                });\n                if (value.length == 1) {\n                    this._padLeft =\n                        this._padRight =\n                            this._padTop =\n                                this._padBottom =\n                                    value[0];\n                }\n                else if (value.length == 2) {\n                    this._padLeft = this._padRight = value[1];\n                    this._padTop = this._padBottom = value[0];\n                }\n                else if (value.length == 3) {\n                    this._padTop = value[0];\n                    this._padRight = value[1];\n                    this._padBottom = value[2];\n                    this._padLeft = value[1];\n                }\n                else if (value.length == 4) {\n                    this._padTop = value[0];\n                    this._padRight = value[1];\n                    this._padBottom = value[2];\n                    this._padLeft = value[3];\n                }\n            }\n            else if (key === 'margin') {\n                if (typeof value === 'number') {\n                    value = [value];\n                }\n                else if (typeof value === 'string') {\n                    value = value.split(' ');\n                }\n                value = value.map((v) => {\n                    if (typeof v === 'string')\n                        return Number.parseInt(v);\n                    return v;\n                });\n                if (value.length == 1) {\n                    this._marginLeft =\n                        this._marginRight =\n                            this._marginTop =\n                                this._marginBottom =\n                                    value[0];\n                }\n                else if (value.length == 2) {\n                    this._marginLeft = this._marginRight = value[1];\n                    this._marginTop = this._marginBottom = value[0];\n                }\n                else if (value.length == 3) {\n                    this._marginTop = value[0];\n                    this._marginRight = value[1];\n                    this._marginBottom = value[2];\n                    this._marginLeft = value[1];\n                }\n                else if (value.length == 4) {\n                    this._marginTop = value[0];\n                    this._marginRight = value[1];\n                    this._marginBottom = value[2];\n                    this._marginLeft = value[3];\n                }\n            }\n            else {\n                const field = '_' + key;\n                if (typeof value === 'string') {\n                    if (value.match(/^[+-]?\\d+$/)) {\n                        value = Number.parseInt(value);\n                    }\n                    else if (value === 'true') {\n                        value = true;\n                    }\n                    else if (value === 'false') {\n                        value = false;\n                    }\n                }\n                this[field] = value;\n            }\n        }\n        else if (key instanceof Style) {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (name === 'selector' || name === '_dirty')\n                    return;\n                if (value !== undefined && value !== null) {\n                    this[name] = value;\n                }\n                else if (value === null) {\n                    this.unset(name);\n                }\n            });\n        }\n        else {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (value === null) {\n                    this.unset(name);\n                }\n                else {\n                    this.set(name, value, setDirty);\n                }\n            });\n        }\n        this.dirty || (this.dirty = setDirty);\n        return this;\n    }\n    unset(key) {\n        const field = key.startsWith('_') ? key : '_' + key;\n        delete this[field];\n        this.dirty = true;\n        return this;\n    }\n    clone() {\n        const other = new this.constructor();\n        other.copy(this);\n        return other;\n    }\n    copy(other) {\n        Object.assign(this, other);\n        return this;\n    }\n}\nexport function makeStyle(style, selector = '$') {\n    const opts = {};\n    const parts = style\n        .trim()\n        .split(';')\n        .map((p) => p.trim());\n    parts.forEach((p) => {\n        const [name, base] = p.split(':').map((p) => p.trim());\n        if (!name)\n            return;\n        const baseParts = base.split(/ +/g);\n        if (baseParts.length == 1) {\n            // @ts-ignore\n            opts[name] = base;\n        }\n        else {\n            // @ts-ignore\n            opts[name] = baseParts;\n        }\n    });\n    return new Style(selector, opts);\n}\n// const NO_BOUNDS = ['fg', 'bg', 'depth', 'align', 'valign'];\n// export function affectsBounds(key: keyof StyleOptions): boolean {\n//     return !NO_BOUNDS.includes(key);\n// }\nexport class ComputedStyle extends Style {\n    // constructor(source: Stylable, sources?: Style[]) {\n    constructor(sources) {\n        super();\n        // obj: Stylable;\n        this.sources = [];\n        // this.obj = source;\n        if (sources) {\n            // sort low to high priority (highest should be this.obj._style, lowest = global default:'*')\n            sources.sort((a, b) => a.selector.priority - b.selector.priority);\n            this.sources = sources;\n        }\n        this.sources.forEach((s) => super.set(s));\n        this._dirty = false; // As far as I know I reflect all of the current source values.\n    }\n    get dirty() {\n        return this._dirty || this.sources.some((s) => s.dirty);\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n}\nexport class Sheet {\n    constructor(parentSheet) {\n        this.rules = [];\n        this._dirty = true;\n        if (parentSheet === undefined) {\n            parentSheet = defaultStyle;\n        }\n        if (parentSheet) {\n            this.rules = parentSheet.rules.slice();\n        }\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (!this._dirty) {\n            this.rules.forEach((r) => (r.dirty = false));\n        }\n    }\n    add(selector, props) {\n        if (selector.includes(',')) {\n            const parts = selector\n                .split(',')\n                .map((p) => p.trim())\n                .map((p) => this.add(p, props));\n            return parts[parts.length - 1];\n        }\n        if (selector.includes(' '))\n            throw new Error('Hierarchical selectors not supported.');\n        // if 2 '.' - Error('Only single class rules supported.')\n        // if '&' - Error('Not supported.')\n        let rule = new Style(selector, props);\n        const existing = this.rules.findIndex((s) => s.selector.text === rule.selector.text);\n        if (existing > -1) {\n            const current = this.rules[existing];\n            current.set(rule);\n            rule = current;\n        }\n        else {\n            this.rules.push(rule);\n        }\n        // rulesChanged = true;\n        this.dirty = true;\n        return rule;\n    }\n    get(selector) {\n        return this.rules.find((s) => s.selector.text === selector) || null;\n    }\n    remove(selector) {\n        const existing = this.rules.findIndex((s) => s.selector.text === selector);\n        if (existing > -1) {\n            this.rules.splice(existing, 1);\n            this.dirty = true;\n        }\n    }\n    computeFor(widget) {\n        const sources = this.rules.filter((r) => r.selector.matches(widget));\n        const widgetStyle = widget.style();\n        if (widgetStyle) {\n            sources.push(widgetStyle);\n        }\n        widgetStyle.dirty = false;\n        return new ComputedStyle(sources);\n    }\n}\nexport const defaultStyle = new Sheet(null);\n","import * as GWU from 'gw-utils';\nimport * as Style from './style';\nStyle.defaultStyle.add('*', {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n    position: 'static',\n});\nexport class Element {\n    // hovered: Style.Style = {};\n    // active: Style.Style = {};\n    constructor(tag, styles) {\n        this.parent = null;\n        this._props = {};\n        this._attrs = {};\n        this.classes = [];\n        this.children = [];\n        this.events = {};\n        this._data = null;\n        this._bounds = new GWU.xy.Bounds(0, 0, 0, 0);\n        this._text = '';\n        this._lines = [];\n        this._dirty = false;\n        this._attached = false;\n        this._style = null;\n        this.tag = tag;\n        this._usedStyle = styles\n            ? styles.computeFor(this)\n            : new Style.ComputedStyle();\n    }\n    contains(x, y) {\n        if (typeof x === 'number')\n            return this._bounds.contains(x, y);\n        return this._bounds.contains(x);\n    }\n    clone() {\n        if (this._attached && !this.parent)\n            throw new Error('Cannot clone a root widget.');\n        const other = new this.constructor(this.tag);\n        Object.assign(other._props, this._props);\n        other.classes = this.classes.slice();\n        other._text = this._text;\n        if (this._style) {\n            other._style = this._style.clone();\n        }\n        other.parent = null; // The root cloned widget will not have a parent anymore\n        other._attached = false;\n        other.dirty = true;\n        // First we clone the children, then we set their parent to us\n        other.children = this.children.map((c) => c.clone());\n        other.children.forEach((c) => (c.parent = other));\n        return other;\n    }\n    get dirty() {\n        return this._dirty || this._usedStyle.dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (this.parent && v) {\n            const position = this.used('position');\n            if (position === 'static' || position === 'relative') {\n                this.parent.dirty = true;\n            }\n        }\n    }\n    attr(name, value) {\n        if (value === undefined)\n            return this._attrs[name];\n        this._setAttr(name, value);\n        return this;\n    }\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'style') {\n            this._style = Style.makeStyle(value);\n            this._usedStyle.dirty = true;\n        }\n    }\n    _attrInt(name, def = 0) {\n        let v = this._attrs[name];\n        if (v === undefined)\n            return def;\n        if (typeof v === 'string') {\n            return Number.parseInt(v);\n        }\n        else if (typeof v === 'boolean') {\n            return v ? 1 : 0;\n        }\n        return v;\n    }\n    _attrString(name) {\n        let v = this._attrs[name] || '';\n        if (typeof v === 'string')\n            return v;\n        return '' + v;\n    }\n    _attrBool(name) {\n        const v = this._attrs[name] || false;\n        if (typeof v === 'boolean')\n            return v;\n        if (typeof v === 'number')\n            return v != 0;\n        return v.length > 0 && v !== 'false';\n    }\n    prop(name, value) {\n        if (value === undefined)\n            return this._props[name];\n        this._setProp(name, value);\n        return this;\n    }\n    _setProp(name, value) {\n        if (this._props[name] === value)\n            return;\n        this._props[name] = value;\n        this._usedStyle.dirty = true; // Need to reload styles\n    }\n    toggleProp(name) {\n        const v = this._props[name] || false;\n        this._setProp(name, !v);\n        return this;\n    }\n    val(v) {\n        if (v === undefined)\n            return this.prop('value');\n        this._setProp('value', v);\n        return this;\n    }\n    data(doc, v) {\n        if (doc === undefined) {\n            return this._data;\n        }\n        this._setData(doc, v);\n        return this;\n    }\n    _setData(_doc, v) {\n        this._data = v;\n    }\n    onblur(_doc) {\n        this.prop('focus', false);\n    }\n    onfocus(_doc, _reverse) {\n        this.prop('focus', true);\n    }\n    _propInt(name, def = 0) {\n        let v = this._props[name];\n        if (v === undefined)\n            return def;\n        if (typeof v === 'string') {\n            return Number.parseInt(v);\n        }\n        else if (typeof v === 'boolean') {\n            return v ? 1 : 0;\n        }\n        return v;\n    }\n    _propString(name) {\n        let v = this._props[name] || '';\n        if (typeof v === 'string')\n            return v;\n        return '' + v;\n    }\n    _propBool(name) {\n        const v = this._props[name] || false;\n        return !!v;\n    }\n    // CHILDREN\n    _isValidChild(_child) {\n        return true;\n    }\n    appendChild(child, beforeIndex = -1) {\n        if (!this._isValidChild(child)) {\n            throw new Error(`Invalid child (tag=${child.tag}) for element (tag=${this.tag})`);\n        }\n        if (child.parent) {\n            if (child.parent === this)\n                return this; // ok\n            throw new Error('Cannot add a currently attached child to another element.  Detach it first.');\n        }\n        if (beforeIndex == 0) {\n            this.children.unshift(child);\n        }\n        else if (beforeIndex > 0 && beforeIndex <= this.children.length - 1) {\n            this.children.splice(beforeIndex, 0, child);\n        }\n        else {\n            this.children.push(child);\n        }\n        child.parent = this;\n        child.dirty = true;\n        this.dirty = true;\n        return this;\n    }\n    removeChild(child) {\n        if (!child.parent)\n            return this; // not attached, silently ignore\n        if (child.parent !== this) {\n            // TODO - fail silently?\n            throw new Error('Cannot remove child that is not attached to this widget.');\n        }\n        if (GWU.arrayDelete(this.children, child)) {\n            child.parent = null;\n            child.dirty = true;\n            this.dirty = true;\n        }\n        return this;\n    }\n    empty() {\n        this.text(''); // clear the text\n        // clear the children\n        const old = this.children;\n        this.children = []; // no more children\n        old.forEach((c) => {\n            c.parent = null;\n            c.dirty = true;\n        });\n        this.dirty = true;\n        // return the children for cleanup\n        return old;\n    }\n    root() {\n        let current = this;\n        while (current.parent) {\n            current = current.parent;\n        }\n        return current !== this ? current : null;\n    }\n    positionedParent() {\n        const position = this._usedStyle.position || 'static';\n        if (position === 'static')\n            return null;\n        if (position === 'relative')\n            return this;\n        if (position === 'fixed')\n            return this.root();\n        let parent = this.parent;\n        if (parent) {\n            // for absolute position, position is relative to closest ancestor that is positioned\n            while (parent && !parent.isPositioned()) {\n                parent = parent.parent;\n            }\n        }\n        if (!parent) {\n            return this.root(); // no positioned parent so we act fixed.\n        }\n        return parent;\n    }\n    // BOUNDS\n    get bounds() {\n        // this._update();\n        return this._bounds;\n    }\n    get innerLeft() {\n        return (this._bounds.left +\n            (this._usedStyle.padLeft || 0) +\n            (this._usedStyle.marginLeft || 0) +\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerRight() {\n        return (this._bounds.right -\n            (this._usedStyle.padRight || 0) -\n            (this._usedStyle.marginRight || 0) -\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerWidth() {\n        return Math.max(0, this._bounds.width -\n            (this._usedStyle.padLeft || 0) -\n            (this._usedStyle.padRight || 0) -\n            (this._usedStyle.marginLeft || 0) -\n            (this._usedStyle.marginRight || 0) -\n            (this._usedStyle.border ? 2 : 0));\n    }\n    get innerHeight() {\n        return Math.max(0, this._bounds.height -\n            (this._usedStyle.padTop || 0) -\n            (this._usedStyle.padBottom || 0) -\n            (this._usedStyle.marginTop || 0) -\n            (this._usedStyle.marginBottom || 0) -\n            (this._usedStyle.border ? 2 : 0));\n    }\n    get innerTop() {\n        return (this._bounds.top +\n            (this._usedStyle.padTop || 0) +\n            (this._usedStyle.marginTop || 0) +\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerBottom() {\n        return (this._bounds.bottom -\n            (this._usedStyle.padBottom || 0) -\n            (this._usedStyle.marginBottom || 0) -\n            (this._usedStyle.border ? 1 : 0));\n    }\n    updateLayout() {\n        // if (!this.dirty) {\n        //     this.children.forEach((c) => c.updateLayout());\n        //     return this;\n        // }\n        this._updateWidth();\n        this._updateHeight();\n        this._updateLeft();\n        this._updateTop();\n        // this.dirty = false;\n        // this.children.forEach((c) => (c.dirty = false));\n        return this;\n    }\n    // update bounds.width and return it\n    _updateWidth() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        bounds.width = used.width || 0;\n        if (!bounds.width) {\n            const position = used.position || 'static';\n            if (['static', 'relative'].includes(position) && this.parent) {\n                bounds.width = this.parent.innerWidth || 0;\n            }\n            // compute internal width\n            if (!bounds.width) {\n                bounds.width =\n                    (used.padLeft || 0) +\n                        (used.padRight || 0) +\n                        (used.marginLeft || 0) +\n                        (used.marginRight || 0) +\n                        (used.border ? 2 : 0);\n                if (this.children.length) {\n                    // my width comes from my children...\n                    bounds.width += this.children.reduce((len, c) => Math.max(len, c._updateWidth()), 0);\n                }\n                else {\n                    bounds.width += this._calcContentWidth();\n                }\n            }\n        }\n        bounds.width = GWU.clamp(bounds.width, used.minWidth || bounds.width, used.maxWidth || bounds.width);\n        this.children.forEach((c) => c._updateWidth());\n        // These do not figure into parent with calculation\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.width;\n    }\n    _updateHeight() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        let contentHeight = 0;\n        bounds.height = used.height || 0;\n        if (!bounds.height) {\n            bounds.height =\n                (used.padTop || 0) +\n                    (used.padBottom || 0) +\n                    (used.marginTop || 0) +\n                    (used.marginBottom || 0) +\n                    (used.border ? 2 : 0);\n            if (this.children.length) {\n                // my height comes from my children...\n                bounds.height += this._calcChildHeight();\n            }\n            else {\n                contentHeight = this._calcContentHeight();\n                bounds.height += contentHeight;\n            }\n        }\n        bounds.height = GWU.clamp(bounds.height, used.minHeight || bounds.height, used.maxHeight || bounds.height);\n        if (contentHeight > this.innerHeight) {\n            this._updateContentHeight();\n        }\n        this.children.forEach((c) => c._updateHeight());\n        // These do not figure into parent height calculation\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.height;\n    }\n    _updateLeft() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        const position = used.position || 'static';\n        bounds.left = 0;\n        if (position === 'static') {\n            if (this.parent) {\n                bounds.left = this.parent.innerLeft;\n            }\n        }\n        else {\n            const root = this.positionedParent();\n            if (used.left !== undefined) {\n                bounds.left = (root ? root.bounds.left : 0) + used.left;\n            }\n            else if (used.right !== undefined) {\n                if (root) {\n                    bounds.right = root.bounds.right - used.right;\n                }\n            }\n            else {\n                bounds.left = root ? root.bounds.left : 0;\n            }\n        }\n        this.children.forEach((c) => c._updateLeft());\n    }\n    _updateTop(parentBottom = 0) {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position)) {\n            const root = this.positionedParent();\n            if (used.top !== undefined) {\n                bounds.top = (root ? root.bounds.top : 0) + used.top;\n            }\n            else if (used.bottom !== undefined) {\n                if (root) {\n                    bounds.bottom = root.bounds.bottom - used.bottom;\n                }\n            }\n            else {\n                bounds.top = root ? root.bounds.top : 0;\n            }\n        }\n        else {\n            bounds.top = parentBottom;\n            if (position === 'relative') {\n                if (used.top !== undefined) {\n                    bounds.top += used.top;\n                }\n                else if (used.bottom !== undefined) {\n                    bounds.top -= used.bottom;\n                }\n            }\n        }\n        if (this.children.length) {\n            let innerTop = this.innerTop;\n            this.children.forEach((c) => {\n                innerTop += c._updateTop(innerTop);\n            });\n        }\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.height;\n    }\n    style(...args) {\n        if (!this._style) {\n            this._style = new Style.Style();\n        }\n        if (args.length === 0)\n            return this._style;\n        if (args.length === 1) {\n            const v = args[0];\n            if (typeof v === 'string') {\n                return this._style.get(v);\n            }\n            else {\n                this._style.set(args[0], false); // do not set the dirty flag\n                this._usedStyle.set(args[0], false); // do not set the dirty flag\n                this.dirty = true; // Need layout update\n            }\n        }\n        else {\n            this._style.set(args[0], args[1], false); // do not set dirty flag\n            this._usedStyle.set(args[0], args[1], false); // do not set dirty flag\n            this.dirty = true; // Need layout update\n        }\n        return this;\n    }\n    removeStyle(id) {\n        if (!this._style)\n            return this;\n        this._style.unset(id);\n        this._usedStyle.dirty = true;\n        return this;\n    }\n    used(id) {\n        if (!id)\n            return this._usedStyle;\n        if (id instanceof Style.ComputedStyle) {\n            this._usedStyle = id;\n            this.dirty = true;\n            return this;\n        }\n        return this._usedStyle.get(id);\n    }\n    addClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (this.classes.includes(cls))\n                return;\n            this._usedStyle.dirty = true; // It needs to get styles for this class\n            this.classes.push(cls);\n        });\n        return this;\n    }\n    removeClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (!GWU.arrayDelete(this.classes, cls))\n                return;\n            this._usedStyle.dirty = true; // It may need to remove some styles\n        });\n        return this;\n    }\n    toggleClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (!GWU.arrayDelete(this.classes, cls)) {\n                this.classes.push(cls);\n            }\n            this._usedStyle.dirty = true;\n        });\n        return this;\n    }\n    pos(...args) {\n        if (args.length === 0)\n            return this.bounds;\n        let pos;\n        let wantStyle = 'fixed';\n        if (typeof args[0] === 'number') {\n            pos = { left: args.shift(), top: args.shift() };\n        }\n        else {\n            pos = args.shift();\n        }\n        // update style if necessary\n        if (args[0] && args[0].length) {\n            wantStyle = args[0];\n            this.style('position', wantStyle);\n        }\n        else if (!this.isPositioned()) {\n            this.style('position', 'fixed'); // convert to fixed\n        }\n        if (pos.right !== undefined) {\n            this.style('right', pos.right);\n        }\n        if (pos.left !== undefined) {\n            this.style('left', pos.left);\n        }\n        if (pos.top !== undefined) {\n            this.style('top', pos.top);\n        }\n        if (pos.bottom !== undefined) {\n            this.style('bottom', pos.bottom);\n        }\n        return this;\n    }\n    isPositioned() {\n        const pos = this._usedStyle.position;\n        return !!pos && pos !== 'static';\n    }\n    size(size, height) {\n        if (size === undefined)\n            return this.bounds;\n        if (typeof size === 'number') {\n            size = { width: size, height };\n        }\n        if (size.minWidth !== undefined)\n            this.style('minWidth', size.minWidth);\n        if (size.minHeight !== undefined)\n            this.style('minHeight', size.minHeight);\n        if (size.maxWidth !== undefined)\n            this.style('maxWidth', size.maxWidth);\n        if (size.maxHeight !== undefined)\n            this.style('maxHeight', size.maxHeight);\n        if (size.width !== undefined)\n            this.style('width', size.width);\n        if (size.height !== undefined)\n            this.style('height', size.height);\n        // this._update();\n        return this;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        this._setText(v);\n        return this;\n    }\n    _setText(v) {\n        this._text = v;\n        this.dirty = true;\n        this._usedStyle.dirty = true; // We need to re-layout the _lines (which possibly affects width+height)\n    }\n    _calcContentWidth() {\n        this._lines = GWU.text.splitIntoLines(this._text);\n        return this._lines.reduce((out, line) => Math.max(out, line.length), 0);\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth);\n        return this._lines.length;\n    }\n    _calcChildHeight() {\n        return this.children.reduce((len, c) => len + c._updateHeight(), 0);\n    }\n    _updateContentHeight() {\n        this._lines.length = this.innerHeight;\n    }\n    // DRAWING\n    draw(buffer) {\n        const used = this._usedStyle;\n        if (used.border) {\n            this._drawBorder(buffer);\n        }\n        this._fill(buffer);\n        this._drawContent(buffer);\n        this.dirty = false;\n        return true;\n    }\n    _drawBorder(buffer) {\n        const used = this._usedStyle;\n        const bounds = this.bounds;\n        GWU.xy.forBorder(bounds.x + (used.marginLeft || 0), bounds.y + (used.marginTop || 0), bounds.width - (used.marginLeft || 0) - (used.marginRight || 0), bounds.height - (used.marginTop || 0) - (used.marginBottom || 0), (x, y) => {\n            buffer.draw(x, y, 0, used.border, used.border);\n        });\n    }\n    _fill(buffer) {\n        const used = this._usedStyle;\n        const bg = used.bg;\n        const bounds = this.bounds;\n        buffer.fillRect(bounds.x + (used.marginLeft || 0) + (used.border ? 1 : 0), bounds.y + (used.marginTop || 0) + (used.border ? 1 : 0), bounds.width -\n            (used.marginLeft || 0) -\n            (used.marginRight || 0) -\n            (used.border ? 2 : 0), bounds.height -\n            (used.marginTop || 0) -\n            (used.marginBottom || 0) -\n            (used.border ? 2 : 0), ' ', bg, bg);\n    }\n    _drawContent(buffer) {\n        if (this.children.length) {\n            this._drawChildren(buffer);\n        }\n        else {\n            this._drawText(buffer);\n        }\n    }\n    _drawChildren(buffer) {\n        // https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/Stacking_without_z-index\n        this.children.forEach((c) => {\n            if (!c.isPositioned())\n                c.draw(buffer);\n        });\n        this.children.forEach((c) => {\n            if (c.isPositioned())\n                c.draw(buffer);\n        });\n    }\n    _drawText(buffer) {\n        if (this._lines.length) {\n            const fg = this.used('fg') || 'white';\n            const top = this.innerTop;\n            const width = this.innerWidth;\n            const left = this.innerLeft;\n            const align = this.used('align');\n            this._lines.forEach((line, i) => {\n                buffer.drawText(left, top + i, line, fg, -1, width, align);\n            });\n        }\n    }\n    // Events\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    elementFromPoint(x, y) {\n        let result = null;\n        // positioned elements\n        for (let w of this.children) {\n            if (w.isPositioned() && w.contains(x, y)) {\n                result = w.elementFromPoint(x, y) || result;\n            }\n        }\n        if (result)\n            return result;\n        // static elements\n        for (let w of this.children) {\n            if (!w.isPositioned() && w.contains(x, y)) {\n                result = w.elementFromPoint(x, y) || result;\n            }\n        }\n        if (result)\n            return result;\n        if (!result && this.contains(x, y)) {\n            result = this;\n        }\n        return result;\n    }\n}\n","import * as Element from './element';\nimport * as Style from './style';\nconst MARKUP_RE = /<!--[^]*?(?=-->)-->|<(\\/?)(\\w*)\\s*([^>]*?)(\\/?)>/g;\nconst ATTR_RE = /(\\w+)(?: *= *(?:(?:\\'([^\\']*)\\')|(?:\\\"([^\\\"]*)\\\")|(\\w+)))?/g;\n// var kAttributePattern = /\\b(id|class)\\s*=\\s*(\"([^\"]+)\"|'([^']+)'|(\\S+))/gi;\nexport const selfClosingTags = {\n    meta: true,\n    img: true,\n    link: true,\n    input: true,\n    area: true,\n    br: true,\n    hr: true,\n};\nvar tagsClosedByOpening = {\n    li: { li: true },\n    p: { p: true, div: true },\n    td: { td: true, th: true },\n    th: { td: true, th: true },\n};\nvar tagsClosedByClosing = {\n    li: { ul: true, ol: true },\n    a: { div: true },\n    b: { div: true },\n    i: { div: true },\n    p: { div: true },\n    td: { tr: true, table: true },\n    th: { tr: true, table: true },\n};\nexport const elements = {};\nexport function configureElement(tag, opts = {}) {\n    if (opts.selfClosing) {\n        selfClosingTags[tag] = true;\n    }\n    if (opts.openCloses && opts.openCloses.length) {\n        const tcbo = (tagsClosedByOpening[tag] = {});\n        opts.openCloses.forEach((t) => (tcbo[t] = true));\n    }\n    if (opts.closeCloses && opts.closeCloses.length) {\n        const tcbc = (tagsClosedByClosing[tag] = {});\n        opts.closeCloses.forEach((t) => (tcbc[t] = true));\n    }\n}\nexport function installElement(tag, fn, opts = {}) {\n    elements[tag] = fn;\n    configureElement(tag, opts);\n}\nfunction createElement(tag, rawAttr, stylesheet) {\n    const fn = elements[tag];\n    const e = fn ? fn(tag, stylesheet) : new Element.Element(tag, stylesheet);\n    // TODO - Add attributs, properties, and styles\n    if (rawAttr) {\n        // console.log(tag, rawAttr);\n        const re = new RegExp(ATTR_RE, 'g');\n        let match = re.exec(rawAttr);\n        while (match) {\n            const name = match[1];\n            const value = match[2] || match[3] || match[4] || true;\n            // console.log('- attr', name, value);\n            if (value === true) {\n                e.prop(name, value);\n            }\n            else {\n                e.attr(name, value);\n            }\n            match = re.exec(rawAttr);\n        }\n    }\n    return e;\n}\nfunction back(arr) {\n    return arr[arr.length - 1];\n}\n/**\n * Parse a chuck of HTML source.\n * @param  {string} data      html\n * @return {HTMLElement}      root element\n */\nexport function parse(data, options = {}) {\n    if (options instanceof Style.Sheet) {\n        options = { stylesheet: options };\n    }\n    var root = createElement('dummy', '', options.stylesheet);\n    var currentElement = root;\n    var stack = [root];\n    var lastTextPos = -1;\n    options = options || {};\n    const RE = new RegExp(MARKUP_RE, 'gi');\n    var match, text;\n    match = RE.exec(data);\n    while (match) {\n        if (lastTextPos > -1) {\n            if (lastTextPos + match[0].length < RE.lastIndex) {\n                // if has content\n                text = data.substring(lastTextPos, RE.lastIndex - match[0].length);\n                currentElement.text(text); //.appendNode(new TextNode(text));\n            }\n        }\n        lastTextPos = RE.lastIndex;\n        if (match[0][1] == '!') {\n            // this is a comment\n            continue;\n        }\n        if (options.lowerCaseTagName)\n            match[2] = match[2].toLowerCase();\n        if (!match[1]) {\n            // not </ tags\n            // var attrs: Record<string, string> = {};\n            // var attMatch;\n            // attMatch = kAttributePattern.exec(match[3]);\n            // while (attMatch) {\n            //     attrs[attMatch[1]] = attMatch[3] || attMatch[4] || attMatch[5];\n            //     attMatch = kAttributePattern.exec(match[3]);\n            // }\n            // console.log(attrs);\n            if (!match[4] && tagsClosedByOpening[currentElement.tag]) {\n                if (tagsClosedByOpening[currentElement.tag][match[2]]) {\n                    stack.pop();\n                    currentElement = back(stack);\n                }\n            }\n            const child = createElement(match[2], match[3], options.stylesheet);\n            stack.push(child);\n            currentElement.appendChild(child);\n            currentElement = child;\n            // if (kBlockTextElements[match[2]]) {\n            //   // a little test to find next </script> or </style> ...\n            //   var closeMarkup = '</' + match[2] + '>';\n            //   var index = data.indexOf(closeMarkup, kMarkupPattern.lastIndex);\n            //   if (options[match[2]]) {\n            //     if (index == -1) {\n            //       // there is no matching ending for the text element.\n            //       text = data.substr(kMarkupPattern.lastIndex);\n            //     } else {\n            //       text = data.substring(kMarkupPattern.lastIndex, index);\n            //     }\n            //     if (text.length > 0)\n            //       currentParent.appendChild(new TextNode(text));\n            //   }\n            //   if (index == -1) {\n            //     lastTextPos = kMarkupPattern.lastIndex = data.length + 1;\n            //   } else {\n            //     lastTextPos = kMarkupPattern.lastIndex = index + closeMarkup.length;\n            //     match[1] = true;\n            //   }\n            // }\n        }\n        if (match[1] || match[4] || selfClosingTags[match[2]]) {\n            // </ or /> or <br> etc.\n            while (true) {\n                if (currentElement.tag == match[2]) {\n                    stack.pop();\n                    currentElement = back(stack);\n                    break;\n                }\n                else {\n                    // Trying to close current tag, and move on\n                    if (tagsClosedByClosing[currentElement.tag]) {\n                        if (tagsClosedByClosing[currentElement.tag][match[2]]) {\n                            stack.pop();\n                            currentElement = back(stack);\n                            continue;\n                        }\n                    }\n                    // Use aggressive strategy to handle unmatching markups.\n                    break;\n                }\n            }\n        }\n        match = RE.exec(data);\n    }\n    // in case you forget closing tag on something like : \"<div>text\"\n    if (lastTextPos > -1) {\n        if (lastTextPos < data.length) {\n            // if has content\n            text = data.substring(lastTextPos);\n            currentElement.text(text); //.appendNode(new TextNode(text));\n        }\n    }\n    const e = root.children[0]; // real root\n    e.parent = null;\n    return e;\n}\n// let t = parse('<div name=\"test\" checked id=A>Test</div>');\n// console.log(t);\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('input', {\n    fg: 'black',\n    bg: 'gray',\n});\nexport class Input extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.prop('tabindex', true);\n        this.prop('value', '');\n    }\n    // reset() {\n    //     this.prop('value', this._attrString('value'));\n    // }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        super._setAttr(name, value);\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n        super._setProp('valid', this.isValid());\n    }\n    _setProp(name, value) {\n        if (name === 'value') {\n            value = '' + value;\n            const maxLength = this._attrInt('maxLength', 0);\n            if (maxLength && value.length > maxLength) {\n                value = value.substring(0, maxLength);\n            }\n            super._setProp('empty', value.length == 0);\n            this._props.value = value;\n            this.dirty = true;\n        }\n        else {\n            super._setProp(name, value);\n        }\n        super._setProp('valid', this.isValid());\n    }\n    get isTypeNumber() {\n        return this._attrs.type === 'number';\n    }\n    // PROPERTIES\n    // CONTENT\n    _calcContentWidth() {\n        const size = this._attrs.size || '';\n        if (size.length)\n            return Number.parseInt(size);\n        return 10; // default somewhere else?\n    }\n    _calcContentHeight() {\n        return 1;\n    }\n    _updateContentHeight() { }\n    isValid() {\n        const v = this._propString('value');\n        if (this.isTypeNumber) {\n            const val = this._propInt('value');\n            const min = this._attrInt('min', Number.MIN_SAFE_INTEGER);\n            if (val < min)\n                return false;\n            const max = this._attrInt('max', Number.MAX_SAFE_INTEGER);\n            if (val > max)\n                return false;\n            return v.length > 0;\n        }\n        const requiredLen = this._propInt('required', 0);\n        // console.log(\n        //     'required',\n        //     this._attrs.required,\n        //     requiredLen,\n        //     v,\n        //     v.length,\n        //     this._attrInt('minLength', requiredLen)\n        // );\n        return (v.length >= this._attrInt('minLength', requiredLen) &&\n            v.length <= this._attrInt('maxLength', Number.MAX_SAFE_INTEGER));\n    }\n    // DRAWING\n    _drawText(buffer) {\n        const fg = this.used('fg') || 'white';\n        const top = this.innerTop;\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = this.used('align');\n        let v = this._propString('value');\n        if (v.length == 0) {\n            v = this._attrString('placeholder');\n        }\n        buffer.drawText(left, top, v, fg, -1, width, align);\n    }\n    // EVENTS\n    onblur(doc) {\n        super.onblur(doc);\n        if (this.val() !== this.attr('value')) {\n            doc._fireEvent(this, 'change');\n        }\n    }\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter') {\n            document.nextTabStop();\n            return true;\n        }\n        if (e.key === 'Escape') {\n            this._setProp('value', '');\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key === 'Backspace' || e.key === 'Delete') {\n            const v = this._propString('value');\n            this._setProp('value', v.substring(0, v.length - 1));\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key.length > 1) {\n            return false;\n        }\n        const textEntryBounds = this.isTypeNumber ? ['0', '9'] : [' ', '~'];\n        // eat/use all other keys\n        if (e.key >= textEntryBounds[0] && e.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            const v = this._propString('value');\n            this._setProp('value', v + e.key);\n            document._fireEvent(this, 'input', e);\n        }\n        return true;\n    }\n}\nParser.installElement('input', (tag, sheet) => {\n    return new Input(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport * as Element from './element';\nimport * as Parser from './parser';\nexport class CheckBox extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.on('click', this.click.bind(this));\n        this.prop('tabindex', true);\n        this.prop('checked', false);\n        Object.entries(CheckBox.default).forEach(([key, value]) => this.attr(key, value));\n    }\n    // reset() {\n    //     this.prop('value', this._attrString('value'));\n    // }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n    }\n    // PROPERTIES\n    // CONTENT\n    _calcContentWidth() {\n        return 2 + super._calcContentWidth();\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth - 2);\n        return Math.max(1, this._lines.length);\n    }\n    // DRAWING\n    _drawText(buffer) {\n        const fg = this.used('fg') || 'white';\n        const top = this.innerTop;\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = this.used('align');\n        const state = this.prop('checked') ? 'check' : 'uncheck';\n        let v = this._attrs[state];\n        buffer.drawText(left, top, v, fg, -1);\n        this._lines.forEach((line, i) => {\n            buffer.drawText(left + 2, top + i, line, fg, -1, width - 2, align);\n        });\n    }\n    // EVENTS\n    onblur(doc) {\n        super.onblur(doc);\n        doc._fireEvent(this, 'change');\n    }\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter' || e.key === ' ') {\n            this.toggleProp('checked');\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key === 'Backspace' || e.key === 'Delete') {\n            this.prop('checked', false);\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        return false;\n    }\n    click(document, _element, e) {\n        if (!e)\n            return false;\n        if (!this.contains(e))\n            return false;\n        this.toggleProp('checked');\n        document.setActiveElement(this);\n        document._fireEvent(this, 'input', e);\n        return true;\n    }\n}\nCheckBox.default = {\n    uncheck: '\\u2610',\n    check: '\\u2612',\n    padCheck: '1',\n    value: 'on',\n};\nParser.installElement('checkbox', (tag, sheet) => {\n    return new CheckBox(tag, sheet);\n});\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('button', {\n    fg: 'black',\n    bg: 'gray',\n});\nexport class Button extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.on('click', this.click.bind(this));\n        this.prop('tabindex', true);\n        Object.entries(Button.default).forEach(([key, value]) => {\n            if (typeof value === 'boolean') {\n                this.prop(key, value);\n            }\n            else {\n                this.attr(key, value);\n            }\n        });\n    }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n    }\n    // PROPERTIES\n    // CONTENT\n    // DRAWING\n    // EVENTS\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter' || e.key === ' ') {\n            document._fireEvent(this, 'click', e);\n            return true;\n        }\n        return false;\n    }\n    click(document, _element, e) {\n        if (!e)\n            return false;\n        if (!this.contains(e))\n            return false;\n        if (this.prop('clickfocus')) {\n            document.setActiveElement(this);\n        }\n        return true;\n    }\n}\nButton.default = {\n    clickfocus: false,\n};\nParser.installElement('button', (tag, sheet) => {\n    return new Button(tag, sheet);\n});\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('fieldset', {\n    margin: 1,\n    border: 'dark_gray',\n    fg: 'white',\n    bg: -1,\n    padding: 1,\n});\nexport class FieldSet extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        Object.entries(FieldSet.default).forEach(([key, value]) => {\n            if (typeof value === 'boolean') {\n                this.prop(key, value);\n            }\n            else if (value !== undefined) {\n                this.attr(key, '' + value);\n            }\n        });\n    }\n    // ATTRIBUTES\n    // PROPERTIES\n    // CONTENT\n    // DRAWING\n    _drawBorder(buffer) {\n        super._drawBorder(buffer);\n        const legend = this.attr('legend');\n        if (!legend || legend.length == 0)\n            return;\n        const used = this._usedStyle;\n        const fg = used.fg || 'white';\n        const top = this.innerTop - (used.padTop || 0) - 1; // -1 for border\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = used.align;\n        buffer.drawText(left, top, legend, fg, -1, width, align);\n    }\n}\nFieldSet.default = {};\nParser.installElement('fieldset', (tag, sheet) => {\n    return new FieldSet(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport * as Element from './element';\nimport * as Parser from './parser';\n// import { Document } from './document';\n// Style.defaultStyle.add('button', {\n//     fg: 'black',\n//     bg: 'gray',\n// });\nexport class UnorderedList extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n    }\n    // CONTENT\n    get indentWidth() {\n        return 2;\n    }\n    _calcContentWidth() {\n        return this.indentWidth + super._calcContentWidth();\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth - this.indentWidth);\n        return Math.max(1, this._lines.length);\n    }\n    get innerLeft() {\n        return super.innerLeft + this.indentWidth;\n    }\n    get innerWidth() {\n        return Math.max(0, super.innerWidth - this.indentWidth);\n    }\n    // DRAWING\n    _drawBullet(buffer, _index, left, top, fg) {\n        const b = this._attrs.bullet || UnorderedList.default.bullet;\n        buffer.drawText(left, top, b, fg, -1);\n    }\n    _drawChildren(buffer) {\n        this.children.forEach((c, i) => {\n            const fg = c.used('fg') || 'white';\n            const top = c.bounds.top + (c.used('marginTop') || 0);\n            const left = c.bounds.left - this.indentWidth;\n            this._drawBullet(buffer, i, left, top, fg);\n            c.draw(buffer);\n        });\n    }\n}\nUnorderedList.default = {\n    bullet: '\\u2022', // bullet\n};\nParser.installElement('ul', (tag, sheet) => {\n    return new UnorderedList(tag, sheet);\n});\nexport class OrderedList extends UnorderedList {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n    }\n    get indentWidth() {\n        return this.children.length >= 10 ? 4 : 3;\n    }\n    _drawBullet(buffer, index, left, top, fg) {\n        const b = ('' + (index + 1) + '. ').padStart(this.indentWidth, ' ');\n        buffer.drawText(left, top, b, fg, -1);\n    }\n}\nParser.installElement('ol', (tag, sheet) => {\n    return new OrderedList(tag, sheet);\n});\n","import * as Element from './element';\nimport * as Parser from './parser';\nexport class DataList extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this._data = [];\n    }\n    // CONTENT\n    _setData(doc, v) {\n        if (!Array.isArray(v)) {\n            throw new Error('<datalist> only uses Array values for data field.');\n        }\n        super._setData(doc, v);\n        this.dirty = true;\n        if (this.children.length) {\n            const oldChildren = doc.select(this.children.filter((c) => c.tag === 'data'));\n            oldChildren.detach();\n        }\n        if (!this._data)\n            return;\n        this._data.forEach((item) => {\n            doc.create('<data>').text(item).appendTo(this);\n        });\n    }\n    get indentWidth() {\n        return 0;\n        // const prefix = this.attr('prefix') || DataList.default.prefix;\n        // if (!prefix) return 0;\n        // if (prefix.includes('#')) {\n        //     return prefix.length - 1 + this._data.length >= 10 ? 2 : 1;\n        // }\n        // return prefix.length;\n    }\n    _calcContentWidth() {\n        return DataList.default.width; // no legend or data, so use default\n    }\n    _calcContentHeight() {\n        return 1; // no legend or data so just an empty cell\n    }\n    _calcChildHeight() {\n        if (!this._data || this._data.length === 0) {\n            return super._calcChildHeight() + 1; // legend (if present) + empty cell\n        }\n        return super._calcChildHeight();\n    }\n    get innerLeft() {\n        return super.innerLeft + this.indentWidth;\n    }\n    get innerWidth() {\n        return Math.max(0, super.innerWidth - this.indentWidth);\n    }\n    // DRAWING\n    _drawContent(buffer) {\n        // draw legend and data (if any)\n        this._drawChildren(buffer);\n        if (!this._data || this._data.length == 0) {\n            // empty cell is necessary\n            const fg = this.used('fg') || 'white';\n            const top = this.innerBottom - 1;\n            const left = this.innerLeft + this.indentWidth;\n            const width = this.innerWidth - this.indentWidth;\n            const align = this.used('align');\n            const empty = this.attr('empty') || DataList.default.empty;\n            buffer.drawText(left, top, empty, fg, -1, width, align);\n        }\n    }\n    // CHILDREN\n    _isValidChild(child) {\n        return ['data', 'legend'].includes(child.tag);\n    }\n}\nDataList.default = {\n    bullet: '\\u2022',\n    empty: '-',\n    prefix: 'none',\n    width: 10,\n};\nParser.installElement('datalist', (tag, sheet) => {\n    return new DataList(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport { Selector } from '../selector';\nimport * as Style from './style';\nimport { Element } from './element';\nimport { parse } from './parser';\nStyle.defaultStyle.add('body', {\n    bg: 'black',\n});\nexport class Document {\n    constructor(ui, rootTag = 'body') {\n        this._activeElement = null;\n        this._done = false;\n        this.ui = ui;\n        this.stylesheet = new Style.Sheet();\n        this.body = new Element(rootTag);\n        this.body.style({\n            width: ui.buffer.width,\n            maxWidth: ui.buffer.width,\n            height: ui.buffer.height,\n            maxHeight: ui.buffer.height,\n            position: 'fixed',\n            top: 0,\n            left: 0,\n        });\n        this.body._attached = true; // attached as the root of the layer\n        this.children = [this.body];\n    }\n    $(id) {\n        return this.select(id);\n    }\n    select(id) {\n        let selected;\n        if (id === undefined) {\n            selected = [this.body];\n        }\n        else if (id instanceof Selection) {\n            return id;\n        }\n        else if (typeof id === 'string') {\n            if (id.startsWith('<')) {\n                selected = [this.createElement(id)];\n            }\n            else {\n                if (id === 'document') {\n                    selected = [this.body]; // convenience\n                }\n                else {\n                    const s = new Selector(id);\n                    selected = this.children.filter((w) => s.matches(w));\n                }\n            }\n        }\n        else if (Array.isArray(id)) {\n            selected = id;\n        }\n        else {\n            selected = [id];\n        }\n        return new Selection(this, selected);\n    }\n    createElement(tag) {\n        return parse(tag, this.stylesheet);\n    }\n    create(tag) {\n        return this.select(this.createElement(tag));\n    }\n    rule(rule, style) {\n        if (typeof rule === 'string') {\n            if (style) {\n                this.stylesheet.add(rule, style);\n                return this;\n            }\n            let out = this.stylesheet.get(rule);\n            if (out)\n                return out;\n            return this.stylesheet.add(rule, {});\n        }\n        Object.entries(rule).forEach(([name, value]) => {\n            this.stylesheet.add(name, value);\n        });\n        return this;\n    }\n    removeRule(rule) {\n        this.stylesheet.remove(rule);\n        return this;\n    }\n    _attach(w) {\n        if (Array.isArray(w)) {\n            w.forEach((x) => this._attach(x));\n            return this;\n        }\n        if (this.children.includes(w))\n            return this;\n        this.children.push(w);\n        w._attached = true;\n        w.children.forEach((c) => this._attach(c));\n        return this;\n    }\n    _detach(w) {\n        if (Array.isArray(w)) {\n            w.forEach((x) => this._detach(x));\n            return this;\n        }\n        if (w === this.body)\n            throw new Error('Cannot detach root widget.');\n        GWU.arrayDelete(this.children, w);\n        w._attached = false;\n        w.children.forEach((c) => this._detach(c));\n        return this;\n    }\n    computeStyles() {\n        let anyChanged = false;\n        this.children.forEach((w) => {\n            if (w.used().dirty || this.stylesheet.dirty) {\n                w.used(this.stylesheet.computeFor(w));\n                anyChanged = true;\n            }\n        });\n        this.stylesheet.dirty = false;\n        return anyChanged;\n    }\n    updateLayout(widget) {\n        widget = widget || this.body;\n        widget.updateLayout();\n    }\n    draw(buffer) {\n        if (this._prepareDraw()) {\n            buffer = buffer || this.ui.buffer;\n            this.body.draw(buffer);\n            buffer.render();\n            // console.log('draw');\n        }\n    }\n    _prepareDraw() {\n        if (!this.computeStyles() && !this.children.some((c) => c.dirty))\n            return false;\n        this.updateLayout();\n        return true;\n    }\n    // activeElement\n    get activeElement() {\n        return this._activeElement;\n    }\n    setActiveElement(w, reverse = false) {\n        if (w === this._activeElement)\n            return true;\n        const opts = {\n            target: w,\n            dir: [reverse ? -1 : 1, 0],\n        };\n        if (this._activeElement &&\n            this._fireEvent(this._activeElement, 'blur', opts)) {\n            return false;\n        }\n        if (w && this._fireEvent(w, 'focus', opts))\n            return false;\n        if (this._activeElement)\n            this._activeElement.onblur(this);\n        this._activeElement = w;\n        if (this._activeElement)\n            this._activeElement.onfocus(this, reverse);\n        return true;\n    }\n    nextTabStop() {\n        if (!this._activeElement) {\n            this.setActiveElement(this.children.find((w) => !w.prop('disabled') && w.prop('tabindex')) || null);\n            return !!this._activeElement;\n        }\n        const next = GWU.arrayNext(this.children, this._activeElement, (w) => !!w.prop('tabindex') && !w.prop('disabled'));\n        if (next) {\n            this.setActiveElement(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabStop() {\n        if (!this._activeElement) {\n            this.setActiveElement(this.children.find((w) => !w.prop('disabled') && w.prop('tabindex')) || null);\n            return !!this._activeElement;\n        }\n        const prev = GWU.arrayPrev(this.children, this._activeElement, (w) => !!w.prop('tabindex') && !w.prop('disabled'));\n        if (prev) {\n            this.setActiveElement(prev, true);\n            return true;\n        }\n        return false;\n    }\n    // events\n    // return topmost element under point\n    elementFromPoint(x, y) {\n        return this.body.elementFromPoint(x, y) || this.body;\n    }\n    _fireEvent(element, name, e) {\n        if (!e || !e.type) {\n            e = GWU.io.makeCustomEvent(name, e);\n        }\n        const handlers = element.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(this, element, e) || out, false);\n        return handled;\n    }\n    _bubbleEvent(element, name, e) {\n        let current = element;\n        while (current) {\n            const handlers = current.events[name] || [];\n            let handled = handlers.reduce((out, h) => h(this, current, e) || out, false);\n            if (handled)\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n    click(e) {\n        let element = this.elementFromPoint(e.x, e.y);\n        if (!element)\n            return false;\n        if (element.prop('disabled'))\n            return false;\n        if (this._bubbleEvent(element, 'click', e))\n            return this._done;\n        if (element.prop('tabindex')) {\n            this.setActiveElement(element);\n        }\n        return false;\n    }\n    mousemove(e) {\n        let element = this.elementFromPoint(e.x, e.y);\n        const hovered = [];\n        let current = element;\n        while (current) {\n            hovered.push(current);\n            current.prop('hover', true);\n            current = current.parent;\n        }\n        this.children.forEach((w) => {\n            if (hovered.includes(w))\n                return;\n            w.prop('hover', false);\n        });\n        if (element && this._bubbleEvent(element, 'mousemove', e))\n            return this._done;\n        return false;\n    }\n    // dir\n    dir(e) {\n        const element = this.activeElement || this.body;\n        if (element && this._bubbleEvent(element, 'dir', e))\n            return this._done;\n        return false;\n    }\n    // keypress\n    keypress(e) {\n        const element = this.activeElement || this.body;\n        if (element) {\n            if (this._bubbleEvent(element, e.key, e))\n                return this._done;\n            if (this._bubbleEvent(element, e.code, e))\n                return this._done;\n            if (this._bubbleEvent(element, 'keypress', e))\n                return this._done;\n        }\n        if (e.key === 'Tab') {\n            this.nextTabStop();\n        }\n        else if (e.key === 'TAB') {\n            this.prevTabStop();\n        }\n        return false;\n    }\n}\n///////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////\n// TODO - look at cheerio\nexport class Selection {\n    constructor(document, widgets = []) {\n        this.document = document;\n        this.selected = widgets.slice();\n    }\n    get(index) {\n        if (index === undefined)\n            return this.selected;\n        if (index < 0)\n            return this.selected[this.selected.length + index];\n        return this.selected[index];\n    }\n    length() {\n        return this.selected.length;\n    }\n    slice(start, end) {\n        return new Selection(this.document, this.selected.slice(start, end));\n    }\n    add(arg) {\n        if (!(arg instanceof Selection)) {\n            arg = this.document.$(arg);\n        }\n        arg.forEach((w) => {\n            if (!this.selected.includes(w)) {\n                this.selected.push(w);\n            }\n        });\n        return this;\n    }\n    clone() {\n        this.selected = this.selected.map((w) => w.clone());\n        return this;\n    }\n    // async ???\n    forEach(cb) {\n        this.selected.forEach(cb);\n        return this;\n    }\n    // HIERARCHY\n    after(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach();\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((next, i) => {\n            if (!next.parent)\n                throw new Error('Cannot add after detached widgets.');\n            current =\n                i < last ? content.clone() : content;\n            const parent = next.parent;\n            let nextIndex = parent.children.indexOf(next) + 1;\n            current.forEach((toAdd) => {\n                parent.appendChild(toAdd, nextIndex);\n                if (parent._attached) {\n                    this.document._attach(toAdd);\n                }\n            });\n        });\n        return this;\n    }\n    append(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach(); // remove all items to be appended from the tree\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((dest, i) => {\n            current =\n                i < last ? content.clone() : content;\n            current.forEach((toAppend) => {\n                dest.appendChild(toAppend);\n                if (dest._attached) {\n                    this.document._attach(toAppend);\n                }\n            });\n        });\n        return this;\n    }\n    appendTo(dest) {\n        if (!(dest instanceof Selection)) {\n            dest = this.document.$(dest);\n        }\n        dest.append(this);\n        return this;\n    }\n    before(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach();\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((next, i) => {\n            if (!next.parent)\n                throw new Error('Cannot add before detached widgets.');\n            current =\n                i < last ? content.clone() : content;\n            const parent = next.parent;\n            let nextIndex = parent.children.indexOf(next);\n            current.forEach((toAdd) => {\n                parent.appendChild(toAdd, nextIndex++);\n                if (parent._attached) {\n                    this.document._attach(toAdd);\n                }\n            });\n        });\n        return this;\n    }\n    detach() {\n        this.selected.forEach((w) => {\n            if (w._attached) {\n                if (!w.parent)\n                    throw new Error('Cannot detach root widget.');\n                w.parent.removeChild(w);\n                // remove from document.children\n                this.document._detach(w);\n            }\n        });\n        return this;\n    }\n    empty() {\n        this.selected.forEach((w) => {\n            const oldChildren = w.empty();\n            this.document._detach(oldChildren);\n        });\n        return this;\n    }\n    insertAfter(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.after(this);\n        return this;\n    }\n    insertBefore(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.before(this);\n        return this;\n    }\n    prepend(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach(); // remove all items to be prepended from the tree\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((dest, i) => {\n            current =\n                i < last ? content.clone() : content;\n            current.forEach((toAppend) => {\n                dest.appendChild(toAppend, 0); // before first child\n                if (dest._attached) {\n                    this.document._attach(toAppend);\n                }\n            });\n        });\n        return this;\n    }\n    prependTo(dest) {\n        if (!(dest instanceof Selection)) {\n            dest = this.document.$(dest);\n        }\n        dest.prepend(this);\n        return this;\n    }\n    remove(_sub) {\n        // TODO - subselector\n        // TODO - remove events\n        return this.detach();\n    }\n    replaceAll(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.before(this);\n        target.detach();\n        return this;\n    }\n    replaceWith(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        content.replaceAll(this);\n        return this;\n    }\n    text(t) {\n        if (!t) {\n            return this.selected.length ? this.selected[0].text() : '';\n        }\n        this.selected.forEach((w) => w.text(t));\n        return this;\n    }\n    data(d) {\n        if (d === undefined) {\n            if (!this.selected.length)\n                return undefined;\n            return this.selected[0].data();\n        }\n        this.selected.forEach((e) => e.data(this.document, d));\n        return this;\n    }\n    attr(id, value) {\n        if (value === undefined) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].attr(id);\n        }\n        this.selected.forEach((e) => e.attr(id, value));\n        return this;\n    }\n    prop(id, value) {\n        if (value === undefined) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].prop(id);\n        }\n        this.selected.forEach((e) => e.prop(id, value));\n        return this;\n    }\n    // STYLE\n    addClass(id) {\n        this.selected.forEach((w) => w.addClass(id));\n        return this;\n    }\n    hasClass(id) {\n        if (this.selected.length == 0)\n            return false;\n        return this.selected[0].classes.includes(id);\n    }\n    removeClass(id) {\n        this.selected.forEach((w) => w.removeClass(id));\n        return this;\n    }\n    toggleClass(id) {\n        this.selected.forEach((w) => w.toggleClass(id));\n        return this;\n    }\n    style(name, value) {\n        if (!name)\n            return this.selected[0].style();\n        if (value === undefined) {\n            if (typeof name === 'string') {\n                return this.selected[0].style(name);\n            }\n        }\n        this.selected.forEach((w) => {\n            if (typeof name === 'string') {\n                w.style(name, value);\n            }\n            else {\n                w.style(name);\n            }\n        });\n        return this;\n    }\n    removeStyle(name) {\n        this.selected.forEach((w) => w.removeStyle(name));\n        return this;\n    }\n    pos(...args) {\n        if (args.length == 0) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].pos();\n        }\n        this.selected.forEach((w) => w.pos(args[0], args[1], args[2]));\n        return this;\n    }\n    size(...args) {\n        if (args.length == 0) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].size();\n        }\n        this.selected.forEach((w) => w.size(args[0], args[1]));\n        return this;\n    }\n    // ANIMATION\n    animate(_props, _ms) {\n        return this;\n    }\n    clearQueue(_name) {\n        return this;\n    }\n    delay(_ms, _name) {\n        return this;\n    }\n    dequeue() {\n        return this;\n    }\n    fadeIn(_ms) {\n        return this;\n    }\n    fadeOut(_ms) {\n        return this;\n    }\n    fadeTo(_ms, _opacity) {\n        return this;\n    }\n    fadeToggle(_ms) {\n        return this;\n    }\n    finish(_name) {\n        return this;\n    }\n    hide(_ms) {\n        return this;\n    }\n    queue(..._args) {\n        return [];\n    }\n    show(_ms) {\n        return this;\n    }\n    slideDown(_ms) {\n        return this;\n    }\n    slideToggle(_ms) {\n        return this;\n    }\n    slideUp(_ms) {\n        return this;\n    }\n    stop() {\n        return this;\n    }\n    toggle(_arg) {\n        return this;\n    }\n    // EVENTS\n    on(event, cb) {\n        this.selected.forEach((w) => {\n            w.on(event, cb);\n        });\n        return this;\n    }\n    off(event, cb) {\n        this.selected.forEach((w) => {\n            w.off(event, cb);\n        });\n        return this;\n    }\n    fire(event, e) {\n        if (!e) {\n            e = GWU.io.makeCustomEvent(event);\n        }\n        this.selected.forEach((w) => {\n            const handlers = w.events[event];\n            if (handlers) {\n                handlers.forEach((cb) => cb(this.document, w, e));\n            }\n        });\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Style from '../style';\nStyle.defaultStyle.add('*', {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n});\nexport class Widget {\n    constructor(term, opts = {}) {\n        this.tag = 'text';\n        this.bounds = new GWU.xy.Bounds(0, 0, 0, 1);\n        this.depth = 0;\n        this.events = {};\n        this.action = '';\n        this.children = [];\n        this._style = new Style.Style();\n        this.parent = null;\n        this.classes = [];\n        this._props = {};\n        this._attrs = {};\n        this.term = term;\n        // this.bounds.x = term.x;\n        // this.bounds.y = term.y;\n        this.bounds.x = opts.x || 0;\n        this.bounds.y = opts.y || 0;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        if (opts.tag) {\n            this.tag = opts.tag;\n        }\n        if (opts.id) {\n            this.attr('id', opts.id);\n        }\n        if (opts.parent) {\n            this.parent = opts.parent;\n        }\n        if (opts.depth) {\n            this.depth = opts.depth;\n        }\n        this._style.set(opts);\n        if (opts.class) {\n            if (typeof opts.class === 'string') {\n                opts.class = opts.class.split(/ +/g);\n            }\n            this.classes = opts.class.map((c) => c.trim());\n        }\n        if (opts.tabStop) {\n            this.prop('tabStop', true);\n        }\n        if (opts.action) {\n            this.attr('action', opts.action);\n        }\n        if (opts.action) {\n            this.action = opts.action;\n            this.on('click', (_n, w, e) => {\n                if (this.action) {\n                    this._bubbleEvent(this.action, w, e);\n                }\n                return false; // keep bubbling\n            });\n        }\n        this._updateStyle();\n    }\n    attr(name, v) {\n        if (v === undefined)\n            return this._attrs[name];\n        this._attrs[name] = v;\n        return this;\n    }\n    prop(name, v) {\n        if (v === undefined)\n            return this._props[name];\n        const current = this._props[name];\n        if (current !== v) {\n            this._props[name] = v;\n            // console.log(`${this.tag}.${name}=${v}`);\n            this._updateStyle();\n        }\n        return this;\n    }\n    toggleProp(name) {\n        const current = !!this._props[name];\n        this.prop(name, !current);\n        return this;\n    }\n    incProp(name) {\n        let current = this.prop(name) || 0;\n        if (typeof current === 'boolean') {\n            current = current ? 1 : 0;\n        }\n        else if (typeof current === 'string') {\n            current = Number.parseInt(current) || 0;\n        }\n        ++current;\n        this.prop(name, current);\n        return this;\n    }\n    contains(...args) {\n        return this.bounds.contains(args[0], args[1]);\n    }\n    style(opts) {\n        if (opts === undefined)\n            return this._style;\n        this._style.set(opts);\n        this._updateStyle();\n        return this;\n    }\n    addClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a))\n                return;\n            this.classes.push(a);\n        });\n        return this;\n    }\n    removeClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            GWU.arrayDelete(this.classes, a);\n        });\n        return this;\n    }\n    hasClass(c) {\n        const all = c.split(/ +/g);\n        return GWU.arrayIncludesAll(this.classes, all);\n    }\n    toggleClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a)) {\n                GWU.arrayDelete(this.classes, a);\n            }\n            else {\n                this.classes.push(a);\n            }\n        });\n        return this;\n    }\n    get focused() {\n        return !!this.prop('focus');\n    }\n    set focused(v) {\n        this.prop('focus', v);\n    }\n    get hovered() {\n        return !!this.prop('hover');\n    }\n    set hovered(v) {\n        this.prop('hover', v);\n    }\n    get hidden() {\n        let current = this;\n        while (current) {\n            if (current.prop('hidden'))\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n    set hidden(v) {\n        this.prop('hidden', v);\n    }\n    _updateStyle() {\n        this._used = this.term.styles.computeFor(this);\n        this.term.needsDraw = true; // changed style or state\n    }\n    draw(buffer) {\n        if (this.hidden)\n            return false;\n        return this._draw(buffer);\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        return true;\n    }\n    _drawFill(buffer) {\n        if (this._used.bg !== undefined && this._used.bg !== -1) {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this._used.bg, this._used.bg);\n            return true;\n        }\n        return false;\n    }\n    // Children\n    addChild(w, beforeIndex = -1) {\n        if (w.parent && w.parent !== this)\n            throw new Error('Trying to add child that already has a parent.');\n        if (!this.children.includes(w)) {\n            if (beforeIndex < 0 || beforeIndex >= this.children.length) {\n                this.children.push(w);\n            }\n            else {\n                this.children.splice(beforeIndex, 0, w);\n            }\n        }\n        w.parent = this;\n        return this;\n    }\n    removeChild(w) {\n        if (!w.parent || w.parent !== this)\n            throw new Error('Removing child that does not have this widget as parent.');\n        GWU.arrayDelete(this.children, w);\n        w.parent = null;\n        return this;\n    }\n    // Events\n    mouseenter(e) {\n        if (!this.contains(e))\n            return;\n        if (this.hovered)\n            return;\n        this.hovered = true;\n        this._fireEvent('mouseenter', this, e);\n        if (this.parent) {\n            this.parent.mouseenter(e);\n        }\n    }\n    mousemove(e) {\n        if (this.hidden)\n            return false;\n        if (this.contains(e) && !e.defaultPrevented) {\n            this.mouseenter(e);\n            this._fireEvent('mousemove', this, e);\n            e.preventDefault();\n        }\n        else {\n            this.mouseleave(e);\n        }\n        return false;\n    }\n    mouseleave(e) {\n        if (this.contains(e))\n            return;\n        if (!this.hovered)\n            return;\n        this.hovered = false;\n        this._fireEvent('mouseleave', this, e);\n        if (this.parent) {\n            this.parent.mouseleave(e);\n        }\n    }\n    click(e) {\n        if (this.hidden)\n            return false;\n        return this._bubbleEvent('click', this, e);\n    }\n    keypress(_e) {\n        return false;\n    }\n    dir(_e) {\n        return false;\n    }\n    tick(_e) {\n        return false;\n    }\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    _fireEvent(name, source, e) {\n        if (!e || !e.type) {\n            e = GWU.io.makeCustomEvent(name, e);\n        }\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source || this, e) || out, false);\n        return handled;\n    }\n    _bubbleEvent(name, source, e) {\n        let current = this;\n        while (current) {\n            if (current._fireEvent(name, source, e))\n                return true;\n            current = current.parent;\n        }\n        return this.term.fireEvent(name, source, e);\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Border extends Widget.Widget {\n    constructor(term, opts) {\n        super(term, opts);\n        this.ascii = false;\n        if (opts.ascii) {\n            this.ascii = true;\n        }\n        else if (opts.fg && opts.ascii !== false) {\n            this.ascii = true;\n        }\n    }\n    contains(..._args) {\n        return false;\n    }\n    _draw(buffer) {\n        const w = this.bounds.width;\n        const h = this.bounds.height;\n        const x = this.bounds.x;\n        const y = this.bounds.y;\n        const ascii = this.ascii;\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        return true;\n    }\n}\nexport function drawBorder(buffer, x, y, w, h, style, ascii) {\n    const fg = style.fg;\n    const bg = style.bg;\n    if (ascii) {\n        for (let i = 1; i < w; ++i) {\n            buffer.draw(x + i, y, '-', fg, bg);\n            buffer.draw(x + i, y + h - 1, '-', fg, bg);\n        }\n        for (let j = 1; j < h; ++j) {\n            buffer.draw(x, y + j, '|', fg, bg);\n            buffer.draw(x + w - 1, y + j, '|', fg, bg);\n        }\n        buffer.draw(x, y, '+', fg, bg);\n        buffer.draw(x + w - 1, y, '+', fg, bg);\n        buffer.draw(x, y + h - 1, '+', fg, bg);\n        buffer.draw(x + w - 1, y + h - 1, '+', fg, bg);\n    }\n    else {\n        GWU.xy.forBorder(x, y, w, h, (x, y) => {\n            buffer.draw(x, y, ' ', bg, bg);\n        });\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nexport class Text extends Widget {\n    constructor(term, text, opts = {}) {\n        super(term, opts);\n        this._text = '';\n        this._lines = [];\n        this._fixedWidth = false;\n        this._fixedHeight = false;\n        this._fixedHeight = !!opts.height;\n        this._fixedWidth = !!opts.width;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        this.text(text);\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        this._text = v;\n        let w = this._fixedWidth ? this.bounds.width : 100;\n        this._lines = GWU.text.splitIntoLines(this._text, w);\n        if (!this._fixedWidth) {\n            this.bounds.width = this._lines.reduce((out, line) => Math.max(out, GWU.text.length(line)), 0);\n        }\n        if (this._fixedHeight) {\n            if (this._lines.length > this.bounds.height) {\n                this._lines.length = this.bounds.height;\n            }\n        }\n        else {\n            this.bounds.height = this._lines.length;\n        }\n        this.term.needsDraw = true;\n        return this;\n    }\n    _draw(buffer, _force = false) {\n        this._drawFill(buffer);\n        let vOffset = 0;\n        if (this._used.valign === 'bottom') {\n            vOffset = this.bounds.height - this._lines.length;\n        }\n        else if (this._used.valign === 'middle') {\n            vOffset = Math.floor((this.bounds.height - this._lines.length) / 2);\n        }\n        this._lines.forEach((line, i) => {\n            buffer.drawText(this.bounds.x, this.bounds.y + i + vOffset, line, this._used.fg, -1, this.bounds.width, this._used.align);\n        });\n        return true;\n    }\n}\n","import * as Widget from './widget';\nexport class Button extends Widget.Widget {\n    constructor(term, opts) {\n        super(term, opts);\n    }\n}\n","import * as GWU from 'gw-utils';\nexport class Grid {\n    constructor(x, y) {\n        this._left = 0;\n        this._top = 0;\n        this._colWidths = [];\n        this._rowHeights = [];\n        this._col = 0;\n        this._row = -1;\n        this.x = 0;\n        this.y = 0;\n        this._left = x;\n        this._top = y;\n        this.x = x;\n        this.y = y;\n    }\n    cols(...args) {\n        if (args.length === 0)\n            return this._colWidths;\n        if (args.length == 2) {\n            args[0] = new Array(args[0]).fill(args[1]);\n        }\n        if (Array.isArray(args[0])) {\n            this._colWidths = args[0];\n        }\n        return this;\n    }\n    rows(...args) {\n        if (args.length === 0)\n            return this._rowHeights;\n        if (typeof args[0] === 'number') {\n            args[0] = new Array(args[0]).fill(args[1] || 1);\n        }\n        if (Array.isArray(args[0])) {\n            this._rowHeights = args[0];\n        }\n        return this;\n    }\n    col(n) {\n        if (n === undefined)\n            n = this._col;\n        this._col = GWU.clamp(n, 0, this._colWidths.length - 1);\n        return this._resetX()._resetY(); // move back to top of our current row\n    }\n    nextCol() {\n        return this.col(this._col + 1);\n    }\n    row(n) {\n        if (n === undefined)\n            n = this._row;\n        this._row = GWU.clamp(n, 0, this._rowHeights.length - 1);\n        return this._resetY()._resetX(); // move back to beginning of current column\n    }\n    nextRow() {\n        return this.row(this._row + 1).col(0);\n    }\n    setRowHeight(h) {\n        if (h < 0)\n            return this;\n        this._rowHeights[this._row] = h;\n        return this;\n    }\n    _resetX() {\n        this.x = this._left;\n        for (let i = 0; i < this._col; ++i) {\n            this.x += this._colWidths[i];\n        }\n        return this;\n    }\n    _resetY() {\n        this.y = this._top;\n        for (let i = 0; i < this._row; ++i) {\n            this.y += this._rowHeights[i];\n        }\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nimport { drawBorder } from './border';\nexport class Column {\n    constructor(opts) {\n        this.format = GWU.IDENTITY;\n        this.width = opts.width;\n        if (typeof opts.format === 'function') {\n            this.format = opts.format;\n        }\n        else if (opts.format) {\n            this.format = GWU.text.compile(opts.format);\n        }\n        this.header = opts.header || '';\n        this.headerClass = opts.headerClass || '';\n        this.empty = opts.empty || '';\n        this.dataClass = opts.dataClass || '';\n    }\n    makeHeader(table) {\n        return table.term.text(this.header, {\n            class: this.headerClass,\n            tag: table.headerTag,\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n        });\n    }\n    makeData(table, data, col, row) {\n        let text;\n        if (Array.isArray(data)) {\n            text = '' + (data[col] || this.empty);\n        }\n        else if (typeof data !== 'object') {\n            text = '' + data;\n        }\n        else {\n            text = this.format(data);\n        }\n        const widget = table.term.text(text, {\n            class: this.dataClass,\n            tag: table.dataTag,\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n        });\n        widget.prop(row % 2 == 0 ? 'even' : 'odd', true);\n        widget.prop('row', row);\n        widget.prop('col', col);\n        return widget;\n    }\n}\nexport class Table extends Widget {\n    constructor(term, opts) {\n        super(term, opts);\n        this._data = [];\n        this.columns = [];\n        this.showHeader = false;\n        this.headerTag = 'th';\n        this.dataTag = 'td';\n        this.prefix = 'none';\n        this.select = 'cell';\n        this.rowHeight = 1;\n        this.border = 'none';\n        this.tag = 'table';\n        this.size = opts.size || term.height;\n        this.bounds.width = 0;\n        opts.columns.forEach((o) => {\n            const col = new Column(o);\n            this.columns.push(col);\n            this.bounds.width += col.width;\n        });\n        if (opts.border) {\n            if (opts.border === true)\n                opts.border = 'ascii';\n            this.border = opts.border;\n        }\n        this.rowHeight = opts.rowHeight || 1;\n        this.bounds.height = 1;\n        if (opts.header) {\n            this.showHeader = true;\n        }\n        if (opts.headerTag)\n            this.headerTag = opts.headerTag;\n        if (opts.dataTag)\n            this.dataTag = opts.dataTag;\n        if (opts.prefix)\n            this.prefix = opts.prefix;\n        if (opts.select)\n            this.select = opts.select;\n        if (opts.data) {\n            this.data(opts.data);\n        }\n    }\n    data(data) {\n        if (data === undefined)\n            return this._data;\n        this._data = data;\n        this.children = []; // get rid of old format...\n        const borderAdj = this.border !== 'none' ? 1 : 0;\n        let x = this.bounds.x + borderAdj;\n        let y = this.bounds.y + borderAdj;\n        if (this.showHeader) {\n            this.columns.forEach((col) => {\n                this.term.pos(x, y);\n                const th = col.makeHeader(this);\n                this.children.push(th);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        }\n        this._data.forEach((obj, j) => {\n            if (j >= this.size)\n                return;\n            x = this.bounds.x + borderAdj;\n            this.columns.forEach((col, i) => {\n                this.term.pos(x, y);\n                const td = col.makeData(this, obj, i, j);\n                this.children.push(td);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        });\n        this.bounds.height = y - this.bounds.y;\n        this.bounds.width = x - this.bounds.x;\n        this._updateStyle(); // sets this.needsDraw\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        this.children.forEach((w) => {\n            if (w.prop('row') >= this.size)\n                return;\n            if (this.border !== 'none') {\n                drawBorder(buffer, w.bounds.x - 1, w.bounds.y - 1, w.bounds.width + 2, w.bounds.height + 2, this._used, this.border == 'ascii');\n            }\n        });\n        return true;\n    }\n    mousemove(e) {\n        const active = (this.hovered = this.contains(e));\n        if (!active) {\n            this.children.forEach((c) => (c.hovered = false));\n            return false;\n        }\n        const hovered = this.children.find((c) => c.contains(e));\n        if (hovered) {\n            if (this.select === 'none') {\n                this.children.forEach((c) => (c.hovered = false));\n            }\n            else if (this.select === 'row') {\n                this.children.forEach((c) => (c.hovered = hovered.prop('row') == c.prop('row')));\n            }\n            else if (this.select === 'column') {\n                this.children.forEach((c) => (c.hovered = hovered.prop('col') == c.prop('col')));\n            }\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Menu extends Widget.Widget {\n    constructor(term, opts) {\n        super(term, opts);\n        this.tag = opts.tag || 'menu';\n        this.buttonClass = opts.buttonClass || '';\n        this.buttonTag = opts.buttonTag || 'mi';\n        this._initButtons(opts);\n        this.bounds.height = this.children.length;\n    }\n    _initButtons(opts) {\n        this.children = [];\n        const buttons = opts.buttons;\n        const entries = Object.entries(buttons);\n        if (this.bounds.width <= 0) {\n            this.bounds.width = Math.max(opts.minWidth || 0, entries.reduce((out, [key, value]) => {\n                const textLen = GWU.text.length(key) +\n                    (typeof value === 'string' ? 0 : 2);\n                return Math.max(out, textLen);\n            }, 0));\n        }\n        entries.forEach(([key, value], i) => {\n            const opts = {\n                x: this.bounds.x,\n                y: this.bounds.y + i,\n                class: this.buttonClass,\n                tag: this.buttonTag,\n                width: this.bounds.width,\n                height: 1,\n                depth: this.depth + 1,\n                parent: this,\n            };\n            if (typeof value === 'string') {\n                opts.action = value;\n                const menuItem = this.term.text(key, opts);\n                this.children.push(menuItem);\n            }\n            else {\n                const menuOpts = opts;\n                menuOpts.text = key;\n                menuOpts.buttons = value;\n                const menuItem = new MenuButton(this.term, menuOpts);\n                this.term.addWidget(menuItem);\n                this.children.push(menuItem);\n            }\n        });\n    }\n}\nexport class MenuButton extends Widget.Widget {\n    constructor(term, opts) {\n        super(term, opts);\n        this.tag = opts.tag || 'mi';\n        this._initButton(opts);\n        this._initMenu(opts);\n        this.bounds.height = 1;\n    }\n    _initButton(opts) {\n        this.button = this.term\n            .text(opts.text + ' \\u25b6', {\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'mi',\n            width: this.bounds.width,\n            height: 1,\n            depth: this.depth + 1,\n            parent: this,\n        })\n            .on('mouseenter', () => {\n            this.menu.hidden = false;\n            return false;\n        })\n            .on('mouseleave', (_n, _w, e) => {\n            if (!this.menu.contains(e)) {\n                this.menu.hidden = true;\n            }\n            return false;\n        });\n        this.addChild(this.button, 0);\n    }\n    _initMenu(opts) {\n        this.menu = this.term\n            .menu({\n            x: this.bounds.x + this.button.bounds.width,\n            y: this.bounds.y,\n            class: opts.buttonClass,\n            tag: opts.buttonTag || 'select',\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n            parent: this,\n        })\n            .on('click', () => {\n            this.menu.hidden = true;\n            return false;\n        })\n            .on('mouseleave', (_n, _w, e) => {\n            if (!this.button.contains(e)) {\n                this.menu.hidden = true;\n            }\n            return false;\n        });\n        this.menu.hidden = true;\n        this.addChild(this.menu);\n    }\n}\n","// import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Select extends Widget.Widget {\n    constructor(term, opts) {\n        super(term, opts);\n        this.tag = opts.tag || 'select';\n        this._initText(opts);\n        this._initMenu(opts);\n        this.bounds.height = 1; // just the text component\n    }\n    _initText(opts) {\n        this.dropdown = this.term\n            .text(opts.text + ' \\u25bc', {\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'select',\n            width: this.bounds.width,\n            height: 1,\n            depth: this.depth + 1,\n            parent: this,\n        })\n            .on('click', () => {\n            this.menu.toggleProp('hidden');\n            return false;\n        });\n        this.addChild(this.dropdown, 0);\n    }\n    _initMenu(opts) {\n        this.menu = this.term\n            .menu({\n            x: this.bounds.x,\n            y: this.bounds.y + 1,\n            class: opts.buttonClass,\n            tag: opts.buttonTag || 'select',\n            width: opts.width,\n            minWidth: this.dropdown.bounds.width,\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n            parent: this,\n        })\n            .on('click', () => {\n            this.menu.hidden = true;\n            return false;\n        });\n        this.menu.hidden = true;\n        this.addChild(this.menu);\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Grid } from './grid';\nimport * as Text from './text';\nimport * as Style from '../style';\nimport * as Widget from './widget';\nimport * as Table from './table';\nimport * as Menu from './menu';\nimport * as Button from './button';\nimport * as Border from './border';\nimport * as Select from './select';\nexport class Term {\n    constructor(ui) {\n        this.opts = {};\n        // widgets: Widget.Widget[] = [];\n        this.allWidgets = [];\n        this.styles = new Style.Sheet();\n        // _currentWidget: Widget.Widget | null = null;\n        this.events = {};\n        this._grid = null;\n        this._needsDraw = false;\n        this._buffer = null;\n        this.ui = ui;\n        this.body = new Widget.Widget(this, {\n            tag: 'body',\n            id: 'BODY',\n            depth: -1,\n            width: ui.width,\n            height: ui.height,\n        });\n        this.allWidgets.push(this.body);\n        this.reset();\n    }\n    get buffer() {\n        return this._buffer || this.ui.buffer;\n    }\n    get width() {\n        return this.ui.width;\n    }\n    get height() {\n        return this.ui.height;\n    }\n    get needsDraw() {\n        return this._needsDraw;\n    }\n    set needsDraw(v) {\n        this._needsDraw = v;\n    }\n    // RUN\n    show() {\n        if (this._buffer)\n            return;\n        this._buffer = this.ui.startLayer();\n    }\n    hide() {\n        if (!this._buffer)\n            return;\n        this.ui.finishLayer();\n        this._buffer = null;\n    }\n    // COLOR\n    reset() {\n        this.opts = { x: 0, y: 0 };\n        return this;\n    }\n    fg(v) {\n        this.opts.fg = v;\n        return this;\n    }\n    bg(v) {\n        this.opts.bg = v;\n        return this;\n    }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this.opts.fg = GWU.color.from(this.opts.fg || 'white').darken(pct);\n        }\n        if (bg) {\n            this.opts.bg = GWU.color.from(this.opts.bg || 'black').darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this.opts.fg = GWU.color.from(this.opts.fg || 'white').lighten(pct);\n        }\n        if (bg) {\n            this.opts.bg = GWU.color.from(this.opts.bg || 'black').lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this.opts.fg, this.opts.bg] = [this.opts.bg, this.opts.fg];\n        return this;\n    }\n    // STYLE\n    style(opts) {\n        Object.assign(this.opts, opts);\n        return this;\n    }\n    // POSITION\n    pos(x, y) {\n        this.opts.x = GWU.clamp(x, 0, this.width);\n        this.opts.y = GWU.clamp(y, 0, this.height);\n        return this;\n    }\n    moveTo(x, y) {\n        return this.pos(x, y);\n    }\n    move(dx, dy) {\n        this.opts.x = GWU.clamp(this.opts.x + dx, 0, this.width);\n        this.opts.y = GWU.clamp(this.opts.y + dy, 0, this.height);\n        return this;\n    }\n    up(n = 1) {\n        return this.move(0, -n);\n    }\n    down(n = 1) {\n        return this.move(0, n);\n    }\n    left(n = 1) {\n        return this.move(-n, 0);\n    }\n    right(n = 1) {\n        return this.move(n, 0);\n    }\n    nextLine(n = 1) {\n        return this.pos(0, this.opts.y + n);\n    }\n    prevLine(n = 1) {\n        return this.pos(0, this.opts.y - n);\n    }\n    // EDIT\n    // erase and move back to top left\n    clear(color) {\n        this.body.children = [];\n        this.allWidgets = [this.body];\n        if (color) {\n            this.body.style().set('bg', color);\n        }\n        else {\n            this.body.style().unset('bg');\n        }\n        return this;\n    }\n    // // just erase screen\n    // erase(color?: GWU.color.ColorBase): this {\n    //     // remove all widgets\n    //     this._needsDraw = true;\n    //     if (color === undefined) {\n    //         color = this.opts.bg;\n    //     }\n    //     this.buffer.fill(' ', color, color);\n    //     return this;\n    // }\n    // eraseBelow(): this {\n    //     // TODO - remove widgets below\n    //     this.buffer.fillRect(\n    //         0,\n    //         this.y + 1,\n    //         this.width,\n    //         this.height - this.y - 1,\n    //         ' ',\n    //         this._style.bg,\n    //         this._style.bg\n    //     );\n    //     this._needsDraw = true;\n    //     return this;\n    // }\n    // eraseAbove(): this {\n    //     // TODO - remove widgets above\n    //     this.buffer.fillRect(\n    //         0,\n    //         0,\n    //         this.width,\n    //         this.y - 1,\n    //         ' ',\n    //         this._style.bg,\n    //         this._style.bg\n    //     );\n    //     this._needsDraw = true;\n    //     return this;\n    // }\n    // eraseLine(n: number): this {\n    //     if (n === undefined) {\n    //         n = this.y;\n    //     }\n    //     if (n >= 0 && n < this.height) {\n    //         // TODO - remove widgets on line\n    //         this.buffer.fillRect(\n    //             0,\n    //             n,\n    //             this.width,\n    //             1,\n    //             ' ',\n    //             this._style.bg,\n    //             this._style.bg\n    //         );\n    //     }\n    //     this._needsDraw = true;\n    //     return this;\n    // }\n    // eraseLineAbove(): this {\n    //     return this.eraseLine(this.y - 1);\n    // }\n    // eraseLineBelow(): this {\n    //     return this.eraseLine(this.y + 1);\n    // }\n    // GRID\n    // erases/clears current grid information\n    grid() {\n        this._grid = new Grid(this.opts.x, this.opts.y);\n        return this;\n    }\n    endGrid() {\n        this._grid = null;\n        return this;\n    }\n    cols(...args) {\n        if (!this._grid)\n            return this;\n        this._grid.cols(args[0], args[1]);\n        return this;\n    }\n    rows(...args) {\n        if (!this._grid)\n            return this;\n        this._grid.rows(args[0], args[1]);\n        return this;\n    }\n    startRow(n) {\n        if (!this._grid)\n            return this;\n        if (n !== undefined) {\n            this._grid.row(n);\n        }\n        else {\n            this._grid.nextRow();\n        }\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    nextCol() {\n        if (!this._grid)\n            return this;\n        this._grid.nextCol();\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    // new row height\n    endRow(h) {\n        if (!this._grid)\n            return this;\n        if (h !== undefined && h > 0) {\n            this._grid.setRowHeight(h);\n        }\n        return this;\n    }\n    // moves to specific column\n    col(n) {\n        if (!this._grid)\n            return this;\n        this._grid.col(n);\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    // moves to specific row\n    row(n) {\n        if (!this._grid)\n            return this;\n        this._grid.row(n);\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    // WIDGETS\n    addWidget(w) {\n        const index = this.allWidgets.findIndex((aw) => aw.depth <= w.depth);\n        if (index < 0) {\n            this.allWidgets.push(w);\n        }\n        else {\n            this.allWidgets.splice(index, 0, w);\n        }\n        if (!w.parent) {\n            this.body.addChild(w);\n        }\n        this.needsDraw = true;\n        return this;\n    }\n    removeWidget(w) {\n        // GWU.arrayDelete(this.widgets, w);\n        GWU.arrayDelete(this.allWidgets, w);\n        this.needsDraw = true;\n        if (w.parent) {\n            w.parent.removeChild(w);\n        }\n        return this;\n    }\n    widgetAt(...args) {\n        return (this.allWidgets.find((w) => w.contains(args[0], args[1]) && !w.hidden) || null);\n    }\n    text(text, opts = {}) {\n        // TODO - if in a grid cell, adjust width and height based on grid\n        // opts.style = opts.style || this._style;\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Text.Text(this, text, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    table(opts) {\n        // TODO - if in a grid cell, adjust width and height based on grid\n        // opts.style = opts.style || this._style;\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Table.Table(this, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    menu(opts) {\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Menu.Menu(this, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    button(opts) {\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Button.Button(this, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    border(opts) {\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Border.Border(this, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    select(opts) {\n        const _opts = Object.assign({}, this.opts, opts);\n        const widget = new Select.Select(this, _opts);\n        this.addWidget(widget);\n        return widget;\n    }\n    // CONTROL\n    render() {\n        this.draw();\n        return this;\n    }\n    // EVENTS\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    fireEvent(name, source, e) {\n        if (!e || !e.type) {\n            e = GWU.io.makeCustomEvent(name, e);\n        }\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source, e) || out, false);\n        return handled;\n    }\n    mousemove(e) {\n        this.allWidgets.forEach((w) => {\n            w.mousemove(e);\n        });\n        return false; // TODO - this._done\n    }\n    click(e) {\n        const w = this.widgetAt(e);\n        if (w) {\n            w.click(e);\n        }\n        else {\n            this.fireEvent('click', null, e);\n        }\n        return false; // TODO - this._done\n    }\n    draw() {\n        if (this.styles.dirty) {\n            this._needsDraw = true;\n            this.allWidgets.forEach((w) => w._updateStyle());\n            this.styles.dirty = false;\n        }\n        if (!this._needsDraw)\n            return;\n        this._needsDraw = false;\n        if (!this._buffer) {\n            this.show();\n        }\n        this.ui.resetLayerBuffer();\n        // draw from low depth to high depth\n        for (let i = this.allWidgets.length - 1; i >= 0; --i) {\n            const w = this.allWidgets[i];\n            w.draw(this._buffer);\n        }\n        console.log('draw');\n        this.ui.render();\n    }\n}\n","import * as Table from './table';\nexport class List extends Table.Table {\n    constructor(id, opts) {\n        super(id, (() => {\n            // @ts-ignore\n            const tableOpts = opts;\n            tableOpts.columns = [opts];\n            tableOpts.headers = opts.header ? true : false;\n            tableOpts.hover = opts.hover === false ? 'none' : 'row';\n            return tableOpts;\n        })());\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Messages extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        opts.x = opts.x || 0;\n        opts.y = opts.y || 0;\n        super.init(opts);\n        if (!this.bounds.height)\n            throw new Error('Must provde a height for messages widget.');\n        this.cache = new GWU.message.MessageCache({\n            width: this.bounds.width,\n            length: opts.length || 40,\n            match: (_x, _y) => {\n                return true;\n            },\n        });\n    }\n    click(e, dialog) {\n        if (!this.contains(e))\n            return false;\n        return this.showArchive(dialog).then(() => true);\n    }\n    draw(buffer) {\n        const isOnTop = this.bounds.y < 10;\n        // black out the message area\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.bg, this.bg);\n        this.cache.forEach((line, confirmed, i) => {\n            if (i >= this.bounds.height)\n                return;\n            const localY = isOnTop ? this.bounds.height - i - 1 : i;\n            const y = localY + this.bounds.y;\n            buffer.drawText(this.bounds.x, y, line, this.fg);\n            if (confirmed) {\n                buffer.mix(this.bg, 50, this.bounds.x, y, this.bounds.width, 1);\n            }\n        });\n        return true;\n    }\n    async showArchive(dialog) {\n        let reverse, fadePercent = 0;\n        let fastForward;\n        const ui = dialog.ui;\n        // Count the number of lines in the archive.\n        let totalMessageCount = this.cache.length;\n        if (totalMessageCount <= this.bounds.height)\n            return false;\n        const isOnTop = this.bounds.y < 10;\n        const dbuf = ui.startLayer();\n        const fg = GWU.color.from(this.fg);\n        totalMessageCount = Math.min(totalMessageCount, isOnTop ? dbuf.height - this.bounds.top : this.bounds.bottom);\n        // Pull-down/pull-up animation:\n        for (reverse = 0; reverse <= 1; reverse++) {\n            fastForward = false;\n            const dM = reverse ? -1 : 1;\n            const startM = reverse ? totalMessageCount : this.bounds.height;\n            const endM = reverse\n                ? this.bounds.height + dM + 1\n                : totalMessageCount + dM;\n            // console.log(\n            //     `setting up draw - startM=${startM}, endM=${endM}, dM=${dM}`\n            // );\n            for (let currentM = startM; currentM != endM; currentM += dM) {\n                const startY = isOnTop\n                    ? this.bounds.y + currentM - 1\n                    : this.bounds.bottom - currentM;\n                const endY = isOnTop ? this.bounds.y : this.bounds.bottom;\n                const dy = isOnTop ? -1 : 1;\n                ui.resetLayerBuffer();\n                // console.log(\n                //     `draw archive - count=${i}, startY=${startY}, endY=${endY}, dy=${dy}`\n                // );\n                dbuf.fillRect(this.bounds.x, Math.min(startY, endY), this.bounds.width, currentM, ' ', this.bg, this.bg);\n                this.cache.forEach((line, _confirmed, j) => {\n                    const y = startY + j * dy;\n                    if (isOnTop) {\n                        if (y < endY)\n                            return;\n                    }\n                    else if (y > endY)\n                        return;\n                    fadePercent = Math.floor((50 * j) / currentM);\n                    const fgColor = fg.clone().mix(this.bg, fadePercent);\n                    dbuf.drawText(this.bounds.x, y, line, fgColor, this.bg);\n                });\n                dbuf.render();\n                if (!fastForward) {\n                    if (await ui.loop.pause(reverse ? 15 : 45)) {\n                        fastForward = true;\n                        currentM = endM - 2 * dM; // skip to the end-1\n                    }\n                }\n            }\n            if (!reverse) {\n                const y = isOnTop ? 0 : dbuf.height - 1;\n                const x = this.bounds.x > 8\n                    ? this.bounds.x - 8 // to left of box\n                    : Math.min(this.bounds.x + this.bounds.width, // just to right of box\n                    dbuf.width - 8 // But definitely on the screen - overwrite some text if necessary\n                    );\n                dbuf.wrapText(x, y, 8, '--DONE--', this.bg, this.fg);\n                dbuf.render();\n                await ui.loop.waitForAck();\n            }\n        }\n        ui.finishLayer();\n        this.cache.confirmAll();\n        dialog.requestRedraw(); // everything is confirmed\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class UI {\n    constructor(opts = {}) {\n        this.layers = [];\n        this.freeBuffers = [];\n        this.inDialog = false;\n        if (!opts.canvas)\n            throw new Error('Need a canvas.');\n        this.canvas = opts.canvas;\n        this.buffer = opts.canvas.buffer;\n        this.loop = opts.loop || GWU.loop;\n    }\n    get width() {\n        return this.canvas.width;\n    }\n    get height() {\n        return this.canvas.height;\n    }\n    render() {\n        this.buffer.render();\n    }\n    get baseBuffer() {\n        return this.layers[this.layers.length - 1] || this.canvas.buffer;\n    }\n    get canvasBuffer() {\n        return this.canvas.buffer;\n    }\n    startLayer() {\n        this.inDialog = true;\n        const base = this.buffer || this.canvas.buffer;\n        this.layers.push(base);\n        this.buffer = this.freeBuffers.pop() || this.canvas.buffer.clone();\n        // UI_OVERLAY._data.forEach( (c) => c.opacity = 0 );\n        this.buffer.copy(base);\n        this.buffer.changed = false;\n        return this.buffer;\n    }\n    resetLayerBuffer() {\n        const base = this.baseBuffer;\n        this.buffer.copy(base);\n        this.buffer.changed = false; // So you have to draw something to make the canvas render...\n    }\n    finishLayer() {\n        if (!this.inDialog)\n            return;\n        if (this.buffer !== this.canvas.buffer) {\n            this.freeBuffers.push(this.buffer);\n        }\n        this.buffer = this.layers.pop() || this.canvas.buffer;\n        this.buffer.changed = true;\n        this.buffer.render();\n        this.inDialog = this.layers.length > 0;\n    }\n    // UTILITY FUNCTIONS\n    async fadeTo(color = 'black', duration = 1000) {\n        color = GWU.color.from(color);\n        const buffer = this.startLayer();\n        let pct = 0;\n        let elapsed = 0;\n        while (elapsed < duration) {\n            elapsed += 32;\n            if (await this.loop.pause(32)) {\n                elapsed = duration;\n            }\n            pct = Math.floor((100 * elapsed) / duration);\n            this.resetLayerBuffer();\n            buffer.mix(color, pct);\n            buffer.render();\n        }\n        this.finishLayer();\n    }\n    async alert(opts, text, args) {\n        if (typeof opts === 'number') {\n            opts = { duration: opts };\n        }\n        if (args) {\n            text = GWU.text.apply(text, args);\n        }\n        const width = opts.width || GWU.text.length(text);\n        opts.box = opts.box || { bg: opts.bg };\n        // opts.box.bg = opts.box.bg || 'gray';\n        const textOpts = {\n            fg: opts.fg,\n            text,\n            x: 0,\n            y: 0,\n            wrap: width,\n        };\n        const textWidget = new Widget.Text('TEXT', textOpts);\n        const height = textWidget.bounds.height;\n        const dlg = Widget.buildDialog(this, width, height)\n            .with(textWidget, { x: 0, y: 0 })\n            .addBox(opts.box)\n            .center()\n            .done();\n        dlg.setEventHandlers({\n            click: () => dlg.close(true),\n            keypress: () => dlg.close(true),\n            TIMEOUT: () => dlg.close(false),\n        });\n        if (!opts.waitForAck) {\n            dlg.setTimeout('TIMEOUT', opts.duration || 3000);\n        }\n        return await dlg.show();\n    }\n    async confirm(...args) {\n        let opts;\n        let text;\n        let textArgs = null;\n        if (args.length <= 2 && typeof args[0] === 'string') {\n            opts = {};\n            text = args[0];\n            textArgs = args[1] || null;\n        }\n        else {\n            opts = args[0];\n            text = args[1];\n            textArgs = args[2] || null;\n        }\n        if (textArgs) {\n            text = GWU.text.apply(text, textArgs);\n        }\n        const width = opts.width ||\n            Math.min(Math.floor(this.buffer.width / 2), GWU.text.length(text));\n        const textOpts = {\n            fg: opts.fg,\n            text,\n            wrap: width,\n        };\n        const textWidget = new Widget.Text('TEXT', textOpts);\n        const height = textWidget.bounds.height + 2;\n        opts.allowCancel = opts.allowCancel !== false;\n        opts.buttons = Object.assign({\n            fg: 'white',\n            activeFg: 'teal',\n            bg: 'dark_gray',\n            activeBg: 'darkest_gray',\n        }, opts.buttons || {});\n        if (typeof opts.ok === 'string') {\n            opts.ok = { text: opts.ok };\n        }\n        if (typeof opts.cancel === 'string') {\n            opts.cancel = { text: opts.cancel };\n        }\n        opts.ok = opts.ok || {};\n        opts.cancel = opts.cancel || {};\n        const okOpts = Object.assign({}, opts.buttons, { text: 'OK' }, opts.ok);\n        const cancelOpts = Object.assign({}, opts.buttons, { text: 'CANCEL' }, opts.cancel);\n        const builder = Widget.buildDialog(this, width, height)\n            .with(textWidget, { x: 0, y: 0 })\n            .with(new Widget.Button('OK', okOpts), { x: 0, bottom: 0 });\n        if (opts.allowCancel) {\n            builder.with(new Widget.Button('CANCEL', cancelOpts), {\n                right: 0,\n                bottom: 0,\n            });\n        }\n        const dlg = builder.center().addBox(opts.box).done();\n        dlg.setEventHandlers({\n            OK() {\n                dlg.close(true);\n            },\n            CANCEL() {\n                dlg.close(false);\n            },\n            Escape() {\n                dlg.close(false);\n            },\n            Enter() {\n                dlg.close(true);\n            },\n        });\n        return await dlg.show();\n    }\n    async showWidget(widget, keymap = {}) {\n        const center = widget.bounds.x < 0 || widget.bounds.y < 0;\n        const place = { x: widget.bounds.x, y: widget.bounds.y };\n        const builder = Widget.buildDialog(this).with(widget, { x: 0, y: 0 });\n        if (center) {\n            builder.center();\n        }\n        else {\n            builder.place(place.x, place.y);\n        }\n        const dlg = builder.done();\n        keymap.Escape =\n            keymap.Escape ||\n                (() => {\n                    dlg.close(false);\n                });\n        dlg.setEventHandlers(keymap);\n        return await dlg.show();\n    }\n    // assumes you are in a dialog and give the buffer for that dialog\n    async getInputAt(x, y, maxLength, opts = {}) {\n        opts.width = maxLength;\n        opts.x = x;\n        opts.y = y;\n        const widget = new Widget.Input('INPUT', opts);\n        return this.showWidget(widget, {\n            INPUT(_e, dlg) {\n                dlg.close(widget.text);\n            },\n            Escape(_e, dlg) {\n                dlg.close('');\n            },\n        });\n    }\n    async inputBox(opts, prompt, args) {\n        if (args) {\n            prompt = GWU.text.apply(prompt, args);\n        }\n        const width = opts.width ||\n            Math.min(Math.floor(this.buffer.width / 2), GWU.text.length(prompt));\n        const promptOpts = {\n            fg: opts.fg,\n            text: prompt,\n            wrap: width,\n        };\n        const promptWidget = new Widget.Text('TEXT', promptOpts);\n        const height = promptWidget.bounds.height +\n            2 + // skip + input\n            2; // skip + ok/cancel\n        opts.allowCancel = opts.allowCancel !== false;\n        opts.buttons = Object.assign({\n            fg: 'white',\n            activeFg: 'teal',\n            bg: 'dark_gray',\n            activeBg: 'darkest_gray',\n        }, opts.buttons || {});\n        if (typeof opts.ok === 'string') {\n            opts.ok = { text: opts.ok };\n        }\n        if (typeof opts.cancel === 'string') {\n            opts.cancel = { text: opts.cancel };\n        }\n        opts.ok = opts.ok || {};\n        opts.cancel = opts.cancel || {};\n        const okOpts = Object.assign({}, opts.buttons, { text: 'OK' }, opts.ok);\n        const cancelOpts = Object.assign({}, opts.buttons, { text: 'CANCEL' }, opts.cancel);\n        opts.input = opts.input || {};\n        opts.input.width = opts.input.width || width;\n        opts.input.bg = opts.input.bg || opts.fg;\n        opts.input.fg = opts.input.fg || opts.bg;\n        const inputWidget = new Widget.Input('INPUT', opts.input || {});\n        const builder = Widget.buildDialog(this, width, height)\n            .with(promptWidget, { x: 0, y: 0 })\n            .with(inputWidget, { bottom: 2, x: 0 })\n            .with(new Widget.Button('OK', okOpts), { bottom: 0, x: 0 })\n            .addBox(opts.box);\n        if (opts.allowCancel) {\n            builder.with(new Widget.Button('CANCEL', cancelOpts), {\n                bottom: 0,\n                right: 0,\n            });\n        }\n        const dlg = builder.center().done();\n        dlg.setEventHandlers({\n            OK() {\n                dlg.close(inputWidget.text);\n            },\n            CANCEL() {\n                dlg.close('');\n            },\n            Escape() {\n                dlg.close('');\n            },\n            INPUT() {\n                dlg.close(inputWidget.text);\n            },\n        });\n        return await dlg.show();\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Viewport extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this._subject = null;\n    }\n    init(opts) {\n        opts.bg = opts.bg || 'black';\n        opts.x = opts.x || 0;\n        opts.y = opts.y || 0;\n        super.init(opts);\n        this.snap = opts.snap || false;\n        this.center = opts.center || false;\n        this.filter = opts.filter || null;\n        if (opts.lock) {\n            this.lockX = true;\n            this.lockY = true;\n        }\n        else {\n            if (opts.lockX) {\n                this.lockX = true;\n            }\n            if (opts.lockY) {\n                this.lockY = true;\n            }\n        }\n    }\n    get subject() {\n        return this._subject;\n    }\n    set subject(subject) {\n        this.center = !!subject;\n        if (subject) {\n            this.offsetX = subject.x - this.halfWidth();\n            this.offsetY = subject.y - this.halfHeight();\n        }\n        this._subject = subject;\n    }\n    set lock(v) {\n        this.lockX = v;\n        this.lockY = v;\n    }\n    toMapX(x) {\n        return x + this.offsetX - this.bounds.x;\n    }\n    toMapY(y) {\n        return y + this.offsetY - this.bounds.y;\n    }\n    toInnerX(x) {\n        return x - this.bounds.x;\n    }\n    toInnerY(y) {\n        return y - this.bounds.y;\n    }\n    halfWidth() {\n        return Math.floor(this.bounds.width / 2);\n    }\n    halfHeight() {\n        return Math.floor(this.bounds.height / 2);\n    }\n    centerOn(map, x, y) {\n        this.center = true;\n        this.subject = { x, y, map };\n    }\n    showMap(map, x = 0, y = 0) {\n        this.subject = { x, y, map };\n        this.offsetX = x;\n        this.offsetY = y;\n        this.center = false;\n        this.snap = false;\n    }\n    updateOffset() {\n        if (!this._subject) {\n            this.offsetX = 0;\n            this.offsetY = 0;\n            return;\n        }\n        const subject = this._subject;\n        const map = subject.memory || subject.map;\n        const bounds = map;\n        if (subject && map.hasXY(subject.x, subject.y)) {\n            if (this.snap) {\n                let left = this.offsetX;\n                let right = this.offsetX + this.bounds.width;\n                let top = this.offsetY;\n                let bottom = this.offsetY + this.bounds.height;\n                // auto center if outside the viewport\n                if (subject.x < left || subject.x > right) {\n                    left = this.offsetX = subject.x - this.halfWidth();\n                    right = left + this.bounds.width;\n                }\n                if (subject.y < top || subject.y > bottom) {\n                    top = this.offsetY = subject.y - this.halfHeight();\n                    bottom = top + this.bounds.height;\n                }\n                const edgeX = Math.floor(this.bounds.width / 5);\n                const edgeY = Math.floor(this.bounds.height / 5);\n                const thirdW = Math.floor(this.bounds.width / 3);\n                if (left + edgeX >= subject.x) {\n                    this.offsetX = Math.max(0, subject.x + thirdW - this.bounds.width);\n                }\n                else if (right - edgeX <= subject.x) {\n                    this.offsetX = Math.min(subject.x - thirdW, bounds.width - this.bounds.width);\n                }\n                const thirdH = Math.floor(this.bounds.height / 3);\n                if (top + edgeY >= subject.y) {\n                    this.offsetY = Math.max(0, subject.y + thirdH - this.bounds.height);\n                }\n                else if (bottom - edgeY <= subject.y) {\n                    this.offsetY = Math.min(subject.y - thirdH, bounds.height - this.bounds.height);\n                }\n            }\n            else if (this.center) {\n                this.offsetX = subject.x - this.halfWidth();\n                this.offsetY = subject.y - this.halfHeight();\n            }\n            else {\n                this.offsetX = subject.x;\n                this.offsetY = subject.y;\n            }\n        }\n        if (this.lockX && map) {\n            this.offsetX = GWU.clamp(this.offsetX, 0, map.width - this.bounds.width);\n        }\n        if (this.lockY && map) {\n            this.offsetY = GWU.clamp(this.offsetY, 0, map.height - this.bounds.height);\n        }\n    }\n    draw(buffer) {\n        buffer.blackOutRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this.bg);\n        if (!this._subject) {\n            return false;\n        }\n        this.updateOffset();\n        const map = this._subject.memory || this._subject.map;\n        const fov = this._subject.fov;\n        const mixer = new GWU.sprite.Mixer();\n        for (let x = 0; x < this.bounds.width; ++x) {\n            for (let y = 0; y < this.bounds.height; ++y) {\n                const mapX = x + this.offsetX;\n                const mapY = y + this.offsetY;\n                if (map.hasXY(mapX, mapY)) {\n                    const cell = map.cell(mapX, mapY);\n                    map.drawer.drawCell(mixer, cell, fov);\n                }\n                else {\n                    mixer.draw(' ', this.bg, this.bg); // blackOut\n                }\n                if (this.filter) {\n                    this.filter(mixer, mapX, mapY, map);\n                }\n                buffer.drawSprite(x + this.bounds.x, y + this.bounds.y, mixer);\n            }\n        }\n        // map.clearMapFlag(GWM.flags.Map.MAP_CHANGED);\n        return true;\n    }\n}\n"],"names":["Selector","constructor","text","this","priority","startsWith","matchFn","_parse","parts","split","map","p","trim","matches","i","length","push","_parentMatch","_ancestorMatch","_matchElement","reduce","out","fn","bind","undefined","GWU","TRUE","next","e","parent","current","re","RegExp","match","exec","_matchTag","_matchId","_matchClass","_matchNot","_matchProp","every","tag","el","cls","classes","includes","prop","_matchFirst","_matchLast","id","attr","children","obj","Style","selector","init","_dirty","set","dirty","v","fg","_fg","bg","_bg","dim","pct","color","from","darken","bright","lighten","invert","align","_align","valign","_valign","get","key","value","setDirty","field","Number","parseInt","Object","entries","forEach","name","unset","clone","other","copy","assign","ComputedStyle","sources","super","sort","a","b","s","some","Sheet","parentSheet","rules","defaultStyle","slice","r","add","props","Error","rule","existing","findIndex","find","remove","splice","computeFor","widget","filter","widgetStyle","style","Widget","opts","active","hovered","tabStop","depth","activeFg","activeBg","hoverFg","hoverBg","bounds","xy","Bounds","reset","x","y","width","height","action","activate","_reverse","deactivate","contains","arguments","mousemove","_dialog","tick","_e","click","keypress","dir","draw","buffer","textLen","fillRect","Math","floor","drawText","Text","Widget.Widget","wrap","lines","splitIntoLines","truncate","max","setText","line","Button","first","async","ev","dialog","fireAction","Input","minLength","default","errorFg","hint","hintFg","numbersOnly","min","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","isValid","val","textEntryBounds","then","spliceRaw","Column","header","empty","_value","IDENTITY","index","object","assignOmitting","compile","data","Table","selectedColumn","selectedIndex","columns","headers","letters","hoverType","hover","wrapColumns","wrapRows","headerFg","headerBg","columnWidth","_data","String","fromCharCode","c","col","setData","selectRow","Array","isArray","list","selectNextRow","len","nextIndex","selectPrevRow","prevIndex","selectNextColumn","selectPrevColumn","selectedData","at","drawColumn","column","item","drawCell","bottom","oldColumn","oldIndex","requestRedraw","Box","title","borderBg","Dialog","ui","widgets","eventHandlers","_activeWidget","result","done","timers","needsRedraw","activeWidget","setActiveWidget","w","reverse","setTimeout","time","clearTimeout","handler","setEventHandlers","startLayer","loop","run","render","finishLayer","close","returnValue","widgetAt","getWidget","nextTabstop","arrayNext","prevTabstop","prev","arrayPrev","dt","promises","Promise","all","code","force","resetLayerBuffer","DialogBuilder","nextY","box","with","right","center","size","place","addBox","padX","pad","padY","Box.Box","unshift","buildDialog","install","EntryBase","dist","changed","sidebarY","_buffer","_bounds","ActorEntry","actor","drawStatus","ItemEntry","CellEntry","cell","MenuButton","ActionButton","DropDownButton","menu","buttons","addButton","config","button","setBounds","px","py","pw","totalWidth","totalHeight","buttonAt","dropBg","dropFg","showDropDown","activeButton","Escape","Tab","activeIndex","TAB","newActive","selected","getButtonAt","indexOf","clearHighlight","actionButton","clamp","BaseStyle.Style","border","_border","position","_position","minWidth","_minWidth","maxWidth","_maxWidth","_width","minHeight","_minHeight","maxHeight","_maxHeight","_height","_x","left","_left","_right","_y","top","_top","_bottom","padLeft","_padLeft","padRight","_padRight","padTop","_padTop","padBottom","_padBottom","marginLeft","_marginLeft","marginRight","_marginRight","marginTop","_marginTop","marginBottom","_marginBottom","makeStyle","base","baseParts","Element","styles","_props","_attrs","events","_text","_lines","_attached","_style","_usedStyle","Style.ComputedStyle","used","_setAttr","Style.makeStyle","_attrInt","def","_attrString","_attrBool","_setProp","toggleProp","doc","_setData","_doc","onblur","onfocus","_propInt","_propString","_propBool","_isValidChild","_child","appendChild","child","beforeIndex","removeChild","arrayDelete","old","root","positionedParent","isPositioned","innerLeft","innerRight","innerWidth","innerHeight","innerTop","innerBottom","updateLayout","_updateWidth","_updateHeight","_updateLeft","_updateTop","_calcContentWidth","contentHeight","_calcChildHeight","_calcContentHeight","_updateContentHeight","parentBottom","args","Style.Style","removeStyle","addClass","removeClass","toggleClass","pos","wantStyle","shift","_setText","_drawBorder","_fill","_drawContent","forBorder","_drawChildren","_drawText","on","event","cb","handlers","off","elementFromPoint","MARKUP_RE","ATTR_RE","selfClosingTags","meta","img","link","input","area","br","hr","tagsClosedByOpening","li","div","td","th","tagsClosedByClosing","ul","ol","tr","table","elements","configureElement","selfClosing","openCloses","tcbo","t","closeCloses","tcbc","installElement","createElement","rawAttr","stylesheet","Element.Element","back","arr","parse","options","Style.Sheet","currentElement","stack","lastTextPos","RE","lastIndex","substring","lowerCaseTagName","toLowerCase","pop","sheet","maxLength","isTypeNumber","type","requiredLen","_fireEvent","document","_element","nextTabStop","CheckBox","state","setActiveElement","uncheck","check","padCheck","clickfocus","margin","padding","FieldSet","legend","UnorderedList","indentWidth","_drawBullet","_index","bullet","OrderedList","padStart","DataList","select","detach","create","appendTo","prefix","Selection","start","end","arg","$","after","content","last","toAdd","_attach","append","dest","toAppend","before","_detach","oldChildren","insertAfter","target","insertBefore","prepend","prependTo","_sub","replaceAll","replaceWith","d","hasClass","animate","_ms","clearQueue","_name","delay","dequeue","fadeIn","fadeOut","fadeTo","_opacity","fadeToggle","finish","hide","queue","_args","show","slideDown","slideToggle","slideUp","stop","toggle","_arg","fire","io","makeCustomEvent","rootTag","_activeElement","_done","body","removeRule","computeStyles","anyChanged","_prepareDraw","activeElement","prevTabStop","element","h","_bubbleEvent","term","class","_n","_updateStyle","incProp","arrayIncludesAll","focused","hidden","_used","needsDraw","_draw","_drawFill","addChild","mouseenter","defaultPrevented","preventDefault","mouseleave","source","fireEvent","Border","ascii","drawBorder","j","_fixedWidth","_fixedHeight","_force","vOffset","Grid","_colWidths","_rowHeights","_col","_row","cols","fill","rows","n","_resetX","_resetY","nextCol","row","nextRow","setRowHeight","format","headerClass","dataClass","makeHeader","headerTag","rowHeight","makeData","dataTag","showHeader","o","borderAdj","Menu","buttonClass","buttonTag","_initButtons","menuItem","menuOpts","addWidget","_initButton","_initMenu","_w","Select","_initText","dropdown","allWidgets","_grid","_needsDraw","moveTo","move","dx","dy","up","down","nextLine","prevLine","clear","grid","endGrid","startRow","endRow","aw","removeWidget","_opts","Text.Text","Table.Table","Menu.Menu","Button.Button","Border.Border","Select.Select","console","log","Widget.Text","promptFg","overflow","isPrompt","showText","capitalize","showPrompt","getFlavorText","fov","buf","isAnyKindOfVisible","isDirectlyVisible","isRemembered","isRevealed","isMapped","isMagicMapped","intro","hasActor","actorAt","theItem","hasItem","itemAt","standsInTile","hasTileFlag","GWM","flags","Tile","T_STAND_IN_TILE","needObjectArticle","getFlavor","article","groundTile","depthTile","Depth","GROUND","tile","tiles","NULL","surfaceTile","SURFACE","liquidTile","LIQUID","surface","T_BRIDGE","liquid","ground","apply","tableOpts","separator","lead","_addButton","onTop","arrayFindRight","bgColor","cache","message","MessageCache","showArchive","isOnTop","confirmed","mix","fastForward","fadePercent","totalMessageCount","dbuf","dM","startM","endM","currentM","startY","endY","_confirmed","fgColor","pause","wrapText","waitForAck","confirmAll","cellCache","lastX","lastY","lastMap","subject","highlight","entryAt","entry","highlightRow","updateCellCache","hasMapFlag","Map","MAP_SIDEBAR_TILES_CHANGED","forRect","info","hasEntityFlag","Entity","L_LIST_IN_SIDEBAR","clearMapFlag","_makeActorEntry","_makeItemEntry","_makeCellEntry","_getPriority","hasCellFlag","Cell","STABLE_MEMORY","_isDim","_addActorEntry","distanceBetween","isPlayer","_addItemEntry","_addCellEntry","findEntries","cx","cy","alloc","eachActor","eachItem","free","update","updateFor","updateAt","memory","drawBounds","currentEntry","usedLines","layers","freeBuffers","inDialog","canvas","baseBuffer","canvasBuffer","duration","elapsed","textOpts","textWidget","dlg","Widget.buildDialog","TIMEOUT","textArgs","allowCancel","ok","cancel","okOpts","cancelOpts","builder","Widget.Button","OK","CANCEL","Enter","keymap","Widget.Input","showWidget","INPUT","prompt","promptOpts","promptWidget","inputWidget","offsetX","offsetY","_subject","snap","lock","lockX","lockY","halfWidth","halfHeight","toMapX","toMapY","toInnerX","toInnerY","centerOn","showMap","updateOffset","hasXY","edgeX","edgeY","thirdW","thirdH","blackOutRect","mixer","sprite","Mixer","mapX","mapY","drawer","drawSprite"],"mappings":"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"}