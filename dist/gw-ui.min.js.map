{"version":3,"file":"gw-ui.min.js","sources":["../js/widget/widget.js","../js/widget/text.js","../js/widget/button.js","../js/widget/input.js","../js/widget/table.js","../js/widget/box.js","../js/widget/dialog.js","../js/flavor.js","../js/sidebar.js","../js/menu.js","../js/html/selector.js","../js/html/style.js","../js/html/element.js","../js/html/parser.js","../js/html/input.js","../js/html/checkbox.js","../js/html/button.js","../js/html/fieldset.js","../js/html/lists.js","../js/html/datalist.js","../js/html/document.js","../js/term/text.js","../js/term/grid.js","../js/term/term.js","../js/widget/list.js","../js/message.js","../js/ui.js","../js/viewport.js"],"sourcesContent":["import * as GWU from 'gw-utils';\nexport class Widget {\n    constructor(id, opts) {\n        this.active = false;\n        this.hovered = false;\n        this.tabStop = false;\n        this.depth = 0;\n        this.fg = 0xfff;\n        this.bg = -1;\n        this.activeFg = 0xfff;\n        this.activeBg = -1;\n        this.hoverFg = 0xfff;\n        this.hoverBg = -1;\n        this.text = '';\n        this.align = 'left';\n        this.valign = 'middle';\n        this.bounds = new GWU.xy.Bounds(-1, -1, -1, -1); // nothing set\n        this.id = id;\n        if (opts)\n            this.init(opts);\n        this.reset();\n    }\n    init(opts) {\n        if (opts.x !== undefined)\n            this.bounds.x = opts.x;\n        if (opts.y !== undefined)\n            this.bounds.y = opts.y;\n        if (opts.width !== undefined)\n            this.bounds.width = opts.width;\n        if (opts.height !== undefined)\n            this.bounds.height = opts.height;\n        if (opts.depth !== undefined)\n            this.depth = opts.depth;\n        if (opts.text) {\n            this.text = opts.text;\n            if (this.bounds.width <= 0)\n                this.bounds.width = opts.text.length;\n            if (this.bounds.height <= 0)\n                this.bounds.height = 1;\n        }\n        if (this.bounds.height <= 0)\n            this.bounds.height = 1;\n        if (opts.fg !== undefined) {\n            this.fg = opts.fg;\n            this.activeFg = opts.fg;\n            this.hoverFg = opts.fg;\n        }\n        if (opts.bg !== undefined) {\n            this.bg = opts.bg;\n            this.activeBg = opts.bg;\n            this.hoverBg = opts.bg;\n        }\n        if (opts.activeFg !== undefined) {\n            this.activeFg = opts.activeFg;\n            this.hoverFg = opts.activeFg;\n        }\n        if (opts.activeBg !== undefined) {\n            this.activeBg = opts.activeBg;\n            this.hoverBg = opts.activeBg;\n        }\n        if (opts.hoverFg !== undefined)\n            this.hoverFg = opts.hoverFg;\n        if (opts.hoverBg !== undefined)\n            this.hoverBg = opts.hoverBg;\n        if (opts.tabStop !== undefined)\n            this.tabStop = opts.tabStop;\n        this.action = opts.action || this.id;\n    }\n    reset() { }\n    activate(_reverse = false) {\n        this.active = true;\n    }\n    deactivate() {\n        this.active = false;\n    }\n    contains(x, y) {\n        if (arguments.length == 1)\n            return this.bounds.contains(x);\n        return this.bounds.contains(x, y);\n    }\n    // EVENTS\n    // returns true if mouse is over this widget\n    mousemove(e, _dialog) {\n        this.hovered = this.contains(e);\n        return this.hovered;\n    }\n    tick(_e, _dialog) { }\n    // returns true if click is handled by this widget (stopPropagation)\n    click(_e, _dialog) {\n        return false;\n    }\n    // returns true if key is used by widget and you want to stopPropagation\n    keypress(_e, _dialog) {\n        return false;\n    }\n    // returns true if key is used by widget and you want to stopPropagation\n    dir(_e, _dialog) {\n        return false;\n    }\n    // DRAW\n    draw(buffer) {\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        const textLen = GWU.text.length(this.text);\n        if (this.bounds.width > textLen || this.bounds.height > 1) {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', fg, bg);\n        }\n        let x = this.bounds.x;\n        if (this.align == 'center') {\n            x += Math.floor((this.bounds.width - textLen) / 2);\n        }\n        else if (this.align == 'right') {\n            x += this.bounds.width - textLen;\n        }\n        let y = this.bounds.y; // 'top'\n        if (this.bounds.height > 1) {\n            if (this.valign == 'middle') {\n                y += Math.floor(this.bounds.height / 2);\n            }\n            else if (this.valign == 'bottom') {\n                y += this.bounds.height - 1;\n            }\n        }\n        buffer.drawText(x, y, this.text, fg, bg);\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Text extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        // if (!opts.text)\n        //     throw new Error(\n        //         'Must have text value in config for Text widget - ' + this.id\n        //     );\n        this.text = opts.text || '';\n        if (opts.wrap) {\n            this.wrap = true;\n            opts.width = opts.wrap;\n            this.lines = GWU.text.splitIntoLines(this.text, \n            // @ts-ignore\n            opts.width);\n        }\n        else {\n            const textLen = GWU.text.length(this.text);\n            opts.width = opts.width || textLen || 10;\n            if (opts.width < textLen) {\n                opts.text = GWU.text.truncate(this.text, opts.width);\n            }\n            this.lines = [this.text];\n        }\n        opts.height = Math.max(this.lines.length, opts.height || 1);\n        super.init(opts);\n    }\n    setText(text) {\n        this.text = text;\n        if (this.wrap) {\n            this.lines = GWU.text.splitIntoLines(this.text, this.bounds.width);\n        }\n        else {\n            const textLen = GWU.text.length(this.text);\n            if (textLen > this.bounds.width) {\n                this.text = GWU.text.truncate(this.text, this.bounds.width);\n            }\n            this.lines = [this.text];\n        }\n    }\n    // TODO - get text() {}, set text(v:string) { // do lines stuff }\n    draw(buffer) {\n        const fg = this.active ? this.activeFg : this.fg;\n        const bg = this.active ? this.activeBg : this.bg;\n        this.lines.forEach((line, i) => {\n            buffer.drawText(this.bounds.x, this.bounds.y + i, line, fg, bg, this.bounds.width);\n        });\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Button extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        if (!opts.text)\n            throw new Error('Must have text value in config for Button widget - ' + this.id);\n        opts.tabStop = GWU.first(opts.tabStop, true); // Can receive input (Enter)\n        super.init(opts);\n    }\n    async click(ev, dialog) {\n        if (!this.contains(ev))\n            return false;\n        await dialog.fireAction(this.action, this);\n        return true;\n    }\n    async keypress(ev, dialog) {\n        if (!ev.key)\n            return false;\n        if (ev.key === 'Enter') {\n            await dialog.fireAction(this.action, this);\n            return true;\n        }\n        return false;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Input extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        this.minLength = opts.minLength || 1;\n        if (!opts.width) {\n            opts.width = Math.max(this.minLength, 10);\n        }\n        opts.tabStop = GWU.first(opts.tabStop, true); // Need to receive input\n        super.init(opts);\n        this.default = opts.default || '';\n        this.errorFg = opts.errorFg || this.fg;\n        this.hint = opts.hint || '';\n        this.hintFg = opts.hintFg || this.errorFg;\n        this.numbersOnly = opts.numbersOnly || false;\n        this.min = GWU.first(opts.min, Number.MIN_SAFE_INTEGER);\n        this.max = GWU.first(opts.max, Number.MAX_SAFE_INTEGER);\n        if (this.bounds.width <= 0) {\n            if (this.hint)\n                this.bounds.width = this.hint.length;\n            if (this.default)\n                this.bounds.width = this.default.length;\n        }\n        if (this.bounds.height <= 0) {\n            this.bounds.height = 1;\n        }\n        this.reset();\n    }\n    reset() {\n        this.text = this.default;\n    }\n    isValid() {\n        if (this.numbersOnly) {\n            const val = Number.parseInt(this.text);\n            if (this.min !== undefined && val < this.min)\n                return false;\n            if (this.max !== undefined && val > this.max)\n                return false;\n            return val > 0;\n        }\n        return this.text.length >= this.minLength;\n    }\n    get value() {\n        if (this.numbersOnly)\n            return Number.parseInt(this.text);\n        return this.text;\n    }\n    keypress(ev, dialog) {\n        const textEntryBounds = this.numbersOnly ? ['0', '9'] : [' ', '~'];\n        if (!ev.key)\n            return false;\n        if (ev.key === 'Enter' && this.isValid()) {\n            const r = dialog.fireAction(this.action, this);\n            if (r)\n                return r.then(() => true);\n            return true;\n        }\n        if (ev.key == 'Delete' || ev.key == 'Backspace') {\n            if (this.text.length) {\n                this.text = GWU.text.spliceRaw(this.text, this.text.length - 1, 1);\n            }\n            return true;\n        }\n        else if (ev.key.length > 1) {\n            // ignore other special keys...\n            return false;\n        }\n        // eat/use all other keys\n        if (ev.key >= textEntryBounds[0] && ev.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            if (this.text.length < this.bounds.width) {\n                this.text += ev.key;\n            }\n        }\n        return true;\n    }\n    draw(buffer) {\n        const x = this.bounds.x;\n        const y = this.bounds.y;\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        buffer.fillRect(x, y, this.bounds.width, 1, ' ', fg, bg);\n        if (!this.text.length && this.hint && this.hint.length) {\n            buffer.drawText(x, y, this.hint, this.hintFg);\n        }\n        else {\n            const color = this.isValid() ? fg : this.errorFg;\n            buffer.drawText(x, y, this.text, color);\n        }\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Column {\n    constructor(opts) {\n        this.active = false;\n        this.hovered = false;\n        this.fg = null;\n        this.bg = null;\n        this.activeFg = null;\n        this.activeBg = null;\n        this.hoverFg = null;\n        this.hoverBg = null;\n        this.align = 'left';\n        this.header = '';\n        this.empty = '';\n        this._value = GWU.IDENTITY;\n        // align: Widget.Align = 'left';\n        // valign: Widget.VAlign = 'middle';\n        // hover: HoverType = 'cell';\n        this.x = -1;\n        this.width = -1;\n        this.index = -1;\n        GWU.object.assignOmitting('value', this, opts);\n        if (this.width <= 0) {\n            this.width = this.header.length || 1;\n        }\n        if (typeof opts.value === 'string') {\n            this._value = GWU.text.compile(opts.value);\n        }\n        else {\n            this._value = opts.value || GWU.IDENTITY;\n        }\n        if (opts.align)\n            this.align = opts.align;\n    }\n    value(data, index) {\n        const v = this._value(data, index);\n        return GWU.text.truncate(v, this.width);\n    }\n}\nexport class Table extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.data = null;\n        this.selectedColumn = null;\n        this.selectedIndex = -1;\n    }\n    init(opts) {\n        if (!opts.height)\n            throw new Error('Height is required.');\n        if (!opts.columns || opts.columns.length == 0)\n            throw new Error('Must have at least 1 column.');\n        opts.tabStop = GWU.first(opts.tabStop, true);\n        super.init(opts);\n        this.headers = GWU.first(opts.headers, true);\n        this.letters = GWU.first(opts.letters, true);\n        this.columns = [];\n        this.hoverType = opts.hover || 'row';\n        this.wrapColumns = GWU.first(opts.wrapColumns, opts.wrap, true);\n        this.wrapRows = GWU.first(opts.wrapRows, opts.wrap, true);\n        this.headerFg = opts.headerFg || this.fg;\n        this.headerBg = opts.headerBg || this.bg;\n        let columnWidth = 0;\n        if (opts.letters) {\n            this.columns.push(new Column({\n                width: 2,\n                value: (_data, index) => {\n                    const letter = String.fromCharCode(97 + index);\n                    return letter + ')';\n                },\n            }));\n            columnWidth += 2;\n        }\n        if (opts.columns) {\n            opts.columns.forEach((c) => {\n                const col = new Column(c);\n                this.columns.push(col);\n                columnWidth += col.width;\n            });\n        }\n        this.columns.forEach((c, i) => (c.index = i));\n        // scrolling?  paging?  fixed columns/headers?\n        this.bounds.width =\n            this.bounds.width > 0 ? this.bounds.width : columnWidth;\n    }\n    setData(data) {\n        this.data = data;\n        this.selectedIndex = -1;\n    }\n    selectRow(index) {\n        if (!this.data)\n            return false;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        if (index >= len)\n            return false;\n        if (index < -1)\n            return false;\n        this.selectedIndex = index;\n        return true;\n    }\n    selectNextRow(wrap = true) {\n        if (!this.data)\n            return -1;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        this.selectedIndex = GWU.nextIndex(this.selectedIndex, len, wrap);\n        if (this.selectedIndex > -1 && !this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        return this.selectedIndex;\n    }\n    selectPrevRow(wrap = true) {\n        if (!this.data)\n            return -1;\n        const len = Array.isArray(this.data)\n            ? this.data.length\n            : GWU.list.length(this.data);\n        this.selectedIndex = GWU.prevIndex(this.selectedIndex, len, wrap);\n        if (this.selectedIndex > -1 && !this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        return this.selectedIndex;\n    }\n    selectNextColumn(wrap = true) {\n        if (!this.selectedColumn) {\n            this.selectedColumn = this.columns[0];\n        }\n        else {\n            let index = GWU.nextIndex(this.selectedColumn.index, this.columns.length, wrap);\n            this.selectedColumn = this.columns[index] || null;\n        }\n        if (this.selectedColumn && this.selectedIndex < 0 && this.data) {\n            this.selectedIndex = 0;\n        }\n        return this.selectedColumn;\n    }\n    selectPrevColumn(wrap = true) {\n        if (!this.selectedColumn) {\n            this.selectedColumn = this.columns[this.columns.length - 1]; // last column\n        }\n        else {\n            let index = GWU.prevIndex(this.selectedColumn.index, this.columns.length, wrap);\n            this.selectedColumn = this.columns[index] || null;\n        }\n        if (this.selectedColumn && this.selectedIndex < 0 && this.data) {\n            this.selectedIndex = 0;\n        }\n        return this.selectedColumn;\n    }\n    get selectedData() {\n        if (!this.data)\n            return null;\n        if (Array.isArray(this.data)) {\n            return this.data[this.selectedIndex] || null;\n        }\n        else {\n            return GWU.list.at(this.data, this.selectedIndex);\n        }\n    }\n    draw(buffer) {\n        const b = this.bounds;\n        buffer.fillRect(b.x, b.y, b.width, b.height, ' ', this.bg, this.bg);\n        let x = b.x;\n        this.columns.forEach((col) => {\n            this.drawColumn(buffer, col, x);\n            x += col.width;\n        });\n    }\n    drawColumn(buffer, column, x) {\n        let y = this.bounds.y;\n        if (column.header) {\n            buffer.fillRect(x, y, column.width, 1, ' ', this.headerFg, this.headerBg);\n            buffer.drawText(x, y, column.header, this.headerFg, this.headerBg, column.width, column.align);\n            ++y;\n        }\n        if (!this.data)\n            return;\n        if (Array.isArray(this.data)) {\n            this.data.forEach((item, index) => {\n                this.drawCell(buffer, column, item, index, x, y);\n                ++y;\n            });\n        }\n        else {\n            GWU.list.forEach(this.data, (item, index) => {\n                this.drawCell(buffer, column, item, index, x, y);\n                ++y;\n            });\n        }\n    }\n    drawCell(buffer, column, data, index, x, y) {\n        if (y > this.bounds.bottom)\n            return;\n        let text = column._value(data, index);\n        if (text.length == 0) {\n            text = column.empty;\n        }\n        // pick color...\n        let fg = this.fg;\n        let bg = this.bg;\n        if (this.hoverType === 'row') {\n            if (index === this.selectedIndex) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        else if (this.hoverType === 'column') {\n            if (column === this.selectedColumn) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        else if (this.hoverType === 'cell') {\n            if (column === this.selectedColumn &&\n                index === this.selectedIndex) {\n                fg = this.hoverFg;\n                bg = this.hoverBg;\n            }\n        }\n        buffer.fillRect(x, y, column.width, 1, ' ', bg, bg);\n        buffer.drawText(x, y, text, fg, bg, column.width, column.align);\n    }\n    async mousemove(e, dialog) {\n        if (!super.mousemove(e, dialog)) {\n            return false;\n        }\n        const oldColumn = this.selectedColumn;\n        const oldIndex = this.selectedIndex;\n        let x = e.x - this.bounds.x;\n        const column = (this.selectedColumn =\n            this.columns.find((c) => {\n                if (c.width >= x)\n                    return true;\n                x -= c.width;\n                return false;\n            }) || null);\n        let index = -1;\n        if (this.data) {\n            index = e.y - this.bounds.y - (this.headers ? 1 : 0);\n            if (Array.isArray(this.data)) {\n                if (index >= this.data.length)\n                    index = -1;\n            }\n        }\n        this.selectedIndex = index;\n        if (oldColumn !== column || oldIndex !== index) {\n            dialog.fireAction(this.id + '_HOVER', this);\n            dialog.requestRedraw();\n        }\n        return true;\n    }\n    dir(e) {\n        if (!e.dir)\n            return false;\n        if (e.dir[0] > 0) {\n            this.selectNextColumn(this.wrapColumns);\n        }\n        else if (e.dir[0] < 0) {\n            this.selectPrevColumn(this.wrapColumns);\n        }\n        if (e.dir[1] > 0) {\n            this.selectNextRow(this.wrapRows);\n        }\n        else if (e.dir[1] < 0) {\n            this.selectPrevRow(this.wrapRows);\n        }\n        return true;\n    }\n}\nexport function makeTable(id, opts) {\n    return new Table(id, opts);\n}\n","import * as Widget from './widget';\nexport class Box extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, (() => {\n            if (!opts)\n                return opts;\n            if (opts.depth === undefined)\n                opts.depth = -10; // hide behind other widgets\n            if (opts.title)\n                opts.text = opts.title;\n            opts.bg = opts.bg || 'gray';\n            return opts;\n        })());\n    }\n    init(opts) {\n        super.init(opts);\n        this.borderBg = opts.borderBg || null;\n    }\n    // EVENTS\n    // box is completely idle\n    mousemove(_e, _dialog) {\n        return false;\n    }\n    // DRAW\n    draw(buffer) {\n        const fg = this.active\n            ? this.activeFg\n            : this.hovered\n                ? this.hoverFg\n                : this.fg;\n        const bg = this.active\n            ? this.activeBg\n            : this.hovered\n                ? this.hoverBg\n                : this.bg;\n        // Draw dialog\n        if (this.borderBg) {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.borderBg, this.borderBg);\n            buffer.fillRect(this.bounds.x + 1, this.bounds.y + 1, this.bounds.width - 2, this.bounds.height - 2, ' ', bg, bg);\n        }\n        else {\n            buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', bg, bg);\n        }\n        if (this.text) {\n            buffer.drawText(this.bounds.x, this.bounds.y, this.text, fg, -1, this.bounds.width, 'center');\n        }\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Box from './box';\nexport class Dialog {\n    constructor(ui, id) {\n        // bounds: GWU.xy.Bounds;\n        this.widgets = [];\n        this.eventHandlers = {};\n        this._activeWidget = null;\n        this.result = null;\n        this.done = false;\n        this.timers = {};\n        this.needsRedraw = true;\n        this.ui = ui;\n        this.id = id || 'DIALOG';\n        // this.bounds = new GWU.xy.Bounds(-1, -1, 0, 0);\n        // if (opts) this.init(opts);\n    }\n    init() {\n        // if (opts.id) this.id = opts.id;\n        // if (opts.x !== undefined) this.bounds.x = opts.x;\n        // if (opts.y !== undefined) this.bounds.y = opts.y;\n        // if (opts.height !== undefined) this.bounds.height = opts.height;\n        // if (opts.width !== undefined) this.bounds.width = opts.width;\n        // if (opts.box) {\n        //     let boxOpts: Box.BoxOptions = {\n        //         fg: 'white',\n        //         bg: 'gray',\n        //         borderBg: 'dark_gray',\n        //         width: this.bounds.width,\n        //         height: this.bounds.height,\n        //         x: this.bounds.x,\n        //         y: this.bounds.y,\n        //     };\n        //     if (opts.box !== true) {\n        //         Object.assign(boxOpts, opts.box);\n        //     }\n        //     const box = new Box.Box(this.id + '_BOX', boxOpts);\n        //     this.widgets.push(box);\n        // }\n        // if (opts.widgets) {\n        //     opts.widgets.forEach((w) => this.widgets.push(w));\n        // }\n        this.widgets.sort((a, b) => (a.depth < b.depth ? -1 : 1));\n    }\n    get activeWidget() {\n        return this._activeWidget;\n    }\n    setActiveWidget(w, reverse = false) {\n        if (w === this._activeWidget)\n            return;\n        if (this._activeWidget) {\n            this._activeWidget.deactivate();\n        }\n        this._activeWidget = w;\n        if (this._activeWidget) {\n            this._activeWidget.activate(reverse);\n        }\n    }\n    // contains(e: GWU.xy.XY): boolean {\n    //     return this.bounds.contains(e);\n    // }\n    requestRedraw() {\n        this.needsRedraw = true;\n    }\n    setTimeout(action, time) {\n        this.timers[action] = time;\n    }\n    clearTimeout(action) {\n        delete this.timers[action];\n    }\n    async fireAction(action, widget) {\n        const handler = this.eventHandlers[action];\n        if (handler) {\n            await handler(action, this, widget);\n        }\n    }\n    // Multiple calls result in adding more handlers\n    setEventHandlers(map) {\n        Object.assign(this.eventHandlers, map);\n    }\n    async show() {\n        this.done = false;\n        // reset any temp data...\n        this.widgets.forEach((w) => w.reset());\n        // first tabStop is the starting active Widget\n        this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n        // start dialog\n        const buffer = this.ui.startLayer();\n        // run input loop\n        await this.ui.loop.run({\n            keypress: this.keypress.bind(this),\n            dir: this.dir.bind(this),\n            mousemove: this.mousemove.bind(this),\n            click: this.click.bind(this),\n            tick: this.tick.bind(this),\n            draw: () => {\n                this.draw(buffer);\n                buffer.render();\n            },\n        }, 100);\n        // stop dialog\n        this.ui.finishLayer();\n        return this.result;\n    }\n    close(returnValue) {\n        this.result = returnValue;\n        this.done = true;\n    }\n    widgetAt(x, y) {\n        return (this.widgets.find((w) => w.contains(x, y) && w.depth >= 0) || null);\n    }\n    getWidget(id) {\n        return this.widgets.find((w) => w.id === id) || null;\n    }\n    nextTabstop() {\n        if (!this.activeWidget) {\n            this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n            return !!this.activeWidget;\n        }\n        const next = GWU.arrayNext(this.widgets, this.activeWidget, (w) => w.tabStop);\n        if (next) {\n            this.setActiveWidget(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabstop() {\n        if (!this.activeWidget) {\n            this.setActiveWidget(this.widgets.find((w) => w.tabStop) || null);\n            return !!this.activeWidget;\n        }\n        const prev = GWU.arrayPrev(this.widgets, this.activeWidget, (w) => w.tabStop);\n        if (prev) {\n            this.setActiveWidget(prev, true);\n            return true;\n        }\n        return false;\n    }\n    async tick(e) {\n        const dt = e.dt;\n        let promises = [];\n        Object.entries(this.timers).forEach(([action, time]) => {\n            time -= dt;\n            if (time <= 0) {\n                delete this.timers[action];\n                promises.push(this.fireAction(action, null));\n            }\n            else {\n                this.timers[action] = time;\n            }\n        });\n        for (let w of this.widgets) {\n            promises.push(w.tick(e, this));\n        }\n        if (promises.length) {\n            return Promise.all(promises).then(() => this.done);\n        }\n        return this.done;\n    }\n    // TODO - async - to allow animations or events on mouseover?\n    async mousemove(e) {\n        // this.setActiveWidget(null);\n        await Promise.all(this.widgets.map(async (w) => {\n            await w.mousemove(e, this);\n            if (w.hovered && w.tabStop) {\n                this.setActiveWidget(w);\n            }\n        }));\n        return this.done;\n    }\n    async click(e) {\n        // this.mousemove(e); // make sure activeWidget is set correctly\n        // if (!this.contains(e)) {\n        //     return false;\n        // }\n        const widget = this.widgetAt(e.x, e.y);\n        let fn = null;\n        if (widget) {\n            if (await widget.click(e, this)) {\n                return this.done;\n            }\n            fn = this.eventHandlers[widget.id];\n        }\n        fn = fn || this.eventHandlers[this.id] || this.eventHandlers.click;\n        if (fn) {\n            await fn(e, this, this.activeWidget);\n        }\n        return this.done;\n    }\n    async keypress(e) {\n        if (!e.key)\n            return false;\n        if (this.activeWidget) {\n            if (await this.activeWidget.keypress(e, this)) {\n                return this.done;\n            }\n        }\n        const fn = this.eventHandlers[e.key] ||\n            this.eventHandlers[e.code] ||\n            this.eventHandlers.keypress;\n        if (fn) {\n            if (await fn(e, this, this.activeWidget)) {\n                return this.done;\n            }\n        }\n        if (e.key === 'Tab') {\n            // Next widget\n            this.nextTabstop();\n            return false; // not done\n        }\n        else if (e.key === 'TAB') {\n            // Prev Widget\n            this.prevTabstop();\n            return false; // not done\n        }\n        return this.done;\n    }\n    async dir(e) {\n        if (this.activeWidget) {\n            if (await this.activeWidget.dir(e, this)) {\n                return this.done;\n            }\n        }\n        const fn = this.eventHandlers.dir || this.eventHandlers.keypress;\n        if (fn) {\n            await fn(e, this, this.activeWidget);\n        }\n        return this.done;\n    }\n    draw(buffer, force = false) {\n        if (!this.needsRedraw && !force)\n            return;\n        this.ui.resetLayerBuffer();\n        this.widgets.forEach((w) => w.draw(buffer));\n    }\n}\nexport class DialogBuilder {\n    constructor(ui, width, height) {\n        this.nextY = 0;\n        this.box = null;\n        this.nextY = 1;\n        this.dialog = new Dialog(ui);\n        this.bounds = new GWU.xy.Bounds(-1, -1, width, height);\n    }\n    with(widget, at) {\n        // widget bounds are set relative to the dialog top left,\n        // if we don't get any, help them out\n        // TODO - Get rid of x, y\n        const bounds = this.bounds;\n        if (at) {\n            if (at.right !== undefined) {\n                bounds.width = Math.max(bounds.width, widget.bounds.width + at.right);\n                widget.bounds.right = bounds.width - at.right - 1;\n            }\n            else {\n                widget.bounds.x = at.x || 0;\n                bounds.width = Math.max(bounds.width, widget.bounds.width + widget.bounds.x);\n            }\n            if (at.bottom !== undefined) {\n                bounds.height = Math.max(bounds.height, widget.bounds.height + at.bottom);\n                widget.bounds.bottom = bounds.height - at.bottom - 1;\n            }\n            else {\n                widget.bounds.y = at.y || 0;\n                bounds.height = Math.max(bounds.height, widget.bounds.height + widget.bounds.y);\n            }\n        }\n        else {\n            bounds.width = Math.max(bounds.width, widget.bounds.right);\n            bounds.height = Math.max(bounds.height, widget.bounds.bottom);\n        }\n        this.dialog.widgets.push(widget);\n        this.nextY = Math.max(this.nextY, widget.bounds.bottom + 1);\n        return this;\n    }\n    center() {\n        const size = this.dialog.ui.buffer;\n        const bounds = this.bounds;\n        bounds.x = Math.floor((size.width - bounds.width) / 2);\n        bounds.y = Math.floor((size.height - bounds.height) / 2);\n        return this;\n    }\n    place(x, y) {\n        const bounds = this.bounds;\n        bounds.x = x;\n        bounds.y = y;\n        return this;\n    }\n    addBox(opts) {\n        this.box = opts || {};\n        return this;\n    }\n    done() {\n        if (this.bounds.x < 0)\n            this.bounds.x = 0;\n        if (this.bounds.y < 0)\n            this.bounds.y = 0;\n        if (this.bounds.right > this.dialog.ui.buffer.width)\n            throw new Error('Dialog is off screen!');\n        if (this.bounds.bottom > this.dialog.ui.buffer.height)\n            throw new Error('Dialog is off screen!');\n        if (this.box) {\n            const padX = this.box.padX || this.box.pad || 1;\n            const padY = this.box.padY || this.box.pad || 1;\n            this.box.x = 0;\n            this.box.y = 0;\n            this.box.width = this.bounds.width + 2 * padX;\n            this.box.height = this.bounds.height + 2 * padY;\n            const widget = new Box.Box(this.dialog.id + '_BOX', this.box);\n            this.dialog.widgets.forEach((w) => {\n                w.bounds.x += padX;\n                w.bounds.y += padY;\n            });\n            this.dialog.widgets.unshift(widget);\n        }\n        // lock in locations\n        this.dialog.widgets.forEach((w) => {\n            w.bounds.x += this.bounds.x;\n            w.bounds.y += this.bounds.y;\n        });\n        return this.dialog;\n    }\n}\nexport function buildDialog(ui, width = 0, height = 0) {\n    return new DialogBuilder(ui, width, height);\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from './widget';\nGWU.color.install('flavorText', 50, 40, 90);\nGWU.color.install('flavorPrompt', 100, 90, 20);\nexport class Flavor extends Widget.Text {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        opts.fg = opts.fg || 'flavorText';\n        opts.bg = opts.bg || 'black';\n        super.init(opts);\n        this.promptFg = GWU.color.from(opts.promptFg || 'flavorPrompt');\n        this.overflow = opts.overflow || false;\n        this.isPrompt = false;\n    }\n    showText(text) {\n        this.text = GWU.text.capitalize(text);\n        const len = GWU.text.length(this.text);\n        if (len > this.bounds.width) {\n            this.lines = GWU.text.splitIntoLines(this.text, this.bounds.width);\n            if (!this.overflow && this.lines.length > this.bounds.height) {\n                if (this.bounds.height == 1) {\n                    this.text = GWU.text.truncate(this.text, this.bounds.width);\n                    this.lines = [this.text];\n                }\n                else {\n                    this.lines.length = this.bounds.height;\n                }\n            }\n        }\n        else {\n            this.lines = [this.text];\n        }\n        this.isPrompt = false;\n    }\n    clear() {\n        this.text = '';\n        this.lines = [''];\n        this.isPrompt = false;\n    }\n    showPrompt(text) {\n        this.showText(text);\n        this.isPrompt = true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.bg, this.bg);\n        super.draw(buffer);\n    }\n    getFlavorText(map, x, y, fov) {\n        const cell = map.cell(x, y); // KNOWLEDGE / MEMORY !!!\n        let buf;\n        // let magicItem;\n        // let standsInTerrain;\n        // let subjectMoving;\n        // let prepositionLocked = false;\n        // let subject;\n        // let verb;\n        // let preposition;\n        let object = '';\n        // let adjective;\n        const isAnyKindOfVisible = fov ? fov.isAnyKindOfVisible(x, y) : true;\n        const isDirectlyVisible = fov ? fov.isDirectlyVisible(x, y) : true;\n        const isRemembered = fov ? fov.isRevealed(x, y) : false;\n        const isMapped = fov ? fov.isMagicMapped(x, y) : false;\n        let intro;\n        if (isDirectlyVisible) {\n            intro = 'you see';\n        }\n        else if (isAnyKindOfVisible) {\n            intro = 'you sense';\n        }\n        else if (isRemembered) {\n            intro = 'you remember';\n        }\n        else if (isMapped) {\n            intro = 'you expect to see';\n        }\n        else {\n            return '';\n        }\n        const actor = cell.hasActor() ? map.actorAt(x, y) : null;\n        // const player = actor?.isPlayer() ? actor : null;\n        const theItem = cell.hasItem() ? map.itemAt(x, y) : null;\n        const standsInTile = cell.hasTileFlag(GWM.flags.Tile.T_STAND_IN_TILE);\n        let needObjectArticle = false;\n        if (actor) {\n            object = actor.getFlavor({\n                color: false,\n                article: true,\n                action: true,\n            });\n            needObjectArticle = true;\n        }\n        else if (theItem) {\n            object = theItem.getFlavor({ color: false, article: true });\n            needObjectArticle = true;\n        }\n        let article = standsInTile ? ' in ' : ' on ';\n        const groundTile = cell.depthTile(GWM.flags.Depth.GROUND) || GWM.tile.tiles.NULL;\n        const surfaceTile = cell.depthTile(GWM.flags.Depth.SURFACE);\n        const liquidTile = cell.depthTile(GWM.flags.Depth.LIQUID);\n        // const gasTile = cell.depthTile(GWM.flags.Depth.GAS);\n        let surface = '';\n        if (surfaceTile) {\n            const tile = surfaceTile;\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' on ';\n            }\n            if (tile.hasTileFlag(GWM.flags.Tile.T_BRIDGE)) {\n                article = ' over ';\n            }\n            surface = surfaceTile.getFlavor() + article;\n        }\n        let liquid = '';\n        if (liquidTile) {\n            liquid = liquidTile.getFlavor() + ' covering ';\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' in ';\n            }\n        }\n        if (needObjectArticle) {\n            needObjectArticle = false;\n            object += ' on ';\n        }\n        let ground = groundTile.getFlavor({ article: true });\n        buf = GWU.text.apply('§intro§ §text§.', {\n            intro,\n            text: object + surface + liquid + ground,\n        });\n        return buf;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from './widget';\nGWU.color.install('blueBar', 15, 10, 50);\nGWU.color.install('redBar', 45, 10, 15);\nGWU.color.install('purpleBar', 50, 0, 50);\nGWU.color.install('greenBar', 10, 50, 10);\nexport class EntryBase {\n    constructor() {\n        this.dist = 0;\n        this.priority = 0;\n        this.changed = false;\n        this.sidebarY = -1;\n    }\n    draw(_buffer, _bounds) {\n        return 0;\n    }\n}\nexport class ActorEntry extends EntryBase {\n    constructor(actor) {\n        super();\n        this.actor = actor;\n    }\n    get x() {\n        return this.actor.x;\n    }\n    get y() {\n        return this.actor.y;\n    }\n    draw(buffer, bounds) {\n        return this.actor.drawStatus(buffer, bounds);\n    }\n}\nexport class ItemEntry extends EntryBase {\n    constructor(item) {\n        super();\n        this.item = item;\n    }\n    get x() {\n        return this.item.x;\n    }\n    get y() {\n        return this.item.y;\n    }\n    draw(buffer, bounds) {\n        return this.item.drawStatus(buffer, bounds);\n    }\n}\nexport class CellEntry extends EntryBase {\n    constructor(cell) {\n        super();\n        this.cell = cell;\n    }\n    get x() {\n        return this.cell.x;\n    }\n    get y() {\n        return this.cell.y;\n    }\n    draw(buffer, bounds) {\n        return this.cell.drawStatus(buffer, bounds);\n    }\n}\nexport class Sidebar extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.cellCache = [];\n        this.lastX = -1;\n        this.lastY = -1;\n        this.lastMap = null;\n        this.entries = [];\n        this.subject = null;\n        this.highlight = null;\n    }\n    init(opts) {\n        opts.fg = opts.fg || 'purple';\n        opts.bg = opts.bg || 'black';\n        super.init(opts);\n    }\n    reset() {\n        super.reset();\n        this.lastMap = null;\n        this.lastX = -1;\n        this.lastY = -1;\n    }\n    entryAt(e) {\n        return (this.entries.find((entry) => {\n            return entry.sidebarY <= e.y && entry.sidebarY !== -1;\n        }) || null);\n    }\n    mousemove(e, dialog) {\n        super.mousemove(e, dialog);\n        if (this.contains(e)) {\n            return this.highlightRow(e.y);\n        }\n        return this.clearHighlight();\n    }\n    highlightRow(y) {\n        const last = this.highlight;\n        this.highlight = null;\n        // processed in ascending y order\n        this.entries.forEach((e) => {\n            if (e.sidebarY <= y && e.sidebarY !== -1) {\n                this.highlight = e;\n            }\n        });\n        return this.highlight !== last;\n    }\n    clearHighlight() {\n        const result = !!this.highlight;\n        this.highlight = null;\n        return result;\n    }\n    updateCellCache(map) {\n        if (this.lastMap &&\n            map === this.lastMap &&\n            !map.hasMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED)) {\n            return;\n        }\n        this.lastMap = null; // Force us to regather the entries, even if at same location\n        this.cellCache.length = 0;\n        GWU.xy.forRect(map.width, map.height, (x, y) => {\n            const info = map.cell(x, y);\n            if (info.hasEntityFlag(GWM.flags.Entity.L_LIST_IN_SIDEBAR)) {\n                this.cellCache.push(info);\n            }\n        });\n        map.clearMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED);\n    }\n    _makeActorEntry(actor) {\n        return new ActorEntry(actor);\n    }\n    _makeItemEntry(item) {\n        return new ItemEntry(item);\n    }\n    _makeCellEntry(cell) {\n        return new CellEntry(cell);\n    }\n    _getPriority(map, x, y, fov) {\n        if (!fov) {\n            return map.cell(x, y).hasCellFlag(GWM.flags.Cell.STABLE_MEMORY)\n                ? 3\n                : 1;\n        }\n        if (fov.isDirectlyVisible(x, y)) {\n            return 1;\n        }\n        else if (fov.isAnyKindOfVisible(x, y)) {\n            return 2;\n        }\n        else if (fov.isRevealed(x, y)) {\n            return 3;\n        }\n        return -1; // not visible, or revealed\n    }\n    _isDim(entry) {\n        if (entry === this.highlight)\n            return false;\n        return entry.priority > 2 || !!this.highlight;\n    }\n    _addActorEntry(actor, map, x, y, fov) {\n        const priority = this._getPriority(map, actor.x, actor.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeActorEntry(actor);\n        entry.dist = GWU.xy.distanceBetween(x, y, actor.x, actor.y);\n        entry.priority = actor.isPlayer() ? 0 : priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addItemEntry(item, map, x, y, fov) {\n        const priority = this._getPriority(map, item.x, item.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeItemEntry(item);\n        entry.dist = GWU.xy.distanceBetween(x, y, item.x, item.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addCellEntry(cell, map, x, y, fov) {\n        const priority = this._getPriority(map, cell.x, cell.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeCellEntry(cell);\n        entry.dist = GWU.xy.distanceBetween(x, y, cell.x, cell.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    findEntries(map, cx, cy, fov) {\n        if (map === this.lastMap && cx === this.lastX && cy === this.lastY)\n            return;\n        this.clearHighlight(); // If we are moving around the map, then turn off the highlight\n        this.lastMap = map;\n        this.lastX = cx;\n        this.lastY = cy;\n        this.entries.length = 0;\n        const done = GWU.grid.alloc(map.width, map.height);\n        map.eachActor((a) => {\n            const x = a.x;\n            const y = a.y;\n            if (done[x][y])\n                return;\n            if (this._addActorEntry(a, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        map.eachItem((i) => {\n            const x = i.x;\n            const y = i.y;\n            if (done[x][y])\n                return;\n            if (this._addItemEntry(i, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        this.cellCache.forEach((c) => {\n            if (done[c.x][c.y])\n                return;\n            if (this._addCellEntry(c, map, cx, cy, fov)) {\n                done[c.x][c.y] = 1;\n            }\n        });\n        this.entries.sort((a, b) => {\n            if (a.priority != b.priority) {\n                return a.priority - b.priority;\n            }\n            return a.dist - b.dist;\n        });\n        GWU.grid.free(done);\n    }\n    update() {\n        if (!this.subject) {\n            throw new Error('Update requires a subject to follow.');\n        }\n        return this.updateFor(this.subject);\n    }\n    updateFor(subject) {\n        return this.updateAt(subject.memory || subject.map, subject.x, subject.y, subject.fov);\n    }\n    updateAt(map, cx, cy, fov) {\n        this.updateCellCache(map);\n        this.findEntries(map, cx, cy, fov);\n        return true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, 0, 0, this.bg);\n        // clear the row information\n        this.entries.forEach((e) => (e.sidebarY = -1));\n        const drawBounds = this.bounds.clone();\n        let currentEntry;\n        for (let i = 0; i < this.entries.length && drawBounds.height > 0; ++i) {\n            currentEntry = this.entries[i];\n            currentEntry.sidebarY = drawBounds.y;\n            let usedLines = currentEntry.draw(buffer, drawBounds);\n            if (this._isDim(currentEntry)) {\n                buffer.mix(this.bg, 50, drawBounds.x, drawBounds.y, drawBounds.width, usedLines);\n            }\n            if (usedLines) {\n                ++usedLines; // skip a space\n                drawBounds.y += usedLines;\n                drawBounds.height -= usedLines;\n            }\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class MenuButton {\n    constructor(text) {\n        this.hovered = false;\n        this.x = 999;\n        this.text = text;\n    }\n    get width() {\n        return this.text.length;\n    }\n}\nexport class ActionButton extends MenuButton {\n    constructor(text, action) {\n        super(text);\n        this.action = action;\n    }\n}\nexport class DropDownButton extends MenuButton {\n    constructor(menu, parent, text, buttons) {\n        super(text);\n        this.buttons = [];\n        this.parent = null;\n        this.menu = menu;\n        this.parent = parent;\n        this.text = text;\n        this.bounds = new GWU.xy.Bounds(0, 0, 0, 0);\n        Object.entries(buttons).forEach(([text, opts]) => {\n            this.addButton(text, opts);\n        });\n    }\n    addButton(text, config) {\n        // if (this.buttons.length >= this.menu.bounds.height - 1) {\n        //     throw new Error('Too many menu options.');\n        // }\n        let button;\n        if (typeof config === 'string') {\n            button = new ActionButton(text, config);\n        }\n        else {\n            button = new DropDownButton(this.menu, this, text, config);\n        }\n        this.buttons.push(button);\n        ++this.bounds.height;\n        this.bounds.width = Math.max(this.bounds.width, text.length + 2);\n    }\n    setBounds(buffer, px, py, pw) {\n        // vertical reveal\n        const right = px + pw;\n        const totalWidth = buffer.width;\n        if (this.bounds.width < totalWidth - right) {\n            this.bounds.x = right;\n        }\n        else if (this.bounds.width < px) {\n            this.bounds.x = px - this.bounds.width;\n        }\n        else {\n            throw new Error('Menu does not fit - too wide.');\n        }\n        const totalHeight = buffer.height;\n        if (this.bounds.height <= totalHeight - py) {\n            this.bounds.y = py;\n        }\n        else if (this.bounds.height < totalHeight) {\n            this.bounds.y = totalHeight - this.bounds.height - 1;\n        }\n        else {\n            throw new Error('Menu does not fit - too tall.');\n        }\n        // this.buttons.forEach((b) => {\n        //     if (b instanceof DropDownButton) {\n        //         b.setBounds(buffer);\n        //     }\n        // });\n    }\n    contains(e) {\n        return this.bounds.contains(e);\n    }\n    buttonAt(e) {\n        const index = e.y - this.bounds.y;\n        return this.buttons[index] || null;\n    }\n    draw(buffer) {\n        const width = this.bounds.width;\n        const height = this.bounds.height;\n        const x = this.bounds.x;\n        let y = this.bounds.y;\n        buffer.fillRect(x, y, width, height, 0, 0, this.menu.dropBg);\n        // Now draw the individual buttons...\n        this.buttons.forEach((b) => {\n            buffer.drawText(x + 1, y, b.text, b.hovered ? this.menu.activeFg : this.menu.dropFg, b.hovered ? this.menu.activeBg : this.menu.dropBg);\n            ++y;\n        });\n        if (this.parent) {\n            this.parent.draw(buffer);\n        }\n    }\n}\nexport async function showDropDown(dialog, menu, button) {\n    // Start dialog\n    const ui = dialog.ui;\n    const buffer = ui.startLayer();\n    button.buttons.forEach((b) => (b.hovered = false));\n    // button.buttons[0].hovered = true;\n    let activeButton = button;\n    await ui.loop.run({\n        Escape() {\n            return true;\n        },\n        // TODO - Tab\n        Tab() {\n            menu.activeIndex = (menu.activeIndex + 1) % menu.buttons.length;\n            const button = menu.buttons[menu.activeIndex];\n            if (button) {\n                button.hovered = true;\n            }\n            if (activeButton && button instanceof DropDownButton) {\n                activeButton.hovered = false;\n                activeButton = button;\n            }\n            else {\n                activeButton = null; // done.\n            }\n            dialog.requestRedraw();\n            return !activeButton;\n        },\n        // TODO - TAB\n        TAB() {\n            menu.activeIndex =\n                (menu.buttons.length + menu.activeIndex - 1) %\n                    menu.buttons.length;\n            const button = menu.buttons[menu.activeIndex];\n            if (button) {\n                button.hovered = true;\n            }\n            if (activeButton && button instanceof DropDownButton) {\n                activeButton.hovered = false;\n                activeButton = button;\n            }\n            else {\n                activeButton = null; // done.\n            }\n            dialog.requestRedraw();\n            return !activeButton;\n        },\n        mousemove: (e) => {\n            if (!activeButton)\n                return true; // we are done (should not happen)\n            let newActive = activeButton;\n            while (newActive && !newActive.contains(e)) {\n                newActive = newActive.parent;\n            }\n            if (newActive) {\n                activeButton = newActive;\n                const selected = activeButton.buttonAt(e);\n                if (selected) {\n                    activeButton.buttons.forEach((b) => {\n                        b.hovered = false;\n                    });\n                    selected.hovered = true;\n                    if (selected instanceof DropDownButton) {\n                        selected.buttons.forEach((b) => {\n                            b.hovered = false;\n                        });\n                        selected.buttons[0].hovered = true;\n                        selected.setBounds(ui.buffer, activeButton.bounds.x, e.y, activeButton.bounds.width);\n                        activeButton = selected;\n                    }\n                }\n            }\n            else {\n                if (menu.contains(e)) {\n                    if (dialog)\n                        dialog.requestRedraw();\n                    const button = menu.getButtonAt(e.x, e.y);\n                    if (button) {\n                        button.hovered = true;\n                        menu.activeIndex = menu.buttons.indexOf(button);\n                    }\n                    if (button instanceof DropDownButton) {\n                        activeButton.hovered = false;\n                        activeButton = button;\n                    }\n                    else {\n                        activeButton = null; // done.\n                    }\n                    if (dialog)\n                        dialog.requestRedraw();\n                }\n            }\n            return !activeButton; // if no active button we are done (should not happen)\n        },\n        click: async (e) => {\n            if (!activeButton)\n                return true; // we are done (should not happen)\n            if (!activeButton.contains(e)) {\n                menu.clearHighlight();\n                return true; // we are done\n            }\n            const actionButton = activeButton.buttonAt(e);\n            if (!actionButton) {\n                return true; // weird, but we are done.\n            }\n            if (actionButton instanceof ActionButton) {\n                menu.actionButton = actionButton;\n                await dialog.fireAction(actionButton.action, menu);\n                return true;\n            }\n            return false;\n        },\n        dir: async (e) => {\n            if (!activeButton)\n                return true; // should not happen\n            if (!e.dir)\n                return;\n            if (e.dir[1]) {\n                const current = activeButton.buttons.findIndex((b) => b.hovered);\n                if (current < 1 && e.dir[1] < 0) {\n                    activeButton.buttons.forEach((b) => (b.hovered = false));\n                    return true; // close me!\n                }\n                const index = GWU.clamp(current + e.dir[1], 0, activeButton.buttons.length - 1);\n                activeButton.buttons.forEach((b, i) => (b.hovered = i === index));\n                const selected = activeButton.buttons[index];\n                if (selected instanceof DropDownButton) {\n                    selected.buttons.forEach((b) => {\n                        b.hovered = false;\n                    });\n                    selected.buttons[0].hovered = true;\n                    selected.setBounds(ui.buffer, activeButton.bounds.x, e.y, activeButton.bounds.width);\n                    activeButton = selected;\n                }\n            }\n        },\n        draw: () => {\n            if (!activeButton)\n                return;\n            ui.resetLayerBuffer();\n            activeButton.draw(buffer);\n            menu.draw(buffer);\n            buffer.render();\n        },\n    });\n    ui.finishLayer();\n    menu.clearHighlight();\n}\nexport class Menu extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.activeIndex = -1;\n        this.actionButton = null;\n    }\n    init(opts) {\n        opts.fg = GWU.first(opts.fg, 'black');\n        opts.bg = GWU.first(opts.bg, 'light_gray');\n        opts.height = opts.height || 1;\n        opts.tabStop = GWU.first(opts.tabStop, true);\n        super.init(opts);\n        this.dropFg = GWU.color.from(opts.dropFg || this.fg);\n        this.dropBg = GWU.color.from(opts.dropBg || this.bg);\n        this.buttons = [];\n        this.separator = opts.separator || ' | ';\n        this.lead = opts.lead || ' ';\n        Object.entries(opts.buttons).forEach(([text, opts]) => {\n            this._addButton(text, opts);\n        });\n        if (opts.separator) {\n            this.separator = opts.separator;\n        }\n        if (opts.lead !== undefined) {\n            this.lead = opts.lead ? opts.lead : '';\n        }\n    }\n    reset() {\n        super.reset();\n        const onTop = this.bounds.y <= 10;\n        this.buttons.forEach((b) => {\n            if (b instanceof DropDownButton) {\n                if (onTop) {\n                    b.bounds.top = this.bounds.bottom + 1;\n                }\n                else {\n                    b.bounds.bottom = this.bounds.top - 1;\n                }\n            }\n        });\n    }\n    activate(reverse = false) {\n        super.activate(reverse);\n        if (this.activeIndex < 0)\n            this.activeIndex = reverse ? this.buttons.length - 1 : 0;\n    }\n    deactivate() {\n        super.deactivate();\n        this.activeIndex = -1;\n    }\n    mousemove(e, dialog) {\n        // turn off all the hovers\n        this.buttons.forEach((b) => {\n            if (b.hovered) {\n                b.hovered = false;\n            }\n        });\n        if (!super.mousemove(e, dialog))\n            return false;\n        // highlight one of them...\n        if (this.bounds.contains(e)) {\n            let hovered = null;\n            this.buttons.forEach((b) => {\n                b.hovered = false;\n                if (b.x < e.x) {\n                    hovered = b;\n                }\n            });\n            if (hovered) {\n                // @ts-ignore\n                hovered.hovered = true;\n                this.activeIndex = this.buttons.indexOf(hovered);\n            }\n            if (dialog)\n                dialog.requestRedraw();\n            return true; // we handled the message\n        }\n        return false;\n    }\n    clearHighlight() {\n        this.buttons.forEach((b) => {\n            b.hovered = false;\n        });\n    }\n    getButtonAt(x, _y) {\n        return GWU.arrayFindRight(this.buttons, (b) => b.x < x) || null;\n    }\n    async click(e, dialog) {\n        if (this.bounds.contains(e)) {\n            // get active button\n            let activeButton = this.getButtonAt(e.x, e.y);\n            if (!activeButton)\n                return false;\n            this.activeIndex = this.buttons.indexOf(activeButton);\n            if (activeButton instanceof DropDownButton) {\n                await showDropDown(dialog, this, activeButton);\n            }\n            else if (activeButton instanceof ActionButton) {\n                this.actionButton = activeButton;\n                await dialog.fireAction(activeButton.action, this);\n            }\n            return true;\n        }\n        return false;\n    }\n    async keypress(e, dialog) {\n        if (this.active) {\n            if (e.key === 'Tab') {\n                ++this.activeIndex;\n                if (this.activeIndex >= this.buttons.length) {\n                    this.deactivate();\n                    return false; // tabbing away from me, need to process in dialog\n                }\n                return true;\n            }\n            else if (e.key === 'TAB') {\n                --this.activeIndex;\n                if (this.activeIndex < 0) {\n                    this.deactivate();\n                    return false; // shift tabbing away from me, need to process in dialog\n                }\n                return true;\n            }\n            else if (e.key === 'Enter') {\n                const activeButton = this.buttons[this.activeIndex];\n                if (activeButton instanceof DropDownButton) {\n                    await showDropDown(dialog, this, activeButton);\n                }\n                else if (activeButton instanceof ActionButton) {\n                    this.actionButton = activeButton;\n                    await dialog.fireAction(activeButton.action, this);\n                }\n                return true;\n            }\n        }\n        return super.keypress(e, dialog);\n    }\n    _addButton(text, config) {\n        const x = this.buttons.reduce((len, button) => len + button.text.length + this.separator.length, this.lead.length + this.bounds.x);\n        if (x + text.length + this.separator.length > this.bounds.width) {\n            throw new Error('Button makes menu too wide :' + text);\n        }\n        let button;\n        if (typeof config === 'string') {\n            button = new ActionButton(text, config);\n        }\n        else {\n            const dropdown = new DropDownButton(this, null, text, config);\n            dropdown.bounds.x = x - 1; // Hmmm...\n            button = dropdown;\n        }\n        button.x = x;\n        this.buttons.push(button);\n    }\n    draw(buffer) {\n        const bg = this.active ? this.activeBg : this.bg;\n        const fg = this.active ? this.activeFg : this.fg;\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, 1, 0, bg, bg);\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        buffer.drawText(x, y, this.lead, fg);\n        this.buttons.forEach((b, i) => {\n            const hovered = i === this.activeIndex;\n            const color = hovered ? this.hoverFg : fg;\n            const bgColor = hovered ? this.hoverBg : bg;\n            buffer.drawText(b.x, y, b.text, color, bgColor);\n            x = b.x + b.text.length;\n            buffer.drawText(x, y, this.separator, fg);\n        });\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nexport class Selector {\n    constructor(text) {\n        this.priority = 0;\n        if (text.startsWith(':') || text.startsWith('.')) {\n            text = '*' + text;\n        }\n        this.text = text;\n        this.matchFn = this._parse(text);\n    }\n    _parse(text) {\n        const parts = text.split(/ +/g).map((p) => p.trim());\n        const matches = [];\n        for (let i = 0; i < parts.length; ++i) {\n            let p = parts[i];\n            if (p === '>') {\n                matches.push(this._parentMatch());\n                ++i;\n                p = parts[i];\n            }\n            else if (i > 0) {\n                matches.push(this._ancestorMatch());\n            }\n            matches.push(this._matchElement(p));\n        }\n        return matches.reduce((out, fn) => fn.bind(undefined, out), GWU.TRUE);\n    }\n    _parentMatch() {\n        return function parentM(next, e) {\n            // console.log('parent', e.parent);\n            if (!e.parent)\n                return false;\n            return next(e.parent);\n        };\n    }\n    _ancestorMatch() {\n        return function ancestorM(next, e) {\n            let current = e.parent;\n            while (current) {\n                if (next(current))\n                    return true;\n            }\n            return false;\n        };\n    }\n    _matchElement(text) {\n        const CSS_RE = /(?:(\\w+|\\*|\\$)|#(\\w+)|\\.([^\\.: ]+))|(?::(?:(?:not\\(\\.([^\\)]+)\\))|(?:not\\(:([^\\)]+)\\))|([^\\.: ]+)))/g;\n        const parts = [];\n        const re = new RegExp(CSS_RE, 'g');\n        let match = re.exec(text);\n        while (match) {\n            if (match[1]) {\n                const fn = this._matchTag(match[1]);\n                if (fn) {\n                    parts.push(fn);\n                }\n            }\n            else if (match[2]) {\n                parts.push(this._matchId(match[2]));\n            }\n            else if (match[3]) {\n                parts.push(this._matchClass(match[3]));\n            }\n            else if (match[4]) {\n                parts.push(this._matchNot(this._matchClass(match[4])));\n            }\n            else if (match[5]) {\n                parts.push(this._matchNot(this._matchProp(match[5])));\n            }\n            else {\n                parts.push(this._matchProp(match[6]));\n            }\n            match = re.exec(text);\n        }\n        return (next, e) => {\n            if (!parts.every((fn) => fn(e)))\n                return false;\n            return next(e);\n        };\n    }\n    _matchTag(tag) {\n        if (tag === '*')\n            return null;\n        if (tag === '$') {\n            this.priority += 10000;\n            return null;\n        }\n        this.priority += 10;\n        return (el) => el.tag === tag;\n    }\n    _matchClass(cls) {\n        this.priority += 100;\n        return (el) => el.classes.includes(cls);\n    }\n    _matchProp(prop) {\n        if (prop.startsWith('first')) {\n            return this._matchFirst();\n        }\n        else if (prop.startsWith('last')) {\n            return this._matchLast();\n        }\n        else if (prop === 'invalid') {\n            return this._matchNot(this._matchProp('valid'));\n        }\n        else if (prop === 'optional') {\n            return this._matchNot(this._matchProp('required'));\n        }\n        else if (prop === 'enabled') {\n            return this._matchNot(this._matchProp('disabled'));\n        }\n        else if (prop === 'unchecked') {\n            return this._matchNot(this._matchProp('checked'));\n        }\n        this.priority += 1; // prop\n        return (el) => !!el.prop(prop);\n    }\n    _matchId(id) {\n        this.priority += 1000;\n        return (el) => el.attr('id') === id;\n    }\n    _matchFirst() {\n        this.priority += 1; // prop\n        return (el) => !!el.parent && el.parent.children[0] === el;\n    }\n    _matchLast() {\n        this.priority += 1; // prop\n        return (el) => !!el.parent &&\n            el.parent.children[el.parent.children.length - 1] === el;\n    }\n    _matchNot(fn) {\n        return (el) => !fn(el);\n    }\n    matches(obj) {\n        return this.matchFn(obj);\n    }\n}\nexport function compile(text) {\n    return new Selector(text);\n}\n","import { Selector } from './selector';\nexport class Style {\n    constructor(selector = '$', init) {\n        this._dirty = false;\n        this.selector = new Selector(selector);\n        if (init) {\n            this.set(init);\n        }\n        this._dirty = false;\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n    get fg() {\n        return this._fg;\n    }\n    get bg() {\n        return this._bg;\n    }\n    get border() {\n        return this._border;\n    }\n    // get depth(): number | undefined {\n    //     return this._depth;\n    // }\n    get align() {\n        return this._align;\n    }\n    get valign() {\n        return this._valign;\n    }\n    get position() {\n        return this._position;\n    }\n    get minWidth() {\n        return this._minWidth;\n    }\n    get maxWidth() {\n        return this._maxWidth;\n    }\n    get width() {\n        return this._width;\n    }\n    get minHeight() {\n        return this._minHeight;\n    }\n    get maxHeight() {\n        return this._maxHeight;\n    }\n    get height() {\n        return this._height;\n    }\n    get x() {\n        return this._x;\n    }\n    get left() {\n        return this._left;\n    }\n    get right() {\n        return this._right;\n    }\n    get y() {\n        return this._y;\n    }\n    get top() {\n        return this._top;\n    }\n    get bottom() {\n        return this._bottom;\n    }\n    get padLeft() {\n        return this._padLeft;\n    }\n    get padRight() {\n        return this._padRight;\n    }\n    get padTop() {\n        return this._padTop;\n    }\n    get padBottom() {\n        return this._padBottom;\n    }\n    get marginLeft() {\n        return this._marginLeft;\n    }\n    get marginRight() {\n        return this._marginRight;\n    }\n    get marginTop() {\n        return this._marginTop;\n    }\n    get marginBottom() {\n        return this._marginBottom;\n    }\n    get(key) {\n        const id = ('_' + key);\n        return this[id];\n    }\n    set(key, value, setDirty = true) {\n        if (typeof key === 'string') {\n            if (key === 'padding') {\n                if (typeof value === 'number') {\n                    value = [value];\n                }\n                else if (typeof value === 'string') {\n                    value = value.split(' ');\n                }\n                value = value.map((v) => {\n                    if (typeof v === 'string')\n                        return Number.parseInt(v);\n                    return v;\n                });\n                if (value.length == 1) {\n                    this._padLeft =\n                        this._padRight =\n                            this._padTop =\n                                this._padBottom =\n                                    value[0];\n                }\n                else if (value.length == 2) {\n                    this._padLeft = this._padRight = value[1];\n                    this._padTop = this._padBottom = value[0];\n                }\n                else if (value.length == 3) {\n                    this._padTop = value[0];\n                    this._padRight = value[1];\n                    this._padBottom = value[2];\n                    this._padLeft = value[1];\n                }\n                else if (value.length == 4) {\n                    this._padTop = value[0];\n                    this._padRight = value[1];\n                    this._padBottom = value[2];\n                    this._padLeft = value[3];\n                }\n            }\n            else if (key === 'margin') {\n                if (typeof value === 'number') {\n                    value = [value];\n                }\n                else if (typeof value === 'string') {\n                    value = value.split(' ');\n                }\n                value = value.map((v) => {\n                    if (typeof v === 'string')\n                        return Number.parseInt(v);\n                    return v;\n                });\n                if (value.length == 1) {\n                    this._marginLeft =\n                        this._marginRight =\n                            this._marginTop =\n                                this._marginBottom =\n                                    value[0];\n                }\n                else if (value.length == 2) {\n                    this._marginLeft = this._marginRight = value[1];\n                    this._marginTop = this._marginBottom = value[0];\n                }\n                else if (value.length == 3) {\n                    this._marginTop = value[0];\n                    this._marginRight = value[1];\n                    this._marginBottom = value[2];\n                    this._marginLeft = value[1];\n                }\n                else if (value.length == 4) {\n                    this._marginTop = value[0];\n                    this._marginRight = value[1];\n                    this._marginBottom = value[2];\n                    this._marginLeft = value[3];\n                }\n            }\n            else {\n                const field = '_' + key;\n                if (typeof value === 'string') {\n                    if (value.match(/^[+-]?\\d+$/)) {\n                        value = Number.parseInt(value);\n                    }\n                    else if (value === 'true') {\n                        value = true;\n                    }\n                    else if (value === 'false') {\n                        value = false;\n                    }\n                }\n                this[field] = value;\n            }\n        }\n        else if (key instanceof Style) {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (name === 'selector' || name === '_dirty')\n                    return;\n                if (value !== undefined && value !== null) {\n                    this[name] = value;\n                }\n                else if (value === null) {\n                    this.unset(name);\n                }\n            });\n        }\n        else {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (value === null) {\n                    this.unset(name);\n                }\n                else {\n                    this.set(name, value, setDirty);\n                }\n            });\n        }\n        this.dirty || (this.dirty = setDirty);\n        return this;\n    }\n    unset(key) {\n        const field = key.startsWith('_') ? key : '_' + key;\n        delete this[field];\n        this.dirty = true;\n        return this;\n    }\n    clone() {\n        const other = new this.constructor();\n        other.copy(this);\n        return other;\n    }\n    copy(other) {\n        Object.assign(this, other);\n        return this;\n    }\n}\nexport function makeStyle(style, selector = '$') {\n    const opts = {};\n    const parts = style\n        .trim()\n        .split(';')\n        .map((p) => p.trim());\n    parts.forEach((p) => {\n        const [name, base] = p.split(':').map((p) => p.trim());\n        if (!name)\n            return;\n        const baseParts = base.split(/ +/g);\n        if (baseParts.length == 1) {\n            // @ts-ignore\n            opts[name] = base;\n        }\n        else {\n            // @ts-ignore\n            opts[name] = baseParts;\n        }\n    });\n    return new Style(selector, opts);\n}\n// const NO_BOUNDS = ['fg', 'bg', 'depth', 'align', 'valign'];\n// export function affectsBounds(key: keyof StyleOptions): boolean {\n//     return !NO_BOUNDS.includes(key);\n// }\nexport class ComputedStyle extends Style {\n    // constructor(source: Stylable, sources?: Style[]) {\n    constructor(sources) {\n        super();\n        // obj: Stylable;\n        this.sources = [];\n        // this.obj = source;\n        if (sources) {\n            // sort low to high priority (highest should be this.obj._style, lowest = global default:'*')\n            sources.sort((a, b) => a.selector.priority - b.selector.priority);\n            this.sources = sources;\n        }\n        this.sources.forEach((s) => super.set(s));\n        this._dirty = false; // As far as I know I reflect all of the current source values.\n    }\n    get dirty() {\n        return this._dirty || this.sources.some((s) => s.dirty);\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n}\nexport class Sheet {\n    constructor(parentSheet) {\n        this.rules = [];\n        this._dirty = true;\n        if (parentSheet === undefined) {\n            parentSheet = defaultStyle;\n        }\n        if (parentSheet) {\n            this.rules = parentSheet.rules.slice();\n        }\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (!this._dirty) {\n            this.rules.forEach((r) => (r.dirty = false));\n        }\n    }\n    add(selector, props) {\n        if (selector.includes(',')) {\n            const parts = selector\n                .split(',')\n                .map((p) => p.trim())\n                .map((p) => this.add(p, props));\n            return parts[parts.length - 1];\n        }\n        if (selector.includes(' '))\n            throw new Error('Hierarchical selectors not supported.');\n        // if 2 '.' - Error('Only single class rules supported.')\n        // if '&' - Error('Not supported.')\n        let rule = new Style(selector, props);\n        const existing = this.rules.findIndex((s) => s.selector.text === rule.selector.text);\n        if (existing > -1) {\n            const current = this.rules[existing];\n            current.set(rule);\n            rule = current;\n        }\n        else {\n            this.rules.push(rule);\n        }\n        // rulesChanged = true;\n        this.dirty = true;\n        return rule;\n    }\n    get(selector) {\n        return this.rules.find((s) => s.selector.text === selector) || null;\n    }\n    remove(selector) {\n        const existing = this.rules.findIndex((s) => s.selector.text === selector);\n        if (existing > -1) {\n            this.rules.splice(existing, 1);\n            this.dirty = true;\n        }\n    }\n    computeFor(widget) {\n        const sources = this.rules.filter((r) => r.selector.matches(widget));\n        const widgetStyle = widget.style();\n        if (widgetStyle) {\n            sources.push(widgetStyle);\n        }\n        widgetStyle.dirty = false;\n        return new ComputedStyle(sources);\n    }\n}\nexport const defaultStyle = new Sheet(null);\n","import * as GWU from 'gw-utils';\nimport * as Style from './style';\nStyle.defaultStyle.add('*', {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n    position: 'static',\n});\nexport class Element {\n    // hovered: Style.Style = {};\n    // active: Style.Style = {};\n    constructor(tag, styles) {\n        this.parent = null;\n        this._props = {};\n        this._attrs = {};\n        this.classes = [];\n        this.children = [];\n        this.events = {};\n        this._data = null;\n        this._bounds = new GWU.xy.Bounds(0, 0, 0, 0);\n        this._text = '';\n        this._lines = [];\n        this._dirty = false;\n        this._attached = false;\n        this._style = null;\n        this.tag = tag;\n        this._usedStyle = styles\n            ? styles.computeFor(this)\n            : new Style.ComputedStyle();\n    }\n    contains(x, y) {\n        if (typeof x === 'number')\n            return this._bounds.contains(x, y);\n        return this._bounds.contains(x);\n    }\n    clone() {\n        if (this._attached && !this.parent)\n            throw new Error('Cannot clone a root widget.');\n        const other = new this.constructor(this.tag);\n        Object.assign(other._props, this._props);\n        other.classes = this.classes.slice();\n        other._text = this._text;\n        if (this._style) {\n            other._style = this._style.clone();\n        }\n        other.parent = null; // The root cloned widget will not have a parent anymore\n        other._attached = false;\n        other.dirty = true;\n        // First we clone the children, then we set their parent to us\n        other.children = this.children.map((c) => c.clone());\n        other.children.forEach((c) => (c.parent = other));\n        return other;\n    }\n    get dirty() {\n        return this._dirty || this._usedStyle.dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (this.parent && v) {\n            const position = this.used('position');\n            if (position === 'static' || position === 'relative') {\n                this.parent.dirty = true;\n            }\n        }\n    }\n    attr(name, value) {\n        if (value === undefined)\n            return this._attrs[name];\n        this._setAttr(name, value);\n        return this;\n    }\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'style') {\n            this._style = Style.makeStyle(value);\n            this._usedStyle.dirty = true;\n        }\n    }\n    _attrInt(name, def = 0) {\n        let v = this._attrs[name];\n        if (v === undefined)\n            return def;\n        if (typeof v === 'string') {\n            return Number.parseInt(v);\n        }\n        else if (typeof v === 'boolean') {\n            return v ? 1 : 0;\n        }\n        return v;\n    }\n    _attrString(name) {\n        let v = this._attrs[name] || '';\n        if (typeof v === 'string')\n            return v;\n        return '' + v;\n    }\n    _attrBool(name) {\n        const v = this._attrs[name] || false;\n        if (typeof v === 'boolean')\n            return v;\n        if (typeof v === 'number')\n            return v != 0;\n        return v.length > 0 && v !== 'false';\n    }\n    prop(name, value) {\n        if (value === undefined)\n            return this._props[name];\n        this._setProp(name, value);\n        return this;\n    }\n    _setProp(name, value) {\n        if (this._props[name] === value)\n            return;\n        this._props[name] = value;\n        this._usedStyle.dirty = true; // Need to reload styles\n    }\n    toggleProp(name) {\n        const v = this._props[name] || false;\n        this._setProp(name, !v);\n        return this;\n    }\n    val(v) {\n        if (v === undefined)\n            return this.prop('value');\n        this._setProp('value', v);\n        return this;\n    }\n    data(doc, v) {\n        if (doc === undefined) {\n            return this._data;\n        }\n        this._setData(doc, v);\n        return this;\n    }\n    _setData(_doc, v) {\n        this._data = v;\n    }\n    onblur(_doc) {\n        this.prop('focus', false);\n    }\n    onfocus(_doc, _reverse) {\n        this.prop('focus', true);\n    }\n    _propInt(name, def = 0) {\n        let v = this._props[name];\n        if (v === undefined)\n            return def;\n        if (typeof v === 'string') {\n            return Number.parseInt(v);\n        }\n        else if (typeof v === 'boolean') {\n            return v ? 1 : 0;\n        }\n        return v;\n    }\n    _propString(name) {\n        let v = this._props[name] || '';\n        if (typeof v === 'string')\n            return v;\n        return '' + v;\n    }\n    _propBool(name) {\n        const v = this._props[name] || false;\n        return !!v;\n    }\n    // CHILDREN\n    _isValidChild(_child) {\n        return true;\n    }\n    appendChild(child, beforeIndex = -1) {\n        if (!this._isValidChild(child)) {\n            throw new Error(`Invalid child (tag=${child.tag}) for element (tag=${this.tag})`);\n        }\n        if (child.parent) {\n            if (child.parent === this)\n                return this; // ok\n            throw new Error('Cannot add a currently attached child to another element.  Detach it first.');\n        }\n        if (beforeIndex == 0) {\n            this.children.unshift(child);\n        }\n        else if (beforeIndex > 0 && beforeIndex <= this.children.length - 1) {\n            this.children.splice(beforeIndex, 0, child);\n        }\n        else {\n            this.children.push(child);\n        }\n        child.parent = this;\n        child.dirty = true;\n        this.dirty = true;\n        return this;\n    }\n    removeChild(child) {\n        if (!child.parent)\n            return this; // not attached, silently ignore\n        if (child.parent !== this) {\n            // TODO - fail silently?\n            throw new Error('Cannot remove child that is not attached to this widget.');\n        }\n        if (GWU.arrayDelete(this.children, child)) {\n            child.parent = null;\n            child.dirty = true;\n            this.dirty = true;\n        }\n        return this;\n    }\n    empty() {\n        this.text(''); // clear the text\n        // clear the children\n        const old = this.children;\n        this.children = []; // no more children\n        old.forEach((c) => {\n            c.parent = null;\n            c.dirty = true;\n        });\n        this.dirty = true;\n        // return the children for cleanup\n        return old;\n    }\n    root() {\n        let current = this;\n        while (current.parent) {\n            current = current.parent;\n        }\n        return current !== this ? current : null;\n    }\n    positionedParent() {\n        const position = this._usedStyle.position || 'static';\n        if (position === 'static')\n            return null;\n        if (position === 'relative')\n            return this;\n        if (position === 'fixed')\n            return this.root();\n        let parent = this.parent;\n        if (parent) {\n            // for absolute position, position is relative to closest ancestor that is positioned\n            while (parent && !parent.isPositioned()) {\n                parent = parent.parent;\n            }\n        }\n        if (!parent) {\n            return this.root(); // no positioned parent so we act fixed.\n        }\n        return parent;\n    }\n    // BOUNDS\n    get bounds() {\n        // this._update();\n        return this._bounds;\n    }\n    get innerLeft() {\n        return (this._bounds.left +\n            (this._usedStyle.padLeft || 0) +\n            (this._usedStyle.marginLeft || 0) +\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerRight() {\n        return (this._bounds.right -\n            (this._usedStyle.padRight || 0) -\n            (this._usedStyle.marginRight || 0) -\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerWidth() {\n        return Math.max(0, this._bounds.width -\n            (this._usedStyle.padLeft || 0) -\n            (this._usedStyle.padRight || 0) -\n            (this._usedStyle.marginLeft || 0) -\n            (this._usedStyle.marginRight || 0) -\n            (this._usedStyle.border ? 2 : 0));\n    }\n    get innerHeight() {\n        return Math.max(0, this._bounds.height -\n            (this._usedStyle.padTop || 0) -\n            (this._usedStyle.padBottom || 0) -\n            (this._usedStyle.marginTop || 0) -\n            (this._usedStyle.marginBottom || 0) -\n            (this._usedStyle.border ? 2 : 0));\n    }\n    get innerTop() {\n        return (this._bounds.top +\n            (this._usedStyle.padTop || 0) +\n            (this._usedStyle.marginTop || 0) +\n            (this._usedStyle.border ? 1 : 0));\n    }\n    get innerBottom() {\n        return (this._bounds.bottom -\n            (this._usedStyle.padBottom || 0) -\n            (this._usedStyle.marginBottom || 0) -\n            (this._usedStyle.border ? 1 : 0));\n    }\n    updateLayout() {\n        // if (!this.dirty) {\n        //     this.children.forEach((c) => c.updateLayout());\n        //     return this;\n        // }\n        this._updateWidth();\n        this._updateHeight();\n        this._updateLeft();\n        this._updateTop();\n        // this.dirty = false;\n        // this.children.forEach((c) => (c.dirty = false));\n        return this;\n    }\n    // update bounds.width and return it\n    _updateWidth() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        bounds.width = used.width || 0;\n        if (!bounds.width) {\n            const position = used.position || 'static';\n            if (['static', 'relative'].includes(position) && this.parent) {\n                bounds.width = this.parent.innerWidth || 0;\n            }\n            // compute internal width\n            if (!bounds.width) {\n                bounds.width =\n                    (used.padLeft || 0) +\n                        (used.padRight || 0) +\n                        (used.marginLeft || 0) +\n                        (used.marginRight || 0) +\n                        (used.border ? 2 : 0);\n                if (this.children.length) {\n                    // my width comes from my children...\n                    bounds.width += this.children.reduce((len, c) => Math.max(len, c._updateWidth()), 0);\n                }\n                else {\n                    bounds.width += this._calcContentWidth();\n                }\n            }\n        }\n        bounds.width = GWU.clamp(bounds.width, used.minWidth || bounds.width, used.maxWidth || bounds.width);\n        this.children.forEach((c) => c._updateWidth());\n        // These do not figure into parent with calculation\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.width;\n    }\n    _updateHeight() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        let contentHeight = 0;\n        bounds.height = used.height || 0;\n        if (!bounds.height) {\n            bounds.height =\n                (used.padTop || 0) +\n                    (used.padBottom || 0) +\n                    (used.marginTop || 0) +\n                    (used.marginBottom || 0) +\n                    (used.border ? 2 : 0);\n            if (this.children.length) {\n                // my height comes from my children...\n                bounds.height += this._calcChildHeight();\n            }\n            else {\n                contentHeight = this._calcContentHeight();\n                bounds.height += contentHeight;\n            }\n        }\n        bounds.height = GWU.clamp(bounds.height, used.minHeight || bounds.height, used.maxHeight || bounds.height);\n        if (contentHeight > this.innerHeight) {\n            this._updateContentHeight();\n        }\n        this.children.forEach((c) => c._updateHeight());\n        // These do not figure into parent height calculation\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.height;\n    }\n    _updateLeft() {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        const position = used.position || 'static';\n        bounds.left = 0;\n        if (position === 'static') {\n            if (this.parent) {\n                bounds.left = this.parent.innerLeft;\n            }\n        }\n        else {\n            const root = this.positionedParent();\n            if (used.left !== undefined) {\n                bounds.left = (root ? root.bounds.left : 0) + used.left;\n            }\n            else if (used.right !== undefined) {\n                if (root) {\n                    bounds.right = root.bounds.right - used.right;\n                }\n            }\n            else {\n                bounds.left = root ? root.bounds.left : 0;\n            }\n        }\n        this.children.forEach((c) => c._updateLeft());\n    }\n    _updateTop(parentBottom = 0) {\n        const used = this._usedStyle;\n        const bounds = this._bounds;\n        const position = used.position || 'static';\n        if (['fixed', 'absolute'].includes(position)) {\n            const root = this.positionedParent();\n            if (used.top !== undefined) {\n                bounds.top = (root ? root.bounds.top : 0) + used.top;\n            }\n            else if (used.bottom !== undefined) {\n                if (root) {\n                    bounds.bottom = root.bounds.bottom - used.bottom;\n                }\n            }\n            else {\n                bounds.top = root ? root.bounds.top : 0;\n            }\n        }\n        else {\n            bounds.top = parentBottom;\n            if (position === 'relative') {\n                if (used.top !== undefined) {\n                    bounds.top += used.top;\n                }\n                else if (used.bottom !== undefined) {\n                    bounds.top -= used.bottom;\n                }\n            }\n        }\n        if (this.children.length) {\n            let innerTop = this.innerTop;\n            this.children.forEach((c) => {\n                innerTop += c._updateTop(innerTop);\n            });\n        }\n        if (['fixed', 'absolute'].includes(position))\n            return 0;\n        return bounds.height;\n    }\n    style(...args) {\n        if (!this._style) {\n            this._style = new Style.Style();\n        }\n        if (args.length === 0)\n            return this._style;\n        if (args.length === 1) {\n            const v = args[0];\n            if (typeof v === 'string') {\n                return this._style.get(v);\n            }\n            else {\n                this._style.set(args[0], false); // do not set the dirty flag\n                this._usedStyle.set(args[0], false); // do not set the dirty flag\n                this.dirty = true; // Need layout update\n            }\n        }\n        else {\n            this._style.set(args[0], args[1], false); // do not set dirty flag\n            this._usedStyle.set(args[0], args[1], false); // do not set dirty flag\n            this.dirty = true; // Need layout update\n        }\n        return this;\n    }\n    removeStyle(id) {\n        if (!this._style)\n            return this;\n        this._style.unset(id);\n        this._usedStyle.dirty = true;\n        return this;\n    }\n    used(id) {\n        if (!id)\n            return this._usedStyle;\n        if (id instanceof Style.ComputedStyle) {\n            this._usedStyle = id;\n            this.dirty = true;\n            return this;\n        }\n        return this._usedStyle.get(id);\n    }\n    addClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (this.classes.includes(cls))\n                return;\n            this._usedStyle.dirty = true; // It needs to get styles for this class\n            this.classes.push(cls);\n        });\n        return this;\n    }\n    removeClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (!GWU.arrayDelete(this.classes, cls))\n                return;\n            this._usedStyle.dirty = true; // It may need to remove some styles\n        });\n        return this;\n    }\n    toggleClass(id) {\n        const items = id.split(' ');\n        items.forEach((cls) => {\n            if (cls.length == 0)\n                return;\n            if (!GWU.arrayDelete(this.classes, cls)) {\n                this.classes.push(cls);\n            }\n            this._usedStyle.dirty = true;\n        });\n        return this;\n    }\n    pos(...args) {\n        if (args.length === 0)\n            return this.bounds;\n        let pos;\n        let wantStyle = 'fixed';\n        if (typeof args[0] === 'number') {\n            pos = { left: args.shift(), top: args.shift() };\n        }\n        else {\n            pos = args.shift();\n        }\n        // update style if necessary\n        if (args[0] && args[0].length) {\n            wantStyle = args[0];\n            this.style('position', wantStyle);\n        }\n        else if (!this.isPositioned()) {\n            this.style('position', 'fixed'); // convert to fixed\n        }\n        if (pos.right !== undefined) {\n            this.style('right', pos.right);\n        }\n        if (pos.left !== undefined) {\n            this.style('left', pos.left);\n        }\n        if (pos.top !== undefined) {\n            this.style('top', pos.top);\n        }\n        if (pos.bottom !== undefined) {\n            this.style('bottom', pos.bottom);\n        }\n        return this;\n    }\n    isPositioned() {\n        const pos = this._usedStyle.position;\n        return !!pos && pos !== 'static';\n    }\n    size(size, height) {\n        if (size === undefined)\n            return this.bounds;\n        if (typeof size === 'number') {\n            size = { width: size, height };\n        }\n        if (size.minWidth !== undefined)\n            this.style('minWidth', size.minWidth);\n        if (size.minHeight !== undefined)\n            this.style('minHeight', size.minHeight);\n        if (size.maxWidth !== undefined)\n            this.style('maxWidth', size.maxWidth);\n        if (size.maxHeight !== undefined)\n            this.style('maxHeight', size.maxHeight);\n        if (size.width !== undefined)\n            this.style('width', size.width);\n        if (size.height !== undefined)\n            this.style('height', size.height);\n        // this._update();\n        return this;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        this._setText(v);\n        return this;\n    }\n    _setText(v) {\n        this._text = v;\n        this.dirty = true;\n        this._usedStyle.dirty = true; // We need to re-layout the _lines (which possibly affects width+height)\n    }\n    _calcContentWidth() {\n        this._lines = GWU.text.splitIntoLines(this._text);\n        return this._lines.reduce((out, line) => Math.max(out, line.length), 0);\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth);\n        return this._lines.length;\n    }\n    _calcChildHeight() {\n        return this.children.reduce((len, c) => len + c._updateHeight(), 0);\n    }\n    _updateContentHeight() {\n        this._lines.length = this.innerHeight;\n    }\n    // DRAWING\n    draw(buffer) {\n        const used = this._usedStyle;\n        if (used.border) {\n            this._drawBorder(buffer);\n        }\n        this._fill(buffer);\n        this._drawContent(buffer);\n        this.dirty = false;\n        return true;\n    }\n    _drawBorder(buffer) {\n        const used = this._usedStyle;\n        const bounds = this.bounds;\n        GWU.xy.forBorder(bounds.x + (used.marginLeft || 0), bounds.y + (used.marginTop || 0), bounds.width - (used.marginLeft || 0) - (used.marginRight || 0), bounds.height - (used.marginTop || 0) - (used.marginBottom || 0), (x, y) => {\n            buffer.draw(x, y, 0, used.border, used.border);\n        });\n    }\n    _fill(buffer) {\n        const used = this._usedStyle;\n        const bg = used.bg;\n        const bounds = this.bounds;\n        buffer.fillRect(bounds.x + (used.marginLeft || 0) + (used.border ? 1 : 0), bounds.y + (used.marginTop || 0) + (used.border ? 1 : 0), bounds.width -\n            (used.marginLeft || 0) -\n            (used.marginRight || 0) -\n            (used.border ? 2 : 0), bounds.height -\n            (used.marginTop || 0) -\n            (used.marginBottom || 0) -\n            (used.border ? 2 : 0), ' ', bg, bg);\n    }\n    _drawContent(buffer) {\n        if (this.children.length) {\n            this._drawChildren(buffer);\n        }\n        else {\n            this._drawText(buffer);\n        }\n    }\n    _drawChildren(buffer) {\n        // https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/Stacking_without_z-index\n        this.children.forEach((c) => {\n            if (!c.isPositioned())\n                c.draw(buffer);\n        });\n        this.children.forEach((c) => {\n            if (c.isPositioned())\n                c.draw(buffer);\n        });\n    }\n    _drawText(buffer) {\n        if (this._lines.length) {\n            const fg = this.used('fg') || 'white';\n            const top = this.innerTop;\n            const width = this.innerWidth;\n            const left = this.innerLeft;\n            const align = this.used('align');\n            this._lines.forEach((line, i) => {\n                buffer.drawText(left, top + i, line, fg, -1, width, align);\n            });\n        }\n    }\n    // Events\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    elementFromPoint(x, y) {\n        let result = null;\n        // positioned elements\n        for (let w of this.children) {\n            if (w.isPositioned() && w.contains(x, y)) {\n                result = w.elementFromPoint(x, y) || result;\n            }\n        }\n        if (result)\n            return result;\n        // static elements\n        for (let w of this.children) {\n            if (!w.isPositioned() && w.contains(x, y)) {\n                result = w.elementFromPoint(x, y) || result;\n            }\n        }\n        if (result)\n            return result;\n        if (!result && this.contains(x, y)) {\n            result = this;\n        }\n        return result;\n    }\n}\n","import * as Element from './element';\nimport * as Style from './style';\nconst MARKUP_RE = /<!--[^]*?(?=-->)-->|<(\\/?)(\\w*)\\s*([^>]*?)(\\/?)>/g;\nconst ATTR_RE = /(\\w+)(?: *= *(?:(?:\\'([^\\']*)\\')|(?:\\\"([^\\\"]*)\\\")|(\\w+)))?/g;\n// var kAttributePattern = /\\b(id|class)\\s*=\\s*(\"([^\"]+)\"|'([^']+)'|(\\S+))/gi;\nexport const selfClosingTags = {\n    meta: true,\n    img: true,\n    link: true,\n    input: true,\n    area: true,\n    br: true,\n    hr: true,\n};\nvar tagsClosedByOpening = {\n    li: { li: true },\n    p: { p: true, div: true },\n    td: { td: true, th: true },\n    th: { td: true, th: true },\n};\nvar tagsClosedByClosing = {\n    li: { ul: true, ol: true },\n    a: { div: true },\n    b: { div: true },\n    i: { div: true },\n    p: { div: true },\n    td: { tr: true, table: true },\n    th: { tr: true, table: true },\n};\nexport const elements = {};\nexport function configureElement(tag, opts = {}) {\n    if (opts.selfClosing) {\n        selfClosingTags[tag] = true;\n    }\n    if (opts.openCloses && opts.openCloses.length) {\n        const tcbo = (tagsClosedByOpening[tag] = {});\n        opts.openCloses.forEach((t) => (tcbo[t] = true));\n    }\n    if (opts.closeCloses && opts.closeCloses.length) {\n        const tcbc = (tagsClosedByClosing[tag] = {});\n        opts.closeCloses.forEach((t) => (tcbc[t] = true));\n    }\n}\nexport function installElement(tag, fn, opts = {}) {\n    elements[tag] = fn;\n    configureElement(tag, opts);\n}\nfunction createElement(tag, rawAttr, stylesheet) {\n    const fn = elements[tag];\n    const e = fn ? fn(tag, stylesheet) : new Element.Element(tag, stylesheet);\n    // TODO - Add attributs, properties, and styles\n    if (rawAttr) {\n        // console.log(tag, rawAttr);\n        const re = new RegExp(ATTR_RE, 'g');\n        let match = re.exec(rawAttr);\n        while (match) {\n            const name = match[1];\n            const value = match[2] || match[3] || match[4] || true;\n            // console.log('- attr', name, value);\n            if (value === true) {\n                e.prop(name, value);\n            }\n            else {\n                e.attr(name, value);\n            }\n            match = re.exec(rawAttr);\n        }\n    }\n    return e;\n}\nfunction back(arr) {\n    return arr[arr.length - 1];\n}\n/**\n * Parse a chuck of HTML source.\n * @param  {string} data      html\n * @return {HTMLElement}      root element\n */\nexport function parse(data, options = {}) {\n    if (options instanceof Style.Sheet) {\n        options = { stylesheet: options };\n    }\n    var root = createElement('dummy', '', options.stylesheet);\n    var currentElement = root;\n    var stack = [root];\n    var lastTextPos = -1;\n    options = options || {};\n    const RE = new RegExp(MARKUP_RE, 'gi');\n    var match, text;\n    match = RE.exec(data);\n    while (match) {\n        if (lastTextPos > -1) {\n            if (lastTextPos + match[0].length < RE.lastIndex) {\n                // if has content\n                text = data.substring(lastTextPos, RE.lastIndex - match[0].length);\n                currentElement.text(text); //.appendNode(new TextNode(text));\n            }\n        }\n        lastTextPos = RE.lastIndex;\n        if (match[0][1] == '!') {\n            // this is a comment\n            continue;\n        }\n        if (options.lowerCaseTagName)\n            match[2] = match[2].toLowerCase();\n        if (!match[1]) {\n            // not </ tags\n            // var attrs: Record<string, string> = {};\n            // var attMatch;\n            // attMatch = kAttributePattern.exec(match[3]);\n            // while (attMatch) {\n            //     attrs[attMatch[1]] = attMatch[3] || attMatch[4] || attMatch[5];\n            //     attMatch = kAttributePattern.exec(match[3]);\n            // }\n            // console.log(attrs);\n            if (!match[4] && tagsClosedByOpening[currentElement.tag]) {\n                if (tagsClosedByOpening[currentElement.tag][match[2]]) {\n                    stack.pop();\n                    currentElement = back(stack);\n                }\n            }\n            const child = createElement(match[2], match[3], options.stylesheet);\n            stack.push(child);\n            currentElement.appendChild(child);\n            currentElement = child;\n            // if (kBlockTextElements[match[2]]) {\n            //   // a little test to find next </script> or </style> ...\n            //   var closeMarkup = '</' + match[2] + '>';\n            //   var index = data.indexOf(closeMarkup, kMarkupPattern.lastIndex);\n            //   if (options[match[2]]) {\n            //     if (index == -1) {\n            //       // there is no matching ending for the text element.\n            //       text = data.substr(kMarkupPattern.lastIndex);\n            //     } else {\n            //       text = data.substring(kMarkupPattern.lastIndex, index);\n            //     }\n            //     if (text.length > 0)\n            //       currentParent.appendChild(new TextNode(text));\n            //   }\n            //   if (index == -1) {\n            //     lastTextPos = kMarkupPattern.lastIndex = data.length + 1;\n            //   } else {\n            //     lastTextPos = kMarkupPattern.lastIndex = index + closeMarkup.length;\n            //     match[1] = true;\n            //   }\n            // }\n        }\n        if (match[1] || match[4] || selfClosingTags[match[2]]) {\n            // </ or /> or <br> etc.\n            while (true) {\n                if (currentElement.tag == match[2]) {\n                    stack.pop();\n                    currentElement = back(stack);\n                    break;\n                }\n                else {\n                    // Trying to close current tag, and move on\n                    if (tagsClosedByClosing[currentElement.tag]) {\n                        if (tagsClosedByClosing[currentElement.tag][match[2]]) {\n                            stack.pop();\n                            currentElement = back(stack);\n                            continue;\n                        }\n                    }\n                    // Use aggressive strategy to handle unmatching markups.\n                    break;\n                }\n            }\n        }\n        match = RE.exec(data);\n    }\n    // in case you forget closing tag on something like : \"<div>text\"\n    if (lastTextPos > -1) {\n        if (lastTextPos < data.length) {\n            // if has content\n            text = data.substring(lastTextPos);\n            currentElement.text(text); //.appendNode(new TextNode(text));\n        }\n    }\n    const e = root.children[0]; // real root\n    e.parent = null;\n    return e;\n}\n// let t = parse('<div name=\"test\" checked id=A>Test</div>');\n// console.log(t);\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('input', {\n    fg: 'black',\n    bg: 'gray',\n});\nexport class Input extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.prop('tabindex', true);\n        this.prop('value', '');\n    }\n    // reset() {\n    //     this.prop('value', this._attrString('value'));\n    // }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        super._setAttr(name, value);\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n        super._setProp('valid', this.isValid());\n    }\n    _setProp(name, value) {\n        if (name === 'value') {\n            value = '' + value;\n            const maxLength = this._attrInt('maxLength', 0);\n            if (maxLength && value.length > maxLength) {\n                value = value.substring(0, maxLength);\n            }\n            super._setProp('empty', value.length == 0);\n            this._props.value = value;\n            this.dirty = true;\n        }\n        else {\n            super._setProp(name, value);\n        }\n        super._setProp('valid', this.isValid());\n    }\n    get isTypeNumber() {\n        return this._attrs.type === 'number';\n    }\n    // PROPERTIES\n    // CONTENT\n    _calcContentWidth() {\n        const size = this._attrs.size || '';\n        if (size.length)\n            return Number.parseInt(size);\n        return 10; // default somewhere else?\n    }\n    _calcContentHeight() {\n        return 1;\n    }\n    _updateContentHeight() { }\n    isValid() {\n        const v = this._propString('value');\n        if (this.isTypeNumber) {\n            const val = this._propInt('value');\n            const min = this._attrInt('min', Number.MIN_SAFE_INTEGER);\n            if (val < min)\n                return false;\n            const max = this._attrInt('max', Number.MAX_SAFE_INTEGER);\n            if (val > max)\n                return false;\n            return v.length > 0;\n        }\n        const requiredLen = this._propInt('required', 0);\n        // console.log(\n        //     'required',\n        //     this._attrs.required,\n        //     requiredLen,\n        //     v,\n        //     v.length,\n        //     this._attrInt('minLength', requiredLen)\n        // );\n        return (v.length >= this._attrInt('minLength', requiredLen) &&\n            v.length <= this._attrInt('maxLength', Number.MAX_SAFE_INTEGER));\n    }\n    // DRAWING\n    _drawText(buffer) {\n        const fg = this.used('fg') || 'white';\n        const top = this.innerTop;\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = this.used('align');\n        let v = this._propString('value');\n        if (v.length == 0) {\n            v = this._attrString('placeholder');\n        }\n        buffer.drawText(left, top, v, fg, -1, width, align);\n    }\n    // EVENTS\n    onblur(doc) {\n        super.onblur(doc);\n        if (this.val() !== this.attr('value')) {\n            doc._fireEvent(this, 'change');\n        }\n    }\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter') {\n            document.nextTabStop();\n            return true;\n        }\n        if (e.key === 'Escape') {\n            this._setProp('value', '');\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key === 'Backspace' || e.key === 'Delete') {\n            const v = this._propString('value');\n            this._setProp('value', v.substring(0, v.length - 1));\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key.length > 1) {\n            return false;\n        }\n        const textEntryBounds = this.isTypeNumber ? ['0', '9'] : [' ', '~'];\n        // eat/use all other keys\n        if (e.key >= textEntryBounds[0] && e.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            const v = this._propString('value');\n            this._setProp('value', v + e.key);\n            document._fireEvent(this, 'input', e);\n        }\n        return true;\n    }\n}\nParser.installElement('input', (tag, sheet) => {\n    return new Input(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport * as Element from './element';\nimport * as Parser from './parser';\nexport class CheckBox extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.on('click', this.click.bind(this));\n        this.prop('tabindex', true);\n        this.prop('checked', false);\n        Object.entries(CheckBox.default).forEach(([key, value]) => this.attr(key, value));\n    }\n    // reset() {\n    //     this.prop('value', this._attrString('value'));\n    // }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n    }\n    // PROPERTIES\n    // CONTENT\n    _calcContentWidth() {\n        return 2 + super._calcContentWidth();\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth - 2);\n        return Math.max(1, this._lines.length);\n    }\n    // DRAWING\n    _drawText(buffer) {\n        const fg = this.used('fg') || 'white';\n        const top = this.innerTop;\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = this.used('align');\n        const state = this.prop('checked') ? 'check' : 'uncheck';\n        let v = this._attrs[state];\n        buffer.drawText(left, top, v, fg, -1);\n        this._lines.forEach((line, i) => {\n            buffer.drawText(left + 2, top + i, line, fg, -1, width - 2, align);\n        });\n    }\n    // EVENTS\n    onblur(doc) {\n        super.onblur(doc);\n        doc._fireEvent(this, 'change');\n    }\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter' || e.key === ' ') {\n            this.toggleProp('checked');\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        if (e.key === 'Backspace' || e.key === 'Delete') {\n            this.prop('checked', false);\n            document._fireEvent(this, 'input', e);\n            return true;\n        }\n        return false;\n    }\n    click(document, _element, e) {\n        if (!e)\n            return false;\n        if (!this.contains(e))\n            return false;\n        this.toggleProp('checked');\n        document.setActiveElement(this);\n        document._fireEvent(this, 'input', e);\n        return true;\n    }\n}\nCheckBox.default = {\n    uncheck: '\\u2610',\n    check: '\\u2612',\n    padCheck: '1',\n    value: 'on',\n};\nParser.installElement('checkbox', (tag, sheet) => {\n    return new CheckBox(tag, sheet);\n});\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('button', {\n    fg: 'black',\n    bg: 'gray',\n});\nexport class Button extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this.on('keypress', this.keypress.bind(this));\n        this.on('click', this.click.bind(this));\n        this.prop('tabindex', true);\n        Object.entries(Button.default).forEach(([key, value]) => {\n            if (typeof value === 'boolean') {\n                this.prop(key, value);\n            }\n            else {\n                this.attr(key, value);\n            }\n        });\n    }\n    // ATTRIBUTES\n    _setAttr(name, value) {\n        this._attrs[name] = value;\n        if (name === 'value') {\n            this._setProp('value', value);\n        }\n    }\n    // PROPERTIES\n    // CONTENT\n    // DRAWING\n    // EVENTS\n    keypress(document, _element, e) {\n        if (!e)\n            return false;\n        if (e.key === 'Enter' || e.key === ' ') {\n            document._fireEvent(this, 'click', e);\n            return true;\n        }\n        return false;\n    }\n    click(document, _element, e) {\n        if (!e)\n            return false;\n        if (!this.contains(e))\n            return false;\n        if (this.prop('clickfocus')) {\n            document.setActiveElement(this);\n        }\n        return true;\n    }\n}\nButton.default = {\n    clickfocus: false,\n};\nParser.installElement('button', (tag, sheet) => {\n    return new Button(tag, sheet);\n});\n","import * as Style from './style';\nimport * as Element from './element';\nimport * as Parser from './parser';\nStyle.defaultStyle.add('fieldset', {\n    margin: 1,\n    border: 'dark_gray',\n    fg: 'white',\n    bg: -1,\n    padding: 1,\n});\nexport class FieldSet extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        Object.entries(FieldSet.default).forEach(([key, value]) => {\n            if (typeof value === 'boolean') {\n                this.prop(key, value);\n            }\n            else if (value !== undefined) {\n                this.attr(key, '' + value);\n            }\n        });\n    }\n    // ATTRIBUTES\n    // PROPERTIES\n    // CONTENT\n    // DRAWING\n    _drawBorder(buffer) {\n        super._drawBorder(buffer);\n        const legend = this.attr('legend');\n        if (!legend || legend.length == 0)\n            return;\n        const used = this._usedStyle;\n        const fg = used.fg || 'white';\n        const top = this.innerTop - (used.padTop || 0) - 1; // -1 for border\n        const width = this.innerWidth;\n        const left = this.innerLeft;\n        const align = used.align;\n        buffer.drawText(left, top, legend, fg, -1, width, align);\n    }\n}\nFieldSet.default = {};\nParser.installElement('fieldset', (tag, sheet) => {\n    return new FieldSet(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport * as Element from './element';\nimport * as Parser from './parser';\n// import { Document } from './document';\n// Style.defaultStyle.add('button', {\n//     fg: 'black',\n//     bg: 'gray',\n// });\nexport class UnorderedList extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n    }\n    // CONTENT\n    get indentWidth() {\n        return 2;\n    }\n    _calcContentWidth() {\n        return this.indentWidth + super._calcContentWidth();\n    }\n    _calcContentHeight() {\n        this._lines = GWU.text.splitIntoLines(this._text, this.innerWidth - this.indentWidth);\n        return Math.max(1, this._lines.length);\n    }\n    get innerLeft() {\n        return super.innerLeft + this.indentWidth;\n    }\n    get innerWidth() {\n        return Math.max(0, super.innerWidth - this.indentWidth);\n    }\n    // DRAWING\n    _drawBullet(buffer, _index, left, top, fg) {\n        const b = this._attrs.bullet || UnorderedList.default.bullet;\n        buffer.drawText(left, top, b, fg, -1);\n    }\n    _drawChildren(buffer) {\n        this.children.forEach((c, i) => {\n            const fg = c.used('fg') || 'white';\n            const top = c.bounds.top + (c.used('marginTop') || 0);\n            const left = c.bounds.left - this.indentWidth;\n            this._drawBullet(buffer, i, left, top, fg);\n            c.draw(buffer);\n        });\n    }\n}\nUnorderedList.default = {\n    bullet: '\\u2022', // bullet\n};\nParser.installElement('ul', (tag, sheet) => {\n    return new UnorderedList(tag, sheet);\n});\nexport class OrderedList extends UnorderedList {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n    }\n    get indentWidth() {\n        return this.children.length >= 10 ? 4 : 3;\n    }\n    _drawBullet(buffer, index, left, top, fg) {\n        const b = ('' + (index + 1) + '. ').padStart(this.indentWidth, ' ');\n        buffer.drawText(left, top, b, fg, -1);\n    }\n}\nParser.installElement('ol', (tag, sheet) => {\n    return new OrderedList(tag, sheet);\n});\n","import * as Element from './element';\nimport * as Parser from './parser';\nexport class DataList extends Element.Element {\n    constructor(tag, sheet) {\n        super(tag, sheet);\n        this._data = [];\n    }\n    // CONTENT\n    _setData(doc, v) {\n        if (!Array.isArray(v)) {\n            throw new Error('<datalist> only uses Array values for data field.');\n        }\n        super._setData(doc, v);\n        this.dirty = true;\n        if (this.children.length) {\n            const oldChildren = doc.select(this.children.filter((c) => c.tag === 'data'));\n            oldChildren.detach();\n        }\n        if (!this._data)\n            return;\n        this._data.forEach((item) => {\n            doc.create('<data>').text(item).appendTo(this);\n        });\n    }\n    get indentWidth() {\n        return 0;\n        // const prefix = this.attr('prefix') || DataList.default.prefix;\n        // if (!prefix) return 0;\n        // if (prefix.includes('#')) {\n        //     return prefix.length - 1 + this._data.length >= 10 ? 2 : 1;\n        // }\n        // return prefix.length;\n    }\n    _calcContentWidth() {\n        return DataList.default.width; // no legend or data, so use default\n    }\n    _calcContentHeight() {\n        return 1; // no legend or data so just an empty cell\n    }\n    _calcChildHeight() {\n        if (!this._data || this._data.length === 0) {\n            return super._calcChildHeight() + 1; // legend (if present) + empty cell\n        }\n        return super._calcChildHeight();\n    }\n    get innerLeft() {\n        return super.innerLeft + this.indentWidth;\n    }\n    get innerWidth() {\n        return Math.max(0, super.innerWidth - this.indentWidth);\n    }\n    // DRAWING\n    _drawContent(buffer) {\n        // draw legend and data (if any)\n        this._drawChildren(buffer);\n        if (!this._data || this._data.length == 0) {\n            // empty cell is necessary\n            const fg = this.used('fg') || 'white';\n            const top = this.innerBottom - 1;\n            const left = this.innerLeft + this.indentWidth;\n            const width = this.innerWidth - this.indentWidth;\n            const align = this.used('align');\n            const empty = this.attr('empty') || DataList.default.empty;\n            buffer.drawText(left, top, empty, fg, -1, width, align);\n        }\n    }\n    // CHILDREN\n    _isValidChild(child) {\n        return ['data', 'legend'].includes(child.tag);\n    }\n}\nDataList.default = {\n    bullet: '\\u2022',\n    empty: '-',\n    prefix: 'none',\n    width: 10,\n};\nParser.installElement('datalist', (tag, sheet) => {\n    return new DataList(tag, sheet);\n});\n","import * as GWU from 'gw-utils';\nimport { Selector } from './selector';\nimport * as Style from './style';\nimport { Element } from './element';\nimport { parse } from './parser';\nStyle.defaultStyle.add('body', {\n    bg: 'black',\n});\nexport class Document {\n    constructor(ui, rootTag = 'body') {\n        this._activeElement = null;\n        this._done = false;\n        this.ui = ui;\n        this.stylesheet = new Style.Sheet();\n        this.body = new Element(rootTag);\n        this.body.style({\n            width: ui.buffer.width,\n            maxWidth: ui.buffer.width,\n            height: ui.buffer.height,\n            maxHeight: ui.buffer.height,\n            position: 'fixed',\n            top: 0,\n            left: 0,\n        });\n        this.body._attached = true; // attached as the root of the layer\n        this.children = [this.body];\n    }\n    $(id) {\n        return this.select(id);\n    }\n    select(id) {\n        let selected;\n        if (id === undefined) {\n            selected = [this.body];\n        }\n        else if (id instanceof Selection) {\n            return id;\n        }\n        else if (typeof id === 'string') {\n            if (id.startsWith('<')) {\n                selected = [this.createElement(id)];\n            }\n            else {\n                if (id === 'document') {\n                    selected = [this.body]; // convenience\n                }\n                else {\n                    const s = new Selector(id);\n                    selected = this.children.filter((w) => s.matches(w));\n                }\n            }\n        }\n        else if (Array.isArray(id)) {\n            selected = id;\n        }\n        else {\n            selected = [id];\n        }\n        return new Selection(this, selected);\n    }\n    createElement(tag) {\n        return parse(tag, this.stylesheet);\n    }\n    create(tag) {\n        return this.select(this.createElement(tag));\n    }\n    rule(rule, style) {\n        if (typeof rule === 'string') {\n            if (style) {\n                this.stylesheet.add(rule, style);\n                return this;\n            }\n            let out = this.stylesheet.get(rule);\n            if (out)\n                return out;\n            return this.stylesheet.add(rule, {});\n        }\n        Object.entries(rule).forEach(([name, value]) => {\n            this.stylesheet.add(name, value);\n        });\n        return this;\n    }\n    removeRule(rule) {\n        this.stylesheet.remove(rule);\n        return this;\n    }\n    _attach(w) {\n        if (Array.isArray(w)) {\n            w.forEach((x) => this._attach(x));\n            return this;\n        }\n        if (this.children.includes(w))\n            return this;\n        this.children.push(w);\n        w._attached = true;\n        w.children.forEach((c) => this._attach(c));\n        return this;\n    }\n    _detach(w) {\n        if (Array.isArray(w)) {\n            w.forEach((x) => this._detach(x));\n            return this;\n        }\n        if (w === this.body)\n            throw new Error('Cannot detach root widget.');\n        GWU.arrayDelete(this.children, w);\n        w._attached = false;\n        w.children.forEach((c) => this._detach(c));\n        return this;\n    }\n    computeStyles() {\n        let anyChanged = false;\n        this.children.forEach((w) => {\n            if (w.used().dirty || this.stylesheet.dirty) {\n                w.used(this.stylesheet.computeFor(w));\n                anyChanged = true;\n            }\n        });\n        this.stylesheet.dirty = false;\n        return anyChanged;\n    }\n    updateLayout(widget) {\n        widget = widget || this.body;\n        widget.updateLayout();\n    }\n    draw(buffer) {\n        if (this._prepareDraw()) {\n            buffer = buffer || this.ui.buffer;\n            this.body.draw(buffer);\n            buffer.render();\n            // console.log('draw');\n        }\n    }\n    _prepareDraw() {\n        if (!this.computeStyles() && !this.children.some((c) => c.dirty))\n            return false;\n        this.updateLayout();\n        return true;\n    }\n    // activeElement\n    get activeElement() {\n        return this._activeElement;\n    }\n    setActiveElement(w, reverse = false) {\n        if (w === this._activeElement)\n            return true;\n        const opts = {\n            target: w,\n            dir: [reverse ? -1 : 1, 0],\n        };\n        if (this._activeElement &&\n            this._fireEvent(this._activeElement, 'blur', opts)) {\n            return false;\n        }\n        if (w && this._fireEvent(w, 'focus', opts))\n            return false;\n        if (this._activeElement)\n            this._activeElement.onblur(this);\n        this._activeElement = w;\n        if (this._activeElement)\n            this._activeElement.onfocus(this, reverse);\n        return true;\n    }\n    nextTabStop() {\n        if (!this._activeElement) {\n            this.setActiveElement(this.children.find((w) => !w.prop('disabled') && w.prop('tabindex')) || null);\n            return !!this._activeElement;\n        }\n        const next = GWU.arrayNext(this.children, this._activeElement, (w) => !!w.prop('tabindex') && !w.prop('disabled'));\n        if (next) {\n            this.setActiveElement(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabStop() {\n        if (!this._activeElement) {\n            this.setActiveElement(this.children.find((w) => !w.prop('disabled') && w.prop('tabindex')) || null);\n            return !!this._activeElement;\n        }\n        const prev = GWU.arrayPrev(this.children, this._activeElement, (w) => !!w.prop('tabindex') && !w.prop('disabled'));\n        if (prev) {\n            this.setActiveElement(prev, true);\n            return true;\n        }\n        return false;\n    }\n    // events\n    // return topmost element under point\n    elementFromPoint(x, y) {\n        return this.body.elementFromPoint(x, y) || this.body;\n    }\n    _fireEvent(element, name, e) {\n        if (!e || !e.type) {\n            e = GWU.io.makeCustomEvent(name, e);\n        }\n        const handlers = element.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(this, element, e) || out, false);\n        return handled;\n    }\n    _bubbleEvent(element, name, e) {\n        let current = element;\n        while (current) {\n            const handlers = current.events[name] || [];\n            let handled = handlers.reduce((out, h) => h(this, current, e) || out, false);\n            if (handled)\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n    click(e) {\n        let element = this.elementFromPoint(e.x, e.y);\n        if (!element)\n            return false;\n        if (element.prop('disabled'))\n            return false;\n        if (this._bubbleEvent(element, 'click', e))\n            return this._done;\n        if (element.prop('tabindex')) {\n            this.setActiveElement(element);\n        }\n        return false;\n    }\n    mousemove(e) {\n        let element = this.elementFromPoint(e.x, e.y);\n        const hovered = [];\n        let current = element;\n        while (current) {\n            hovered.push(current);\n            current.prop('hover', true);\n            current = current.parent;\n        }\n        this.children.forEach((w) => {\n            if (hovered.includes(w))\n                return;\n            w.prop('hover', false);\n        });\n        if (element && this._bubbleEvent(element, 'mousemove', e))\n            return this._done;\n        return false;\n    }\n    // dir\n    dir(e) {\n        const element = this.activeElement || this.body;\n        if (element && this._bubbleEvent(element, 'dir', e))\n            return this._done;\n        return false;\n    }\n    // keypress\n    keypress(e) {\n        const element = this.activeElement || this.body;\n        if (element) {\n            if (this._bubbleEvent(element, e.key, e))\n                return this._done;\n            if (this._bubbleEvent(element, e.code, e))\n                return this._done;\n            if (this._bubbleEvent(element, 'keypress', e))\n                return this._done;\n        }\n        if (e.key === 'Tab') {\n            this.nextTabStop();\n        }\n        else if (e.key === 'TAB') {\n            this.prevTabStop();\n        }\n        return false;\n    }\n}\n///////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////\n// TODO - look at cheerio\nexport class Selection {\n    constructor(document, widgets = []) {\n        this.document = document;\n        this.selected = widgets.slice();\n    }\n    get(index) {\n        if (index === undefined)\n            return this.selected;\n        if (index < 0)\n            return this.selected[this.selected.length + index];\n        return this.selected[index];\n    }\n    length() {\n        return this.selected.length;\n    }\n    slice(start, end) {\n        return new Selection(this.document, this.selected.slice(start, end));\n    }\n    add(arg) {\n        if (!(arg instanceof Selection)) {\n            arg = this.document.$(arg);\n        }\n        arg.forEach((w) => {\n            if (!this.selected.includes(w)) {\n                this.selected.push(w);\n            }\n        });\n        return this;\n    }\n    clone() {\n        this.selected = this.selected.map((w) => w.clone());\n        return this;\n    }\n    // async ???\n    forEach(cb) {\n        this.selected.forEach(cb);\n        return this;\n    }\n    // HIERARCHY\n    after(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach();\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((next, i) => {\n            if (!next.parent)\n                throw new Error('Cannot add after detached widgets.');\n            current =\n                i < last ? content.clone() : content;\n            const parent = next.parent;\n            let nextIndex = parent.children.indexOf(next) + 1;\n            current.forEach((toAdd) => {\n                parent.appendChild(toAdd, nextIndex);\n                if (parent._attached) {\n                    this.document._attach(toAdd);\n                }\n            });\n        });\n        return this;\n    }\n    append(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach(); // remove all items to be appended from the tree\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((dest, i) => {\n            current =\n                i < last ? content.clone() : content;\n            current.forEach((toAppend) => {\n                dest.appendChild(toAppend);\n                if (dest._attached) {\n                    this.document._attach(toAppend);\n                }\n            });\n        });\n        return this;\n    }\n    appendTo(dest) {\n        if (!(dest instanceof Selection)) {\n            dest = this.document.$(dest);\n        }\n        dest.append(this);\n        return this;\n    }\n    before(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach();\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((next, i) => {\n            if (!next.parent)\n                throw new Error('Cannot add before detached widgets.');\n            current =\n                i < last ? content.clone() : content;\n            const parent = next.parent;\n            let nextIndex = parent.children.indexOf(next);\n            current.forEach((toAdd) => {\n                parent.appendChild(toAdd, nextIndex++);\n                if (parent._attached) {\n                    this.document._attach(toAdd);\n                }\n            });\n        });\n        return this;\n    }\n    detach() {\n        this.selected.forEach((w) => {\n            if (w._attached) {\n                if (!w.parent)\n                    throw new Error('Cannot detach root widget.');\n                w.parent.removeChild(w);\n                // remove from document.children\n                this.document._detach(w);\n            }\n        });\n        return this;\n    }\n    empty() {\n        this.selected.forEach((w) => {\n            const oldChildren = w.empty();\n            this.document._detach(oldChildren);\n        });\n        return this;\n    }\n    insertAfter(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.after(this);\n        return this;\n    }\n    insertBefore(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.before(this);\n        return this;\n    }\n    prepend(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        if (content.length() == 0)\n            return this;\n        content.detach(); // remove all items to be prepended from the tree\n        let current = content;\n        const last = this.selected.length - 1;\n        this.selected.forEach((dest, i) => {\n            current =\n                i < last ? content.clone() : content;\n            current.forEach((toAppend) => {\n                dest.appendChild(toAppend, 0); // before first child\n                if (dest._attached) {\n                    this.document._attach(toAppend);\n                }\n            });\n        });\n        return this;\n    }\n    prependTo(dest) {\n        if (!(dest instanceof Selection)) {\n            dest = this.document.$(dest);\n        }\n        dest.prepend(this);\n        return this;\n    }\n    remove(_sub) {\n        // TODO - subselector\n        // TODO - remove events\n        return this.detach();\n    }\n    replaceAll(target) {\n        if (!(target instanceof Selection)) {\n            target = this.document.$(target);\n        }\n        target.before(this);\n        target.detach();\n        return this;\n    }\n    replaceWith(content) {\n        if (!(content instanceof Selection)) {\n            content = this.document.$(content);\n        }\n        content.replaceAll(this);\n        return this;\n    }\n    text(t) {\n        if (!t) {\n            return this.selected.length ? this.selected[0].text() : '';\n        }\n        this.selected.forEach((w) => w.text(t));\n        return this;\n    }\n    data(d) {\n        if (d === undefined) {\n            if (!this.selected.length)\n                return undefined;\n            return this.selected[0].data();\n        }\n        this.selected.forEach((e) => e.data(this.document, d));\n        return this;\n    }\n    attr(id, value) {\n        if (value === undefined) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].attr(id);\n        }\n        this.selected.forEach((e) => e.attr(id, value));\n        return this;\n    }\n    prop(id, value) {\n        if (value === undefined) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].prop(id);\n        }\n        this.selected.forEach((e) => e.prop(id, value));\n        return this;\n    }\n    // STYLE\n    addClass(id) {\n        this.selected.forEach((w) => w.addClass(id));\n        return this;\n    }\n    hasClass(id) {\n        if (this.selected.length == 0)\n            return false;\n        return this.selected[0].classes.includes(id);\n    }\n    removeClass(id) {\n        this.selected.forEach((w) => w.removeClass(id));\n        return this;\n    }\n    toggleClass(id) {\n        this.selected.forEach((w) => w.toggleClass(id));\n        return this;\n    }\n    style(name, value) {\n        if (!name)\n            return this.selected[0].style();\n        if (value === undefined) {\n            if (typeof name === 'string') {\n                return this.selected[0].style(name);\n            }\n        }\n        this.selected.forEach((w) => {\n            if (typeof name === 'string') {\n                w.style(name, value);\n            }\n            else {\n                w.style(name);\n            }\n        });\n        return this;\n    }\n    removeStyle(name) {\n        this.selected.forEach((w) => w.removeStyle(name));\n        return this;\n    }\n    pos(...args) {\n        if (args.length == 0) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].pos();\n        }\n        this.selected.forEach((w) => w.pos(args[0], args[1], args[2]));\n        return this;\n    }\n    size(...args) {\n        if (args.length == 0) {\n            if (this.selected.length == 0)\n                return undefined;\n            return this.selected[0].size();\n        }\n        this.selected.forEach((w) => w.size(args[0], args[1]));\n        return this;\n    }\n    // ANIMATION\n    animate(_props, _ms) {\n        return this;\n    }\n    clearQueue(_name) {\n        return this;\n    }\n    delay(_ms, _name) {\n        return this;\n    }\n    dequeue() {\n        return this;\n    }\n    fadeIn(_ms) {\n        return this;\n    }\n    fadeOut(_ms) {\n        return this;\n    }\n    fadeTo(_ms, _opacity) {\n        return this;\n    }\n    fadeToggle(_ms) {\n        return this;\n    }\n    finish(_name) {\n        return this;\n    }\n    hide(_ms) {\n        return this;\n    }\n    queue(..._args) {\n        return [];\n    }\n    show(_ms) {\n        return this;\n    }\n    slideDown(_ms) {\n        return this;\n    }\n    slideToggle(_ms) {\n        return this;\n    }\n    slideUp(_ms) {\n        return this;\n    }\n    stop() {\n        return this;\n    }\n    toggle(_arg) {\n        return this;\n    }\n    // EVENTS\n    on(event, cb) {\n        this.selected.forEach((w) => {\n            w.on(event, cb);\n        });\n        return this;\n    }\n    off(event, cb) {\n        this.selected.forEach((w) => {\n            w.off(event, cb);\n        });\n        return this;\n    }\n    fire(event, e) {\n        if (!e) {\n            e = GWU.io.makeCustomEvent(event);\n        }\n        this.selected.forEach((w) => {\n            const handlers = w.events[event];\n            if (handlers) {\n                handlers.forEach((cb) => cb(this.document, w, e));\n            }\n        });\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nexport class Text {\n    constructor(opts) {\n        this.x = -1;\n        this.y = -1;\n        this.width = -1;\n        this.height = 1;\n        this.text = '';\n        this.normal = { fg: Text.default.fg };\n        this.state = 'normal';\n        this._lines = [];\n        Object.assign(this, opts);\n        this._lines = GWU.text.splitIntoLines(this.text, this.width > 0 ? this.width : 100);\n        if (this.width <= 0) {\n            this.width = this._lines.reduce((out, line) => Math.max(out, line.length), 0);\n        }\n        if (opts.height) {\n            if (this._lines.length > opts.height) {\n                this._lines.length = opts.height;\n            }\n        }\n        else {\n            this.height = this._lines.length;\n        }\n        this.activeStyle = this.normal;\n    }\n    contains(e) {\n        return (this.x <= e.x &&\n            this.y <= e.y &&\n            this.x + this.width > e.x &&\n            this.y + this.height > e.y);\n    }\n    setState(state) {\n        this.state = state;\n        this.activeStyle = this[state] || this.normal;\n    }\n    fg() {\n        return this.activeStyle.fg || this.normal.fg || Text.default.fg;\n    }\n    bg() {\n        return this.activeStyle.bg || this.normal.bg || Text.default.bg;\n    }\n    align() {\n        return (this.activeStyle.align || this.normal.align || Text.default.align);\n    }\n    valign() {\n        return (this.activeStyle.valign || this.normal.valign || Text.default.valign);\n    }\n    draw(buffer) {\n        buffer.fillRect(this.x, this.y, this.width, this.height, ' ', this.bg(), this.bg());\n        this._lines.forEach((line, i) => {\n            buffer.drawText(this.x, this.y + i, line, this.fg(), -1, this.width, this.align());\n        });\n    }\n}\nText.default = {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n};\n","import * as GWU from 'gw-utils';\nexport class Grid {\n    constructor(x, y) {\n        this._left = 0;\n        this._top = 0;\n        this._colWidths = [];\n        this._rowHeights = [];\n        this._col = 0;\n        this._row = -1;\n        this.x = 0;\n        this.y = 0;\n        this._left = x;\n        this._top = y;\n        this.x = x;\n        this.y = y;\n    }\n    cols(...args) {\n        if (args.length === 0)\n            return this._colWidths;\n        if (args.length == 2) {\n            args[0] = new Array(args[0]).fill(args[1]);\n        }\n        if (Array.isArray(args[0])) {\n            this._colWidths = args[0];\n        }\n        return this;\n    }\n    rows(...args) {\n        if (args.length === 0)\n            return this._rowHeights;\n        if (typeof args[0] === 'number') {\n            args[0] = new Array(args[0]).fill(args[1] || 1);\n        }\n        if (Array.isArray(args[0])) {\n            this._rowHeights = args[0];\n        }\n        return this;\n    }\n    col(n) {\n        if (n === undefined)\n            n = this._col;\n        this._col = GWU.clamp(n, 0, this._colWidths.length - 1);\n        return this._setX()._setY(); // move back to top of our current row\n    }\n    nextCol() {\n        return this.col(this._col + 1);\n    }\n    row(n) {\n        if (n === undefined)\n            n = this._row;\n        this._row = GWU.clamp(n, 0, this._rowHeights.length - 1);\n        return this._setY()._setX(); // move back to beginning of current column\n    }\n    nextRow() {\n        return this.row(this._row + 1).col(0);\n    }\n    _setX() {\n        this.x = this._left;\n        for (let i = 0; i < this._col; ++i) {\n            this.x += this._colWidths[i];\n        }\n        return this;\n    }\n    _setY() {\n        this.y = this._top;\n        for (let i = 0; i < this._row; ++i) {\n            this.y += this._rowHeights[i];\n        }\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Grid } from './grid';\nexport class Term {\n    constructor(ui) {\n        this.x = 0;\n        this.y = 0;\n        this._grid = null;\n        this.ui = ui;\n        this.default('white', 'black');\n    }\n    get buffer() {\n        return this.ui.buffer;\n    }\n    get width() {\n        return this.ui.width;\n    }\n    get height() {\n        return this.ui.height;\n    }\n    // COLOR\n    default(fg, bg) {\n        this._defaultFg = fg;\n        this._defaultBg = bg;\n        this._fg = GWU.color.make(fg);\n        this._bg = GWU.color.make(bg);\n        return this;\n    }\n    fg(v) {\n        this._fg.set(v);\n        return this;\n    }\n    bg(v) {\n        this._bg.set(v);\n        return this;\n    }\n    dim(pct = 25) {\n        this._fg.darken(pct);\n        return this;\n    }\n    bright(pct = 25) {\n        this._fg.lighten(pct);\n        return this;\n    }\n    inverse() {\n        [this._fg, this._bg] = [this._bg, this._fg];\n        return this;\n    }\n    reset() {\n        this._fg.set(this._defaultFg);\n        this._bg.set(this._defaultBg);\n        return this;\n    }\n    // POSITION\n    pos(x, y) {\n        this.x = GWU.clamp(x, 0, this.width);\n        this.y = GWU.clamp(y, 0, this.height);\n        return this;\n    }\n    moveTo(x, y) {\n        return this.pos(x, y);\n    }\n    move(dx, dy) {\n        this.x = GWU.clamp(this.x + dx, 0, this.width);\n        this.y = GWU.clamp(this.y + dy, 0, this.height);\n        return this;\n    }\n    up(n = 1) {\n        return this.move(0, -n);\n    }\n    down(n = 1) {\n        return this.move(0, n);\n    }\n    left(n = 1) {\n        return this.move(-n, 0);\n    }\n    right(n = 1) {\n        return this.move(n, 0);\n    }\n    nextLine(n = 1) {\n        return this.pos(0, this.y + n);\n    }\n    prevLine(n = 1) {\n        return this.pos(0, this.y - n);\n    }\n    // EDIT\n    // erase and move back to top left\n    clear(newDefaultBg) {\n        return this.erase(newDefaultBg).pos(0, 0);\n    }\n    // just erase screen\n    erase(newDefaultBg) {\n        // remove all widgets\n        if (newDefaultBg !== undefined) {\n            this._defaultBg = newDefaultBg;\n            this._bg.set(newDefaultBg);\n        }\n        this.buffer.fill(' ', this._bg, this._bg);\n        return this;\n    }\n    eraseBelow() {\n        // TODO - remove widgets below\n        this.buffer.fillRect(0, this.y + 1, this.width, this.height - this.y - 1, ' ', this._bg, this._bg);\n        return this;\n    }\n    eraseAbove() {\n        // TODO - remove widgets above\n        this.buffer.fillRect(0, 0, this.width, this.y - 1, ' ', this._bg, this._bg);\n        return this;\n    }\n    eraseLine(n) {\n        if (n === undefined) {\n            n = this.y;\n        }\n        if (n >= 0 && n < this.height) {\n            // TODO - remove widgets on line\n            this.buffer.fillRect(0, n, this.width, 1, ' ', this._bg, this._bg);\n        }\n        return this;\n    }\n    eraseLineAbove() {\n        return this.eraseLine(this.y - 1);\n    }\n    eraseLineBelow() {\n        return this.eraseLine(this.y + 1);\n    }\n    // GRID\n    // erases/clears current grid information\n    grid() {\n        this._grid = new Grid(this.x, this.y);\n        return this;\n    }\n    cols(...args) {\n        if (!this._grid)\n            return this;\n        this._grid.cols(args[0], args[1]);\n        return this;\n    }\n    rows(...args) {\n        if (!this._grid)\n            return this;\n        this._grid.rows(args[0], args[1]);\n        return this;\n    }\n    startRow(n) {\n        if (!this._grid)\n            return this;\n        if (n !== undefined) {\n            this._grid.row(n);\n        }\n        else {\n            this._grid.nextRow();\n        }\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    nextCol() {\n        if (!this._grid)\n            return this;\n        this._grid.nextCol();\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    endRow() {\n        return this;\n    }\n    // moves to specific column\n    col(n) {\n        if (!this._grid)\n            return this;\n        this._grid.col(n);\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    // moves to specific row\n    row(n) {\n        if (!this._grid)\n            return this;\n        this._grid.row(n);\n        this.pos(this._grid.x, this._grid.y);\n        return this;\n    }\n    // DRAW\n    text(text, width, align) {\n        this.x += this.buffer.drawText(this.x, this.y, text, this._fg, this._bg, width, align);\n        return this;\n    }\n    border(w, h, bg) {\n        const c = bg || this._fg;\n        const buf = this.buffer;\n        GWU.xy.forBorder(this.x, this.y, w, h, (x, y) => {\n            buf.draw(x, y, ' ', c, c);\n        });\n        return this;\n    }\n    // CONTROL\n    render() {\n        this.ui.render();\n        return this;\n    }\n}\n","import * as Table from './table';\nexport class List extends Table.Table {\n    constructor(id, opts) {\n        super(id, (() => {\n            // @ts-ignore\n            const tableOpts = opts;\n            tableOpts.columns = [opts];\n            tableOpts.headers = opts.header ? true : false;\n            tableOpts.hover = opts.hover === false ? 'none' : 'row';\n            return tableOpts;\n        })());\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Messages extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n    }\n    init(opts) {\n        opts.x = opts.x || 0;\n        opts.y = opts.y || 0;\n        super.init(opts);\n        if (!this.bounds.height)\n            throw new Error('Must provde a height for messages widget.');\n        this.cache = new GWU.message.MessageCache({\n            width: this.bounds.width,\n            length: opts.length || 40,\n            match: (_x, _y) => {\n                return true;\n            },\n        });\n    }\n    click(e, dialog) {\n        if (!this.contains(e))\n            return false;\n        return this.showArchive(dialog).then(() => true);\n    }\n    draw(buffer) {\n        const isOnTop = this.bounds.y < 10;\n        // black out the message area\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this.bg, this.bg);\n        this.cache.forEach((line, confirmed, i) => {\n            if (i >= this.bounds.height)\n                return;\n            const localY = isOnTop ? this.bounds.height - i - 1 : i;\n            const y = localY + this.bounds.y;\n            buffer.drawText(this.bounds.x, y, line, this.fg);\n            if (confirmed) {\n                buffer.mix(this.bg, 50, this.bounds.x, y, this.bounds.width, 1);\n            }\n        });\n        return true;\n    }\n    async showArchive(dialog) {\n        let reverse, fadePercent = 0;\n        let fastForward;\n        const ui = dialog.ui;\n        // Count the number of lines in the archive.\n        let totalMessageCount = this.cache.length;\n        if (totalMessageCount <= this.bounds.height)\n            return false;\n        const isOnTop = this.bounds.y < 10;\n        const dbuf = ui.startLayer();\n        const fg = GWU.color.from(this.fg);\n        totalMessageCount = Math.min(totalMessageCount, isOnTop ? dbuf.height - this.bounds.top : this.bounds.bottom);\n        // Pull-down/pull-up animation:\n        for (reverse = 0; reverse <= 1; reverse++) {\n            fastForward = false;\n            const dM = reverse ? -1 : 1;\n            const startM = reverse ? totalMessageCount : this.bounds.height;\n            const endM = reverse\n                ? this.bounds.height + dM + 1\n                : totalMessageCount + dM;\n            // console.log(\n            //     `setting up draw - startM=${startM}, endM=${endM}, dM=${dM}`\n            // );\n            for (let currentM = startM; currentM != endM; currentM += dM) {\n                const startY = isOnTop\n                    ? this.bounds.y + currentM - 1\n                    : this.bounds.bottom - currentM;\n                const endY = isOnTop ? this.bounds.y : this.bounds.bottom;\n                const dy = isOnTop ? -1 : 1;\n                ui.resetLayerBuffer();\n                // console.log(\n                //     `draw archive - count=${i}, startY=${startY}, endY=${endY}, dy=${dy}`\n                // );\n                dbuf.fillRect(this.bounds.x, Math.min(startY, endY), this.bounds.width, currentM, ' ', this.bg, this.bg);\n                this.cache.forEach((line, _confirmed, j) => {\n                    const y = startY + j * dy;\n                    if (isOnTop) {\n                        if (y < endY)\n                            return;\n                    }\n                    else if (y > endY)\n                        return;\n                    fadePercent = Math.floor((50 * j) / currentM);\n                    const fgColor = fg.clone().mix(this.bg, fadePercent);\n                    dbuf.drawText(this.bounds.x, y, line, fgColor, this.bg);\n                });\n                dbuf.render();\n                if (!fastForward) {\n                    if (await ui.loop.pause(reverse ? 15 : 45)) {\n                        fastForward = true;\n                        currentM = endM - 2 * dM; // skip to the end-1\n                    }\n                }\n            }\n            if (!reverse) {\n                const y = isOnTop ? 0 : dbuf.height - 1;\n                const x = this.bounds.x > 8\n                    ? this.bounds.x - 8 // to left of box\n                    : Math.min(this.bounds.x + this.bounds.width, // just to right of box\n                    dbuf.width - 8 // But definitely on the screen - overwrite some text if necessary\n                    );\n                dbuf.wrapText(x, y, 8, '--DONE--', this.bg, this.fg);\n                dbuf.render();\n                await ui.loop.waitForAck();\n            }\n        }\n        ui.finishLayer();\n        this.cache.confirmAll();\n        dialog.requestRedraw(); // everything is confirmed\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class UI {\n    constructor(opts = {}) {\n        this.layers = [];\n        this.freeBuffers = [];\n        this.inDialog = false;\n        if (!opts.canvas)\n            throw new Error('Need a canvas.');\n        this.canvas = opts.canvas;\n        this.buffer = opts.canvas.buffer;\n        this.loop = opts.loop || GWU.loop;\n    }\n    get width() {\n        return this.canvas.width;\n    }\n    get height() {\n        return this.canvas.height;\n    }\n    render() {\n        this.buffer.render();\n    }\n    get baseBuffer() {\n        return this.layers[this.layers.length - 1] || this.canvas.buffer;\n    }\n    get canvasBuffer() {\n        return this.canvas.buffer;\n    }\n    startLayer() {\n        this.inDialog = true;\n        const base = this.buffer || this.canvas.buffer;\n        this.layers.push(base);\n        this.buffer = this.freeBuffers.pop() || this.canvas.buffer.clone();\n        // UI_OVERLAY._data.forEach( (c) => c.opacity = 0 );\n        this.buffer.copy(base);\n        this.buffer.changed = false;\n        return this.buffer;\n    }\n    resetLayerBuffer() {\n        const base = this.baseBuffer;\n        this.buffer.copy(base);\n        this.buffer.changed = false; // So you have to draw something to make the canvas render...\n    }\n    finishLayer() {\n        if (!this.inDialog)\n            return;\n        if (this.buffer !== this.canvas.buffer) {\n            this.freeBuffers.push(this.buffer);\n        }\n        this.buffer = this.layers.pop() || this.canvas.buffer;\n        this.buffer.changed = true;\n        this.buffer.render();\n        this.inDialog = this.layers.length > 0;\n    }\n    // UTILITY FUNCTIONS\n    async fadeTo(color = 'black', duration = 1000) {\n        color = GWU.color.from(color);\n        const buffer = this.startLayer();\n        let pct = 0;\n        let elapsed = 0;\n        while (elapsed < duration) {\n            elapsed += 32;\n            if (await this.loop.pause(32)) {\n                elapsed = duration;\n            }\n            pct = Math.floor((100 * elapsed) / duration);\n            this.resetLayerBuffer();\n            buffer.mix(color, pct);\n            buffer.render();\n        }\n        this.finishLayer();\n    }\n    async alert(opts, text, args) {\n        if (typeof opts === 'number') {\n            opts = { duration: opts };\n        }\n        if (args) {\n            text = GWU.text.apply(text, args);\n        }\n        const width = opts.width || GWU.text.length(text);\n        opts.box = opts.box || { bg: opts.bg };\n        // opts.box.bg = opts.box.bg || 'gray';\n        const textOpts = {\n            fg: opts.fg,\n            text,\n            x: 0,\n            y: 0,\n            wrap: width,\n        };\n        const textWidget = new Widget.Text('TEXT', textOpts);\n        const height = textWidget.bounds.height;\n        const dlg = Widget.buildDialog(this, width, height)\n            .with(textWidget, { x: 0, y: 0 })\n            .addBox(opts.box)\n            .center()\n            .done();\n        dlg.setEventHandlers({\n            click: () => dlg.close(true),\n            keypress: () => dlg.close(true),\n            TIMEOUT: () => dlg.close(false),\n        });\n        if (!opts.waitForAck) {\n            dlg.setTimeout('TIMEOUT', opts.duration || 3000);\n        }\n        return await dlg.show();\n    }\n    async confirm(...args) {\n        let opts;\n        let text;\n        let textArgs = null;\n        if (args.length <= 2 && typeof args[0] === 'string') {\n            opts = {};\n            text = args[0];\n            textArgs = args[1] || null;\n        }\n        else {\n            opts = args[0];\n            text = args[1];\n            textArgs = args[2] || null;\n        }\n        if (textArgs) {\n            text = GWU.text.apply(text, textArgs);\n        }\n        const width = opts.width ||\n            Math.min(Math.floor(this.buffer.width / 2), GWU.text.length(text));\n        const textOpts = {\n            fg: opts.fg,\n            text,\n            wrap: width,\n        };\n        const textWidget = new Widget.Text('TEXT', textOpts);\n        const height = textWidget.bounds.height + 2;\n        opts.allowCancel = opts.allowCancel !== false;\n        opts.buttons = Object.assign({\n            fg: 'white',\n            activeFg: 'teal',\n            bg: 'dark_gray',\n            activeBg: 'darkest_gray',\n        }, opts.buttons || {});\n        if (typeof opts.ok === 'string') {\n            opts.ok = { text: opts.ok };\n        }\n        if (typeof opts.cancel === 'string') {\n            opts.cancel = { text: opts.cancel };\n        }\n        opts.ok = opts.ok || {};\n        opts.cancel = opts.cancel || {};\n        const okOpts = Object.assign({}, opts.buttons, { text: 'OK' }, opts.ok);\n        const cancelOpts = Object.assign({}, opts.buttons, { text: 'CANCEL' }, opts.cancel);\n        const builder = Widget.buildDialog(this, width, height)\n            .with(textWidget, { x: 0, y: 0 })\n            .with(new Widget.Button('OK', okOpts), { x: 0, bottom: 0 });\n        if (opts.allowCancel) {\n            builder.with(new Widget.Button('CANCEL', cancelOpts), {\n                right: 0,\n                bottom: 0,\n            });\n        }\n        const dlg = builder.center().addBox(opts.box).done();\n        dlg.setEventHandlers({\n            OK() {\n                dlg.close(true);\n            },\n            CANCEL() {\n                dlg.close(false);\n            },\n            Escape() {\n                dlg.close(false);\n            },\n            Enter() {\n                dlg.close(true);\n            },\n        });\n        return await dlg.show();\n    }\n    async showWidget(widget, keymap = {}) {\n        const center = widget.bounds.x < 0 || widget.bounds.y < 0;\n        const place = { x: widget.bounds.x, y: widget.bounds.y };\n        const builder = Widget.buildDialog(this).with(widget, { x: 0, y: 0 });\n        if (center) {\n            builder.center();\n        }\n        else {\n            builder.place(place.x, place.y);\n        }\n        const dlg = builder.done();\n        keymap.Escape =\n            keymap.Escape ||\n                (() => {\n                    dlg.close(false);\n                });\n        dlg.setEventHandlers(keymap);\n        return await dlg.show();\n    }\n    // assumes you are in a dialog and give the buffer for that dialog\n    async getInputAt(x, y, maxLength, opts = {}) {\n        opts.width = maxLength;\n        opts.x = x;\n        opts.y = y;\n        const widget = new Widget.Input('INPUT', opts);\n        return this.showWidget(widget, {\n            INPUT(_e, dlg) {\n                dlg.close(widget.text);\n            },\n            Escape(_e, dlg) {\n                dlg.close('');\n            },\n        });\n    }\n    async inputBox(opts, prompt, args) {\n        if (args) {\n            prompt = GWU.text.apply(prompt, args);\n        }\n        const width = opts.width ||\n            Math.min(Math.floor(this.buffer.width / 2), GWU.text.length(prompt));\n        const promptOpts = {\n            fg: opts.fg,\n            text: prompt,\n            wrap: width,\n        };\n        const promptWidget = new Widget.Text('TEXT', promptOpts);\n        const height = promptWidget.bounds.height +\n            2 + // skip + input\n            2; // skip + ok/cancel\n        opts.allowCancel = opts.allowCancel !== false;\n        opts.buttons = Object.assign({\n            fg: 'white',\n            activeFg: 'teal',\n            bg: 'dark_gray',\n            activeBg: 'darkest_gray',\n        }, opts.buttons || {});\n        if (typeof opts.ok === 'string') {\n            opts.ok = { text: opts.ok };\n        }\n        if (typeof opts.cancel === 'string') {\n            opts.cancel = { text: opts.cancel };\n        }\n        opts.ok = opts.ok || {};\n        opts.cancel = opts.cancel || {};\n        const okOpts = Object.assign({}, opts.buttons, { text: 'OK' }, opts.ok);\n        const cancelOpts = Object.assign({}, opts.buttons, { text: 'CANCEL' }, opts.cancel);\n        opts.input = opts.input || {};\n        opts.input.width = opts.input.width || width;\n        opts.input.bg = opts.input.bg || opts.fg;\n        opts.input.fg = opts.input.fg || opts.bg;\n        const inputWidget = new Widget.Input('INPUT', opts.input || {});\n        const builder = Widget.buildDialog(this, width, height)\n            .with(promptWidget, { x: 0, y: 0 })\n            .with(inputWidget, { bottom: 2, x: 0 })\n            .with(new Widget.Button('OK', okOpts), { bottom: 0, x: 0 })\n            .addBox(opts.box);\n        if (opts.allowCancel) {\n            builder.with(new Widget.Button('CANCEL', cancelOpts), {\n                bottom: 0,\n                right: 0,\n            });\n        }\n        const dlg = builder.center().done();\n        dlg.setEventHandlers({\n            OK() {\n                dlg.close(inputWidget.text);\n            },\n            CANCEL() {\n                dlg.close('');\n            },\n            Escape() {\n                dlg.close('');\n            },\n            INPUT() {\n                dlg.close(inputWidget.text);\n            },\n        });\n        return await dlg.show();\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nexport class Viewport extends Widget.Widget {\n    constructor(id, opts) {\n        super(id, opts);\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this._subject = null;\n    }\n    init(opts) {\n        opts.bg = opts.bg || 'black';\n        opts.x = opts.x || 0;\n        opts.y = opts.y || 0;\n        super.init(opts);\n        this.snap = opts.snap || false;\n        this.center = opts.center || false;\n        this.filter = opts.filter || null;\n        if (opts.lock) {\n            this.lockX = true;\n            this.lockY = true;\n        }\n        else {\n            if (opts.lockX) {\n                this.lockX = true;\n            }\n            if (opts.lockY) {\n                this.lockY = true;\n            }\n        }\n    }\n    get subject() {\n        return this._subject;\n    }\n    set subject(subject) {\n        this.center = !!subject;\n        if (subject) {\n            this.offsetX = subject.x - this.halfWidth();\n            this.offsetY = subject.y - this.halfHeight();\n        }\n        this._subject = subject;\n    }\n    set lock(v) {\n        this.lockX = v;\n        this.lockY = v;\n    }\n    toMapX(x) {\n        return x + this.offsetX - this.bounds.x;\n    }\n    toMapY(y) {\n        return y + this.offsetY - this.bounds.y;\n    }\n    toInnerX(x) {\n        return x - this.bounds.x;\n    }\n    toInnerY(y) {\n        return y - this.bounds.y;\n    }\n    halfWidth() {\n        return Math.floor(this.bounds.width / 2);\n    }\n    halfHeight() {\n        return Math.floor(this.bounds.height / 2);\n    }\n    centerOn(map, x, y) {\n        this.center = true;\n        this.subject = { x, y, map };\n    }\n    showMap(map, x = 0, y = 0) {\n        this.subject = { x, y, map };\n        this.offsetX = x;\n        this.offsetY = y;\n        this.center = false;\n        this.snap = false;\n    }\n    updateOffset() {\n        if (!this._subject) {\n            this.offsetX = 0;\n            this.offsetY = 0;\n            return;\n        }\n        const subject = this._subject;\n        const map = subject.memory || subject.map;\n        const bounds = map;\n        if (subject && map.hasXY(subject.x, subject.y)) {\n            if (this.snap) {\n                let left = this.offsetX;\n                let right = this.offsetX + this.bounds.width;\n                let top = this.offsetY;\n                let bottom = this.offsetY + this.bounds.height;\n                // auto center if outside the viewport\n                if (subject.x < left || subject.x > right) {\n                    left = this.offsetX = subject.x - this.halfWidth();\n                    right = left + this.bounds.width;\n                }\n                if (subject.y < top || subject.y > bottom) {\n                    top = this.offsetY = subject.y - this.halfHeight();\n                    bottom = top + this.bounds.height;\n                }\n                const edgeX = Math.floor(this.bounds.width / 5);\n                const edgeY = Math.floor(this.bounds.height / 5);\n                const thirdW = Math.floor(this.bounds.width / 3);\n                if (left + edgeX >= subject.x) {\n                    this.offsetX = Math.max(0, subject.x + thirdW - this.bounds.width);\n                }\n                else if (right - edgeX <= subject.x) {\n                    this.offsetX = Math.min(subject.x - thirdW, bounds.width - this.bounds.width);\n                }\n                const thirdH = Math.floor(this.bounds.height / 3);\n                if (top + edgeY >= subject.y) {\n                    this.offsetY = Math.max(0, subject.y + thirdH - this.bounds.height);\n                }\n                else if (bottom - edgeY <= subject.y) {\n                    this.offsetY = Math.min(subject.y - thirdH, bounds.height - this.bounds.height);\n                }\n            }\n            else if (this.center) {\n                this.offsetX = subject.x - this.halfWidth();\n                this.offsetY = subject.y - this.halfHeight();\n            }\n            else {\n                this.offsetX = subject.x;\n                this.offsetY = subject.y;\n            }\n        }\n        if (this.lockX && map) {\n            this.offsetX = GWU.clamp(this.offsetX, 0, map.width - this.bounds.width);\n        }\n        if (this.lockY && map) {\n            this.offsetY = GWU.clamp(this.offsetY, 0, map.height - this.bounds.height);\n        }\n    }\n    draw(buffer) {\n        buffer.blackOutRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this.bg);\n        if (!this._subject) {\n            return false;\n        }\n        this.updateOffset();\n        const map = this._subject.memory || this._subject.map;\n        const fov = this._subject.fov;\n        const mixer = new GWU.sprite.Mixer();\n        for (let x = 0; x < this.bounds.width; ++x) {\n            for (let y = 0; y < this.bounds.height; ++y) {\n                const mapX = x + this.offsetX;\n                const mapY = y + this.offsetY;\n                if (map.hasXY(mapX, mapY)) {\n                    const cell = map.cell(mapX, mapY);\n                    map.drawer.drawCell(mixer, cell, fov);\n                }\n                else {\n                    mixer.draw(' ', this.bg, this.bg); // blackOut\n                }\n                if (this.filter) {\n                    this.filter(mixer, mapX, mapY, map);\n                }\n                buffer.drawSprite(x + this.bounds.x, y + this.bounds.y, mixer);\n            }\n        }\n        // map.clearMapFlag(GWM.flags.Map.MAP_CHANGED);\n        return true;\n    }\n}\n"],"names":["Widget","constructor","id","opts","this","active","hovered","tabStop","depth","fg","bg","activeFg","activeBg","hoverFg","hoverBg","text","align","valign","bounds","GWU","xy","Bounds","init","reset","undefined","x","y","width","height","length","action","activate","_reverse","deactivate","contains","arguments","mousemove","e","_dialog","tick","_e","click","keypress","dir","draw","buffer","textLen","fillRect","Math","floor","drawText","Text","Widget.Widget","super","wrap","lines","splitIntoLines","truncate","max","setText","forEach","line","i","Button","Error","first","async","ev","dialog","fireAction","key","Input","minLength","default","errorFg","hint","hintFg","numbersOnly","min","Number","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","isValid","val","parseInt","value","textEntryBounds","r","then","spliceRaw","color","Column","header","empty","_value","IDENTITY","index","object","assignOmitting","compile","data","v","Table","selectedColumn","selectedIndex","columns","headers","letters","hoverType","hover","wrapColumns","wrapRows","headerFg","headerBg","columnWidth","push","_data","String","fromCharCode","c","col","setData","selectRow","Array","isArray","list","selectNextRow","len","nextIndex","selectPrevRow","prevIndex","selectNextColumn","selectPrevColumn","selectedData","at","b","drawColumn","column","item","drawCell","bottom","oldColumn","oldIndex","find","requestRedraw","Box","title","borderBg","Dialog","ui","widgets","eventHandlers","_activeWidget","result","done","timers","needsRedraw","sort","a","activeWidget","setActiveWidget","w","reverse","setTimeout","time","clearTimeout","widget","handler","setEventHandlers","map","Object","assign","startLayer","loop","run","bind","render","finishLayer","close","returnValue","widgetAt","getWidget","nextTabstop","next","arrayNext","prevTabstop","prev","arrayPrev","dt","promises","entries","Promise","all","fn","code","force","resetLayerBuffer","DialogBuilder","nextY","box","with","right","center","size","place","addBox","padX","pad","padY","Box.Box","unshift","buildDialog","install","EntryBase","dist","priority","changed","sidebarY","_buffer","_bounds","ActorEntry","actor","drawStatus","ItemEntry","CellEntry","cell","MenuButton","ActionButton","DropDownButton","menu","parent","buttons","addButton","config","button","setBounds","px","py","pw","totalWidth","totalHeight","buttonAt","dropBg","dropFg","showDropDown","activeButton","Escape","Tab","activeIndex","TAB","newActive","selected","getButtonAt","indexOf","clearHighlight","actionButton","current","findIndex","clamp","Selector","startsWith","matchFn","_parse","parts","split","p","trim","matches","_parentMatch","_ancestorMatch","_matchElement","reduce","out","TRUE","re","RegExp","match","exec","_matchTag","_matchId","_matchClass","_matchNot","_matchProp","every","tag","el","cls","classes","includes","prop","_matchFirst","_matchLast","attr","children","obj","Style","selector","_dirty","set","dirty","_fg","_bg","border","_border","_align","_valign","position","_position","minWidth","_minWidth","maxWidth","_maxWidth","_width","minHeight","_minHeight","maxHeight","_maxHeight","_height","_x","left","_left","_right","_y","top","_top","_bottom","padLeft","_padLeft","padRight","_padRight","padTop","_padTop","padBottom","_padBottom","marginLeft","_marginLeft","marginRight","_marginRight","marginTop","_marginTop","marginBottom","_marginBottom","get","setDirty","field","name","unset","clone","other","copy","makeStyle","style","base","baseParts","ComputedStyle","sources","s","some","Sheet","parentSheet","rules","defaultStyle","slice","add","props","rule","existing","remove","splice","computeFor","filter","widgetStyle","Element","styles","_props","_attrs","events","_text","_lines","_attached","_style","_usedStyle","Style.ComputedStyle","used","_setAttr","Style.makeStyle","_attrInt","def","_attrString","_attrBool","_setProp","toggleProp","doc","_setData","_doc","onblur","onfocus","_propInt","_propString","_propBool","_isValidChild","_child","appendChild","child","beforeIndex","removeChild","arrayDelete","old","root","positionedParent","isPositioned","innerLeft","innerRight","innerWidth","innerHeight","innerTop","innerBottom","updateLayout","_updateWidth","_updateHeight","_updateLeft","_updateTop","_calcContentWidth","contentHeight","_calcChildHeight","_calcContentHeight","_updateContentHeight","parentBottom","args","Style.Style","removeStyle","addClass","removeClass","toggleClass","pos","wantStyle","shift","_setText","_drawBorder","_fill","_drawContent","forBorder","_drawChildren","_drawText","on","event","cb","handlers","off","elementFromPoint","MARKUP_RE","ATTR_RE","selfClosingTags","meta","img","link","input","area","br","hr","tagsClosedByOpening","li","div","td","th","tagsClosedByClosing","ul","ol","tr","table","elements","configureElement","selfClosing","openCloses","tcbo","t","closeCloses","tcbc","installElement","createElement","rawAttr","stylesheet","Element.Element","back","arr","parse","options","Style.Sheet","currentElement","stack","lastTextPos","RE","lastIndex","substring","lowerCaseTagName","toLowerCase","pop","sheet","maxLength","isTypeNumber","type","requiredLen","_fireEvent","document","_element","nextTabStop","CheckBox","state","setActiveElement","uncheck","check","padCheck","clickfocus","margin","padding","FieldSet","legend","UnorderedList","indentWidth","_drawBullet","_index","bullet","OrderedList","padStart","DataList","select","detach","create","appendTo","prefix","Selection","start","end","arg","$","after","content","last","toAdd","_attach","append","dest","toAppend","before","_detach","oldChildren","insertAfter","target","insertBefore","prepend","prependTo","_sub","replaceAll","replaceWith","d","hasClass","animate","_ms","clearQueue","_name","delay","dequeue","fadeIn","fadeOut","fadeTo","_opacity","fadeToggle","finish","hide","queue","_args","show","slideDown","slideToggle","slideUp","stop","toggle","_arg","fire","io","makeCustomEvent","rootTag","_activeElement","_done","body","removeRule","computeStyles","anyChanged","_prepareDraw","activeElement","prevTabStop","element","h","_bubbleEvent","normal","activeStyle","setState","Grid","_colWidths","_rowHeights","_col","_row","cols","fill","rows","n","_setX","_setY","nextCol","row","nextRow","_grid","_defaultFg","_defaultBg","make","dim","pct","darken","bright","lighten","inverse","moveTo","move","dx","dy","up","down","nextLine","prevLine","clear","newDefaultBg","erase","eraseBelow","eraseAbove","eraseLine","eraseLineAbove","eraseLineBelow","grid","startRow","endRow","buf","Widget.Text","promptFg","from","overflow","isPrompt","showText","capitalize","showPrompt","getFlavorText","fov","isAnyKindOfVisible","isDirectlyVisible","isRemembered","isRevealed","isMapped","isMagicMapped","intro","hasActor","actorAt","theItem","hasItem","itemAt","standsInTile","hasTileFlag","GWM","flags","Tile","T_STAND_IN_TILE","needObjectArticle","getFlavor","article","groundTile","depthTile","Depth","GROUND","tile","tiles","NULL","surfaceTile","SURFACE","liquidTile","LIQUID","surface","T_BRIDGE","liquid","ground","apply","Table.Table","tableOpts","separator","lead","_addButton","onTop","arrayFindRight","dropdown","bgColor","cache","message","MessageCache","showArchive","isOnTop","confirmed","mix","fastForward","fadePercent","totalMessageCount","dbuf","dM","startM","endM","currentM","startY","endY","_confirmed","j","fgColor","pause","wrapText","waitForAck","confirmAll","cellCache","lastX","lastY","lastMap","subject","highlight","entryAt","entry","highlightRow","updateCellCache","hasMapFlag","Map","MAP_SIDEBAR_TILES_CHANGED","forRect","info","hasEntityFlag","Entity","L_LIST_IN_SIDEBAR","clearMapFlag","_makeActorEntry","_makeItemEntry","_makeCellEntry","_getPriority","hasCellFlag","Cell","STABLE_MEMORY","_isDim","_addActorEntry","distanceBetween","isPlayer","_addItemEntry","_addCellEntry","findEntries","cx","cy","alloc","eachActor","eachItem","free","update","updateFor","updateAt","memory","drawBounds","currentEntry","usedLines","layers","freeBuffers","inDialog","canvas","baseBuffer","canvasBuffer","duration","elapsed","textOpts","textWidget","dlg","Widget.buildDialog","TIMEOUT","textArgs","allowCancel","ok","cancel","okOpts","cancelOpts","builder","Widget.Button","OK","CANCEL","Enter","keymap","Widget.Input","showWidget","INPUT","prompt","promptOpts","promptWidget","inputWidget","offsetX","offsetY","_subject","snap","lock","lockX","lockY","halfWidth","halfHeight","toMapX","toMapY","toInnerX","toInnerY","centerOn","showMap","updateOffset","hasXY","edgeX","edgeY","thirdW","thirdH","blackOutRect","mixer","sprite","Mixer","mapX","mapY","drawer","drawSprite"],"mappings":"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"}