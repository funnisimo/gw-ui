{"version":3,"file":"gw-ui.min.js","sources":["../js/ui/grid.js","../js/ui/selector.js","../js/ui/style.js","../js/widget/widget.js","../js/widget/body.js","../js/ui/layer.js","../js/ui/alert.js","../js/widget/make.js","../js/widget/text.js","../js/widget/button.js","../js/ui/confirm.js","../js/ui/inputBox.js","../js/widget/border.js","../js/widget/dialog.js","../js/widget/fieldset.js","../js/widget/lists.js","../js/widget/input.js","../js/widget/datatable.js","../js/widget/datalist.js","../js/widget/menu.js","../js/widget/menubar.js","../js/widget/select.js","../js/widget/choice.js","../js/game/message.js","../js/game/flavor.js","../js/game/sidebar.js","../js/game/viewport.js","../js/ui/ui.js"],"sourcesContent":["import * as GWU from 'gw-utils';\nexport class Grid {\n    constructor(target) {\n        this._left = 0;\n        this._top = 0;\n        this._colWidths = [];\n        this._rowHeights = [];\n        this._col = 0;\n        this._row = -1;\n        this.target = target;\n        const pos = target.pos();\n        this._left = pos.x;\n        this._top = pos.y;\n    }\n    cols(...args) {\n        if (args.length === 0)\n            return this._colWidths;\n        if (args.length == 2) {\n            args[0] = new Array(args[0]).fill(args[1]);\n        }\n        if (Array.isArray(args[0])) {\n            this._colWidths = args[0];\n        }\n        return this;\n    }\n    rows(...args) {\n        if (args.length === 0)\n            return this._rowHeights;\n        if (typeof args[0] === 'number') {\n            args[0] = new Array(args[0]).fill(args[1] || 1);\n        }\n        if (Array.isArray(args[0])) {\n            this._rowHeights = args[0];\n        }\n        return this;\n    }\n    col(n) {\n        if (n === undefined)\n            n = this._col;\n        this._col = GWU.clamp(n, 0, this._colWidths.length - 1);\n        return this._setPos(); // move back to top of our current row\n    }\n    nextCol() {\n        return this.col(this._col + 1);\n    }\n    row(n) {\n        if (n === undefined)\n            n = this._row;\n        this._row = GWU.clamp(n, 0, this._rowHeights.length - 1);\n        return this._setPos(); // move back to beginning of current column\n    }\n    nextRow() {\n        return this.row(this._row + 1).col(0);\n    }\n    endRow(h) {\n        if (h <= 0)\n            return this;\n        this._rowHeights[this._row] = h;\n        return this;\n    }\n    _setPos() {\n        let x = this._left;\n        for (let i = 0; i < this._col; ++i) {\n            x += this._colWidths[i];\n        }\n        let y = this._top;\n        for (let i = 0; i < this._row; ++i) {\n            y += this._rowHeights[i];\n        }\n        this.target.pos(x, y);\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nexport class Selector {\n    constructor(text) {\n        this.priority = 0;\n        if (text.startsWith(':') || text.startsWith('.')) {\n            text = '*' + text;\n        }\n        this.text = text;\n        this.matchFn = this._parse(text);\n    }\n    _parse(text) {\n        const parts = text.split(/ +/g).map((p) => p.trim());\n        const matches = [];\n        for (let i = 0; i < parts.length; ++i) {\n            let p = parts[i];\n            if (p === '>') {\n                matches.push(this._parentMatch());\n                ++i;\n                p = parts[i];\n            }\n            else if (i > 0) {\n                matches.push(this._ancestorMatch());\n            }\n            matches.push(this._matchElement(p));\n        }\n        return matches.reduce((out, fn) => fn.bind(undefined, out), GWU.TRUE);\n    }\n    _parentMatch() {\n        return function parentM(next, e) {\n            // console.log('parent', e.parent);\n            if (!e.parent)\n                return false;\n            return next(e.parent);\n        };\n    }\n    _ancestorMatch() {\n        return function ancestorM(next, e) {\n            let current = e.parent;\n            while (current) {\n                if (next(current))\n                    return true;\n            }\n            return false;\n        };\n    }\n    _matchElement(text) {\n        const CSS_RE = /(?:(\\w+|\\*|\\$)|#(\\w+)|\\.([^\\.: ]+))|(?::(?:(?:not\\(\\.([^\\)]+)\\))|(?:not\\(:([^\\)]+)\\))|([^\\.: ]+)))/g;\n        const parts = [];\n        const re = new RegExp(CSS_RE, 'g');\n        let match = re.exec(text);\n        while (match) {\n            if (match[1]) {\n                const fn = this._matchTag(match[1]);\n                if (fn) {\n                    parts.push(fn);\n                }\n            }\n            else if (match[2]) {\n                parts.push(this._matchId(match[2]));\n            }\n            else if (match[3]) {\n                parts.push(this._matchClass(match[3]));\n            }\n            else if (match[4]) {\n                parts.push(this._matchNot(this._matchClass(match[4])));\n            }\n            else if (match[5]) {\n                parts.push(this._matchNot(this._matchProp(match[5])));\n            }\n            else {\n                parts.push(this._matchProp(match[6]));\n            }\n            match = re.exec(text);\n        }\n        return (next, e) => {\n            if (!parts.every((fn) => fn(e)))\n                return false;\n            return next(e);\n        };\n    }\n    _matchTag(tag) {\n        if (tag === '*')\n            return null;\n        if (tag === '$') {\n            this.priority += 10000;\n            return null;\n        }\n        this.priority += 10;\n        return (el) => el.tag === tag;\n    }\n    _matchClass(cls) {\n        this.priority += 100;\n        return (el) => el.classes.includes(cls);\n    }\n    _matchProp(prop) {\n        if (prop.startsWith('first')) {\n            return this._matchFirst();\n        }\n        else if (prop.startsWith('last')) {\n            return this._matchLast();\n        }\n        else if (prop === 'invalid') {\n            return this._matchNot(this._matchProp('valid'));\n        }\n        else if (prop === 'optional') {\n            return this._matchNot(this._matchProp('required'));\n        }\n        else if (prop === 'enabled') {\n            return this._matchNot(this._matchProp('disabled'));\n        }\n        else if (prop === 'unchecked') {\n            return this._matchNot(this._matchProp('checked'));\n        }\n        this.priority += 1; // prop\n        return (el) => !!el.prop(prop);\n    }\n    _matchId(id) {\n        this.priority += 1000;\n        return (el) => el.attr('id') === id;\n    }\n    _matchFirst() {\n        this.priority += 1; // prop\n        return (el) => !!el.parent && !!el.parent.children && el.parent.children[0] === el;\n    }\n    _matchLast() {\n        this.priority += 1; // prop\n        return (el) => {\n            if (!el.parent)\n                return false;\n            if (!el.parent.children)\n                return false;\n            return el.parent.children[el.parent.children.length - 1] === el;\n        };\n    }\n    _matchNot(fn) {\n        return (el) => !fn(el);\n    }\n    matches(obj) {\n        return this.matchFn(obj);\n    }\n}\nexport function compile(text) {\n    return new Selector(text);\n}\n","import * as GWU from 'gw-utils';\nimport { Selector } from './selector';\n// static - size/pos automatic (ignore TRBL)\n// relative - size automatic, pos = automatic + TRBL\n// fixed - size = self, pos = TRBL vs root\n// absolute - size = self, pos = TRBL vs positioned parent (fixed, absolute)\n// export interface Stylable {\n//     tag: string;\n//     classes: string[];\n//     attr(name: string): string | undefined;\n//     prop(name: string): PropType | undefined;\n//     parent: UIWidget | null;\n//     children?: UIWidget[];\n//     style(): Style;\n// }\n// export interface StyleOptions {\n//     fg?: GWU.color.ColorBase;\n//     bg?: GWU.color.ColorBase;\n//     // depth?: number;\n//     align?: GWU.text.Align;\n//     valign?: GWU.text.VAlign;\n//     // minWidth?: number;\n//     // maxWidth?: number;\n//     // width?: number;\n//     // minHeight?: number;\n//     // maxHeight?: number;\n//     // height?: number;\n//     // left?: number;\n//     // right?: number;\n//     // top?: number;\n//     // bottom?: number;\n//     // //        all,     [t+b, l+r],        [t, r+l,b],               [t, r, b, l]\n//     // padding?:\n//     //     | number\n//     //     | [number]\n//     //     | [number, number]\n//     //     | [number, number, number]\n//     //     | [number, number, number, number];\n//     // padLeft?: number;\n//     // padRight?: number;\n//     // padTop?: number;\n//     // padBottom?: number;\n//     // //        all,     [t+b, l+r],        [t, l+r, b],               [t, r, b, l]\n//     // margin?:\n//     //     | number\n//     //     | [number]\n//     //     | [number, number]\n//     //     | [number, number, number]\n//     //     | [number, number, number, number];\n//     // marginLeft?: number;\n//     // marginRight?: number;\n//     // marginTop?: number;\n//     // marginBottom?: number;\n//     // border?: GWU.color.ColorBase;\n// }\nexport class Style {\n    constructor(selector = '$', init) {\n        this._dirty = false;\n        this.selector = new Selector(selector);\n        if (init) {\n            this.set(init);\n        }\n        this._dirty = false;\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n    get fg() {\n        return this._fg;\n    }\n    get bg() {\n        return this._bg;\n    }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).darken(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).lighten(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this._fg, this._bg] = [this._bg, this._fg];\n        return this;\n    }\n    get align() {\n        return this._align;\n    }\n    get valign() {\n        return this._valign;\n    }\n    get(key) {\n        const id = ('_' + key);\n        return this[id];\n    }\n    set(key, value, setDirty = true) {\n        if (typeof key === 'string') {\n            const field = '_' + key;\n            if (typeof value === 'string') {\n                if (value.match(/^[+-]?\\d+$/)) {\n                    value = Number.parseInt(value);\n                }\n                else if (value === 'true') {\n                    value = true;\n                }\n                else if (value === 'false') {\n                    value = false;\n                }\n            }\n            this[field] = value;\n            // }\n        }\n        else if (key instanceof Style) {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (name === 'selector' || name === '_dirty')\n                    return;\n                if (value !== undefined && value !== null) {\n                    this[name] = value;\n                }\n                else if (value === null) {\n                    this.unset(name);\n                }\n            });\n        }\n        else {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (value === null) {\n                    this.unset(name);\n                }\n                else {\n                    this.set(name, value, setDirty);\n                }\n            });\n        }\n        this.dirty || (this.dirty = setDirty);\n        return this;\n    }\n    unset(key) {\n        const field = key.startsWith('_') ? key : '_' + key;\n        delete this[field];\n        this.dirty = true;\n        return this;\n    }\n    clone() {\n        const other = new this.constructor();\n        other.copy(this);\n        return other;\n    }\n    copy(other) {\n        Object.assign(this, other);\n        return this;\n    }\n}\nexport function makeStyle(style, selector = '$') {\n    const opts = {};\n    const parts = style\n        .trim()\n        .split(';')\n        .map((p) => p.trim());\n    parts.forEach((p) => {\n        const [name, base] = p.split(':').map((p) => p.trim());\n        if (!name)\n            return;\n        const baseParts = base.split(/ +/g);\n        if (baseParts.length == 1) {\n            // @ts-ignore\n            opts[name] = base;\n        }\n        else {\n            // @ts-ignore\n            opts[name] = baseParts;\n        }\n    });\n    return new Style(selector, opts);\n}\n// const NO_BOUNDS = ['fg', 'bg', 'depth', 'align', 'valign'];\n// export function affectsBounds(key: keyof StyleOptions): boolean {\n//     return !NO_BOUNDS.includes(key);\n// }\nexport class ComputedStyle extends Style {\n    // constructor(source: Stylable, sources?: Style[]) {\n    constructor(sources, opacity = 100) {\n        super();\n        // obj: Stylable;\n        this.sources = [];\n        this._opacity = 100;\n        this._baseFg = null;\n        this._baseBg = null;\n        // this.obj = source;\n        if (sources) {\n            // sort low to high priority (highest should be this.obj._style, lowest = global default:'*')\n            sources.sort((a, b) => a.selector.priority - b.selector.priority);\n            this.sources = sources;\n        }\n        this.sources.forEach((s) => super.set(s));\n        this.opacity = opacity;\n        this._dirty = false; // As far as I know I reflect all of the current source values.\n    }\n    get opacity() {\n        return this._opacity;\n    }\n    set opacity(v) {\n        v = GWU.clamp(v, 0, 100);\n        this._opacity = v;\n        if (v === 100) {\n            this._fg = this._baseFg || this._fg;\n            this._bg = this._baseBg || this._bg;\n            return;\n        }\n        if (this._fg !== undefined) {\n            this._baseFg = this._baseFg || GWU.color.from(this._fg);\n            this._fg = this._baseFg.alpha(v);\n        }\n        if (this._bg !== undefined) {\n            this._baseBg = this._baseBg || GWU.color.from(this._bg);\n            this._bg = this._baseBg.alpha(v);\n        }\n    }\n    get dirty() {\n        return this._dirty || this.sources.some((s) => s.dirty);\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n}\nexport class Sheet {\n    constructor(parentSheet) {\n        this.rules = [];\n        this._dirty = true;\n        if (parentSheet === undefined) {\n            parentSheet = defaultStyle;\n        }\n        if (parentSheet) {\n            this.rules = parentSheet.rules.slice();\n        }\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (!this._dirty) {\n            this.rules.forEach((r) => (r.dirty = false));\n        }\n    }\n    add(selector, props) {\n        if (selector.includes(',')) {\n            selector\n                .split(',')\n                .map((p) => p.trim())\n                .forEach((p) => this.add(p, props));\n            return this;\n        }\n        if (selector.includes(' '))\n            throw new Error('Hierarchical selectors not supported.');\n        // if 2 '.' - Error('Only single class rules supported.')\n        // if '&' - Error('Not supported.')\n        let rule = new Style(selector, props);\n        const existing = this.rules.findIndex((s) => s.selector.text === rule.selector.text);\n        if (existing > -1) {\n            const current = this.rules[existing];\n            current.set(rule);\n            rule = current;\n        }\n        else {\n            this.rules.push(rule);\n        }\n        // rulesChanged = true;\n        this.dirty = true;\n        return this;\n    }\n    get(selector) {\n        return this.rules.find((s) => s.selector.text === selector) || null;\n    }\n    remove(selector) {\n        const existing = this.rules.findIndex((s) => s.selector.text === selector);\n        if (existing > -1) {\n            this.rules.splice(existing, 1);\n            this.dirty = true;\n        }\n    }\n    computeFor(widget) {\n        const sources = this.rules.filter((r) => r.selector.matches(widget));\n        const widgetStyle = widget.style();\n        if (widgetStyle) {\n            sources.push(widgetStyle);\n        }\n        widgetStyle.dirty = false;\n        return new ComputedStyle(sources, widget.opacity);\n    }\n}\nexport const defaultStyle = new Sheet(null);\n","import * as GWU from 'gw-utils';\nimport * as Style from '../ui//style';\nStyle.defaultStyle.add('*', {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n});\nexport class Widget {\n    constructor(term, opts = {}) {\n        this.tag = 'text';\n        this.bounds = new GWU.xy.Bounds(0, 0, 0, 1);\n        this._depth = 0;\n        this.events = {};\n        // action: string = '';\n        this.children = [];\n        this._style = new Style.Style();\n        this._parent = null;\n        this.classes = [];\n        this._props = {};\n        this._attrs = {};\n        this.layer = term;\n        // this.bounds.x = term.x;\n        // this.bounds.y = term.y;\n        this.bounds.x = opts.x || 0;\n        this.bounds.y = opts.y || 0;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        if (opts.tag) {\n            this.tag = opts.tag;\n        }\n        if (opts.id) {\n            this.attr('id', opts.id);\n            this.attr('action', opts.id);\n        }\n        if (opts.depth !== undefined) {\n            this._depth = opts.depth;\n        }\n        this._style.set(opts);\n        if (opts.class) {\n            this.classes = opts.class.split(/ +/g).map((c) => c.trim());\n        }\n        if (opts.tabStop) {\n            this.prop('tabStop', true);\n        }\n        if (opts.action) {\n        }\n        if (opts.disabled) {\n            this.prop('disabled', true);\n        }\n        if (opts.hidden) {\n            this.prop('hidden', true);\n        }\n        if (opts.action) {\n            this.attr('action', opts.action);\n        }\n        if (this.attr('action')) {\n            this.on('click', (_n, w, e) => {\n                const action = this._attrStr('action');\n                if (action) {\n                    this._bubbleEvent(action, w, e);\n                }\n                return false; // keep bubbling\n            });\n        }\n        this.layer.attach(this);\n        this.updateStyle();\n        if (opts.opacity !== undefined) {\n            this._used.opacity = opts.opacity;\n        }\n    }\n    get depth() {\n        return this._depth;\n    }\n    set depth(v) {\n        this._depth = v;\n        this.layer.sortWidgets();\n    }\n    get parent() {\n        return this._parent;\n    }\n    set parent(v) {\n        this.setParent(v);\n    }\n    setParent(v, opts = {}) {\n        if (this._parent) {\n            this._parent._removeChild(this);\n        }\n        this._parent = v;\n        if (this._parent) {\n            this.depth = this._depth || this._parent.depth + 1;\n            this._parent._addChild(this, opts);\n        }\n    }\n    pos(x, y) {\n        if (x === undefined)\n            return this.bounds;\n        if (typeof x === 'number') {\n            this.bounds.x = x;\n            this.bounds.y = y || 0;\n        }\n        else {\n            this.bounds.x = x.x;\n            this.bounds.y = x.y;\n        }\n        this.layer.needsDraw = true;\n        return this;\n    }\n    center(bounds) {\n        return this.centerX(bounds).centerY(bounds);\n    }\n    centerX(bounds) {\n        bounds = bounds || this.layer.body.bounds;\n        const w = this.bounds.width;\n        const mid = Math.round((bounds.width - w) / 2);\n        this.bounds.x = bounds.x + mid;\n        return this;\n    }\n    centerY(bounds) {\n        bounds = bounds || this.layer.body.bounds;\n        const h = this.bounds.height;\n        const mid = Math.round((bounds.height - h) / 2);\n        this.bounds.y = bounds.y + mid;\n        return this;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._attrStr('text');\n        this.attr('text', v);\n        return this;\n    }\n    attr(name, v) {\n        if (v === undefined)\n            return this._attrs[name];\n        this._attrs[name] = v;\n        return this;\n    }\n    _attrInt(name) {\n        const n = this._attrs[name] || 0;\n        if (typeof n === 'number')\n            return n;\n        if (typeof n === 'string')\n            return Number.parseInt(n);\n        return n ? 1 : 0;\n    }\n    _attrStr(name) {\n        const n = this._attrs[name] || '';\n        if (typeof n === 'string')\n            return n;\n        if (typeof n === 'number')\n            return '' + n;\n        return n ? 'true' : 'false';\n    }\n    _attrBool(name) {\n        return !!this._attrs[name];\n    }\n    prop(name, v) {\n        if (v === undefined)\n            return this._props[name];\n        const current = this._props[name];\n        if (current !== v) {\n            this._setProp(name, v);\n        }\n        return this;\n    }\n    _setProp(name, v) {\n        this._props[name] = v;\n        // console.log(`${this.tag}.${name}=${v}`);\n        this.updateStyle();\n    }\n    _propInt(name) {\n        const n = this._props[name] || 0;\n        if (typeof n === 'number')\n            return n;\n        if (typeof n === 'string')\n            return Number.parseInt(n);\n        return n ? 1 : 0;\n    }\n    _propStr(name) {\n        const n = this._props[name] || '';\n        if (typeof n === 'string')\n            return n;\n        if (typeof n === 'number')\n            return '' + n;\n        return n ? 'true' : 'false';\n    }\n    _propBool(name) {\n        return !!this._props[name];\n    }\n    toggleProp(name) {\n        const current = !!this._props[name];\n        this.prop(name, !current);\n        return this;\n    }\n    incProp(name, n = 1) {\n        let current = this.prop(name) || 0;\n        if (typeof current === 'boolean') {\n            current = current ? 1 : 0;\n        }\n        else if (typeof current === 'string') {\n            current = Number.parseInt(current) || 0;\n        }\n        current += n;\n        this.prop(name, current);\n        return this;\n    }\n    contains(...args) {\n        return this.bounds.contains(args[0], args[1]);\n    }\n    style(opts) {\n        if (opts === undefined)\n            return this._style;\n        this._style.set(opts);\n        this.updateStyle();\n        return this;\n    }\n    addClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a))\n                return;\n            this.classes.push(a);\n        });\n        return this;\n    }\n    removeClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            GWU.arrayDelete(this.classes, a);\n        });\n        return this;\n    }\n    hasClass(c) {\n        const all = c.split(/ +/g);\n        return GWU.arrayIncludesAll(this.classes, all);\n    }\n    toggleClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a)) {\n                GWU.arrayDelete(this.classes, a);\n            }\n            else {\n                this.classes.push(a);\n            }\n        });\n        return this;\n    }\n    get focused() {\n        return !!this.prop('focus');\n    }\n    // @return true to stop the focus change event\n    focus(reverse = false) {\n        if (this.prop('focus'))\n            return true;\n        this.prop('focus', true);\n        return this._fireEvent('focus', this, { reverse });\n    }\n    // @return true to stop the focus change event\n    blur(reverse = false) {\n        if (!this.prop('focus'))\n            return false;\n        this.prop('focus', false);\n        return this._fireEvent('blur', this, { reverse });\n    }\n    get hovered() {\n        return !!this.prop('hover');\n    }\n    set hovered(v) {\n        this.prop('hover', v);\n    }\n    get hidden() {\n        let current = this;\n        while (current) {\n            if (current.prop('hidden'))\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n    set hidden(v) {\n        this.prop('hidden', v);\n        if (!v && this._used.opacity == 0) {\n            this._used.opacity = 100;\n        }\n    }\n    get opacity() {\n        let opacity = 100;\n        let current = this;\n        while (current) {\n            if (current._used) {\n                opacity = Math.min(opacity, current._used.opacity); // TODO - opacity = Math.floor(opacity * current._used.opacity / 100);\n            }\n            current = current.parent;\n        }\n        return opacity;\n    }\n    set opacity(v) {\n        if (v !== this._used.opacity) {\n            this._used.opacity = v;\n            this.hidden = this._used.opacity == 0;\n            this.layer.needsDraw = true;\n        }\n    }\n    updateStyle() {\n        this._used = this.layer.styles.computeFor(this);\n        this.layer.needsDraw = true; // changed style or state\n    }\n    draw(buffer) {\n        if (this.hidden)\n            return false;\n        return this._draw(buffer);\n    }\n    // Animation\n    fadeIn(ms) {\n        return this.fadeTo(100, ms);\n    }\n    fadeOut(ms) {\n        return this.fadeTo(0, ms);\n    }\n    fadeTo(opacity, ms) {\n        const tween = GWU.tween\n            .make({ pct: this._used.opacity })\n            .to({ pct: opacity })\n            .duration(ms)\n            .onUpdate((info) => {\n            this.opacity = info.pct;\n        });\n        this.layer.animate(tween);\n        return this;\n    }\n    fadeToggle(ms) {\n        return this.fadeTo(this._used.opacity ? 0 : 100, ms);\n    }\n    slideIn(x, y, from, ms) {\n        let start = { x, y };\n        if (from === 'left') {\n            start.x = -this.bounds.width;\n        }\n        else if (from === 'right') {\n            start.x = this.layer.width + this.bounds.width;\n        }\n        else if (from === 'top') {\n            start.y = -this.bounds.height;\n        }\n        else if (from === 'bottom') {\n            start.y = this.layer.height + this.bounds.height;\n        }\n        return this.slide(start, { x, y }, ms);\n    }\n    slideOut(dir, ms) {\n        let dest = { x: this.bounds.x, y: this.bounds.y };\n        if (dir === 'left') {\n            dest.x = -this.bounds.width;\n        }\n        else if (dir === 'right') {\n            dest.x = this.layer.width + this.bounds.width;\n        }\n        else if (dir === 'top') {\n            dest.y = -this.bounds.height;\n        }\n        else if (dir === 'bottom') {\n            dest.y = this.layer.height + this.bounds.height;\n        }\n        return this.slide(this.bounds, dest, ms);\n    }\n    slide(from, to, ms) {\n        const tween = GWU.tween\n            .make({ x: GWU.xy.x(from), y: GWU.xy.y(from) })\n            .to({ x: GWU.xy.x(to), y: GWU.xy.y(to) })\n            .duration(ms)\n            .onUpdate((info) => {\n            this.pos(info.x, info.y);\n        });\n        this.layer.animate(tween);\n        return this;\n    }\n    // Draw\n    _draw(buffer) {\n        this._drawFill(buffer);\n        return true;\n    }\n    _drawFill(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this._used.bg, this._used.bg);\n    }\n    childAt(...args) {\n        return this.children.find((c) => c.contains(args[0], args[1])) || null;\n    }\n    _addChild(w, opts) {\n        let beforeIndex = -1;\n        if (opts && opts.beforeIndex !== undefined) {\n            beforeIndex = opts.beforeIndex;\n        }\n        if (w._parent && w._parent !== this)\n            throw new Error('Trying to add child that already has a parent.');\n        if (!this.children.includes(w)) {\n            if (beforeIndex < 0 || beforeIndex >= this.children.length) {\n                this.children.push(w);\n            }\n            else {\n                this.children.splice(beforeIndex, 0, w);\n            }\n        }\n        w._parent = this;\n        return this;\n    }\n    _removeChild(w) {\n        if (!w._parent || w._parent !== this)\n            throw new Error('Removing child that does not have this widget as parent.');\n        w._parent = null;\n        GWU.arrayDelete(this.children, w);\n        return this;\n    }\n    resize(w, h) {\n        this.bounds.width = w || this.bounds.width;\n        this.bounds.height = h || this.bounds.height;\n        this.layer.needsDraw = true;\n        return this;\n    }\n    // Events\n    mouseenter(e, over) {\n        if (!this.contains(e))\n            return;\n        if (this.hovered)\n            return;\n        this.hovered = true;\n        this._fireEvent('mouseenter', this, e);\n        if (this._parent) {\n            this._parent.mouseenter(e, over);\n        }\n    }\n    mousemove(e) {\n        if (this.contains(e) && !e.defaultPrevented && !this.hidden) {\n            this._fireEvent('mousemove', this, e);\n            // e.preventDefault();\n        }\n        else {\n            this.mouseleave(e);\n        }\n        return false;\n    }\n    mouseleave(e) {\n        if (this.contains(e))\n            return;\n        if (!this.hovered)\n            return;\n        this.hovered = false;\n        this._fireEvent('mouseleave', this, e);\n        // if (this._parent) {\n        //     this._parent.mouseleave(e);\n        // }\n    }\n    click(e) {\n        if (this.hidden)\n            return false;\n        return this._fireEvent('click', this, e);\n    }\n    keypress(e) {\n        return this._fireEvent('keypress', this, e);\n    }\n    dir(e) {\n        return this._fireEvent('dir', this, e);\n    }\n    tick(e) {\n        return this._fireEvent('tick', this, e);\n    }\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    _fireEvent(name, source, args) {\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source || this, args) || out, false);\n        return handled;\n    }\n    _bubbleEvent(name, source, args) {\n        let current = this;\n        while (current) {\n            if (current._fireEvent(name, source, args))\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n}\n","import * as Widget from './widget';\nexport class Body extends Widget.Widget {\n    constructor(layer) {\n        super(layer, {\n            tag: 'body',\n            id: 'BODY',\n            depth: -1,\n            width: layer.width,\n            height: layer.height,\n        });\n    }\n    _drawFill(buffer) {\n        buffer.blend(this._used.bg);\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Style from './style';\nimport { Body } from '../widget/body';\nimport { Grid } from './grid';\nexport class Layer {\n    constructor(ui, opts = {}) {\n        this.needsDraw = true;\n        this.result = undefined;\n        this._attachOrder = [];\n        this._depthOrder = [];\n        this._focusWidget = null;\n        this._hasTabStop = false;\n        this.timers = [];\n        this._tweens = [];\n        this._done = null;\n        this._opts = { x: 0, y: 0 };\n        this.ui = ui;\n        this.buffer = ui.canvas.buffer.clone();\n        this.styles = new Style.Sheet(opts.styles || ui.styles);\n        this.body = new Body(this);\n        this.promise = new Promise((resolve) => {\n            this._done = resolve;\n        });\n    }\n    get width() {\n        return this.ui.width;\n    }\n    get height() {\n        return this.ui.height;\n    }\n    // Style and Opts\n    reset() {\n        this._opts = { x: 0, y: 0 };\n        return this;\n    }\n    fg(v) {\n        this._opts.fg = v;\n        return this;\n    }\n    bg(v) {\n        this._opts.bg = v;\n        return this;\n    }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._opts.fg = GWU.color\n                .from(this._opts.fg || 'white')\n                .darken(pct);\n        }\n        if (bg) {\n            this._opts.bg = GWU.color\n                .from(this._opts.bg || 'black')\n                .darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._opts.fg = GWU.color\n                .from(this._opts.fg || 'white')\n                .lighten(pct);\n        }\n        if (bg) {\n            this._opts.bg = GWU.color\n                .from(this._opts.bg || 'black')\n                .lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this._opts.fg, this._opts.bg] = [this._opts.bg, this._opts.fg];\n        return this;\n    }\n    // STYLE\n    style(opts) {\n        Object.assign(this._opts, opts);\n        return this;\n    }\n    class(c) {\n        this._opts.class = this._opts.class || '';\n        this._opts.class += ' ' + c;\n        return this;\n    }\n    pos(x, y) {\n        if (x === undefined)\n            return this._opts;\n        this._opts.x = GWU.clamp(x, 0, this.width);\n        this._opts.y = GWU.clamp(y, 0, this.height);\n        return this;\n    }\n    moveTo(x, y) {\n        return this.pos(x, y);\n    }\n    move(dx, dy) {\n        this._opts.x = GWU.clamp(this._opts.x + dx, 0, this.width);\n        this._opts.y = GWU.clamp(this._opts.y + dy, 0, this.height);\n        return this;\n    }\n    up(n = 1) {\n        return this.move(0, -n);\n    }\n    down(n = 1) {\n        return this.move(0, n);\n    }\n    left(n = 1) {\n        return this.move(-n, 0);\n    }\n    right(n = 1) {\n        return this.move(n, 0);\n    }\n    nextLine(n = 1) {\n        return this.pos(0, this._opts.y + n);\n    }\n    prevLine(n = 1) {\n        return this.pos(0, this._opts.y - n);\n    }\n    grid() {\n        return new Grid(this);\n    }\n    // EDIT\n    // erase and move back to top left\n    clear(color) {\n        this.body.children = [];\n        this._depthOrder = [this.body];\n        if (color) {\n            this.body.style().set('bg', color);\n        }\n        else {\n            this.body.style().unset('bg');\n        }\n        return this;\n    }\n    // Widgets\n    // create(tag: string, opts: any): UIWidget {\n    //     const options = Object.assign({ tag }, this._opts, opts);\n    //     const widget = createWidget(tag, this, options);\n    //     this.addWidget(widget);\n    //     return widget;\n    // }\n    sortWidgets() {\n        this._depthOrder.sort((a, b) => b.depth - a.depth);\n        return this;\n    }\n    attach(w) {\n        if (!this._attachOrder.includes(w)) {\n            const index = this._depthOrder.findIndex((aw) => aw.depth <= w.depth);\n            if (index < 0) {\n                this._depthOrder.push(w);\n            }\n            else {\n                this._depthOrder.splice(index, 0, w);\n            }\n            this._attachOrder.push(w);\n            this.needsDraw = true;\n        }\n        if (!w.parent && w !== this.body && this.body) {\n            w.setParent(this.body);\n            this.needsDraw = true;\n        }\n        this._hasTabStop = this._hasTabStop || w._propBool('tabStop');\n        return this;\n    }\n    detach(w) {\n        // GWU.arrayDelete(this.widgets, w);\n        w.setParent(null);\n        GWU.arrayDelete(this._depthOrder, w);\n        GWU.arrayDelete(this._attachOrder, w);\n        if (this._focusWidget === w) {\n            this._hasTabStop = this.nextTabStop();\n        }\n        this.needsDraw = true;\n        return this;\n    }\n    widgetAt(...args) {\n        return (this._depthOrder.find((w) => w.contains(args[0], args[1]) && !w.hidden) || this.body);\n    }\n    get focusWidget() {\n        return this._focusWidget;\n    }\n    setFocusWidget(w, reverse = false) {\n        if (w === this._focusWidget)\n            return;\n        if (this._focusWidget && this._focusWidget.blur(reverse))\n            return;\n        if (w && w.focus(reverse))\n            return;\n        this._focusWidget = w;\n    }\n    getWidget(id) {\n        return this._depthOrder.find((w) => w.attr('id') === id) || null;\n    }\n    nextTabStop() {\n        if (!this.focusWidget) {\n            this.setFocusWidget(this._attachOrder.find((w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden) || null);\n            return !!this.focusWidget;\n        }\n        const next = GWU.arrayNext(this._attachOrder, this.focusWidget, (w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden);\n        if (next) {\n            this.setFocusWidget(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabStop() {\n        if (!this.focusWidget) {\n            this.setFocusWidget(this._attachOrder.find((w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden) || null);\n            return !!this.focusWidget;\n        }\n        const prev = GWU.arrayPrev(this._attachOrder, this.focusWidget, (w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden);\n        if (prev) {\n            this.setFocusWidget(prev, true);\n            return true;\n        }\n        return false;\n    }\n    // EVENTS\n    on(event, cb) {\n        this.body.on(event, cb);\n        return this;\n    }\n    off(event, cb) {\n        this.body.off(event, cb);\n        return this;\n    }\n    mousemove(e) {\n        const over = this.widgetAt(e);\n        over.mouseenter(e, over);\n        this._depthOrder.forEach((w) => {\n            w.mousemove(e); // handles mouseleave\n        });\n        return false; // TODO - this._done\n    }\n    click(e) {\n        let w = this.widgetAt(e);\n        let setFocus = false;\n        while (w) {\n            if (!setFocus && w.prop('tabStop') && !w.prop('disabled')) {\n                this.setFocusWidget(w);\n                setFocus = true;\n            }\n            if (w.click(e))\n                return false;\n            w = w.parent;\n        }\n        return false; // TODO - this._done\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        let w = this.focusWidget || this.body;\n        while (w) {\n            if (w.keypress(e))\n                return false;\n            w = w.parent;\n        }\n        //         const fn =\n        //             this.eventHandlers[e.key] ||\n        //             this.eventHandlers[e.code] ||\n        //             this.eventHandlers.keypress;\n        //         if (fn) {\n        //             if (await fn(e, this, this.focusWidget)) {\n        //                 return this.done;\n        //             }\n        //         }\n        if (e.defaultPrevented)\n            return false;\n        if (e.key === 'Tab') {\n            // Next widget\n            this.nextTabStop();\n        }\n        else if (e.key === 'TAB') {\n            // Prev Widget\n            this.prevTabStop();\n        }\n        //         return this.done;\n        return false;\n    }\n    dir(e) {\n        let target = this.focusWidget || this.body;\n        while (target) {\n            if (target.dir(e))\n                return false;\n            target = target.parent;\n        }\n        // return this.done;\n        return false;\n    }\n    tick(e) {\n        const dt = e.dt;\n        // fire animations\n        this._tweens.forEach((tw) => tw.tick(dt));\n        this._tweens = this._tweens.filter((tw) => tw.isRunning());\n        this.timers.forEach((timer) => {\n            if (timer.time <= 0)\n                return; // ignore fired timers\n            timer.time -= dt;\n            if (timer.time <= 0) {\n                if (typeof timer.action === 'string') {\n                    this.body._fireEvent(timer.action, this.body);\n                }\n                else {\n                    timer.action();\n                }\n            }\n        });\n        for (let w of this._depthOrder) {\n            w.tick(e);\n        }\n        //         return this.done;\n        return false;\n    }\n    draw() {\n        if (this._hasTabStop && !this._focusWidget) {\n            this.nextTabStop();\n        }\n        if (this.styles.dirty) {\n            this.needsDraw = true;\n            this._depthOrder.forEach((w) => w.updateStyle());\n            this.styles.dirty = false;\n        }\n        if (!this.needsDraw)\n            return;\n        this.needsDraw = false;\n        this.ui.copyUIBuffer(this.buffer);\n        // draw from low depth to high depth\n        for (let i = this._depthOrder.length - 1; i >= 0; --i) {\n            const w = this._depthOrder[i];\n            w.draw(this.buffer);\n        }\n        console.log('draw');\n        this.buffer.render();\n    }\n    // LOOP\n    setTimeout(action, time) {\n        const slot = this.timers.findIndex((t) => t.time <= 0);\n        if (slot < 0) {\n            this.timers.push({ action, time });\n        }\n        else {\n            this.timers[slot] = { action, time };\n        }\n    }\n    clearTimeout(action) {\n        const timer = this.timers.find((t) => t.action === action);\n        if (timer) {\n            timer.time = -1;\n        }\n    }\n    animate(tween) {\n        if (!tween.isRunning())\n            tween.start();\n        this._tweens.push(tween);\n        return this;\n    }\n    finish(result) {\n        this.result = result;\n        this.ui.finishLayer(this);\n    }\n    _finish() {\n        if (!this._done)\n            return;\n        this.body._fireEvent('finish', this.body, this.result);\n        this._done(this.result);\n        this._done = null;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Layer } from './layer';\nLayer.prototype.alert = function (opts, text, args) {\n    if (typeof opts === 'number') {\n        opts = { duration: opts };\n    }\n    if (args) {\n        text = GWU.text.apply(text, args);\n    }\n    opts.class = opts.class || 'alert';\n    opts.border = opts.border || 'ascii';\n    opts.pad = opts.pad || 1;\n    const layer = this.ui.startNewLayer();\n    // Fade the background\n    const opacity = opts.opacity !== undefined ? opts.opacity : 50;\n    layer.body.style().set('bg', GWU.color.BLACK.alpha(opacity));\n    // create the text widget\n    const textWidget = layer\n        .text(text, {\n        id: 'TEXT',\n        class: opts.textClass || opts.class,\n        width: opts.width,\n        height: opts.height,\n    })\n        .center();\n    Object.assign(opts, {\n        width: textWidget.bounds.width,\n        height: textWidget.bounds.height,\n        x: textWidget.bounds.x,\n        y: textWidget.bounds.y,\n        id: 'DIALOG',\n    });\n    const dialog = layer.dialog(opts);\n    textWidget.setParent(dialog);\n    layer.on('click', () => {\n        layer.finish(true);\n        return true;\n    });\n    layer.on('keypress', () => {\n        layer.finish(true);\n        return true;\n    });\n    layer.setTimeout(() => {\n        layer.finish(false);\n    }, opts.duration || 3000);\n    return layer;\n};\n","export const widgets = {};\nexport function installWidget(tag, fn) {\n    widgets[tag] = fn;\n}\nexport function createWidget(tag, layer, opts) {\n    const fn = widgets[tag];\n    if (!fn)\n        throw new Error('Unknown tag = ' + tag);\n    return fn(layer, opts);\n}\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nimport { installWidget } from './make';\nimport { Layer } from '../ui/layer';\nexport class Text extends Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this._text = '';\n        this._lines = [];\n        this._fixedWidth = false;\n        this._fixedHeight = false;\n        this._fixedHeight = !!opts.height;\n        this._fixedWidth = !!opts.width;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        this.text(opts.text);\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        this._text = v;\n        let w = this._fixedWidth ? this.bounds.width : 100;\n        this._lines = GWU.text.splitIntoLines(this._text, w);\n        if (!this._fixedWidth) {\n            this.bounds.width = this._lines.reduce((out, line) => Math.max(out, GWU.text.length(line)), 0);\n        }\n        if (this._fixedHeight) {\n            if (this._lines.length > this.bounds.height) {\n                this._lines.length = this.bounds.height;\n            }\n        }\n        else {\n            this.bounds.height = Math.max(1, this._lines.length);\n        }\n        this.layer.needsDraw = true;\n        return this;\n    }\n    resize(w, h) {\n        super.resize(w, h);\n        this._fixedWidth = w > 0;\n        this._fixedHeight = h > 0;\n        this.text(this._text);\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        let vOffset = 0;\n        if (this._used.valign === 'bottom') {\n            vOffset = this.bounds.height - this._lines.length;\n        }\n        else if (this._used.valign === 'middle') {\n            vOffset = Math.floor((this.bounds.height - this._lines.length) / 2);\n        }\n        this._lines.forEach((line, i) => {\n            buffer.drawText(this.bounds.x, this.bounds.y + i + vOffset, line, this._used.fg, -1, this.bounds.width, this._used.align);\n        });\n        return true;\n    }\n}\ninstallWidget('text', (l, opts) => new Text(l, opts));\nLayer.prototype.text = function (text, opts = {}) {\n    const options = Object.assign({}, this._opts, opts, { text });\n    const list = new Text(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    this.pos(list.bounds.x, list.bounds.bottom);\n    return list;\n};\n","import { Layer } from '../ui/layer';\nimport * as Text from './text';\nimport { installWidget } from './make';\nexport class Button extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.text = opts.text || '';\n            opts.action = opts.action || opts.id;\n            opts.tag = opts.tag || 'button';\n            if (!opts.text && !opts.width)\n                throw new Error('Buttons must have text or width.');\n            return opts;\n        })());\n    }\n    keypress(ev) {\n        if (!ev.key)\n            return false;\n        if (this._fireEvent('keypress', this, ev))\n            return true;\n        if (ev.key === 'Enter') {\n            const action = this._attrStr('action');\n            if (action && action.length)\n                this._bubbleEvent(action, this);\n            return true;\n        }\n        return false;\n    }\n    click(ev) {\n        if (!this.contains(ev))\n            return false;\n        if (this._fireEvent('click', this, ev))\n            return true;\n        const action = this._attrStr('action');\n        if (action && action.length)\n            return this._bubbleEvent(action, this);\n        return false;\n    }\n}\ninstallWidget('button', (l, opts) => new Button(l, opts));\nLayer.prototype.button = function (text, opts) {\n    const options = Object.assign({}, this._opts, opts, {\n        text,\n    });\n    const widget = new Button(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    this.pos(widget.bounds.x, widget.bounds.bottom);\n    return widget;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from './layer';\nimport '../widget/button';\nLayer.prototype.confirm = function (opts, text, args) {\n    if (typeof opts === 'string') {\n        args = text;\n        text = opts;\n        opts = {};\n    }\n    if (args) {\n        text = GWU.text.apply(text, args);\n    }\n    opts.class = opts.class || 'confirm';\n    opts.border = opts.border || 'ascii';\n    opts.pad = opts.pad || 1;\n    const layer = this.ui.startNewLayer();\n    // Fade the background\n    const opacity = opts.opacity !== undefined ? opts.opacity : 50;\n    layer.body.style().set('bg', GWU.color.BLACK.alpha(opacity));\n    if (opts.cancel === undefined) {\n        opts.cancel = 'Cancel';\n    }\n    else if (opts.cancel === true) {\n        opts.cancel = 'Cancel';\n    }\n    else if (!opts.cancel) {\n        opts.cancel = '';\n    }\n    opts.ok = opts.ok || 'Ok';\n    let buttonWidth = opts.buttonWidth || 0;\n    if (!buttonWidth) {\n        buttonWidth = Math.max(opts.ok.length, opts.cancel.length);\n    }\n    const width = Math.max(opts.width || 0, buttonWidth * 2 + 2);\n    // create the text widget\n    const textWidget = layer\n        .text(text, {\n        class: opts.textClass || opts.class,\n        width: width,\n        height: opts.height,\n    })\n        .center();\n    Object.assign(opts, {\n        width: textWidget.bounds.width,\n        height: textWidget.bounds.height + 2,\n        x: textWidget.bounds.x,\n        y: textWidget.bounds.y,\n        tag: 'confirm',\n    });\n    const dialog = layer.dialog(opts);\n    textWidget.setParent(dialog);\n    layer\n        .button(opts.ok, {\n        class: opts.okClass || opts.class,\n        width: buttonWidth,\n        id: 'OK',\n        parent: dialog,\n        x: dialog._innerLeft + dialog._innerWidth - buttonWidth,\n        y: dialog._innerTop + dialog._innerHeight - 1,\n    })\n        .on('click', () => {\n        layer.finish(true);\n        return true;\n    });\n    if (opts.cancel.length) {\n        layer\n            .button(opts.cancel, {\n            class: opts.cancelClass || opts.class,\n            width: buttonWidth,\n            id: 'CANCEL',\n            parent: dialog,\n            x: dialog._innerLeft,\n            y: dialog._innerTop + dialog._innerHeight - 1,\n        })\n            .on('click', () => {\n            layer.finish(false);\n            return true;\n        });\n    }\n    layer.on('keypress', (_n, _w, e) => {\n        if (e.key === 'Escape') {\n            layer.finish(false);\n        }\n        else if (e.key === 'Enter') {\n            layer.finish(true);\n        }\n        return true;\n    });\n    return layer;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from './layer';\nimport '../widget/button';\nLayer.prototype.inputbox = function (opts, text, args) {\n    if (typeof opts === 'string') {\n        args = text;\n        text = opts;\n        opts = {};\n    }\n    if (args) {\n        text = GWU.text.apply(text, args);\n    }\n    opts.class = opts.class || 'confirm';\n    opts.border = opts.border || 'ascii';\n    opts.pad = opts.pad || 1;\n    const layer = this.ui.startNewLayer();\n    // Fade the background\n    const opacity = opts.opacity !== undefined ? opts.opacity : 50;\n    layer.body.style().set('bg', GWU.color.BLACK.alpha(opacity));\n    // create the text widget\n    const textWidget = layer\n        .text(text, {\n        class: opts.textClass || opts.class,\n        width: opts.width,\n        height: opts.height,\n    })\n        .center();\n    Object.assign(opts, {\n        width: textWidget.bounds.width,\n        height: textWidget.bounds.height + 2,\n        x: textWidget.bounds.x,\n        y: textWidget.bounds.y,\n        tag: 'inputbox',\n    });\n    const dialog = layer.dialog(opts);\n    textWidget.setParent(dialog);\n    let width = dialog._innerWidth;\n    let x = dialog._innerLeft;\n    if (opts.label) {\n        const label = layer.text(opts.label, {\n            class: opts.labelClass || opts.class,\n            tag: 'label',\n            parent: dialog,\n            x,\n            y: dialog._innerTop + dialog._innerHeight - 1,\n        });\n        x += label.bounds.width + 1;\n        width -= label.bounds.width + 1;\n    }\n    layer\n        .input({\n        class: opts.inputClass || opts.class,\n        width,\n        id: 'INPUT',\n        parent: dialog,\n        x,\n        y: dialog._innerTop + dialog._innerHeight - 1,\n    })\n        .on('INPUT', (_n, w, _e) => {\n        w && layer.finish(w.text());\n        return true;\n    });\n    layer.on('keypress', (_n, _w, e) => {\n        if (e.key === 'Escape') {\n            layer.finish(null);\n            return true;\n        }\n        return false;\n    });\n    return layer;\n};\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nimport { Layer } from '../ui/layer';\nimport { installWidget } from './make';\nexport class Border extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.ascii = false;\n        if (opts.ascii) {\n            this.ascii = true;\n        }\n        else if (opts.fg && opts.ascii !== false) {\n            this.ascii = true;\n        }\n    }\n    contains(..._args) {\n        return false;\n    }\n    _draw(buffer) {\n        const w = this.bounds.width;\n        const h = this.bounds.height;\n        const x = this.bounds.x;\n        const y = this.bounds.y;\n        const ascii = this.ascii;\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        return true;\n    }\n}\ninstallWidget('border', (l, opts) => new Border(l, opts));\nLayer.prototype.border = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Border(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\nexport function drawBorder(buffer, x, y, w, h, style, ascii) {\n    const fg = style.fg;\n    const bg = style.bg;\n    if (ascii) {\n        for (let i = 1; i < w; ++i) {\n            buffer.draw(x + i, y, '-', fg, bg);\n            buffer.draw(x + i, y + h - 1, '-', fg, bg);\n        }\n        for (let j = 1; j < h; ++j) {\n            buffer.draw(x, y + j, '|', fg, bg);\n            buffer.draw(x + w - 1, y + j, '|', fg, bg);\n        }\n        buffer.draw(x, y, '+', fg, bg);\n        buffer.draw(x + w - 1, y, '+', fg, bg);\n        buffer.draw(x, y + h - 1, '+', fg, bg);\n        buffer.draw(x + w - 1, y + h - 1, '+', fg, bg);\n    }\n    else {\n        GWU.xy.forBorder(x, y, w, h, (x, y) => {\n            buffer.draw(x, y, ' ', bg, bg);\n        });\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../ui/layer';\nimport * as Text from './text';\nimport * as Widget from './widget';\nimport { drawBorder } from './border';\nexport function toPadArray(pad) {\n    if (!pad)\n        return [0, 0, 0, 0];\n    if (pad === true) {\n        return [1, 1, 1, 1];\n    }\n    else if (typeof pad === 'number') {\n        return [pad, pad, pad, pad];\n    }\n    else if (pad.length == 1) {\n        const p = pad[0];\n        return [p, p, p, p];\n    }\n    else if (pad.length == 2) {\n        const [pv, ph] = pad;\n        return [pv, ph, pv, ph];\n    }\n    throw new Error('Invalid pad: ' + pad);\n}\nexport class Dialog extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Dialog.default.tag;\n            return opts;\n        })());\n        this.legend = null;\n        let border = opts.border || Dialog.default.border;\n        this.attr('border', border);\n        const pad = toPadArray(opts.pad || Dialog.default.pad);\n        this.attr('padTop', pad[0]);\n        this.attr('padRight', pad[1]);\n        this.attr('padBottom', pad[2]);\n        this.attr('padLeft', pad[3]);\n        if (border !== 'none') {\n            for (let i = 0; i < 4; ++i) {\n                pad[i] += 1;\n            }\n        }\n        this._adjustBounds(pad);\n        this.attr('legendTag', opts.legendTag || Dialog.default.legendTag);\n        this.attr('legendClass', opts.legendClass || opts.class || Dialog.default.legendClass);\n        this.attr('legendAlign', opts.legendAlign || Dialog.default.legendAlign);\n        this._addLegend(opts);\n    }\n    _adjustBounds(pad) {\n        // adjust w,h,x,y for border/pad\n        this.bounds.width += pad[1] + pad[3];\n        this.bounds.height += pad[0] + pad[2];\n        this.bounds.x -= pad[3];\n        this.bounds.y -= pad[0];\n        return this;\n    }\n    get _innerLeft() {\n        const border = this._attrStr('border');\n        const padLeft = this._attrInt('padLeft');\n        return this.bounds.x + padLeft + (border === 'none' ? 0 : 1);\n    }\n    get _innerWidth() {\n        const border = this._attrStr('border');\n        const padSize = this._attrInt('padLeft') + this._attrInt('padRight');\n        return this.bounds.width - padSize - (border === 'none' ? 0 : 2);\n    }\n    get _innerTop() {\n        const border = this._attrStr('border');\n        const padTop = this._attrInt('padTop');\n        return this.bounds.y + padTop + (border === 'none' ? 0 : 1);\n    }\n    get _innerHeight() {\n        const border = this._attrStr('border');\n        const padSize = this._attrInt('padTop') + this._attrInt('padBottom');\n        return this.bounds.height - padSize - (border === 'none' ? 0 : 2);\n    }\n    _addLegend(opts) {\n        if (!opts.legend) {\n            if (this._attrStr('border') === 'none') {\n                this.bounds.height = 0;\n            }\n            return this;\n        }\n        const border = this._attrStr('border') !== 'none';\n        const textWidth = GWU.text.length(opts.legend);\n        const width = this.bounds.width - (border ? 4 : 0);\n        const align = this._attrStr('legendAlign');\n        let x = this.bounds.x + (border ? 2 : 0);\n        if (align === 'center') {\n            x += Math.floor((width - textWidth) / 2);\n        }\n        else if (align === 'right') {\n            x += width - textWidth;\n        }\n        this.legend = new Text.Text(this.layer, {\n            text: opts.legend,\n            x,\n            y: this.bounds.y,\n            depth: this.depth + 1,\n            tag: this._attrStr('legendTag'),\n            class: this._attrStr('legendClass'),\n        });\n        // if (this.bounds.width < this.legend.bounds.width + 4) {\n        //     this.bounds.width = this.legend.bounds.width + 4;\n        // }\n        // this.bounds.height +=\n        //     this._attrInt('padTop') + this._attrInt('padBottom');\n        this.legend.setParent(this);\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        const border = this._attrStr('border');\n        if (border === 'none')\n            return false;\n        drawBorder(buffer, this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this._used, border === 'ascii');\n        return true;\n    }\n}\nDialog.default = {\n    tag: 'dialog',\n    border: 'none',\n    pad: false,\n    legendTag: 'legend',\n    legendClass: '',\n    legendAlign: 'left',\n};\nLayer.prototype.dialog = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Dialog(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../ui/layer';\nimport * as Text from './text';\nimport * as Dialog from './dialog';\nexport class Fieldset extends Dialog.Dialog {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Fieldset.default.tag;\n            opts.border = opts.border || Fieldset.default.border;\n            opts.legendTag = opts.legendTag || Fieldset.default.legendTag;\n            opts.legendClass =\n                opts.legendClass || Fieldset.default.legendClass;\n            opts.legendAlign =\n                opts.legendAlign || Fieldset.default.legendAlign;\n            opts.width = opts.width || 0;\n            opts.height = opts.height || 0;\n            return opts;\n        })());\n        this.fields = [];\n        this.attr('separator', opts.separator || Fieldset.default.separator);\n        this.attr('dataTag', opts.dataTag || Fieldset.default.dataTag);\n        this.attr('dataClass', opts.dataClass || Fieldset.default.dataClass);\n        this.attr('dataWidth', opts.dataWidth);\n        this.attr('labelTag', opts.labelTag || Fieldset.default.labelTag);\n        this.attr('labelClass', opts.labelClass || Fieldset.default.labelClass);\n        this.attr('labelWidth', this._innerWidth - opts.dataWidth);\n        this._addLegend(opts);\n    }\n    _adjustBounds(pad) {\n        this.bounds.width = Math.max(this.bounds.width, pad[1] + pad[3]);\n        this.bounds.height = Math.max(this.bounds.height, pad[0] + pad[2]);\n        return this;\n    }\n    get _labelLeft() {\n        const border = this._attrStr('border');\n        const padLeft = this._attrInt('padLeft');\n        return this.bounds.x + padLeft + (border === 'none' ? 0 : 1);\n    }\n    get _dataLeft() {\n        return this._labelLeft + this._attrInt('labelWidth');\n    }\n    get _nextY() {\n        const border = this._attrStr('border');\n        const padBottom = this._attrInt('padBottom');\n        return this.bounds.bottom - (border === 'none' ? 0 : 1) - padBottom;\n    }\n    add(label, format) {\n        const sep = this._attrStr('separator');\n        const labelText = GWU.text.padEnd(label, this._attrInt('labelWidth') - sep.length, ' ') + sep;\n        this.layer.text(labelText, {\n            x: this._labelLeft,\n            y: this._nextY,\n            width: this._attrInt('labelWidth'),\n            tag: this._attrStr('labelTag'),\n            class: this._attrStr('labelClass'),\n        });\n        if (typeof format === 'string') {\n            format = { format };\n        }\n        format.x = this._dataLeft;\n        format.y = this._nextY;\n        format.width = this._attrInt('dataWidth');\n        format.tag = format.tag || this._attrStr('dataTag');\n        format.class = format.class || this._attrStr('dataClass');\n        const field = new Field(this.layer, format);\n        field.setParent(this);\n        this.bounds.height += 1;\n        this.fields.push(field);\n        return this;\n    }\n    data(d) {\n        this.fields.forEach((f) => f.data(d));\n        this.layer.needsDraw = true;\n        return this;\n    }\n}\nFieldset.default = {\n    tag: 'fieldset',\n    border: 'none',\n    separator: ' : ',\n    pad: false,\n    legendTag: 'legend',\n    legendClass: 'legend',\n    legendAlign: 'left',\n    labelTag: 'label',\n    labelClass: '',\n    dataTag: 'field',\n    dataClass: '',\n};\nLayer.prototype.fieldset = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Fieldset(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\nexport class Field extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            // @ts-ignore\n            const topts = opts;\n            topts.tag = topts.tag || 'field';\n            topts.text = '';\n            return topts;\n        })());\n        if (typeof opts.format === 'string') {\n            this._format = GWU.text.compile(opts.format);\n        }\n        else {\n            this._format = opts.format;\n        }\n    }\n    data(v) {\n        const t = this._format(v) || '';\n        return this.text(t);\n    }\n}\n","import { Layer } from '../ui/layer';\nimport * as Widget from './widget';\nexport class OrderedList extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'ol';\n            return opts;\n        })());\n        this._fixedWidth = false;\n        this._fixedHeight = false;\n        this._fixedHeight = !!opts.height;\n        this._fixedWidth = !!opts.width;\n        this.prop('pad', opts.pad || OrderedList.default.pad);\n    }\n    _addChild(w, opts = {}) {\n        w.bounds.x = this.bounds.x + 2;\n        if (!this._fixedHeight) {\n            w.bounds.y = this.bounds.bottom - 2;\n            this.bounds.height += w.bounds.height;\n        }\n        if (this._fixedWidth) {\n            w.bounds.width = Math.min(w.bounds.width, this.bounds.width - 4);\n        }\n        else if (w.bounds.width > this.bounds.width - 4) {\n            this.bounds.width = w.bounds.width + 4;\n        }\n        return super._addChild(w, opts);\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        this.children.forEach((c, i) => {\n            this._drawBulletFor(c, buffer, i);\n        });\n        return true;\n    }\n    _getBullet(index) {\n        return '' + (index + 1);\n    }\n    _drawBulletFor(widget, buffer, index) {\n        const bullet = this._getBullet(index);\n        const size = this._attrInt('pad') + bullet.length;\n        const x = widget.bounds.x - size;\n        const y = widget.bounds.y;\n        buffer.drawText(x, y, bullet, widget._used.fg, widget._used.bg, size);\n    }\n}\nOrderedList.default = {\n    pad: 1,\n};\nexport class UnorderedList extends OrderedList {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'ul';\n            return opts;\n        })());\n        this.prop('bullet', opts.bullet || UnorderedList.default.bullet);\n        this.prop('pad', opts.pad || UnorderedList.default.pad);\n    }\n    _getBullet(_index) {\n        return this._attrStr('bullet');\n    }\n}\nUnorderedList.default = {\n    bullet: '\\u2022',\n    pad: 1,\n};\nLayer.prototype.ol = function (opts = {}) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new OrderedList(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\nLayer.prototype.ul = function (opts = {}) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new UnorderedList(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../ui/layer';\nimport * as Text from './text';\nimport { installWidget } from './make';\nimport * as Style from '../ui/style';\nStyle.defaultStyle.add('input', {\n    bg: 'light_gray',\n    fg: 'black',\n    align: 'left',\n    valign: 'top',\n});\nStyle.defaultStyle.add('input:invalid', {\n    fg: 'red',\n});\nStyle.defaultStyle.add('input:empty', {\n    fg: 'darkest_green',\n});\nStyle.defaultStyle.add('input:focus', {\n    bg: 'lighter_gray',\n});\nexport class Input extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.text = opts.text || '';\n            opts.tag = opts.tag || 'input';\n            opts.tabStop = opts.tabStop === undefined ? true : opts.tabStop;\n            opts.action = opts.action || opts.id;\n            opts.width =\n                opts.width ||\n                    opts.maxLength ||\n                    Math.max(opts.minLength || 0, 10);\n            return opts;\n        })());\n        this.minLength = 0;\n        this.maxLength = 0;\n        this.numbersOnly = false;\n        this.min = 0;\n        this.max = 0;\n        this.attr('default', this._text);\n        this.attr('placeholder', opts.placeholder || Input.default.placeholder);\n        if (opts.numbersOnly) {\n            this.numbersOnly = true;\n            this.min = opts.min || 0;\n            this.max = opts.max || 0;\n        }\n        else {\n            this.minLength = opts.minLength || 0;\n            this.maxLength = opts.maxLength || 0;\n        }\n        if (opts.required) {\n            this.attr('required', true);\n            this.prop('required', true);\n        }\n        if (opts.disabled) {\n            this.attr('disabled', true);\n            this.prop('disabled', true);\n        }\n        this.prop('valid', this.isValid()); // redo b/c rules are now set\n        this.on('blur', () => this._fireEvent('change', this));\n        this.reset();\n    }\n    reset() {\n        this.text(this._attrStr('default'));\n    }\n    _setProp(name, v) {\n        super._setProp(name, v);\n        this._props.valid = this.isValid();\n    }\n    isValid() {\n        const t = this._text || '';\n        if (this.numbersOnly) {\n            const val = Number.parseInt(t);\n            if (this.min !== undefined && val < this.min)\n                return false;\n            if (this.max !== undefined && val > this.max)\n                return false;\n            return val > 0;\n        }\n        const minLength = Math.max(this.minLength, this.prop('required') ? 1 : 0);\n        return (t.length >= minLength &&\n            (!this.maxLength || t.length <= this.maxLength));\n    }\n    keypress(ev) {\n        if (!ev.key)\n            return false;\n        const textEntryBounds = this.numbersOnly ? ['0', '9'] : [' ', '~'];\n        if (ev.key === 'Enter' && this.isValid()) {\n            const action = this._attrStr('action');\n            if (action && action.length) {\n                this._fireEvent(action, this);\n            }\n            else {\n                this.layer.nextTabStop();\n            }\n            return true;\n        }\n        if (ev.key == 'Delete' || ev.key == 'Backspace') {\n            if (this._text.length) {\n                this.text(GWU.text.spliceRaw(this._text, this._text.length - 1, 1));\n                this._fireEvent('input', this);\n                this._draw(this.layer.buffer); // save some work?\n            }\n            return true;\n        }\n        else if (ev.key.length > 1) {\n            // ignore other special keys...\n            return false;\n        }\n        // eat/use all other keys\n        if (ev.key >= textEntryBounds[0] && ev.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            if (!this.maxLength || this._text.length < this.maxLength) {\n                this.text(this._text + ev.key);\n                this._fireEvent('input', this);\n                this._draw(this.layer.buffer); // save some work?\n            }\n        }\n        return true;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        super.text(v);\n        this.prop('empty', this._text.length === 0);\n        this.prop('valid', this.isValid());\n        return this;\n    }\n    _draw(buffer, _force = false) {\n        this._drawFill(buffer);\n        let vOffset = 0;\n        if (this._used.valign === 'bottom') {\n            vOffset = this.bounds.height - this._lines.length;\n        }\n        else if (this._used.valign === 'middle') {\n            vOffset = Math.floor((this.bounds.height - this._lines.length) / 2);\n        }\n        let show = this._text;\n        if (show.length == 0) {\n            show = this._attrStr('placeholder');\n        }\n        if (this._text.length > this.bounds.width) {\n            show = this._text.slice(this._text.length - this.bounds.width);\n        }\n        buffer.drawText(this.bounds.x, this.bounds.y + vOffset, show, this._used.fg, -1, this.bounds.width, this._used.align);\n        return true;\n    }\n}\nInput.default = {\n    tag: 'input',\n    width: 10,\n    placeholder: '',\n};\ninstallWidget('input', (l, opts) => new Input(l, opts));\nLayer.prototype.input = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Input(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nimport { Text } from './text';\nimport { drawBorder } from './border';\nimport { installWidget } from './make';\nimport { Layer } from '../ui/layer';\nexport class Column {\n    constructor(opts) {\n        this.format = GWU.IDENTITY;\n        this.width = opts.width || DataTable.default.columnWidth;\n        if (typeof opts.format === 'function') {\n            this.format = opts.format;\n        }\n        else if (opts.format) {\n            this.format = GWU.text.compile(opts.format);\n        }\n        this.header = opts.header || '';\n        this.headerTag = opts.headerTag || DataTable.default.headerTag;\n        this.empty = opts.empty || DataTable.default.empty;\n        this.dataTag = opts.dataTag || DataTable.default.dataTag;\n    }\n    addHeader(table, x, y, col) {\n        const t = new Text(table.layer, {\n            x,\n            y,\n            class: table.classes.join(' '),\n            tag: table._attrStr('headerTag'),\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n            text: this.header,\n        });\n        t.prop('row', -1);\n        t.prop('col', col);\n        t.setParent(table);\n        table.layer.attach(t);\n        return t;\n    }\n    addData(table, data, x, y, col, row) {\n        let text;\n        if (Array.isArray(data)) {\n            text = '' + (data[col] || this.empty);\n        }\n        else if (typeof data !== 'object') {\n            text = '' + data;\n        }\n        else {\n            text = this.format(data);\n        }\n        const widget = new TD(table.layer, {\n            text,\n            x,\n            y,\n            class: table.classes.join(' '),\n            tag: table._attrStr('dataTag'),\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n        });\n        widget.prop(row % 2 == 0 ? 'even' : 'odd', true);\n        widget.prop('row', row);\n        widget.prop('col', col);\n        widget.setParent(table);\n        table.layer.attach(widget);\n        return widget;\n    }\n    addEmpty(table, x, y, col, row) {\n        return this.addData(table, [], x, y, col, row);\n    }\n}\nColumn.default = {\n    select: 'row',\n    hover: 'select',\n    tag: 'datatable',\n    headerTag: 'th',\n    dataTag: 'td',\n    border: 'ascii',\n};\nexport class DataTable extends Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || DataTable.default.tag;\n            opts.tabStop = opts.tabStop === undefined ? true : opts.tabStop;\n            return opts;\n        })());\n        this._data = [];\n        this.columns = [];\n        this.showHeader = false;\n        this.rowHeight = 1;\n        this.selectedRow = -1;\n        this.selectedColumn = 0;\n        this.size = opts.size || layer.height;\n        this.bounds.width = 0;\n        opts.columns.forEach((o) => {\n            const col = new Column(o);\n            this.columns.push(col);\n            this.bounds.width += col.width;\n        });\n        if (opts.border) {\n            if (opts.border === true)\n                opts.border = 'ascii';\n        }\n        else if (opts.border === false) {\n            opts.border = 'none';\n        }\n        this.attr('border', opts.border || DataTable.default.border);\n        this.rowHeight = opts.rowHeight || 1;\n        this.bounds.height = 1;\n        this.attr('wrap', opts.wrap === undefined ? DataTable.default.wrap : opts.wrap);\n        this.attr('header', opts.header === undefined ? DataTable.default.header : opts.header);\n        this.attr('headerTag', opts.headerTag || DataTable.default.headerTag);\n        this.attr('dataTag', opts.dataTag || DataTable.default.dataTag);\n        this.attr('prefix', opts.prefix || DataTable.default.prefix);\n        this.attr('select', opts.select || DataTable.default.select);\n        this.attr('hover', opts.hover || DataTable.default.hover);\n        this.data(opts.data || []);\n    }\n    get selectedData() {\n        if (this.selectedRow < 0)\n            return undefined;\n        return this._data[this.selectedRow];\n    }\n    select(col, row) {\n        if (!this._data || this._data.length == 0) {\n            this.selectedRow = this.selectedColumn = 0;\n            return this;\n        }\n        if (this.attr('wrap')) {\n            if (col < 0 || col >= this.columns.length) {\n                col += this.columns.length;\n                col %= this.columns.length;\n            }\n            if (row < 0 || row >= this._data.length) {\n                row += this._data.length;\n                row %= this._data.length;\n            }\n        }\n        col = this.selectedColumn = GWU.clamp(col, 0, this.columns.length - 1);\n        row = this.selectedRow = GWU.clamp(row, 0, this._data.length - 1);\n        const select = this._attrStr('select');\n        if (select === 'none') {\n            this.children.forEach((c) => {\n                c.prop('selected', false);\n            });\n        }\n        else if (select === 'row') {\n            this.children.forEach((c) => {\n                const active = row == c.prop('row');\n                c.prop('selected', active);\n            });\n        }\n        else if (select === 'column') {\n            this.children.forEach((c) => {\n                const active = col == c.prop('col');\n                c.prop('selected', active);\n            });\n        }\n        else if (select === 'cell') {\n            this.children.forEach((c) => {\n                const active = col == c.prop('col') && row == c.prop('row');\n                c.prop('selected', active);\n            });\n        }\n        this._bubbleEvent('input', this, { row, col, data: this.selectedData });\n        return this;\n    }\n    selectNextRow() {\n        return this.select(this.selectedColumn, this.selectedRow + 1);\n    }\n    selectPrevRow() {\n        return this.select(this.selectedColumn, this.selectedRow - 1);\n    }\n    selectNextCol() {\n        return this.select(this.selectedColumn + 1, this.selectedRow);\n    }\n    selectPrevCol() {\n        return this.select(this.selectedColumn - 1, this.selectedRow);\n    }\n    blur(reverse) {\n        this._bubbleEvent('change', this, {\n            col: this.selectedColumn,\n            row: this.selectedRow,\n            data: this.selectedData,\n        });\n        return super.blur(reverse);\n    }\n    data(data) {\n        if (!data)\n            return this._data;\n        this._data = data;\n        for (let i = this.children.length - 1; i >= 0; --i) {\n            const c = this.children[i];\n            if (c.tag !== this.attr('headerTag')) {\n                this.layer.detach(c);\n            }\n        }\n        const borderAdj = this.attr('border') !== 'none' ? 1 : 0;\n        let x = this.bounds.x + borderAdj;\n        let y = this.bounds.y + borderAdj;\n        if (this.attr('header')) {\n            this.columns.forEach((col, i) => {\n                col.addHeader(this, x, y, i);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        }\n        this._data.forEach((obj, j) => {\n            if (j >= this.size)\n                return;\n            x = this.bounds.x + borderAdj;\n            this.columns.forEach((col, i) => {\n                col.addData(this, obj, x, y, i, j);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        });\n        if (this._data.length == 0) {\n            x = this.bounds.x + borderAdj;\n            this.columns.forEach((col, i) => {\n                col.addEmpty(this, x, y, i, 0);\n                x += col.width + borderAdj;\n            });\n            y += 1;\n            this.select(-1, -1);\n        }\n        else {\n            this.select(0, 0);\n        }\n        this.bounds.height = y - this.bounds.y;\n        this.bounds.width = x - this.bounds.x;\n        this.updateStyle(); // sets this.needsDraw\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        this.children.forEach((w) => {\n            if (w.prop('row') >= this.size)\n                return;\n            if (this.attr('border') !== 'none') {\n                drawBorder(buffer, w.bounds.x - 1, w.bounds.y - 1, w.bounds.width + 2, w.bounds.height + 2, this._used, this.attr('border') == 'ascii');\n            }\n        });\n        return true;\n    }\n    mouseenter(e, over) {\n        super.mouseenter(e, over);\n        if (!this.hovered)\n            return;\n        const hovered = this.children.find((c) => c.contains(e));\n        if (hovered) {\n            const col = hovered._propInt('col');\n            const row = hovered._propInt('row');\n            if (col !== this.selectedColumn || row !== this.selectedRow) {\n                this.selectedColumn = col;\n                this.selectedRow = row;\n                let select = false;\n                let hover = this._attrStr('hover');\n                if (hover === 'select') {\n                    hover = this._attrStr('select');\n                    select = true;\n                }\n                if (hover === 'none') {\n                    this.children.forEach((c) => {\n                        c.hovered = false;\n                        if (select)\n                            c.prop('selected', false);\n                    });\n                }\n                else if (hover === 'row') {\n                    this.children.forEach((c) => {\n                        const active = row == c.prop('row');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                else if (hover === 'column') {\n                    this.children.forEach((c) => {\n                        const active = col == c.prop('col');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                else if (hover === 'cell') {\n                    this.children.forEach((c) => {\n                        const active = col == c.prop('col') && row == c.prop('row');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                this._bubbleEvent('input', this, {\n                    row,\n                    col,\n                    data: this.selectedData,\n                });\n            }\n        }\n    }\n    click(e) {\n        if (!this.contains(e))\n            return false;\n        this._bubbleEvent('change', this, {\n            row: this.selectedRow,\n            col: this.selectedColumn,\n            data: this.selectedData,\n        });\n        return false;\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Enter') {\n            this._bubbleEvent('change', this, {\n                row: this.selectedRow,\n                col: this.selectedColumn,\n                data: this.selectedData,\n            });\n            return true;\n        }\n        return false;\n    }\n    dir(e) {\n        if (!e.dir)\n            return false;\n        if (e.dir[1] == 1) {\n            this.selectNextRow();\n        }\n        else if (e.dir[1] == -1) {\n            this.selectPrevRow();\n        }\n        if (e.dir[0] == 1) {\n            this.selectNextCol();\n        }\n        else if (e.dir[0] == -1) {\n            this.selectPrevCol();\n        }\n        return true;\n    }\n}\nDataTable.default = {\n    columnWidth: 10,\n    header: true,\n    empty: '-',\n    tag: 'datatable',\n    headerTag: 'th',\n    dataTag: 'td',\n    select: 'cell',\n    hover: 'select',\n    prefix: 'none',\n    border: 'ascii',\n    wrap: true,\n};\ninstallWidget('datatable', (l, opts) => new DataTable(l, opts));\nexport class TD extends Text {\n    mouseleave(e) {\n        super.mouseleave(e);\n        if (this.parent) {\n            const table = this.parent;\n            if (table.attr('select') === 'row') {\n                this.hovered = this._propInt('row') === table.selectedRow;\n            }\n            else if (table.attr('select') === 'column') {\n                this.hovered = this._propInt('col') === table.selectedColumn;\n            }\n        }\n    }\n}\nLayer.prototype.datatable = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new DataTable(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as DataTable from './datatable';\nimport { installWidget } from './make';\nimport { Layer } from '../ui/layer';\nexport class DataList extends DataTable.DataTable {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            // @ts-ignore\n            const tableOpts = opts;\n            if (opts.border !== 'none' && opts.width) {\n                opts.width -= 2;\n            }\n            tableOpts.columns = [Object.assign({}, opts)];\n            if (!opts.header || !opts.header.length) {\n                tableOpts.header = false;\n            }\n            return tableOpts;\n        })());\n    }\n}\ninstallWidget('list', (l, opts) => new DataList(l, opts));\nLayer.prototype.datalist = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new DataList(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\n// import * as Button from './button';\nimport * as Text from './text';\nimport { Layer } from '../ui/layer';\nimport { installWidget } from './make';\nexport class Menu extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Menu.default.tag;\n            opts.class = opts.class || Menu.default.class;\n            return opts;\n        })());\n        if (Array.isArray(opts.buttonClass)) {\n            this.attr('buttonClass', opts.buttonClass.join(' '));\n        }\n        else {\n            this.attr('buttonClass', opts.buttonClass || Menu.default.buttonClass);\n        }\n        this.attr('buttonTag', opts.buttonTag || Menu.default.buttonTag);\n        this.attr('marker', opts.marker || Menu.default.marker);\n        this._initButtons(opts);\n        this.bounds.height = this.children.length;\n        this.on('mouseenter', (_n, _w, e) => {\n            this.children.forEach((c) => {\n                if (!c.contains(e)) {\n                    c.collapse();\n                }\n                else {\n                    c.expand();\n                }\n            });\n            return true;\n        });\n    }\n    _initButtons(opts) {\n        this.children = [];\n        const buttons = opts.buttons;\n        const marker = this._attrStr('marker');\n        const entries = Object.entries(buttons);\n        if (this.bounds.width <= 0) {\n            this.bounds.width = Math.max(opts.minWidth || 0, entries.reduce((out, [key, value]) => {\n                const textLen = GWU.text.length(key) +\n                    (typeof value === 'string' ? 0 : marker.length);\n                return Math.max(out, textLen);\n            }, 0));\n        }\n        entries.forEach(([key, value], i) => {\n            const opts = {\n                x: this.bounds.x,\n                y: this.bounds.y + i,\n                class: this._attrStr('buttonClass'),\n                tag: this._attrStr('buttonTag'),\n                width: this.bounds.width,\n                height: 1,\n                depth: this.depth + 1,\n                buttons: value,\n                text: key,\n            };\n            if (typeof value === 'string') {\n                opts.action = value;\n            }\n            else {\n                opts.text =\n                    GWU.text.padEnd(key, this.bounds.width - marker.length, ' ') + marker;\n            }\n            const menuItem = new MenuButton(this.layer, opts);\n            menuItem.setParent(this);\n            menuItem.on('mouseenter', () => {\n                this._bubbleEvent('change', menuItem);\n                return false;\n            });\n            menuItem.setParent(this);\n        });\n    }\n    collapse() {\n        this.children.forEach((c) => {\n            c.collapse();\n        });\n        return this;\n    }\n}\nMenu.default = {\n    tag: 'menu',\n    class: '',\n    buttonClass: '',\n    buttonTag: 'mi',\n    marker: ' \\u25b6',\n    minWidth: 4,\n};\nexport class MenuButton extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'mi';\n            return opts;\n        })());\n        this.menu = null;\n        this.tag = opts.tag || 'mi';\n        if (typeof opts.buttons !== 'string') {\n            this.menu = this._initMenu(opts);\n            this.on('mouseenter', () => {\n                this.menu.hidden = false;\n                this.menu._bubbleEvent('change', this);\n                return true;\n            });\n            this.on('mouseleave', (_n, _w, e) => {\n                var _a;\n                if ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.contains(e)) {\n                    this.menu.hidden = true;\n                    return true;\n                }\n                return false;\n            });\n            this.on('click', () => {\n                return true; // eat clicks\n            });\n        }\n    }\n    collapse() {\n        if (this.menu) {\n            this.menu.collapse();\n            this.menu.hidden = true;\n        }\n        return this;\n    }\n    expand() {\n        if (this.menu) {\n            this.menu.hidden = false;\n        }\n        return this;\n    }\n    _setMenuPos(xy, opts) {\n        xy.x = this.bounds.x + this.bounds.width;\n        xy.y = this.bounds.y;\n        const height = Object.keys(opts.buttons).length;\n        if (xy.y + height >= this.layer.height) {\n            xy.y = this.layer.height - height - 1;\n        }\n    }\n    _initMenu(opts) {\n        if (typeof opts.buttons === 'string')\n            return null;\n        const menuOpts = {\n            x: this.bounds.x + this.bounds.width,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'mi',\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        };\n        this._setMenuPos(menuOpts, opts);\n        const menu = new Menu(this.layer, menuOpts);\n        menu.hidden = true;\n        menu.setParent(this);\n        return menu;\n    }\n}\ninstallWidget('menu', (l, opts) => new Menu(l, opts));\nLayer.prototype.menu = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Menu(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as Widget from './widget';\nimport { Layer } from '../ui/layer';\nimport { installWidget } from './make';\nimport { Menu } from './menu';\nimport * as Text from './text';\nexport class Menubar extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tabStop = true;\n            opts.tag = opts.tag || 'menu';\n            return opts;\n        })());\n        this._buttons = [];\n        this._selectedIndex = -1;\n        if (opts.buttonClass) {\n            if (Array.isArray(opts.buttonClass)) {\n                this.attr('buttonClass', opts.buttonClass.join(' '));\n            }\n            else {\n                this.attr('buttonClass', opts.buttonClass);\n            }\n        }\n        else {\n            this.attr('buttonClass', Menubar.default.buttonClass);\n        }\n        this.attr('buttonTag', opts.buttonTag || Menubar.default.buttonTag);\n        if (opts.menuClass) {\n            if (Array.isArray(opts.menuClass)) {\n                this.attr('menuClass', opts.menuClass.join(' '));\n            }\n            else {\n                this.attr('menuClass', opts.menuClass);\n            }\n        }\n        else {\n            this.attr('menuClass', Menubar.default.menuClass);\n        }\n        this.attr('menuTag', opts.menuTag || Menubar.default.menuTag);\n        this.attr('prefix', opts.prefix || Menubar.default.prefix);\n        this.attr('separator', opts.separator || Menubar.default.separator);\n        this._initButtons(opts);\n        this.on('click', this._buttonClick.bind(this));\n    }\n    get selectedIndex() {\n        return this._selectedIndex;\n    }\n    set selectedIndex(v) {\n        if (this._selectedIndex >= 0) {\n            this._buttons[this._selectedIndex].prop('focus', false).collapse();\n        }\n        this._selectedIndex = v;\n        if (v >= 0 && v < this._buttons.length) {\n            this._buttons[v].prop('focus', true).expand();\n        }\n        else {\n            this._selectedIndex = -1;\n        }\n    }\n    get selectedButton() {\n        return this._buttons[this._selectedIndex];\n    }\n    focus(reverse = false) {\n        if (reverse) {\n            this.selectedIndex = this._buttons.length - 1;\n        }\n        else {\n            this.selectedIndex = 0;\n        }\n        return super.focus(reverse);\n    }\n    blur(reverse = false) {\n        this.selectedIndex = -1;\n        return super.blur(reverse);\n    }\n    collapse() {\n        return this._buttons.reduce((out, b) => b.collapse() || out, false);\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (!this.focused)\n            return false;\n        if (e.key === 'Tab') {\n            this.selectedIndex += 1;\n            return this._selectedIndex >= 0;\n        }\n        else if (e.key === 'TAB') {\n            this.selectedIndex -= 1;\n            return this._selectedIndex >= 0;\n        }\n        return false;\n    }\n    mousemove(e) {\n        if (!this.contains(e) || !this.focused)\n            return super.mousemove(e);\n        const active = this._buttons.findIndex((c) => c.contains(e));\n        if (active < 0 || active === this._selectedIndex)\n            return false;\n        this.selectedIndex = active;\n        return true;\n    }\n    _initButtons(opts) {\n        this._config = opts.buttons;\n        const entries = Object.entries(this._config);\n        const buttonTag = this._attrStr('buttonTag');\n        const buttonClass = this._attrStr('buttonClass');\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        entries.forEach(([key, value], i) => {\n            const prefix = i == 0 ? this._attrStr('prefix') : this._attrStr('separator');\n            this.layer.text(prefix, { x, y, parent: this });\n            x += prefix.length;\n            const button = new MenubarButton(this.layer, {\n                text: key,\n                x,\n                y,\n                tag: buttonTag,\n                class: buttonClass,\n                depth: this.depth + 1,\n                buttons: value,\n                // data: value,\n            });\n            button.setParent(this);\n            this._buttons.push(button);\n            x += button.bounds.width;\n        });\n    }\n    _buttonClick(_action, button) {\n        if (!button)\n            return false;\n        this.layer.setFocusWidget(this);\n        console.log('clicked = ' + button.text(), button._attrStr('action'));\n        const barButton = button;\n        this.selectedIndex = this._buttons.indexOf(barButton);\n        if (barButton.menu) {\n            barButton.expand();\n        }\n        else {\n            this.collapse();\n        }\n        return true;\n    }\n}\nMenubar.default = {\n    buttonClass: '',\n    buttonTag: 'mi',\n    menuClass: '',\n    menuTag: 'mi',\n    prefix: ' ',\n    separator: ' | ',\n};\ninstallWidget('menubar', (l, opts) => new Menubar(l, opts));\nexport class MenubarButton extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'mi';\n            if (typeof opts.buttons === 'string') {\n                opts.action = opts.buttons;\n            }\n            return opts;\n        })());\n        this.menu = null;\n        this.tag = opts.tag || 'mi';\n        if (typeof opts.buttons !== 'string') {\n            this.menu = this._initMenu(opts);\n            this.on('mouseenter', () => {\n                this.menu.hidden = false;\n                this.menu._bubbleEvent('change', this);\n                return true;\n            });\n            this.on('mouseleave', (_n, _w, e) => {\n                var _a;\n                if ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.contains(e)) {\n                    this.menu.hidden = true;\n                    return true;\n                }\n                return false;\n            });\n            this.on('click', () => {\n                return true; // eat clicks\n            });\n        }\n    }\n    collapse() {\n        if (!this.menu || this.menu.hidden)\n            return false;\n        this.menu.collapse();\n        this.menu.hidden = true;\n        return true;\n    }\n    expand() {\n        if (this.menu) {\n            this.menu.hidden = false;\n        }\n        return this;\n    }\n    _setMenuPos(xy, opts) {\n        xy.x = this.bounds.x;\n        const height = opts.height || Object.keys(opts.buttons).length;\n        if (this.bounds.y < height) {\n            xy.y = this.bounds.y + 1;\n        }\n        else {\n            xy.y = this.bounds.top - height;\n        }\n    }\n    _initMenu(opts) {\n        if (typeof opts.buttons === 'string')\n            return null;\n        const menuOpts = {\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'mi',\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        };\n        this._setMenuPos(menuOpts, opts);\n        const menu = new Menu(this.layer, menuOpts);\n        menu.hidden = true;\n        menu.setParent(this);\n        return menu;\n    }\n}\nLayer.prototype.menubar = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const menubar = new Menubar(this, options);\n    if (opts.parent) {\n        menubar.setParent(opts.parent, opts);\n    }\n    return menubar;\n};\n// MENU\nexport class MenuViewer extends Widget.Widget {\n    constructor(menubar, buttons) {\n        super(menubar.layer, {\n            tabStop: true,\n            x: 0,\n            y: 0,\n            width: menubar.layer.width,\n            height: menubar.layer.height,\n            // @ts-ignore\n            tag: menubar.attr('menuTag'),\n            // @ts-ignore\n            class: menubar.attr('menuClass'),\n        });\n        this.menubar = menubar;\n        this.mainMenu = this._initMenu(buttons);\n    }\n    contains() {\n        return true;\n    }\n    finish() {\n        this.layer.finish();\n    }\n    _initMenu(buttons) {\n        return new Menu(this.layer, {\n            buttonTag: this.menubar._attrStr('buttonTag'),\n            buttonClass: this.menubar._attrStr('buttonClass'),\n            minWidth: this.menubar.selectedButton.bounds.width,\n            buttons,\n        });\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Escape') {\n            this.finish();\n            return true;\n        }\n        else if (e.key === 'Tab') {\n            this.finish();\n            this.menubar.keypress(e);\n            return true;\n        }\n        else if (e.key === 'TAB') {\n            this.finish();\n            this.menubar.keypress(e);\n            return true;\n        }\n        return false;\n    }\n}\n","// import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nimport * as Menu from './menu';\nimport * as Text from './text';\nimport { Layer } from '../ui/layer';\nimport { installWidget } from './make';\nexport class Select extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.tag = opts.tag || 'select';\n        this._initText(opts);\n        this._initMenu(opts);\n        this.bounds.height = 1; // just the text component\n    }\n    _initText(opts) {\n        this.dropdown = new Text.Text(this.layer, {\n            text: opts.text + ' \\u25bc',\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'select',\n            width: this.bounds.width,\n            height: 1,\n            depth: this.depth + 1,\n        }).on('click', () => {\n            this.menu.toggleProp('hidden');\n            return false;\n        });\n        this.dropdown.setParent(this, { beforeIndex: 0 });\n    }\n    _initMenu(opts) {\n        this.menu = new Menu.Menu(this.layer, {\n            x: this.bounds.x,\n            y: this.bounds.y + 1,\n            class: opts.buttonClass,\n            tag: opts.buttonTag || 'select',\n            width: opts.width,\n            minWidth: this.dropdown.bounds.width,\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        }).on('click', () => {\n            this.menu.hidden = true;\n            return false;\n        });\n        this.menu.hidden = true;\n        this.menu.setParent(this);\n    }\n}\ninstallWidget('select', (l, opts) => new Select(l, opts));\nLayer.prototype.select = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Select(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../ui/layer';\nimport * as Text from './text';\nimport * as Widget from './widget';\nimport { drawBorder } from './border';\nimport { DataList } from './datalist';\nexport class Prompt {\n    constructor(question, field = {}) {\n        this._id = null;\n        this._defaultNext = null;\n        this.selection = -1;\n        if (typeof field === 'string') {\n            field = { field };\n        }\n        this._prompt = question;\n        this._field = field.field || '';\n        this._choices = [];\n        this._infos = [];\n        this._values = [];\n        this._next = [];\n        this._defaultNext = field.next || null;\n        this._id = field.id || field.field || '';\n    }\n    reset() {\n        this.selection = -1;\n    }\n    field(v) {\n        if (v === undefined)\n            return this._field;\n        this._field = v;\n        return this;\n    }\n    id(v) {\n        if (v === undefined)\n            return this._id;\n        this._id = v;\n        return this;\n    }\n    prompt(arg) {\n        if (typeof this._prompt === 'string')\n            return this._prompt;\n        return this._prompt(arg);\n    }\n    next(v) {\n        if (v === undefined)\n            return this._next[this.selection] || this._defaultNext;\n        this._defaultNext = v;\n        return this;\n    }\n    choices(choice, info) {\n        if (choice === undefined)\n            return this._choices;\n        if (!Array.isArray(choice)) {\n            info = Object.values(choice);\n            choice = Object.keys(choice);\n        }\n        else if (!Array.isArray(info)) {\n            info = new Array(choice.length).fill('');\n        }\n        info = info.map((i) => {\n            if (typeof i === 'string')\n                return { info: i };\n            return i;\n        });\n        if (choice.length !== info.length)\n            throw new Error('Choices and Infos must have same length.');\n        choice.forEach((c, i) => {\n            this.choice(c, info[i]);\n        });\n        return this;\n    }\n    choice(choice, info = {}) {\n        if (typeof info === 'string') {\n            info = { info: info };\n        }\n        this._choices.push(choice);\n        this._infos.push(info.info || '');\n        this._next.push(info.next || null);\n        this._values.push(info.value || choice);\n        return this;\n    }\n    info(arg) {\n        const i = this._infos[this.selection] || '';\n        if (typeof i === 'string')\n            return i;\n        return i(arg);\n    }\n    choose(n) {\n        this.selection = n;\n        return this;\n    }\n    value() {\n        return this._values[this.selection];\n    }\n    updateResult(res) {\n        if (this.selection < 0)\n            return this;\n        res[this._field] = this.value();\n        return this;\n    }\n}\nexport class Choice extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Choice.default.tag;\n            return opts;\n        })());\n        this._prompt = null;\n        this._done = null;\n        this.choiceWidth = opts.choiceWidth;\n        this.attr('border', opts.border || Choice.default.border);\n        this.attr('promptTag', opts.promptTag || Choice.default.promptTag);\n        this.attr('promptClass', opts.promptClass || Choice.default.promptClass);\n        this.attr('choiceTag', opts.choiceTag || Choice.default.choiceTag);\n        this.attr('choiceClass', opts.choiceClass || Choice.default.choiceClass);\n        this.attr('infoTag', opts.infoTag || Choice.default.infoTag);\n        this.attr('infoClass', opts.infoClass || Choice.default.infoClass);\n        this._addLegend();\n        this._addList();\n        this._addInfo();\n        if (opts.prompt) {\n            this.showPrompt(opts.prompt);\n        }\n    }\n    showPrompt(prompt, arg) {\n        this._prompt = prompt;\n        prompt.choose(0);\n        this.prompt.text(prompt.prompt(arg));\n        this.list.data(prompt.choices());\n        this.info.text(prompt.info(arg));\n        this._bubbleEvent('input', this, this._prompt);\n        return new Promise((resolve) => (this._done = resolve));\n    }\n    _addList() {\n        this.list = new DataList(this.layer, {\n            height: this.bounds.height - 2,\n            x: this.bounds.x + 1,\n            width: this.choiceWidth,\n            y: this.bounds.y + 1,\n            dataTag: this._attrStr('choiceTag'),\n            dataClass: this._attrStr('choiceClass'),\n            tabStop: true,\n            border: 'none',\n            hover: 'select',\n        });\n        this.list.setParent(this);\n        this.list.on('input', () => {\n            if (!this._prompt)\n                return false;\n            const p = this._prompt;\n            const row = this.list.selectedRow;\n            p.choose(row);\n            this.info.text(p.info());\n            this._bubbleEvent('input', this, p);\n            return true; // I want to eat this event\n        });\n        this.list.on('change', () => {\n            if (!this._prompt)\n                return false;\n            const p = this._prompt;\n            p.choose(this.list.selectedRow);\n            this._bubbleEvent('change', this, p);\n            this._done(p.value());\n            return true; // eat this event\n        });\n        return this;\n    }\n    _addInfo() {\n        this.info = new Text.Text(this.layer, {\n            text: '',\n            x: this.bounds.x + this.choiceWidth + 2,\n            y: this.bounds.y + 1,\n            width: this.bounds.width - this.choiceWidth - 3,\n            height: this.bounds.height - 2,\n            tag: this._attrStr('infoTag'),\n            class: this._attrStr('infoClass'),\n        });\n        this.info.setParent(this);\n        return this;\n    }\n    _addLegend() {\n        this.prompt = new Text.Text(this.layer, {\n            text: '',\n            width: this.bounds.width - 4,\n            x: this.bounds.x + 2,\n            y: this.bounds.y,\n            tag: this._attrStr('promptTag'),\n            class: this._attrStr('promptClass'),\n        });\n        this.prompt.setParent(this);\n        return this;\n    }\n    _draw(buffer) {\n        let w = this.choiceWidth + 2;\n        const h = this.bounds.height;\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        const ascii = this.attr('border') === 'ascii';\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        w = this.bounds.width - this.choiceWidth - 1;\n        x = this.bounds.x + this.choiceWidth + 1;\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        return true;\n    }\n}\nChoice.default = {\n    tag: 'choice',\n    border: 'ascii',\n    promptTag: 'prompt',\n    promptClass: '',\n    choiceTag: 'ci',\n    choiceClass: '',\n    infoTag: 'info',\n    infoClass: '',\n};\nLayer.prototype.choice = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Choice(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n////////////////////////////////////////////////////////////////////////////////\n// INQUIRY\nexport class Inquiry {\n    constructor(widget) {\n        this._prompts = [];\n        this.events = {};\n        this._result = {};\n        this._stack = [];\n        this._current = null;\n        this.widget = widget;\n        this._keypress = this._keypress.bind(this);\n        this._change = this._change.bind(this);\n    }\n    prompts(v, ...args) {\n        if (Array.isArray(v)) {\n            this._prompts = v.slice();\n        }\n        else {\n            args.unshift(v);\n            this._prompts = args;\n        }\n        return this;\n    }\n    _finish() {\n        this.widget.off('keypress', this._keypress);\n        this.widget.off('change', this._change);\n        this._fireEvent('finish', this.widget, this._result);\n    }\n    _cancel() {\n        this.widget.off('keypress', this._keypress);\n        this.widget.off('change', this._change);\n        this._fireEvent('cancel', this.widget);\n    }\n    start() {\n        this._current = this._prompts[0];\n        this._result = {};\n        this.widget.on('keypress', this._keypress);\n        this.widget.on('change', this._change);\n        this.widget.showPrompt(this._current, this._result);\n    }\n    back() {\n        this._current.reset();\n        this._current = this._stack.pop() || null;\n        if (!this._current) {\n            this._cancel();\n        }\n        else {\n            this._current.reset(); // also reset the one we are going back to\n            this._result = {};\n            this._prompts.forEach((p) => p.updateResult(this._result));\n            this.widget.showPrompt(this._current, this._result);\n        }\n    }\n    restart() {\n        this._prompts.forEach((p) => p.reset());\n        this._result = {};\n        this._current = this._prompts[0];\n        this.widget.showPrompt(this._current, this._result);\n    }\n    quit() {\n        this._cancel();\n    }\n    _keypress(_n, _w, e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Escape') {\n            this.back();\n            return true;\n        }\n        else if (e.key === 'R') {\n            this.restart();\n            return true;\n        }\n        else if (e.key === 'Q') {\n            this.quit();\n            return true;\n        }\n        return false;\n    }\n    _change(_n, _w, p) {\n        p.updateResult(this._result);\n        const next = p.next();\n        if (next) {\n            this._current = this._prompts.find((p) => p.id() === next) || null;\n            if (this._current) {\n                this._stack.push(p);\n                this.widget.showPrompt(this._current, this._result);\n                this._fireEvent('step', this.widget, {\n                    prompt: this._current,\n                    data: this._result,\n                });\n                return true;\n            }\n        }\n        this._finish();\n        return true;\n    }\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    _fireEvent(name, source, args) {\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source || this.widget, args) || out, false);\n        if (!handled) {\n            handled = this.widget._bubbleEvent(name, source || this.widget, args);\n        }\n        return handled;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from '../widget';\nexport class Messages extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'messages';\n            return opts;\n        })());\n        if (!this.bounds.height)\n            throw new Error('Must provde a height for messages widget.');\n        this.cache = new GWU.message.MessageCache({\n            width: this.bounds.width,\n            length: opts.length || 40,\n            match: (_x, _y) => {\n                this.layer.needsDraw = true;\n                return true;\n            },\n        });\n    }\n    click(e) {\n        if (!this.contains(e))\n            return false;\n        this.showArchive();\n        return true;\n    }\n    draw(buffer) {\n        const isOnTop = this.bounds.y < 10;\n        // black out the message area\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this._used.bg, this._used.bg);\n        this.cache.forEach((line, confirmed, i) => {\n            if (i >= this.bounds.height)\n                return;\n            const localY = isOnTop ? this.bounds.height - i - 1 : i;\n            const y = localY + this.bounds.y;\n            buffer.drawText(this.bounds.x, y, line, this._used.fg);\n            if (confirmed && this._used.bg) {\n                buffer.mix(this._used.bg, 50, this.bounds.x, y, this.bounds.width, 1);\n            }\n        });\n        return true;\n    }\n    showArchive() {\n        if (this.cache.length <= this.bounds.height)\n            return;\n        const layer = this.layer.ui.startNewLayer();\n        // @ts-ignore\n        const w = new MessageArchive(layer, this);\n    }\n}\nexport class MessageArchive extends Widget.Widget {\n    constructor(layer, source) {\n        super(layer, {\n            id: 'ARCHIVE',\n            tag: 'messages',\n            class: source.classes.concat('archive').join(' '),\n            height: source.bounds.height,\n            width: source.bounds.width,\n            x: 0,\n            y: 0,\n            tabStop: true,\n            depth: 100, // I'm on top\n        });\n        this.mode = 'forward';\n        this.source = source;\n        this.isOnTop = this.source.bounds.y < 10;\n        this.bounds.height = this.isOnTop\n            ? layer.height - source.bounds.y\n            : source.bounds.bottom;\n        this.totalCount = Math.min(source.cache.length, this.isOnTop\n            ? layer.height - this.source.bounds.top\n            : this.source.bounds.bottom);\n        this.shown = source.bounds.height;\n        this.layer.on('FORWARD', this._forward.bind(this));\n        this.layer.on('REVERSE', this._reverse.bind(this));\n        this.layer.setTimeout('FORWARD', 16);\n        // confirm them as they are right now...\n        this.source.cache.confirmAll();\n    }\n    contains() {\n        return true; // Eat all mouse activity\n    }\n    finish() {\n        this.layer.finish();\n    }\n    keypress(_e) {\n        if (this.mode === 'ack') {\n            this.mode = 'reverse';\n            this.layer.needsDraw = true;\n            this.layer.setTimeout('REVERSE', 16);\n        }\n        else if (this.mode === 'reverse') {\n            this.finish();\n            return true;\n        }\n        else {\n            this.mode = 'ack';\n            this.shown = this.totalCount;\n            this.layer.clearTimeout('FORWARD');\n            this.layer.needsDraw = true;\n        }\n        return true; // eat all events\n    }\n    click(_e) {\n        if (this.mode === 'ack') {\n            this.mode = 'reverse';\n            this.layer.needsDraw = true;\n            this.layer.setTimeout('REVERSE', 16);\n        }\n        else if (this.mode === 'reverse') {\n            this.finish();\n        }\n        else {\n            this.mode = 'ack';\n            this.shown = this.totalCount;\n            this.layer.needsDraw = true;\n        }\n        return true;\n    }\n    _forward() {\n        ++this.shown;\n        this.layer.needsDraw = true;\n        if (this.shown < this.totalCount) {\n            this.layer.setTimeout('FORWARD', 16);\n        }\n        else {\n            this.mode = 'ack';\n            this.shown = this.totalCount;\n        }\n        return true;\n    }\n    _reverse() {\n        --this.shown;\n        if (this.shown <= this.source.bounds.height) {\n            this.finish();\n        }\n        else {\n            this.layer.needsDraw = true;\n            this.layer.setTimeout('REVERSE', 16);\n        }\n        return true;\n    }\n    _draw(buffer) {\n        let fadePercent = 0;\n        // let reverse = this.mode === 'reverse';\n        // Count the number of lines in the archive.\n        // let totalMessageCount = this.totalCount;\n        const isOnTop = this.isOnTop;\n        const dbuf = buffer;\n        const fg = GWU.color.from(this.source._used.fg);\n        // const dM = reverse ? -1 : 1;\n        // const startM = reverse ? totalMessageCount : this.bounds.height;\n        // const endM = reverse\n        //     ? this.bounds.height + dM + 1\n        //     : totalMessageCount + dM;\n        const startY = isOnTop\n            ? this.shown - 1\n            : this.bounds.bottom - this.shown;\n        const endY = isOnTop ? 0 : this.bounds.bottom - 1;\n        const dy = isOnTop ? -1 : 1;\n        dbuf.fillRect(this.source.bounds.x, Math.min(startY, endY), this.bounds.width, this.shown, ' ', this._used.bg, this._used.bg);\n        this.source.cache.forEach((line, _confirmed, j) => {\n            const y = startY + j * dy;\n            if (isOnTop) {\n                if (y < endY)\n                    return;\n            }\n            else if (y > endY)\n                return;\n            fadePercent = Math.floor((50 * j) / this.shown);\n            const fgColor = fg.mix(this._used.bg, fadePercent);\n            dbuf.drawText(this.source.bounds.x, y, line, fgColor, this._used.bg);\n        });\n        if (this.mode === 'ack') {\n            const y = this.isOnTop ? 0 : dbuf.height - 1;\n            const x = this.source.bounds.x > 8\n                ? this.source.bounds.x - 8 // to left of box\n                : Math.min(this.source.bounds.x + this.bounds.width, // just to right of box\n                dbuf.width - 8 // But definitely on the screen - overwrite some text if necessary\n                );\n            dbuf.wrapText(x, y, 8, '--DONE--', this._used.bg, this._used.fg);\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from '../widget';\nGWU.color.install('flavorText', 50, 40, 90);\nGWU.color.install('flavorPrompt', 100, 90, 20);\nexport class Flavor extends Widget.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'flavor';\n            opts.text = '';\n            return opts;\n        })());\n        this.overflow = opts.overflow || false;\n        this.isPrompt = false;\n    }\n    showText(text) {\n        this.text(text);\n        this.removeClass('prompt');\n        return this;\n    }\n    clear() {\n        this.text('');\n        this.removeClass('prompt');\n        return this;\n    }\n    showPrompt(text) {\n        this.showText(text);\n        this.addClass('prompt');\n        return this;\n    }\n    getFlavorText(map, x, y, fov) {\n        const cell = map.cell(x, y); // KNOWLEDGE / MEMORY !!!\n        let buf;\n        // let magicItem;\n        // let standsInTerrain;\n        // let subjectMoving;\n        // let prepositionLocked = false;\n        // let subject;\n        // let verb;\n        // let preposition;\n        let object = '';\n        // let adjective;\n        const isAnyKindOfVisible = fov ? fov.isAnyKindOfVisible(x, y) : true;\n        const isDirectlyVisible = fov ? fov.isDirectlyVisible(x, y) : true;\n        const isRemembered = fov ? fov.isRevealed(x, y) : false;\n        const isMapped = fov ? fov.isMagicMapped(x, y) : false;\n        let intro;\n        if (isDirectlyVisible) {\n            intro = 'You see';\n        }\n        else if (isAnyKindOfVisible) {\n            intro = 'You sense';\n        }\n        else if (isRemembered) {\n            intro = 'You remember';\n        }\n        else if (isMapped) {\n            intro = 'You expect to see';\n        }\n        else {\n            return '';\n        }\n        const actor = cell.hasActor() ? map.actorAt(x, y) : null;\n        // const player = actor?.isPlayer() ? actor : null;\n        const theItem = cell.hasItem() ? map.itemAt(x, y) : null;\n        const standsInTile = cell.hasTileFlag(GWM.flags.Tile.T_STAND_IN_TILE);\n        let needObjectArticle = false;\n        if (actor) {\n            object = actor.getFlavor({\n                color: false,\n                article: true,\n                action: true,\n            });\n            needObjectArticle = true;\n        }\n        else if (theItem) {\n            object = theItem.getFlavor({ color: false, article: true });\n            needObjectArticle = true;\n        }\n        let article = standsInTile ? ' in ' : ' on ';\n        const groundTile = cell.depthTile(GWM.flags.Depth.GROUND) || GWM.tile.tiles.NULL;\n        const surfaceTile = cell.depthTile(GWM.flags.Depth.SURFACE);\n        const liquidTile = cell.depthTile(GWM.flags.Depth.LIQUID);\n        // const gasTile = cell.depthTile(GWM.flags.Depth.GAS);\n        let surface = '';\n        if (surfaceTile) {\n            const tile = surfaceTile;\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' on ';\n            }\n            if (tile.hasTileFlag(GWM.flags.Tile.T_BRIDGE)) {\n                article = ' over ';\n            }\n            surface = surfaceTile.getFlavor() + article;\n        }\n        let liquid = '';\n        if (liquidTile) {\n            liquid = liquidTile.getFlavor() + ' covering ';\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' in ';\n            }\n        }\n        if (needObjectArticle) {\n            needObjectArticle = false;\n            object += ' on ';\n        }\n        let ground = groundTile.getFlavor({ article: true });\n        buf = GWU.text.apply('intro text.', {\n            intro,\n            text: object + surface + liquid + ground,\n        });\n        return buf;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from '../widget';\nGWU.color.install('blueBar', 15, 10, 50);\nGWU.color.install('redBar', 45, 10, 15);\nGWU.color.install('purpleBar', 50, 0, 50);\nGWU.color.install('greenBar', 10, 50, 10);\nexport class EntryBase {\n    constructor() {\n        this.dist = 0;\n        this.priority = 0;\n        this.changed = false;\n        this.sidebarY = -1;\n    }\n    draw(_buffer, _bounds) {\n        return 0;\n    }\n}\nexport class ActorEntry extends EntryBase {\n    constructor(actor) {\n        super();\n        this.actor = actor;\n    }\n    get x() {\n        return this.actor.x;\n    }\n    get y() {\n        return this.actor.y;\n    }\n    draw(buffer, bounds) {\n        return this.actor.drawStatus(buffer, bounds);\n    }\n}\nexport class ItemEntry extends EntryBase {\n    constructor(item) {\n        super();\n        this.item = item;\n    }\n    get x() {\n        return this.item.x;\n    }\n    get y() {\n        return this.item.y;\n    }\n    draw(buffer, bounds) {\n        return this.item.drawStatus(buffer, bounds);\n    }\n}\nexport class CellEntry extends EntryBase {\n    constructor(cell) {\n        super();\n        this.cell = cell;\n    }\n    get x() {\n        return this.cell.x;\n    }\n    get y() {\n        return this.cell.y;\n    }\n    draw(buffer, bounds) {\n        return this.cell.drawStatus(buffer, bounds);\n    }\n}\nexport class Sidebar extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.cellCache = [];\n        this.lastX = -1;\n        this.lastY = -1;\n        this.lastMap = null;\n        this.entries = [];\n        this.subject = null;\n        this.highlight = null;\n    }\n    reset() {\n        this.lastMap = null;\n        this.lastX = -1;\n        this.lastY = -1;\n    }\n    entryAt(e) {\n        return (this.entries.find((entry) => {\n            return entry.sidebarY <= e.y && entry.sidebarY !== -1;\n        }) || null);\n    }\n    mousemove(e) {\n        super.mousemove(e);\n        if (this.contains(e)) {\n            return this.highlightRow(e.y);\n        }\n        return this.clearHighlight();\n    }\n    highlightRow(y) {\n        const last = this.highlight;\n        this.highlight = null;\n        // processed in ascending y order\n        this.entries.forEach((e) => {\n            if (e.sidebarY <= y && e.sidebarY !== -1) {\n                this.highlight = e;\n            }\n        });\n        return this.highlight !== last;\n    }\n    clearHighlight() {\n        const result = !!this.highlight;\n        this.highlight = null;\n        return result;\n    }\n    updateCellCache(map) {\n        if (this.lastMap &&\n            map === this.lastMap &&\n            !map.hasMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED)) {\n            return;\n        }\n        this.lastMap = null; // Force us to regather the entries, even if at same location\n        this.cellCache.length = 0;\n        GWU.xy.forRect(map.width, map.height, (x, y) => {\n            const info = map.cell(x, y);\n            if (info.hasEntityFlag(GWM.flags.Entity.L_LIST_IN_SIDEBAR)) {\n                this.cellCache.push(info);\n            }\n        });\n        map.clearMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED);\n    }\n    _makeActorEntry(actor) {\n        return new ActorEntry(actor);\n    }\n    _makeItemEntry(item) {\n        return new ItemEntry(item);\n    }\n    _makeCellEntry(cell) {\n        return new CellEntry(cell);\n    }\n    _getPriority(map, x, y, fov) {\n        if (!fov) {\n            return map.cell(x, y).hasCellFlag(GWM.flags.Cell.STABLE_MEMORY)\n                ? 3\n                : 1;\n        }\n        if (fov.isDirectlyVisible(x, y)) {\n            return 1;\n        }\n        else if (fov.isAnyKindOfVisible(x, y)) {\n            return 2;\n        }\n        else if (fov.isRevealed(x, y)) {\n            return 3;\n        }\n        return -1; // not visible, or revealed\n    }\n    _isDim(entry) {\n        if (entry === this.highlight)\n            return false;\n        return entry.priority > 2 || !!this.highlight;\n    }\n    _addActorEntry(actor, map, x, y, fov) {\n        const priority = this._getPriority(map, actor.x, actor.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeActorEntry(actor);\n        entry.dist = GWU.xy.distanceBetween(x, y, actor.x, actor.y);\n        entry.priority = actor.isPlayer() ? 0 : priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addItemEntry(item, map, x, y, fov) {\n        const priority = this._getPriority(map, item.x, item.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeItemEntry(item);\n        entry.dist = GWU.xy.distanceBetween(x, y, item.x, item.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addCellEntry(cell, map, x, y, fov) {\n        const priority = this._getPriority(map, cell.x, cell.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeCellEntry(cell);\n        entry.dist = GWU.xy.distanceBetween(x, y, cell.x, cell.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    findEntries(map, cx, cy, fov) {\n        if (map === this.lastMap && cx === this.lastX && cy === this.lastY)\n            return;\n        this.clearHighlight(); // If we are moving around the map, then turn off the highlight\n        this.lastMap = map;\n        this.lastX = cx;\n        this.lastY = cy;\n        this.entries.length = 0;\n        const done = GWU.grid.alloc(map.width, map.height);\n        map.eachActor((a) => {\n            const x = a.x;\n            const y = a.y;\n            if (done[x][y])\n                return;\n            if (this._addActorEntry(a, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        map.eachItem((i) => {\n            const x = i.x;\n            const y = i.y;\n            if (done[x][y])\n                return;\n            if (this._addItemEntry(i, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        this.cellCache.forEach((c) => {\n            if (done[c.x][c.y])\n                return;\n            if (this._addCellEntry(c, map, cx, cy, fov)) {\n                done[c.x][c.y] = 1;\n            }\n        });\n        this.entries.sort((a, b) => {\n            if (a.priority != b.priority) {\n                return a.priority - b.priority;\n            }\n            return a.dist - b.dist;\n        });\n        GWU.grid.free(done);\n    }\n    update() {\n        if (!this.subject) {\n            throw new Error('Update requires a subject to follow.');\n        }\n        return this.updateFor(this.subject);\n    }\n    updateFor(subject) {\n        return this.updateAt(subject.memory || subject.map, subject.x, subject.y, subject.fov);\n    }\n    updateAt(map, cx, cy, fov) {\n        this.updateCellCache(map);\n        this.findEntries(map, cx, cy, fov);\n        return true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, 0, 0, this._used.bg);\n        // clear the row information\n        this.entries.forEach((e) => (e.sidebarY = -1));\n        const drawBounds = this.bounds.clone();\n        let currentEntry;\n        for (let i = 0; i < this.entries.length && drawBounds.height > 0; ++i) {\n            currentEntry = this.entries[i];\n            currentEntry.sidebarY = drawBounds.y;\n            let usedLines = currentEntry.draw(buffer, drawBounds);\n            if (this._isDim(currentEntry) && this._used.bg) {\n                buffer.mix(this._used.bg, 50, drawBounds.x, drawBounds.y, drawBounds.width, usedLines);\n            }\n            if (usedLines) {\n                ++usedLines; // skip a space\n                drawBounds.y += usedLines;\n                drawBounds.height -= usedLines;\n            }\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from '../widget';\nexport class Viewport extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this._subject = null;\n        this.attr('snap', opts.snap || false);\n        this.attr('center', opts.center || false);\n        this.filter = opts.filter || null;\n        this.attr('lockX', opts.lock || opts.lockX || false);\n        this.attr('lockY', opts.lock || opts.lockY || false);\n    }\n    get subject() {\n        return this._subject;\n    }\n    set subject(subject) {\n        this.attr('center', !!subject);\n        if (subject) {\n            this.offsetX = subject.x - this.halfWidth();\n            this.offsetY = subject.y - this.halfHeight();\n        }\n        this._subject = subject;\n    }\n    set lock(v) {\n        this.attr('lockX', v);\n        this.attr('lockY', v);\n    }\n    toMapX(x) {\n        return x + this.offsetX - this.bounds.x;\n    }\n    toMapY(y) {\n        return y + this.offsetY - this.bounds.y;\n    }\n    toInnerX(x) {\n        return x - this.bounds.x;\n    }\n    toInnerY(y) {\n        return y - this.bounds.y;\n    }\n    halfWidth() {\n        return Math.floor(this.bounds.width / 2);\n    }\n    halfHeight() {\n        return Math.floor(this.bounds.height / 2);\n    }\n    centerOn(map, x, y) {\n        this.attr('center', true);\n        this.subject = { x, y, map };\n    }\n    showMap(map, x = 0, y = 0) {\n        this.subject = { x, y, map };\n        this.offsetX = x;\n        this.offsetY = y;\n        this.attr('center', false);\n        this.attr('snap', false);\n    }\n    updateOffset() {\n        if (!this._subject) {\n            this.offsetX = 0;\n            this.offsetY = 0;\n            return;\n        }\n        const subject = this._subject;\n        const map = subject.memory || subject.map;\n        const bounds = map;\n        if (subject && map.hasXY(subject.x, subject.y)) {\n            if (this._attrBool('snap')) {\n                let left = this.offsetX;\n                let right = this.offsetX + this.bounds.width;\n                let top = this.offsetY;\n                let bottom = this.offsetY + this.bounds.height;\n                // auto center if outside the viewport\n                if (subject.x < left || subject.x > right) {\n                    left = this.offsetX = subject.x - this.halfWidth();\n                    right = left + this.bounds.width;\n                }\n                if (subject.y < top || subject.y > bottom) {\n                    top = this.offsetY = subject.y - this.halfHeight();\n                    bottom = top + this.bounds.height;\n                }\n                const edgeX = Math.floor(this.bounds.width / 5);\n                const edgeY = Math.floor(this.bounds.height / 5);\n                const thirdW = Math.floor(this.bounds.width / 3);\n                if (left + edgeX >= subject.x) {\n                    this.offsetX = Math.max(0, subject.x + thirdW - this.bounds.width);\n                }\n                else if (right - edgeX <= subject.x) {\n                    this.offsetX = Math.min(subject.x - thirdW, bounds.width - this.bounds.width);\n                }\n                const thirdH = Math.floor(this.bounds.height / 3);\n                if (top + edgeY >= subject.y) {\n                    this.offsetY = Math.max(0, subject.y + thirdH - this.bounds.height);\n                }\n                else if (bottom - edgeY <= subject.y) {\n                    this.offsetY = Math.min(subject.y - thirdH, bounds.height - this.bounds.height);\n                }\n            }\n            else if (this._attrBool('center')) {\n                this.offsetX = subject.x - this.halfWidth();\n                this.offsetY = subject.y - this.halfHeight();\n            }\n            else {\n                this.offsetX = subject.x;\n                this.offsetY = subject.y;\n            }\n        }\n        if (this._attrBool('lockX') && map) {\n            this.offsetX = GWU.clamp(this.offsetX, 0, map.width - this.bounds.width);\n        }\n        if (this._attrBool('lockY') && map) {\n            this.offsetY = GWU.clamp(this.offsetY, 0, map.height - this.bounds.height);\n        }\n    }\n    draw(buffer) {\n        buffer.blackOutRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this._used.bg);\n        if (!this._subject) {\n            return false;\n        }\n        this.updateOffset();\n        const map = this._subject.memory || this._subject.map;\n        const fov = this._subject.fov;\n        const mixer = new GWU.sprite.Mixer();\n        for (let x = 0; x < this.bounds.width; ++x) {\n            for (let y = 0; y < this.bounds.height; ++y) {\n                const mapX = x + this.offsetX;\n                const mapY = y + this.offsetY;\n                if (map.hasXY(mapX, mapY)) {\n                    const cell = map.cell(mapX, mapY);\n                    map.drawer.drawCell(mixer, cell, fov);\n                }\n                else {\n                    mixer.draw(' ', this._used.bg, this._used.bg); // blackOut\n                }\n                if (this.filter) {\n                    this.filter(mixer, mapX, mapY, map);\n                }\n                buffer.drawSprite(x + this.bounds.x, y + this.bounds.y, mixer);\n            }\n        }\n        // map.clearMapFlag(GWM.flags.Map.MAP_CHANGED);\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { defaultStyle } from './style';\nimport { Layer } from './layer';\nexport class UI {\n    constructor(opts = {}) {\n        this.layer = null;\n        this.layers = [];\n        // inDialog = false;\n        this._done = false;\n        this._promise = null;\n        if (!opts.canvas)\n            throw new Error('Need a canvas.');\n        this.canvas = opts.canvas;\n        this.loop = opts.loop || GWU.loop;\n    }\n    get width() {\n        return this.canvas.width;\n    }\n    get height() {\n        return this.canvas.height;\n    }\n    get styles() {\n        return defaultStyle;\n    }\n    // render() {\n    //     this.buffer.render();\n    // }\n    get baseBuffer() {\n        const layer = this.layers[this.layers.length - 2] || null;\n        return layer ? layer.buffer : this.canvas.buffer;\n    }\n    get canvasBuffer() {\n        return this.canvas.buffer;\n    }\n    get buffer() {\n        return this.layer ? this.layer.buffer : this.canvas.buffer;\n    }\n    startNewLayer() {\n        const layer = new Layer(this, {\n            styles: this.layer ? this.layer.styles : this.styles,\n        });\n        this.layers.push(layer);\n        if (!this._promise) {\n            this._promise = this.loop.run(this);\n        }\n        this.layer = layer;\n        return layer;\n    }\n    copyUIBuffer(dest) {\n        const base = this.baseBuffer;\n        dest.copy(base);\n        dest.changed = false; // So you have to draw something to make the canvas render...\n    }\n    finishLayer(layer) {\n        layer._finish();\n        GWU.arrayDelete(this.layers, layer);\n        if (this.layer === layer) {\n            this.layer = this.layers[this.layers.length - 1] || null;\n            this.layer && (this.layer.needsDraw = true);\n        }\n    }\n    stop() {\n        this._done = true;\n        while (this.layer) {\n            this.finishLayer(this.layer);\n        }\n    }\n    // run(): Promise<void> {\n    //     // this._done = false;\n    //     return this.loop.run(this as unknown as GWU.io.IOMap);\n    // }\n    // stop() {\n    //     this._done = true;\n    //     if (this.layer) this.layer.stop();\n    //     this.layers.forEach((l) => l.stop());\n    //     this.layer = null;\n    //     this.layers.length = 0;\n    // }\n    mousemove(e) {\n        if (this.layer)\n            this.layer.mousemove(e);\n        return this._done;\n    }\n    click(e) {\n        if (this.layer)\n            this.layer.click(e);\n        return this._done;\n    }\n    keypress(e) {\n        if (this.layer)\n            this.layer.keypress(e);\n        return this._done;\n    }\n    dir(e) {\n        if (this.layer)\n            this.layer.dir(e);\n        return this._done;\n    }\n    tick(e) {\n        if (this.layer)\n            this.layer.tick(e);\n        return this._done;\n    }\n    draw() {\n        if (this.layer)\n            this.layer.draw();\n    }\n}\n"],"names":["Grid","constructor","target","this","_left","_top","_colWidths","_rowHeights","_col","_row","pos","x","y","cols","args","length","Array","fill","isArray","rows","col","n","undefined","GWU","clamp","_setPos","nextCol","row","nextRow","endRow","h","i","Selector","text","priority","startsWith","matchFn","_parse","parts","split","map","p","trim","matches","push","_parentMatch","_ancestorMatch","_matchElement","reduce","out","fn","bind","TRUE","next","e","parent","current","re","RegExp","match","exec","_matchTag","_matchId","_matchClass","_matchNot","_matchProp","every","tag","el","cls","classes","includes","prop","_matchFirst","_matchLast","id","attr","children","obj","Style","selector","init","_dirty","set","dirty","v","fg","_fg","bg","_bg","dim","pct","color","from","darken","bright","lighten","invert","align","_align","valign","_valign","get","key","value","setDirty","field","Number","parseInt","Object","entries","forEach","name","unset","clone","other","copy","assign","ComputedStyle","sources","opacity","super","_opacity","_baseFg","_baseBg","sort","a","b","s","alpha","some","Sheet","parentSheet","rules","defaultStyle","slice","r","add","props","Error","rule","existing","findIndex","find","remove","splice","computeFor","widget","filter","widgetStyle","style","Widget","term","opts","bounds","xy","Bounds","_depth","events","_style","Style.Style","_parent","_props","_attrs","layer","width","height","depth","class","c","tabStop","action","disabled","hidden","on","_n","w","_attrStr","_bubbleEvent","attach","updateStyle","_used","sortWidgets","setParent","_removeChild","_addChild","needsDraw","center","centerX","centerY","body","mid","Math","round","_attrInt","_attrBool","_setProp","_propInt","_propStr","_propBool","toggleProp","incProp","contains","addClass","removeClass","arrayDelete","hasClass","all","arrayIncludesAll","toggleClass","focused","focus","reverse","_fireEvent","blur","hovered","min","styles","draw","buffer","_draw","fadeIn","ms","fadeTo","fadeOut","tween","make","to","duration","onUpdate","info","animate","fadeToggle","slideIn","start","slide","slideOut","dir","dest","_drawFill","fillRect","childAt","beforeIndex","resize","mouseenter","over","mousemove","defaultPrevented","mouseleave","click","keypress","tick","event","cb","handlers","off","source","Body","Widget.Widget","blend","Layer","ui","result","_attachOrder","_depthOrder","_focusWidget","_hasTabStop","timers","_tweens","_done","_opts","canvas","Style.Sheet","promise","Promise","resolve","reset","moveTo","move","dx","dy","up","down","left","right","nextLine","prevLine","grid","clear","index","aw","detach","nextTabStop","widgetAt","focusWidget","setFocusWidget","getWidget","arrayNext","prevTabStop","prev","arrayPrev","setFocus","dt","tw","isRunning","timer","time","copyUIBuffer","console","log","render","setTimeout","slot","t","clearTimeout","finish","finishLayer","_finish","prototype","alert","apply","border","pad","startNewLayer","BLACK","textWidget","textClass","dialog","widgets","installWidget","Text","_text","_lines","_fixedWidth","_fixedHeight","splitIntoLines","line","max","vOffset","floor","drawText","l","options","list","bottom","Button","Text.Text","ev","button","confirm","cancel","ok","buttonWidth","okClass","_innerLeft","_innerWidth","_innerTop","_innerHeight","cancelClass","_w","inputbox","label","labelClass","input","inputClass","_e","Border","ascii","_args","drawBorder","j","forBorder","toPadArray","pv","ph","Dialog","default","legend","_adjustBounds","legendTag","legendClass","legendAlign","_addLegend","padLeft","padSize","padTop","textWidth","Fieldset","Dialog.Dialog","fields","separator","dataTag","dataClass","dataWidth","labelTag","_labelLeft","_dataLeft","_nextY","padBottom","format","sep","labelText","padEnd","Field","data","d","f","fieldset","topts","_format","compile","OrderedList","_drawBulletFor","_getBullet","bullet","size","UnorderedList","_index","ol","ul","Input","maxLength","minLength","numbersOnly","placeholder","required","isValid","valid","val","textEntryBounds","spliceRaw","_force","show","Column","IDENTITY","DataTable","columnWidth","header","headerTag","empty","addHeader","table","join","rowHeight","addData","TD","addEmpty","select","hover","_data","columns","showHeader","selectedRow","selectedColumn","o","wrap","prefix","selectedData","active","selectNextRow","selectPrevRow","selectNextCol","selectPrevCol","borderAdj","datatable","DataList","DataTable.DataTable","tableOpts","datalist","Menu","buttonClass","buttonTag","marker","_initButtons","expand","collapse","buttons","minWidth","textLen","menuItem","MenuButton","menu","_initMenu","_a","_setMenuPos","keys","menuOpts","Menubar","_buttons","_selectedIndex","menuClass","menuTag","_buttonClick","selectedIndex","selectedButton","_config","MenubarButton","_action","barButton","indexOf","top","menubar","Select","_initText","dropdown","Menu.Menu","Choice","_prompt","choiceWidth","promptTag","promptClass","choiceTag","choiceClass","infoTag","infoClass","_addList","_addInfo","prompt","showPrompt","arg","choose","choices","choice","mainMenu","question","_id","_defaultNext","selection","_field","_choices","_infos","_values","_next","values","updateResult","res","_prompts","_result","_stack","_current","_keypress","_change","prompts","unshift","_cancel","back","pop","restart","quit","handled","MessageArchive","concat","mode","isOnTop","totalCount","cache","shown","_forward","_reverse","confirmAll","fadePercent","dbuf","startY","endY","_confirmed","fgColor","mix","wrapText","install","EntryBase","dist","changed","sidebarY","_buffer","_bounds","ActorEntry","actor","drawStatus","ItemEntry","item","CellEntry","cell","message","MessageCache","_x","_y","showArchive","confirmed","Widget.Text","overflow","isPrompt","showText","getFlavorText","fov","buf","object","isAnyKindOfVisible","isDirectlyVisible","isRemembered","isRevealed","isMapped","isMagicMapped","intro","hasActor","actorAt","theItem","hasItem","itemAt","standsInTile","hasTileFlag","GWM","flags","Tile","T_STAND_IN_TILE","needObjectArticle","getFlavor","article","groundTile","depthTile","Depth","GROUND","tile","tiles","NULL","surfaceTile","SURFACE","liquidTile","LIQUID","surface","T_BRIDGE","liquid","ground","cellCache","lastX","lastY","lastMap","subject","highlight","entryAt","entry","highlightRow","clearHighlight","last","updateCellCache","hasMapFlag","Map","MAP_SIDEBAR_TILES_CHANGED","forRect","hasEntityFlag","Entity","L_LIST_IN_SIDEBAR","clearMapFlag","_makeActorEntry","_makeItemEntry","_makeCellEntry","_getPriority","hasCellFlag","Cell","STABLE_MEMORY","_isDim","_addActorEntry","distanceBetween","isPlayer","_addItemEntry","_addCellEntry","findEntries","cx","cy","done","alloc","eachActor","eachItem","free","update","updateFor","updateAt","memory","drawBounds","currentEntry","usedLines","offsetX","offsetY","_subject","snap","lock","lockX","lockY","halfWidth","halfHeight","toMapX","toMapY","toInnerX","toInnerY","centerOn","showMap","updateOffset","hasXY","edgeX","edgeY","thirdW","thirdH","blackOutRect","mixer","sprite","Mixer","mapX","mapY","drawer","drawCell","drawSprite","layers","_promise","loop","baseBuffer","canvasBuffer","run","base","stop","baseParts"],"mappings":"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"}