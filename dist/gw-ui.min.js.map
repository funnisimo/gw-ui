{"version":3,"file":"gw-ui.min.js","sources":["../js/selector.js","../js/style.js","../js/widget/widget.js","../js/widget/body.js","../js/grid.js","../js/layer.js","../js/widget/make.js","../js/widget/text.js","../js/widget/border.js","../js/widget/button.js","../js/widget/dialog.js","../js/widget/fieldset.js","../js/widget/lists.js","../js/widget/input.js","../js/widget/datatable.js","../js/widget/datalist.js","../js/widget/menu.js","../js/widget/menubar.js","../js/widget/select.js","../js/widget/choice.js","../js/dialog/alert.js","../js/game/message.js","../js/game/flavor.js","../js/game/sidebar.js","../js/ui.js","../js/game/viewport.js"],"sourcesContent":["import * as GWU from 'gw-utils';\nexport class Selector {\n    constructor(text) {\n        this.priority = 0;\n        if (text.startsWith(':') || text.startsWith('.')) {\n            text = '*' + text;\n        }\n        this.text = text;\n        this.matchFn = this._parse(text);\n    }\n    _parse(text) {\n        const parts = text.split(/ +/g).map((p) => p.trim());\n        const matches = [];\n        for (let i = 0; i < parts.length; ++i) {\n            let p = parts[i];\n            if (p === '>') {\n                matches.push(this._parentMatch());\n                ++i;\n                p = parts[i];\n            }\n            else if (i > 0) {\n                matches.push(this._ancestorMatch());\n            }\n            matches.push(this._matchElement(p));\n        }\n        return matches.reduce((out, fn) => fn.bind(undefined, out), GWU.TRUE);\n    }\n    _parentMatch() {\n        return function parentM(next, e) {\n            // console.log('parent', e.parent);\n            if (!e.parent)\n                return false;\n            return next(e.parent);\n        };\n    }\n    _ancestorMatch() {\n        return function ancestorM(next, e) {\n            let current = e.parent;\n            while (current) {\n                if (next(current))\n                    return true;\n            }\n            return false;\n        };\n    }\n    _matchElement(text) {\n        const CSS_RE = /(?:(\\w+|\\*|\\$)|#(\\w+)|\\.([^\\.: ]+))|(?::(?:(?:not\\(\\.([^\\)]+)\\))|(?:not\\(:([^\\)]+)\\))|([^\\.: ]+)))/g;\n        const parts = [];\n        const re = new RegExp(CSS_RE, 'g');\n        let match = re.exec(text);\n        while (match) {\n            if (match[1]) {\n                const fn = this._matchTag(match[1]);\n                if (fn) {\n                    parts.push(fn);\n                }\n            }\n            else if (match[2]) {\n                parts.push(this._matchId(match[2]));\n            }\n            else if (match[3]) {\n                parts.push(this._matchClass(match[3]));\n            }\n            else if (match[4]) {\n                parts.push(this._matchNot(this._matchClass(match[4])));\n            }\n            else if (match[5]) {\n                parts.push(this._matchNot(this._matchProp(match[5])));\n            }\n            else {\n                parts.push(this._matchProp(match[6]));\n            }\n            match = re.exec(text);\n        }\n        return (next, e) => {\n            if (!parts.every((fn) => fn(e)))\n                return false;\n            return next(e);\n        };\n    }\n    _matchTag(tag) {\n        if (tag === '*')\n            return null;\n        if (tag === '$') {\n            this.priority += 10000;\n            return null;\n        }\n        this.priority += 10;\n        return (el) => el.tag === tag;\n    }\n    _matchClass(cls) {\n        this.priority += 100;\n        return (el) => el.classes.includes(cls);\n    }\n    _matchProp(prop) {\n        if (prop.startsWith('first')) {\n            return this._matchFirst();\n        }\n        else if (prop.startsWith('last')) {\n            return this._matchLast();\n        }\n        else if (prop === 'invalid') {\n            return this._matchNot(this._matchProp('valid'));\n        }\n        else if (prop === 'optional') {\n            return this._matchNot(this._matchProp('required'));\n        }\n        else if (prop === 'enabled') {\n            return this._matchNot(this._matchProp('disabled'));\n        }\n        else if (prop === 'unchecked') {\n            return this._matchNot(this._matchProp('checked'));\n        }\n        this.priority += 1; // prop\n        return (el) => !!el.prop(prop);\n    }\n    _matchId(id) {\n        this.priority += 1000;\n        return (el) => el.attr('id') === id;\n    }\n    _matchFirst() {\n        this.priority += 1; // prop\n        return (el) => !!el.parent && !!el.parent.children && el.parent.children[0] === el;\n    }\n    _matchLast() {\n        this.priority += 1; // prop\n        return (el) => {\n            if (!el.parent)\n                return false;\n            if (!el.parent.children)\n                return false;\n            return el.parent.children[el.parent.children.length - 1] === el;\n        };\n    }\n    _matchNot(fn) {\n        return (el) => !fn(el);\n    }\n    matches(obj) {\n        return this.matchFn(obj);\n    }\n}\nexport function compile(text) {\n    return new Selector(text);\n}\n","import * as GWU from 'gw-utils';\nimport { Selector } from './selector';\n// static - size/pos automatic (ignore TRBL)\n// relative - size automatic, pos = automatic + TRBL\n// fixed - size = self, pos = TRBL vs root\n// absolute - size = self, pos = TRBL vs positioned parent (fixed, absolute)\n// export interface Stylable {\n//     tag: string;\n//     classes: string[];\n//     attr(name: string): string | undefined;\n//     prop(name: string): PropType | undefined;\n//     parent: UIWidget | null;\n//     children?: UIWidget[];\n//     style(): Style;\n// }\n// export interface StyleOptions {\n//     fg?: GWU.color.ColorBase;\n//     bg?: GWU.color.ColorBase;\n//     // depth?: number;\n//     align?: GWU.text.Align;\n//     valign?: GWU.text.VAlign;\n//     // minWidth?: number;\n//     // maxWidth?: number;\n//     // width?: number;\n//     // minHeight?: number;\n//     // maxHeight?: number;\n//     // height?: number;\n//     // left?: number;\n//     // right?: number;\n//     // top?: number;\n//     // bottom?: number;\n//     // //        all,     [t+b, l+r],        [t, r+l,b],               [t, r, b, l]\n//     // padding?:\n//     //     | number\n//     //     | [number]\n//     //     | [number, number]\n//     //     | [number, number, number]\n//     //     | [number, number, number, number];\n//     // padLeft?: number;\n//     // padRight?: number;\n//     // padTop?: number;\n//     // padBottom?: number;\n//     // //        all,     [t+b, l+r],        [t, l+r, b],               [t, r, b, l]\n//     // margin?:\n//     //     | number\n//     //     | [number]\n//     //     | [number, number]\n//     //     | [number, number, number]\n//     //     | [number, number, number, number];\n//     // marginLeft?: number;\n//     // marginRight?: number;\n//     // marginTop?: number;\n//     // marginBottom?: number;\n//     // border?: GWU.color.ColorBase;\n// }\nexport class Style {\n    constructor(selector = '$', init) {\n        this._dirty = false;\n        this.selector = new Selector(selector);\n        if (init) {\n            this.set(init);\n        }\n        this._dirty = false;\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n    get fg() {\n        return this._fg;\n    }\n    get bg() {\n        return this._bg;\n    }\n    // get border(): GWU.color.ColorBase | undefined {\n    //     return this._border;\n    // }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).darken(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._fg = GWU.color.from(this._fg).lighten(pct);\n        }\n        if (bg) {\n            this._bg = GWU.color.from(this._bg).lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this._fg, this._bg] = [this._bg, this._fg];\n        return this;\n    }\n    get align() {\n        return this._align;\n    }\n    get valign() {\n        return this._valign;\n    }\n    // get position(): Position | undefined {\n    //     return this._position;\n    // }\n    // get minWidth(): number | undefined {\n    //     return this._minWidth;\n    // }\n    // get maxWidth(): number | undefined {\n    //     return this._maxWidth;\n    // }\n    // get width(): number | undefined {\n    //     return this._width;\n    // }\n    // get minHeight(): number | undefined {\n    //     return this._minHeight;\n    // }\n    // get maxHeight(): number | undefined {\n    //     return this._maxHeight;\n    // }\n    // get height(): number | undefined {\n    //     return this._height;\n    // }\n    // get x(): number | undefined {\n    //     return this._x;\n    // }\n    // get left(): number | undefined {\n    //     return this._left;\n    // }\n    // get right(): number | undefined {\n    //     return this._right;\n    // }\n    // get y(): number | undefined {\n    //     return this._y;\n    // }\n    // get top(): number | undefined {\n    //     return this._top;\n    // }\n    // get bottom(): number | undefined {\n    //     return this._bottom;\n    // }\n    // get padLeft(): number | undefined {\n    //     return this._padLeft;\n    // }\n    // get padRight(): number | undefined {\n    //     return this._padRight;\n    // }\n    // get padTop(): number | undefined {\n    //     return this._padTop;\n    // }\n    // get padBottom(): number | undefined {\n    //     return this._padBottom;\n    // }\n    // get marginLeft(): number | undefined {\n    //     return this._marginLeft;\n    // }\n    // get marginRight(): number | undefined {\n    //     return this._marginRight;\n    // }\n    // get marginTop(): number | undefined {\n    //     return this._marginTop;\n    // }\n    // get marginBottom(): number | undefined {\n    //     return this._marginBottom;\n    // }\n    get(key) {\n        const id = ('_' + key);\n        return this[id];\n    }\n    set(key, value, setDirty = true) {\n        if (typeof key === 'string') {\n            // if (key === 'padding') {\n            //     if (typeof value === 'number') {\n            //         value = [value];\n            //     } else if (typeof value === 'string') {\n            //         value = value.split(' ');\n            //     }\n            //     value = value.map((v: string | number) => {\n            //         if (typeof v === 'string') return Number.parseInt(v);\n            //         return v;\n            //     });\n            //     if (value.length == 1) {\n            //         this._padLeft =\n            //             this._padRight =\n            //             this._padTop =\n            //             this._padBottom =\n            //                 value[0];\n            //     } else if (value.length == 2) {\n            //         this._padLeft = this._padRight = value[1];\n            //         this._padTop = this._padBottom = value[0];\n            //     } else if (value.length == 3) {\n            //         this._padTop = value[0];\n            //         this._padRight = value[1];\n            //         this._padBottom = value[2];\n            //         this._padLeft = value[1];\n            //     } else if (value.length == 4) {\n            //         this._padTop = value[0];\n            //         this._padRight = value[1];\n            //         this._padBottom = value[2];\n            //         this._padLeft = value[3];\n            //     }\n            // } else if (key === 'margin') {\n            //     if (typeof value === 'number') {\n            //         value = [value];\n            //     } else if (typeof value === 'string') {\n            //         value = value.split(' ');\n            //     }\n            //     value = value.map((v: string | number) => {\n            //         if (typeof v === 'string') return Number.parseInt(v);\n            //         return v;\n            //     });\n            //     if (value.length == 1) {\n            //         this._marginLeft =\n            //             this._marginRight =\n            //             this._marginTop =\n            //             this._marginBottom =\n            //                 value[0];\n            //     } else if (value.length == 2) {\n            //         this._marginLeft = this._marginRight = value[1];\n            //         this._marginTop = this._marginBottom = value[0];\n            //     } else if (value.length == 3) {\n            //         this._marginTop = value[0];\n            //         this._marginRight = value[1];\n            //         this._marginBottom = value[2];\n            //         this._marginLeft = value[1];\n            //     } else if (value.length == 4) {\n            //         this._marginTop = value[0];\n            //         this._marginRight = value[1];\n            //         this._marginBottom = value[2];\n            //         this._marginLeft = value[3];\n            //     }\n            // } else {\n            const field = '_' + key;\n            if (typeof value === 'string') {\n                if (value.match(/^[+-]?\\d+$/)) {\n                    value = Number.parseInt(value);\n                }\n                else if (value === 'true') {\n                    value = true;\n                }\n                else if (value === 'false') {\n                    value = false;\n                }\n            }\n            this[field] = value;\n            // }\n        }\n        else if (key instanceof Style) {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (name === 'selector' || name === '_dirty')\n                    return;\n                if (value !== undefined && value !== null) {\n                    this[name] = value;\n                }\n                else if (value === null) {\n                    this.unset(name);\n                }\n            });\n        }\n        else {\n            setDirty = value || value === undefined ? true : false;\n            Object.entries(key).forEach(([name, value]) => {\n                if (value === null) {\n                    this.unset(name);\n                }\n                else {\n                    this.set(name, value, setDirty);\n                }\n            });\n        }\n        this.dirty || (this.dirty = setDirty);\n        return this;\n    }\n    unset(key) {\n        const field = key.startsWith('_') ? key : '_' + key;\n        delete this[field];\n        this.dirty = true;\n        return this;\n    }\n    clone() {\n        const other = new this.constructor();\n        other.copy(this);\n        return other;\n    }\n    copy(other) {\n        Object.assign(this, other);\n        return this;\n    }\n}\nexport function makeStyle(style, selector = '$') {\n    const opts = {};\n    const parts = style\n        .trim()\n        .split(';')\n        .map((p) => p.trim());\n    parts.forEach((p) => {\n        const [name, base] = p.split(':').map((p) => p.trim());\n        if (!name)\n            return;\n        const baseParts = base.split(/ +/g);\n        if (baseParts.length == 1) {\n            // @ts-ignore\n            opts[name] = base;\n        }\n        else {\n            // @ts-ignore\n            opts[name] = baseParts;\n        }\n    });\n    return new Style(selector, opts);\n}\n// const NO_BOUNDS = ['fg', 'bg', 'depth', 'align', 'valign'];\n// export function affectsBounds(key: keyof StyleOptions): boolean {\n//     return !NO_BOUNDS.includes(key);\n// }\nexport class ComputedStyle extends Style {\n    // constructor(source: Stylable, sources?: Style[]) {\n    constructor(sources) {\n        super();\n        // obj: Stylable;\n        this.sources = [];\n        // this.obj = source;\n        if (sources) {\n            // sort low to high priority (highest should be this.obj._style, lowest = global default:'*')\n            sources.sort((a, b) => a.selector.priority - b.selector.priority);\n            this.sources = sources;\n        }\n        this.sources.forEach((s) => super.set(s));\n        this._dirty = false; // As far as I know I reflect all of the current source values.\n    }\n    get dirty() {\n        return this._dirty || this.sources.some((s) => s.dirty);\n    }\n    set dirty(v) {\n        this._dirty = v;\n    }\n}\nexport class Sheet {\n    constructor(parentSheet) {\n        this.rules = [];\n        this._dirty = true;\n        if (parentSheet === undefined) {\n            parentSheet = defaultStyle;\n        }\n        if (parentSheet) {\n            this.rules = parentSheet.rules.slice();\n        }\n    }\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(v) {\n        this._dirty = v;\n        if (!this._dirty) {\n            this.rules.forEach((r) => (r.dirty = false));\n        }\n    }\n    add(selector, props) {\n        if (selector.includes(',')) {\n            selector\n                .split(',')\n                .map((p) => p.trim())\n                .forEach((p) => this.add(p, props));\n            return this;\n        }\n        if (selector.includes(' '))\n            throw new Error('Hierarchical selectors not supported.');\n        // if 2 '.' - Error('Only single class rules supported.')\n        // if '&' - Error('Not supported.')\n        let rule = new Style(selector, props);\n        const existing = this.rules.findIndex((s) => s.selector.text === rule.selector.text);\n        if (existing > -1) {\n            const current = this.rules[existing];\n            current.set(rule);\n            rule = current;\n        }\n        else {\n            this.rules.push(rule);\n        }\n        // rulesChanged = true;\n        this.dirty = true;\n        return this;\n    }\n    get(selector) {\n        return this.rules.find((s) => s.selector.text === selector) || null;\n    }\n    remove(selector) {\n        const existing = this.rules.findIndex((s) => s.selector.text === selector);\n        if (existing > -1) {\n            this.rules.splice(existing, 1);\n            this.dirty = true;\n        }\n    }\n    computeFor(widget) {\n        const sources = this.rules.filter((r) => r.selector.matches(widget));\n        const widgetStyle = widget.style();\n        if (widgetStyle) {\n            sources.push(widgetStyle);\n        }\n        widgetStyle.dirty = false;\n        return new ComputedStyle(sources);\n    }\n}\nexport const defaultStyle = new Sheet(null);\n","import * as GWU from 'gw-utils';\nimport * as Style from '../style';\nStyle.defaultStyle.add('*', {\n    fg: 'white',\n    bg: -1,\n    align: 'left',\n    valign: 'top',\n});\nexport class Widget {\n    constructor(term, opts = {}) {\n        this.tag = 'text';\n        this.bounds = new GWU.xy.Bounds(0, 0, 0, 1);\n        this._depth = 0;\n        this.events = {};\n        // action: string = '';\n        this.children = [];\n        this._style = new Style.Style();\n        this._parent = null;\n        this.classes = [];\n        this._props = {};\n        this._attrs = {};\n        this.layer = term;\n        // this.bounds.x = term.x;\n        // this.bounds.y = term.y;\n        this.bounds.x = opts.x || 0;\n        this.bounds.y = opts.y || 0;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        if (opts.tag) {\n            this.tag = opts.tag;\n        }\n        if (opts.id) {\n            this.attr('id', opts.id);\n            this.attr('action', opts.id);\n        }\n        if (opts.depth !== undefined) {\n            this._depth = opts.depth;\n        }\n        this._style.set(opts);\n        if (opts.class) {\n            if (typeof opts.class === 'string') {\n                opts.class = opts.class.split(/ +/g);\n            }\n            this.classes = opts.class.map((c) => c.trim());\n        }\n        if (opts.tabStop) {\n            this.prop('tabStop', true);\n        }\n        if (opts.action) {\n        }\n        if (opts.disabled) {\n            this.prop('disabled', true);\n        }\n        if (opts.hidden) {\n            this.prop('hidden', true);\n        }\n        if (opts.action) {\n            this.attr('action', opts.action);\n        }\n        if (this.attr('action')) {\n            this.on('click', (_n, w, e) => {\n                const action = this._attrStr('action');\n                if (action) {\n                    this._bubbleEvent(action, w, e);\n                }\n                return false; // keep bubbling\n            });\n        }\n        this.layer.attach(this);\n        this.updateStyle();\n    }\n    get depth() {\n        return this._depth;\n    }\n    set depth(v) {\n        this._depth = v;\n        this.layer.sortWidgets();\n    }\n    get parent() {\n        return this._parent;\n    }\n    set parent(v) {\n        this.setParent(v);\n    }\n    setParent(v, opts = {}) {\n        if (this._parent) {\n            this._parent._removeChild(this);\n        }\n        this._parent = v;\n        if (this._parent) {\n            this.depth = this._depth || this._parent.depth + 1;\n            this._parent._addChild(this, opts);\n        }\n    }\n    pos(x, y) {\n        if (x === undefined)\n            return this.bounds;\n        if (typeof x === 'number') {\n            this.bounds.x = x;\n            this.bounds.y = y || 0;\n        }\n        else {\n            this.bounds.x = x.x;\n            this.bounds.y = x.y;\n        }\n        this.layer.needsDraw = true;\n        return this;\n    }\n    center(bounds) {\n        return this.centerX(bounds).centerY(bounds);\n    }\n    centerX(bounds) {\n        bounds = bounds || this.layer.body.bounds;\n        const w = this.bounds.width;\n        const mid = Math.round((bounds.width - w) / 2);\n        this.bounds.x = bounds.x + mid;\n        return this;\n    }\n    centerY(bounds) {\n        bounds = bounds || this.layer.body.bounds;\n        const h = this.bounds.height;\n        const mid = Math.round((bounds.height - h) / 2);\n        this.bounds.y = bounds.y + mid;\n        return this;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._attrStr('text');\n        this.attr('text', v);\n        return this;\n    }\n    attr(name, v) {\n        if (v === undefined)\n            return this._attrs[name];\n        this._attrs[name] = v;\n        return this;\n    }\n    _attrInt(name) {\n        const n = this._attrs[name] || 0;\n        if (typeof n === 'number')\n            return n;\n        if (typeof n === 'string')\n            return Number.parseInt(n);\n        return n ? 1 : 0;\n    }\n    _attrStr(name) {\n        const n = this._attrs[name] || '';\n        if (typeof n === 'string')\n            return n;\n        if (typeof n === 'number')\n            return '' + n;\n        return n ? 'true' : 'false';\n    }\n    _attrBool(name) {\n        return !!this._attrs[name];\n    }\n    prop(name, v) {\n        if (v === undefined)\n            return this._props[name];\n        const current = this._props[name];\n        if (current !== v) {\n            this._setProp(name, v);\n        }\n        return this;\n    }\n    _setProp(name, v) {\n        this._props[name] = v;\n        // console.log(`${this.tag}.${name}=${v}`);\n        this.updateStyle();\n    }\n    _propInt(name) {\n        const n = this._props[name] || 0;\n        if (typeof n === 'number')\n            return n;\n        if (typeof n === 'string')\n            return Number.parseInt(n);\n        return n ? 1 : 0;\n    }\n    _propStr(name) {\n        const n = this._props[name] || '';\n        if (typeof n === 'string')\n            return n;\n        if (typeof n === 'number')\n            return '' + n;\n        return n ? 'true' : 'false';\n    }\n    _propBool(name) {\n        return !!this._props[name];\n    }\n    toggleProp(name) {\n        const current = !!this._props[name];\n        this.prop(name, !current);\n        return this;\n    }\n    incProp(name, n = 1) {\n        let current = this.prop(name) || 0;\n        if (typeof current === 'boolean') {\n            current = current ? 1 : 0;\n        }\n        else if (typeof current === 'string') {\n            current = Number.parseInt(current) || 0;\n        }\n        current += n;\n        this.prop(name, current);\n        return this;\n    }\n    contains(...args) {\n        return this.bounds.contains(args[0], args[1]);\n    }\n    style(opts) {\n        if (opts === undefined)\n            return this._style;\n        this._style.set(opts);\n        this.updateStyle();\n        return this;\n    }\n    addClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a))\n                return;\n            this.classes.push(a);\n        });\n        return this;\n    }\n    removeClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            GWU.arrayDelete(this.classes, a);\n        });\n        return this;\n    }\n    hasClass(c) {\n        const all = c.split(/ +/g);\n        return GWU.arrayIncludesAll(this.classes, all);\n    }\n    toggleClass(c) {\n        const all = c.split(/ +/g);\n        all.forEach((a) => {\n            if (this.classes.includes(a)) {\n                GWU.arrayDelete(this.classes, a);\n            }\n            else {\n                this.classes.push(a);\n            }\n        });\n        return this;\n    }\n    get focused() {\n        return !!this.prop('focus');\n    }\n    // @return true to stop the focus change event\n    focus(reverse = false) {\n        if (this.prop('focus'))\n            return true;\n        this.prop('focus', true);\n        return this._fireEvent('focus', this, { reverse });\n    }\n    // @return true to stop the focus change event\n    blur(reverse = false) {\n        if (!this.prop('focus'))\n            return false;\n        this.prop('focus', false);\n        return this._fireEvent('blur', this, { reverse });\n    }\n    get hovered() {\n        return !!this.prop('hover');\n    }\n    set hovered(v) {\n        this.prop('hover', v);\n    }\n    get hidden() {\n        let current = this;\n        while (current) {\n            if (current.prop('hidden'))\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n    set hidden(v) {\n        this.prop('hidden', v);\n    }\n    updateStyle() {\n        this._used = this.layer.styles.computeFor(this);\n        this.layer.needsDraw = true; // changed style or state\n    }\n    draw(buffer) {\n        if (this.hidden)\n            return false;\n        return this._draw(buffer);\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        return true;\n    }\n    _drawFill(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this._used.bg, this._used.bg);\n    }\n    childAt(...args) {\n        return this.children.find((c) => c.contains(args[0], args[1])) || null;\n    }\n    _addChild(w, opts) {\n        let beforeIndex = -1;\n        if (opts && opts.beforeIndex !== undefined) {\n            beforeIndex = opts.beforeIndex;\n        }\n        if (w._parent && w._parent !== this)\n            throw new Error('Trying to add child that already has a parent.');\n        if (!this.children.includes(w)) {\n            if (beforeIndex < 0 || beforeIndex >= this.children.length) {\n                this.children.push(w);\n            }\n            else {\n                this.children.splice(beforeIndex, 0, w);\n            }\n        }\n        w._parent = this;\n        return this;\n    }\n    _removeChild(w) {\n        if (!w._parent || w._parent !== this)\n            throw new Error('Removing child that does not have this widget as parent.');\n        w._parent = null;\n        GWU.arrayDelete(this.children, w);\n        return this;\n    }\n    resize(w, h) {\n        this.bounds.width = w || this.bounds.width;\n        this.bounds.height = h || this.bounds.height;\n        this.layer.needsDraw = true;\n        return this;\n    }\n    // Events\n    mouseenter(e, over) {\n        if (!this.contains(e))\n            return;\n        if (this.hovered)\n            return;\n        this.hovered = true;\n        this._fireEvent('mouseenter', this, e);\n        if (this._parent) {\n            this._parent.mouseenter(e, over);\n        }\n    }\n    mousemove(e) {\n        if (this.contains(e) && !e.defaultPrevented && !this.hidden) {\n            this._fireEvent('mousemove', this, e);\n            // e.preventDefault();\n        }\n        else {\n            this.mouseleave(e);\n        }\n        return false;\n    }\n    mouseleave(e) {\n        if (this.contains(e))\n            return;\n        if (!this.hovered)\n            return;\n        this.hovered = false;\n        this._fireEvent('mouseleave', this, e);\n        // if (this._parent) {\n        //     this._parent.mouseleave(e);\n        // }\n    }\n    click(e) {\n        if (this.hidden)\n            return false;\n        return this._fireEvent('click', this, e);\n    }\n    keypress(e) {\n        return this._fireEvent('keypress', this, e);\n    }\n    dir(e) {\n        return this._fireEvent('dir', this, e);\n    }\n    tick(e) {\n        return this._fireEvent('tick', this, e);\n    }\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    _fireEvent(name, source, args) {\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source || this, args) || out, false);\n        return handled;\n    }\n    _bubbleEvent(name, source, args) {\n        let current = this;\n        while (current) {\n            if (current._fireEvent(name, source, args))\n                return true;\n            current = current.parent;\n        }\n        return false;\n    }\n}\n","import * as Widget from './widget';\nexport class Body extends Widget.Widget {\n    constructor(layer) {\n        super(layer, {\n            tag: 'body',\n            id: 'BODY',\n            depth: -1,\n            width: layer.width,\n            height: layer.height,\n        });\n    }\n    _drawFill(buffer) {\n        buffer.blend(this._used.bg);\n    }\n}\n","import * as GWU from 'gw-utils';\nexport class Grid {\n    constructor(target) {\n        this._left = 0;\n        this._top = 0;\n        this._colWidths = [];\n        this._rowHeights = [];\n        this._col = 0;\n        this._row = -1;\n        this.target = target;\n        const pos = target.pos();\n        this._left = pos.x;\n        this._top = pos.y;\n    }\n    cols(...args) {\n        if (args.length === 0)\n            return this._colWidths;\n        if (args.length == 2) {\n            args[0] = new Array(args[0]).fill(args[1]);\n        }\n        if (Array.isArray(args[0])) {\n            this._colWidths = args[0];\n        }\n        return this;\n    }\n    rows(...args) {\n        if (args.length === 0)\n            return this._rowHeights;\n        if (typeof args[0] === 'number') {\n            args[0] = new Array(args[0]).fill(args[1] || 1);\n        }\n        if (Array.isArray(args[0])) {\n            this._rowHeights = args[0];\n        }\n        return this;\n    }\n    col(n) {\n        if (n === undefined)\n            n = this._col;\n        this._col = GWU.clamp(n, 0, this._colWidths.length - 1);\n        return this._setPos(); // move back to top of our current row\n    }\n    nextCol() {\n        return this.col(this._col + 1);\n    }\n    row(n) {\n        if (n === undefined)\n            n = this._row;\n        this._row = GWU.clamp(n, 0, this._rowHeights.length - 1);\n        return this._setPos(); // move back to beginning of current column\n    }\n    nextRow() {\n        return this.row(this._row + 1).col(0);\n    }\n    endRow(h) {\n        if (h <= 0)\n            return this;\n        this._rowHeights[this._row] = h;\n        return this;\n    }\n    _setPos() {\n        let x = this._left;\n        for (let i = 0; i < this._col; ++i) {\n            x += this._colWidths[i];\n        }\n        let y = this._top;\n        for (let i = 0; i < this._row; ++i) {\n            y += this._rowHeights[i];\n        }\n        this.target.pos(x, y);\n        return this;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Style from './style';\nimport { Body } from './widget/body';\nimport { Grid } from './grid';\nexport class Layer {\n    constructor(ui, opts = {}) {\n        this.needsDraw = true;\n        this.result = undefined;\n        this._attachOrder = [];\n        this._depthOrder = [];\n        this._focusWidget = null;\n        this._hasTabStop = false;\n        this.timers = [];\n        this._done = null;\n        this._opts = { x: 0, y: 0 };\n        this.ui = ui;\n        this.buffer = ui.canvas.buffer.clone();\n        this.styles = new Style.Sheet(opts.styles || ui.styles);\n        this.body = new Body(this);\n        this.promise = new Promise((resolve) => {\n            this._done = resolve;\n        });\n    }\n    get width() {\n        return this.ui.width;\n    }\n    get height() {\n        return this.ui.height;\n    }\n    // Style and Opts\n    reset() {\n        this._opts = { x: 0, y: 0 };\n        return this;\n    }\n    fg(v) {\n        this._opts.fg = v;\n        return this;\n    }\n    bg(v) {\n        this._opts.bg = v;\n        return this;\n    }\n    dim(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._opts.fg = GWU.color\n                .from(this._opts.fg || 'white')\n                .darken(pct);\n        }\n        if (bg) {\n            this._opts.bg = GWU.color\n                .from(this._opts.bg || 'black')\n                .darken(pct);\n        }\n        return this;\n    }\n    bright(pct = 25, fg = true, bg = false) {\n        if (fg) {\n            this._opts.fg = GWU.color\n                .from(this._opts.fg || 'white')\n                .lighten(pct);\n        }\n        if (bg) {\n            this._opts.bg = GWU.color\n                .from(this._opts.bg || 'black')\n                .lighten(pct);\n        }\n        return this;\n    }\n    invert() {\n        [this._opts.fg, this._opts.bg] = [this._opts.bg, this._opts.fg];\n        return this;\n    }\n    // STYLE\n    style(opts) {\n        Object.assign(this._opts, opts);\n        return this;\n    }\n    class(c) {\n        this._opts.class = this._opts.class || '';\n        this._opts.class += ' ' + c;\n        return this;\n    }\n    pos(x, y) {\n        if (x === undefined)\n            return this._opts;\n        this._opts.x = GWU.clamp(x, 0, this.width);\n        this._opts.y = GWU.clamp(y, 0, this.height);\n        return this;\n    }\n    moveTo(x, y) {\n        return this.pos(x, y);\n    }\n    move(dx, dy) {\n        this._opts.x = GWU.clamp(this._opts.x + dx, 0, this.width);\n        this._opts.y = GWU.clamp(this._opts.y + dy, 0, this.height);\n        return this;\n    }\n    up(n = 1) {\n        return this.move(0, -n);\n    }\n    down(n = 1) {\n        return this.move(0, n);\n    }\n    left(n = 1) {\n        return this.move(-n, 0);\n    }\n    right(n = 1) {\n        return this.move(n, 0);\n    }\n    nextLine(n = 1) {\n        return this.pos(0, this._opts.y + n);\n    }\n    prevLine(n = 1) {\n        return this.pos(0, this._opts.y - n);\n    }\n    grid() {\n        return new Grid(this);\n    }\n    // EDIT\n    // erase and move back to top left\n    clear(color) {\n        this.body.children = [];\n        this._depthOrder = [this.body];\n        if (color) {\n            this.body.style().set('bg', color);\n        }\n        else {\n            this.body.style().unset('bg');\n        }\n        return this;\n    }\n    // Effects\n    fadeTo(_color, _duration) {\n        throw new Error('Method not implemented.');\n    }\n    // Widgets\n    // create(tag: string, opts: any): UIWidget {\n    //     const options = Object.assign({ tag }, this._opts, opts);\n    //     const widget = createWidget(tag, this, options);\n    //     this.addWidget(widget);\n    //     return widget;\n    // }\n    sortWidgets() {\n        this._depthOrder.sort((a, b) => b.depth - a.depth);\n        return this;\n    }\n    attach(w) {\n        if (!this._attachOrder.includes(w)) {\n            const index = this._depthOrder.findIndex((aw) => aw.depth <= w.depth);\n            if (index < 0) {\n                this._depthOrder.push(w);\n            }\n            else {\n                this._depthOrder.splice(index, 0, w);\n            }\n            this._attachOrder.push(w);\n            this.needsDraw = true;\n        }\n        if (!w.parent && w !== this.body && this.body) {\n            w.setParent(this.body);\n            this.needsDraw = true;\n        }\n        this._hasTabStop = this._hasTabStop || w._propBool('tabStop');\n        return this;\n    }\n    detach(w) {\n        // GWU.arrayDelete(this.widgets, w);\n        w.setParent(null);\n        GWU.arrayDelete(this._depthOrder, w);\n        GWU.arrayDelete(this._attachOrder, w);\n        if (this._focusWidget === w) {\n            this._hasTabStop = this.nextTabStop();\n        }\n        this.needsDraw = true;\n        return this;\n    }\n    widgetAt(...args) {\n        return (this._depthOrder.find((w) => w.contains(args[0], args[1]) && !w.hidden) || this.body);\n    }\n    get focusWidget() {\n        return this._focusWidget;\n    }\n    setFocusWidget(w, reverse = false) {\n        if (w === this._focusWidget)\n            return;\n        if (this._focusWidget && this._focusWidget.blur(reverse))\n            return;\n        if (w && w.focus(reverse))\n            return;\n        this._focusWidget = w;\n    }\n    getWidget(id) {\n        return this._depthOrder.find((w) => w.attr('id') === id) || null;\n    }\n    nextTabStop() {\n        if (!this.focusWidget) {\n            this.setFocusWidget(this._attachOrder.find((w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden) || null);\n            return !!this.focusWidget;\n        }\n        const next = GWU.arrayNext(this._attachOrder, this.focusWidget, (w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden);\n        if (next) {\n            this.setFocusWidget(next);\n            return true;\n        }\n        return false;\n    }\n    prevTabStop() {\n        if (!this.focusWidget) {\n            this.setFocusWidget(this._attachOrder.find((w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden) || null);\n            return !!this.focusWidget;\n        }\n        const prev = GWU.arrayPrev(this._attachOrder, this.focusWidget, (w) => !!w.prop('tabStop') && !w.prop('disabled') && !w.hidden);\n        if (prev) {\n            this.setFocusWidget(prev, true);\n            return true;\n        }\n        return false;\n    }\n    // EVENTS\n    on(event, cb) {\n        this.body.on(event, cb);\n        return this;\n    }\n    off(event, cb) {\n        this.body.off(event, cb);\n        return this;\n    }\n    mousemove(e) {\n        const over = this.widgetAt(e);\n        over.mouseenter(e, over);\n        this._depthOrder.forEach((w) => {\n            w.mousemove(e); // handles mouseleave\n        });\n        return false; // TODO - this._done\n    }\n    click(e) {\n        let w = this.widgetAt(e);\n        let setFocus = false;\n        while (w) {\n            if (!setFocus && w.prop('tabStop') && !w.prop('disabled')) {\n                this.setFocusWidget(w);\n                setFocus = true;\n            }\n            if (w.click(e))\n                return false;\n            w = w.parent;\n        }\n        return false; // TODO - this._done\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        let w = this.focusWidget || this.body;\n        while (w) {\n            if (w.keypress(e))\n                return false;\n            w = w.parent;\n        }\n        //         const fn =\n        //             this.eventHandlers[e.key] ||\n        //             this.eventHandlers[e.code] ||\n        //             this.eventHandlers.keypress;\n        //         if (fn) {\n        //             if (await fn(e, this, this.focusWidget)) {\n        //                 return this.done;\n        //             }\n        //         }\n        if (e.defaultPrevented)\n            return false;\n        if (e.key === 'Tab') {\n            // Next widget\n            this.nextTabStop();\n        }\n        else if (e.key === 'TAB') {\n            // Prev Widget\n            this.prevTabStop();\n        }\n        //         return this.done;\n        return false;\n    }\n    dir(e) {\n        let target = this.focusWidget || this.body;\n        while (target) {\n            if (target.dir(e))\n                return false;\n            target = target.parent;\n        }\n        // return this.done;\n        return false;\n    }\n    tick(e) {\n        const dt = e.dt;\n        let promises = [];\n        this.timers.forEach((timer) => {\n            if (timer.time <= 0)\n                return; // ignore fired timers\n            timer.time -= dt;\n            if (timer.time <= 0) {\n                if (typeof timer.action === 'string') {\n                    promises.push(this.body._fireEvent(timer.action, this.body));\n                }\n                else {\n                    promises.push(timer.action());\n                }\n            }\n        });\n        for (let w of this._depthOrder) {\n            w.tick(e);\n        }\n        //         return this.done;\n        return false;\n    }\n    draw() {\n        if (this._hasTabStop && !this._focusWidget) {\n            this.nextTabStop();\n        }\n        if (this.styles.dirty) {\n            this.needsDraw = true;\n            this._depthOrder.forEach((w) => w.updateStyle());\n            this.styles.dirty = false;\n        }\n        if (!this.needsDraw)\n            return;\n        this.needsDraw = false;\n        this.ui.copyUIBuffer(this.buffer);\n        // draw from low depth to high depth\n        for (let i = this._depthOrder.length - 1; i >= 0; --i) {\n            const w = this._depthOrder[i];\n            w.draw(this.buffer);\n        }\n        console.log('draw');\n        this.buffer.render();\n    }\n    // LOOP\n    setTimeout(action, time) {\n        const slot = this.timers.findIndex((t) => t.time <= 0);\n        if (slot < 0) {\n            this.timers.push({ action, time });\n        }\n        else {\n            this.timers[slot] = { action, time };\n        }\n    }\n    clearTimeout(action) {\n        const timer = this.timers.find((t) => t.action === action);\n        if (timer) {\n            timer.time = -1;\n        }\n    }\n    finish(result) {\n        this.result = result;\n        this.ui.finishLayer(this);\n    }\n    _finish() {\n        if (!this._done)\n            return;\n        this._done(this.result);\n        this._done = null;\n    }\n}\n","export const widgets = {};\nexport function installWidget(tag, fn) {\n    widgets[tag] = fn;\n}\nexport function createWidget(tag, layer, opts) {\n    const fn = widgets[tag];\n    if (!fn)\n        throw new Error('Unknown tag = ' + tag);\n    return fn(layer, opts);\n}\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nimport { installWidget } from './make';\nimport { Layer } from '../layer';\nexport class Text extends Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this._text = '';\n        this._lines = [];\n        this._fixedWidth = false;\n        this._fixedHeight = false;\n        this._fixedHeight = !!opts.height;\n        this._fixedWidth = !!opts.width;\n        this.bounds.width = opts.width || 0;\n        this.bounds.height = opts.height || 1;\n        this.text(opts.text);\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        this._text = v;\n        let w = this._fixedWidth ? this.bounds.width : 100;\n        this._lines = GWU.text.splitIntoLines(this._text, w);\n        if (!this._fixedWidth) {\n            this.bounds.width = this._lines.reduce((out, line) => Math.max(out, GWU.text.length(line)), 0);\n        }\n        if (this._fixedHeight) {\n            if (this._lines.length > this.bounds.height) {\n                this._lines.length = this.bounds.height;\n            }\n        }\n        else {\n            this.bounds.height = Math.max(1, this._lines.length);\n        }\n        this.layer.needsDraw = true;\n        return this;\n    }\n    resize(w, h) {\n        super.resize(w, h);\n        this._fixedWidth = w > 0;\n        this._fixedHeight = h > 0;\n        this.text(this._text);\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        let vOffset = 0;\n        if (this._used.valign === 'bottom') {\n            vOffset = this.bounds.height - this._lines.length;\n        }\n        else if (this._used.valign === 'middle') {\n            vOffset = Math.floor((this.bounds.height - this._lines.length) / 2);\n        }\n        this._lines.forEach((line, i) => {\n            buffer.drawText(this.bounds.x, this.bounds.y + i + vOffset, line, this._used.fg, -1, this.bounds.width, this._used.align);\n        });\n        return true;\n    }\n}\ninstallWidget('text', (l, opts) => new Text(l, opts));\nLayer.prototype.text = function (text, opts = {}) {\n    const options = Object.assign({}, this._opts, opts, { text });\n    const list = new Text(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    this.pos(list.bounds.x, list.bounds.bottom);\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nimport { Layer } from '../layer';\nimport { installWidget } from './make';\nexport class Border extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.ascii = false;\n        if (opts.ascii) {\n            this.ascii = true;\n        }\n        else if (opts.fg && opts.ascii !== false) {\n            this.ascii = true;\n        }\n    }\n    contains(..._args) {\n        return false;\n    }\n    _draw(buffer) {\n        const w = this.bounds.width;\n        const h = this.bounds.height;\n        const x = this.bounds.x;\n        const y = this.bounds.y;\n        const ascii = this.ascii;\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        return true;\n    }\n}\ninstallWidget('border', (l, opts) => new Border(l, opts));\nLayer.prototype.border = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Border(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\nexport function drawBorder(buffer, x, y, w, h, style, ascii) {\n    const fg = style.fg;\n    const bg = style.bg;\n    if (ascii) {\n        for (let i = 1; i < w; ++i) {\n            buffer.draw(x + i, y, '-', fg, bg);\n            buffer.draw(x + i, y + h - 1, '-', fg, bg);\n        }\n        for (let j = 1; j < h; ++j) {\n            buffer.draw(x, y + j, '|', fg, bg);\n            buffer.draw(x + w - 1, y + j, '|', fg, bg);\n        }\n        buffer.draw(x, y, '+', fg, bg);\n        buffer.draw(x + w - 1, y, '+', fg, bg);\n        buffer.draw(x, y + h - 1, '+', fg, bg);\n        buffer.draw(x + w - 1, y + h - 1, '+', fg, bg);\n    }\n    else {\n        GWU.xy.forBorder(x, y, w, h, (x, y) => {\n            buffer.draw(x, y, ' ', bg, bg);\n        });\n    }\n}\n","import * as Text from './text';\nimport { installWidget } from './make';\nexport class Button extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.text = opts.text || '';\n            opts.action = opts.action || opts.id;\n            opts.tag = opts.tag || 'button';\n            return opts;\n        })());\n    }\n    keypress(ev) {\n        if (!ev.key)\n            return false;\n        if (ev.key === 'Enter') {\n            const action = this._attrStr('action');\n            if (action && action.length)\n                this._bubbleEvent(action, this);\n            return true;\n        }\n        return false;\n    }\n    click(ev) {\n        if (!this.contains(ev))\n            return false;\n        const action = this._attrStr('action');\n        if (action && action.length)\n            this._bubbleEvent(action, this);\n        return true;\n    }\n}\ninstallWidget('button', (l, opts) => new Button(l, opts));\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../layer';\nimport * as Text from './text';\nimport * as Widget from './widget';\nimport { drawBorder } from './border';\nexport function toPadArray(pad) {\n    if (!pad)\n        return [0, 0, 0, 0];\n    if (pad === true) {\n        return [1, 1, 1, 1];\n    }\n    else if (typeof pad === 'number') {\n        return [pad, pad, pad, pad];\n    }\n    else if (pad.length == 1) {\n        const p = pad[0];\n        return [p, p, p, p];\n    }\n    else if (pad.length == 2) {\n        const [pv, ph] = pad;\n        return [pv, ph, pv, ph];\n    }\n    throw new Error('Invalid pad: ' + pad);\n}\nexport class Dialog extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Dialog.default.tag;\n            return opts;\n        })());\n        this.legend = null;\n        let border = opts.border || Dialog.default.border;\n        this.attr('border', border);\n        const pad = toPadArray(opts.pad || Dialog.default.pad);\n        this.attr('padTop', pad[0]);\n        this.attr('padRight', pad[1]);\n        this.attr('padBottom', pad[2]);\n        this.attr('padLeft', pad[3]);\n        if (border !== 'none') {\n            for (let i = 0; i < 4; ++i) {\n                pad[i] += 1;\n            }\n        }\n        this._adjustBounds(pad);\n        this.attr('legendTag', opts.legendTag || Dialog.default.legendTag);\n        this.attr('legendClass', opts.legendClass || Dialog.default.legendClass);\n        this.attr('legendAlign', opts.legendAlign || Dialog.default.legendAlign);\n        this._addLegend(opts);\n    }\n    _adjustBounds(pad) {\n        // adjust w,h,x,y for border/pad\n        this.bounds.width += pad[1] + pad[3];\n        this.bounds.height += pad[0] + pad[2];\n        this.bounds.x -= pad[3];\n        this.bounds.y -= pad[0];\n        return this;\n    }\n    get _innerLeft() {\n        const border = this._attrStr('border');\n        const padLeft = this._attrInt('padLeft');\n        return this.bounds.x + padLeft + (border === 'none' ? 0 : 1);\n    }\n    get _innerWidth() {\n        const border = this._attrStr('border');\n        const padSize = this._attrInt('padLeft') + this._attrInt('padRight');\n        return this.bounds.width - padSize + (border === 'none' ? 0 : 2);\n    }\n    get _innerTop() {\n        const border = this._attrStr('border');\n        const padTop = this._attrInt('padTop');\n        return this.bounds.y + padTop + (border === 'none' ? 0 : 1);\n    }\n    get _innerHeight() {\n        const border = this._attrStr('border');\n        const padSize = this._attrInt('padTop') + this._attrInt('padBottom');\n        return this.bounds.height - padSize + (border === 'none' ? 0 : 2);\n    }\n    _addLegend(opts) {\n        if (!opts.legend) {\n            if (this._attrStr('border') === 'none') {\n                this.bounds.height = 0;\n            }\n            return this;\n        }\n        const border = this._attrStr('border') !== 'none';\n        const textWidth = GWU.text.length(opts.legend);\n        const width = this.bounds.width - (border ? 4 : 0);\n        const align = this._attrStr('legendAlign');\n        let x = this.bounds.x + (border ? 2 : 0);\n        if (align === 'center') {\n            x += Math.floor((width - textWidth) / 2);\n        }\n        else if (align === 'right') {\n            x += width - textWidth;\n        }\n        this.legend = new Text.Text(this.layer, {\n            text: opts.legend,\n            x,\n            y: this.bounds.y,\n            depth: this.depth + 1,\n            tag: this._attrStr('legendTag'),\n            class: this._attrStr('legendClass'),\n        });\n        // if (this.bounds.width < this.legend.bounds.width + 4) {\n        //     this.bounds.width = this.legend.bounds.width + 4;\n        // }\n        // this.bounds.height +=\n        //     this._attrInt('padTop') + this._attrInt('padBottom');\n        this.legend.setParent(this);\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        const border = this._attrStr('border');\n        if (border === 'none')\n            return false;\n        drawBorder(buffer, this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this._used, border === 'ascii');\n        return true;\n    }\n}\nDialog.default = {\n    tag: 'dialog',\n    border: 'none',\n    pad: false,\n    legendTag: 'legend',\n    legendClass: 'legend',\n    legendAlign: 'left',\n};\nLayer.prototype.dialog = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Dialog(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../layer';\nimport * as Text from './text';\nimport * as Dialog from './dialog';\nexport class Fieldset extends Dialog.Dialog {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Fieldset.default.tag;\n            opts.border = opts.border || Fieldset.default.border;\n            opts.legendTag = opts.legendTag || Fieldset.default.legendTag;\n            opts.legendClass =\n                opts.legendClass || Fieldset.default.legendClass;\n            opts.legendAlign =\n                opts.legendAlign || Fieldset.default.legendAlign;\n            return opts;\n        })());\n        this.fields = [];\n        this.attr('separator', opts.separator || Fieldset.default.separator);\n        this.attr('dataTag', opts.dataTag || Fieldset.default.dataTag);\n        this.attr('dataClass', opts.dataClass || Fieldset.default.dataClass);\n        this.attr('dataWidth', opts.dataWidth);\n        this.attr('labelTag', opts.labelTag || Fieldset.default.labelTag);\n        this.attr('labelClass', opts.labelClass || Fieldset.default.labelClass);\n        this.attr('labelWidth', this._innerWidth - opts.dataWidth);\n        this._addLegend(opts);\n    }\n    _adjustBounds(_pad) {\n        return this;\n    }\n    get _labelLeft() {\n        const border = this._attrStr('border');\n        const padLeft = this._attrInt('padLeft');\n        return this.bounds.x + padLeft + (border === 'none' ? 0 : 1);\n    }\n    get _dataLeft() {\n        return this._labelLeft + this._attrInt('labelWidth');\n    }\n    get _nextY() {\n        const border = this._attrStr('border');\n        const padBottom = this._attrInt('padBottom');\n        return this.bounds.bottom - (border === 'none' ? 0 : 1) - padBottom;\n    }\n    add(label, format) {\n        const sep = this._attrStr('separator');\n        const labelText = GWU.text.padEnd(label, this._attrInt('labelWidth') - sep.length, ' ') + sep;\n        this.layer.text(labelText, {\n            x: this._labelLeft,\n            y: this._nextY,\n            width: this._attrInt('labelWidth'),\n            tag: this._attrStr('labelTag'),\n            class: this._attrStr('labelClass'),\n        });\n        if (typeof format === 'string') {\n            format = { format };\n        }\n        format.x = this._dataLeft;\n        format.y = this._nextY;\n        format.width = this._attrInt('dataWidth');\n        format.tag = format.tag || this._attrStr('dataTag');\n        format.class = format.class || this._attrStr('dataClass');\n        const field = new Field(this.layer, format);\n        field.setParent(this);\n        this.bounds.height += 1;\n        this.fields.push(field);\n        return this;\n    }\n    data(d) {\n        this.fields.forEach((f) => f.data(d));\n        this.layer.needsDraw = true;\n        return this;\n    }\n}\nFieldset.default = {\n    tag: 'fieldset',\n    border: 'none',\n    separator: ' : ',\n    pad: false,\n    legendTag: 'legend',\n    legendClass: 'legend',\n    legendAlign: 'left',\n    labelTag: 'label',\n    labelClass: '',\n    dataTag: 'field',\n    dataClass: '',\n};\nLayer.prototype.fieldset = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Fieldset(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\nexport class Field extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            // @ts-ignore\n            const topts = opts;\n            topts.tag = topts.tag || 'field';\n            topts.text = '';\n            return topts;\n        })());\n        if (typeof opts.format === 'string') {\n            this._format = GWU.text.compile(opts.format);\n        }\n        else {\n            this._format = opts.format;\n        }\n    }\n    data(v) {\n        const t = this._format(v) || '';\n        return this.text(t);\n    }\n}\n","import { Layer } from '../layer';\nimport * as Widget from './widget';\nexport class OrderedList extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'ol';\n            return opts;\n        })());\n        this._fixedWidth = false;\n        this._fixedHeight = false;\n        this._fixedHeight = !!opts.height;\n        this._fixedWidth = !!opts.width;\n        this.prop('pad', opts.pad || OrderedList.default.pad);\n    }\n    _addChild(w, opts = {}) {\n        w.bounds.x = this.bounds.x + 2;\n        if (!this._fixedHeight) {\n            w.bounds.y = this.bounds.bottom - 2;\n            this.bounds.height += w.bounds.height;\n        }\n        if (this._fixedWidth) {\n            w.bounds.width = Math.min(w.bounds.width, this.bounds.width - 4);\n        }\n        else if (w.bounds.width > this.bounds.width - 4) {\n            this.bounds.width = w.bounds.width + 4;\n        }\n        return super._addChild(w, opts);\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        this.children.forEach((c, i) => {\n            this._drawBulletFor(c, buffer, i);\n        });\n        return true;\n    }\n    _getBullet(index) {\n        return '' + (index + 1);\n    }\n    _drawBulletFor(widget, buffer, index) {\n        const bullet = this._getBullet(index);\n        const size = this._attrInt('pad') + bullet.length;\n        const x = widget.bounds.x - size;\n        const y = widget.bounds.y;\n        buffer.drawText(x, y, bullet, widget._used.fg, widget._used.bg, size);\n    }\n}\nOrderedList.default = {\n    pad: 1,\n};\nexport class UnorderedList extends OrderedList {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'ul';\n            return opts;\n        })());\n        this.prop('bullet', opts.bullet || UnorderedList.default.bullet);\n        this.prop('pad', opts.pad || UnorderedList.default.pad);\n    }\n    _getBullet(_index) {\n        return this._attrStr('bullet');\n    }\n}\nUnorderedList.default = {\n    bullet: '\\u2022',\n    pad: 1,\n};\nLayer.prototype.ol = function (opts = {}) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new OrderedList(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\nLayer.prototype.ul = function (opts = {}) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new UnorderedList(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../layer';\nimport * as Text from './text';\nimport { installWidget } from './make';\nimport * as Style from '../style';\nStyle.defaultStyle.add('input', {\n    bg: 'light_gray',\n    fg: 'black',\n    align: 'left',\n    valign: 'top',\n});\nStyle.defaultStyle.add('input:invalid', {\n    fg: 'red',\n});\nStyle.defaultStyle.add('input:empty', {\n    fg: 'darkest_green',\n});\nStyle.defaultStyle.add('input:focus', {\n    bg: 'lighter_gray',\n});\nexport class Input extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.text = opts.text || '';\n            opts.tag = opts.tag || 'input';\n            opts.tabStop = opts.tabStop === undefined ? true : opts.tabStop;\n            opts.action = opts.action || opts.id;\n            opts.width =\n                opts.width ||\n                    opts.maxLength ||\n                    Math.max(opts.minLength || 0, 10);\n            return opts;\n        })());\n        this.minLength = 0;\n        this.maxLength = 0;\n        this.numbersOnly = false;\n        this.min = 0;\n        this.max = 0;\n        this.attr('default', this._text);\n        this.attr('placeholder', opts.placeholder || Input.default.placeholder);\n        if (opts.numbersOnly) {\n            this.numbersOnly = true;\n            this.min = opts.min || 0;\n            this.max = opts.max || 0;\n        }\n        else {\n            this.minLength = opts.minLength || 0;\n            this.maxLength = opts.maxLength || 0;\n        }\n        if (opts.required) {\n            this.attr('required', true);\n            this.prop('required', true);\n        }\n        if (opts.disabled) {\n            this.attr('disabled', true);\n            this.prop('disabled', true);\n        }\n        this.prop('valid', this.isValid()); // redo b/c rules are now set\n        this.on('blur', () => this._fireEvent('change', this));\n        this.reset();\n    }\n    reset() {\n        this.text(this._attrStr('default'));\n    }\n    _setProp(name, v) {\n        super._setProp(name, v);\n        this._props.valid = this.isValid();\n    }\n    isValid() {\n        const t = this._text || '';\n        if (this.numbersOnly) {\n            const val = Number.parseInt(t);\n            if (this.min !== undefined && val < this.min)\n                return false;\n            if (this.max !== undefined && val > this.max)\n                return false;\n            return val > 0;\n        }\n        const minLength = Math.max(this.minLength, this.prop('required') ? 1 : 0);\n        return (t.length >= minLength &&\n            (!this.maxLength || t.length <= this.maxLength));\n    }\n    keypress(ev) {\n        if (!ev.key)\n            return false;\n        const textEntryBounds = this.numbersOnly ? ['0', '9'] : [' ', '~'];\n        if (ev.key === 'Enter' && this.isValid()) {\n            const action = this._attrStr('action');\n            if (action && action.length) {\n                this._fireEvent(action, this);\n            }\n            else {\n                this.layer.nextTabStop();\n            }\n            return true;\n        }\n        if (ev.key == 'Delete' || ev.key == 'Backspace') {\n            if (this._text.length) {\n                this.text(GWU.text.spliceRaw(this._text, this._text.length - 1, 1));\n                this._fireEvent('input', this);\n                this._draw(this.layer.buffer); // save some work?\n            }\n            return true;\n        }\n        else if (ev.key.length > 1) {\n            // ignore other special keys...\n            return false;\n        }\n        // eat/use all other keys\n        if (ev.key >= textEntryBounds[0] && ev.key <= textEntryBounds[1]) {\n            // allow only permitted input\n            if (!this.maxLength || this._text.length < this.maxLength) {\n                this.text(this._text + ev.key);\n                this._fireEvent('input', this);\n                this._draw(this.layer.buffer); // save some work?\n            }\n        }\n        return true;\n    }\n    text(v) {\n        if (v === undefined)\n            return this._text;\n        super.text(v);\n        this.prop('empty', this._text.length === 0);\n        this.prop('valid', this.isValid());\n        return this;\n    }\n    _draw(buffer, _force = false) {\n        this._drawFill(buffer);\n        let vOffset = 0;\n        if (this._used.valign === 'bottom') {\n            vOffset = this.bounds.height - this._lines.length;\n        }\n        else if (this._used.valign === 'middle') {\n            vOffset = Math.floor((this.bounds.height - this._lines.length) / 2);\n        }\n        let show = this._text;\n        if (show.length == 0) {\n            show = this._attrStr('placeholder');\n        }\n        if (this._text.length > this.bounds.width) {\n            show = this._text.slice(this._text.length - this.bounds.width);\n        }\n        buffer.drawText(this.bounds.x, this.bounds.y + vOffset, show, this._used.fg, -1, this.bounds.width, this._used.align);\n        return true;\n    }\n}\nInput.default = {\n    tag: 'input',\n    width: 10,\n    placeholder: '',\n};\ninstallWidget('input', (l, opts) => new Input(l, opts));\nLayer.prototype.input = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Input(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport { Widget } from './widget';\nimport { Text } from './text';\nimport { drawBorder } from './border';\nimport { installWidget } from './make';\nimport { Layer } from '../layer';\nexport class Column {\n    constructor(opts) {\n        this.format = GWU.IDENTITY;\n        this.width = opts.width || DataTable.default.columnWidth;\n        if (typeof opts.format === 'function') {\n            this.format = opts.format;\n        }\n        else if (opts.format) {\n            this.format = GWU.text.compile(opts.format);\n        }\n        this.header = opts.header || '';\n        this.headerTag = opts.headerTag || DataTable.default.headerTag;\n        this.empty = opts.empty || DataTable.default.empty;\n        this.dataTag = opts.dataTag || DataTable.default.dataTag;\n    }\n    addHeader(table, x, y, col) {\n        const t = new Text(table.layer, {\n            x,\n            y,\n            class: table.classes,\n            tag: table._attrStr('headerTag'),\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n            text: this.header,\n        });\n        t.prop('row', -1);\n        t.prop('col', col);\n        t.setParent(table);\n        table.layer.attach(t);\n        return t;\n    }\n    addData(table, data, x, y, col, row) {\n        let text;\n        if (Array.isArray(data)) {\n            text = '' + (data[col] || this.empty);\n        }\n        else if (typeof data !== 'object') {\n            text = '' + data;\n        }\n        else {\n            text = this.format(data);\n        }\n        const widget = new TD(table.layer, {\n            text,\n            x,\n            y,\n            class: table.classes,\n            tag: table._attrStr('dataTag'),\n            width: this.width,\n            height: table.rowHeight,\n            depth: table.depth + 1,\n        });\n        widget.prop(row % 2 == 0 ? 'even' : 'odd', true);\n        widget.prop('row', row);\n        widget.prop('col', col);\n        widget.setParent(table);\n        table.layer.attach(widget);\n        return widget;\n    }\n    addEmpty(table, x, y, col, row) {\n        return this.addData(table, [], x, y, col, row);\n    }\n}\nColumn.default = {\n    select: 'row',\n    hover: 'select',\n    tag: 'datatable',\n    headerTag: 'th',\n    dataTag: 'td',\n    border: 'ascii',\n};\nexport class DataTable extends Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || DataTable.default.tag;\n            opts.tabStop = opts.tabStop === undefined ? true : opts.tabStop;\n            return opts;\n        })());\n        this._data = [];\n        this.columns = [];\n        this.showHeader = false;\n        this.rowHeight = 1;\n        this.selectedRow = -1;\n        this.selectedColumn = 0;\n        this.size = opts.size || layer.height;\n        this.bounds.width = 0;\n        opts.columns.forEach((o) => {\n            const col = new Column(o);\n            this.columns.push(col);\n            this.bounds.width += col.width;\n        });\n        if (opts.border) {\n            if (opts.border === true)\n                opts.border = 'ascii';\n        }\n        else if (opts.border === false) {\n            opts.border = 'none';\n        }\n        this.attr('border', opts.border || DataTable.default.border);\n        this.rowHeight = opts.rowHeight || 1;\n        this.bounds.height = 1;\n        this.attr('wrap', opts.wrap === undefined ? DataTable.default.wrap : opts.wrap);\n        this.attr('header', opts.header === undefined ? DataTable.default.header : opts.header);\n        this.attr('headerTag', opts.headerTag || DataTable.default.headerTag);\n        this.attr('dataTag', opts.dataTag || DataTable.default.dataTag);\n        this.attr('prefix', opts.prefix || DataTable.default.prefix);\n        this.attr('select', opts.select || DataTable.default.select);\n        this.attr('hover', opts.hover || DataTable.default.hover);\n        this.data(opts.data || []);\n    }\n    get selectedData() {\n        if (this.selectedRow < 0)\n            return undefined;\n        return this._data[this.selectedRow];\n    }\n    select(col, row) {\n        if (!this._data || this._data.length == 0) {\n            this.selectedRow = this.selectedColumn = 0;\n            return this;\n        }\n        if (this.attr('wrap')) {\n            if (col < 0 || col >= this.columns.length) {\n                col += this.columns.length;\n                col %= this.columns.length;\n            }\n            if (row < 0 || row >= this._data.length) {\n                row += this._data.length;\n                row %= this._data.length;\n            }\n        }\n        col = this.selectedColumn = GWU.clamp(col, 0, this.columns.length - 1);\n        row = this.selectedRow = GWU.clamp(row, 0, this._data.length - 1);\n        const select = this._attrStr('select');\n        if (select === 'none') {\n            this.children.forEach((c) => {\n                c.prop('selected', false);\n            });\n        }\n        else if (select === 'row') {\n            this.children.forEach((c) => {\n                const active = row == c.prop('row');\n                c.prop('selected', active);\n            });\n        }\n        else if (select === 'column') {\n            this.children.forEach((c) => {\n                const active = col == c.prop('col');\n                c.prop('selected', active);\n            });\n        }\n        else if (select === 'cell') {\n            this.children.forEach((c) => {\n                const active = col == c.prop('col') && row == c.prop('row');\n                c.prop('selected', active);\n            });\n        }\n        this._bubbleEvent('input', this, { row, col, data: this.selectedData });\n        return this;\n    }\n    selectNextRow() {\n        return this.select(this.selectedColumn, this.selectedRow + 1);\n    }\n    selectPrevRow() {\n        return this.select(this.selectedColumn, this.selectedRow - 1);\n    }\n    selectNextCol() {\n        return this.select(this.selectedColumn + 1, this.selectedRow);\n    }\n    selectPrevCol() {\n        return this.select(this.selectedColumn - 1, this.selectedRow);\n    }\n    blur(reverse) {\n        this._bubbleEvent('change', this, {\n            col: this.selectedColumn,\n            row: this.selectedRow,\n            data: this.selectedData,\n        });\n        return super.blur(reverse);\n    }\n    data(data) {\n        if (!data)\n            return this._data;\n        this._data = data;\n        for (let i = this.children.length - 1; i >= 0; --i) {\n            const c = this.children[i];\n            if (c.tag !== this.attr('headerTag')) {\n                this.layer.detach(c);\n            }\n        }\n        const borderAdj = this.attr('border') !== 'none' ? 1 : 0;\n        let x = this.bounds.x + borderAdj;\n        let y = this.bounds.y + borderAdj;\n        if (this.attr('header')) {\n            this.columns.forEach((col, i) => {\n                col.addHeader(this, x, y, i);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        }\n        this._data.forEach((obj, j) => {\n            if (j >= this.size)\n                return;\n            x = this.bounds.x + borderAdj;\n            this.columns.forEach((col, i) => {\n                col.addData(this, obj, x, y, i, j);\n                x += col.width + borderAdj;\n            });\n            y += this.rowHeight + borderAdj;\n        });\n        if (this._data.length == 0) {\n            x = this.bounds.x + borderAdj;\n            this.columns.forEach((col, i) => {\n                col.addEmpty(this, x, y, i, 0);\n                x += col.width + borderAdj;\n            });\n            y += 1;\n            this.select(-1, -1);\n        }\n        else {\n            this.select(0, 0);\n        }\n        this.bounds.height = y - this.bounds.y;\n        this.bounds.width = x - this.bounds.x;\n        this.updateStyle(); // sets this.needsDraw\n        return this;\n    }\n    _draw(buffer) {\n        this._drawFill(buffer);\n        this.children.forEach((w) => {\n            if (w.prop('row') >= this.size)\n                return;\n            if (this.attr('border') !== 'none') {\n                drawBorder(buffer, w.bounds.x - 1, w.bounds.y - 1, w.bounds.width + 2, w.bounds.height + 2, this._used, this.attr('border') == 'ascii');\n            }\n        });\n        return true;\n    }\n    mouseenter(e, over) {\n        super.mouseenter(e, over);\n        if (!this.hovered)\n            return;\n        const hovered = this.children.find((c) => c.contains(e));\n        if (hovered) {\n            const col = hovered._propInt('col');\n            const row = hovered._propInt('row');\n            if (col !== this.selectedColumn || row !== this.selectedRow) {\n                this.selectedColumn = col;\n                this.selectedRow = row;\n                let select = false;\n                let hover = this._attrStr('hover');\n                if (hover === 'select') {\n                    hover = this._attrStr('select');\n                    select = true;\n                }\n                if (hover === 'none') {\n                    this.children.forEach((c) => {\n                        c.hovered = false;\n                        if (select)\n                            c.prop('selected', false);\n                    });\n                }\n                else if (hover === 'row') {\n                    this.children.forEach((c) => {\n                        const active = row == c.prop('row');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                else if (hover === 'column') {\n                    this.children.forEach((c) => {\n                        const active = col == c.prop('col');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                else if (hover === 'cell') {\n                    this.children.forEach((c) => {\n                        const active = col == c.prop('col') && row == c.prop('row');\n                        c.hovered = active;\n                        if (select)\n                            c.prop('selected', active);\n                    });\n                }\n                this._bubbleEvent('input', this, {\n                    row,\n                    col,\n                    data: this.selectedData,\n                });\n            }\n        }\n    }\n    click(e) {\n        if (!this.contains(e))\n            return false;\n        this._bubbleEvent('change', this, {\n            row: this.selectedRow,\n            col: this.selectedColumn,\n            data: this.selectedData,\n        });\n        return false;\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Enter') {\n            this._bubbleEvent('change', this, {\n                row: this.selectedRow,\n                col: this.selectedColumn,\n                data: this.selectedData,\n            });\n            return true;\n        }\n        return false;\n    }\n    dir(e) {\n        if (!e.dir)\n            return false;\n        if (e.dir[1] == 1) {\n            this.selectNextRow();\n        }\n        else if (e.dir[1] == -1) {\n            this.selectPrevRow();\n        }\n        if (e.dir[0] == 1) {\n            this.selectNextCol();\n        }\n        else if (e.dir[0] == -1) {\n            this.selectPrevCol();\n        }\n        return true;\n    }\n}\nDataTable.default = {\n    columnWidth: 10,\n    header: true,\n    empty: '-',\n    tag: 'datatable',\n    headerTag: 'th',\n    dataTag: 'td',\n    select: 'cell',\n    hover: 'select',\n    prefix: 'none',\n    border: 'ascii',\n    wrap: true,\n};\ninstallWidget('datatable', (l, opts) => new DataTable(l, opts));\nexport class TD extends Text {\n    mouseleave(e) {\n        super.mouseleave(e);\n        if (this.parent) {\n            const table = this.parent;\n            if (table.attr('select') === 'row') {\n                this.hovered = this._propInt('row') === table.selectedRow;\n            }\n            else if (table.attr('select') === 'column') {\n                this.hovered = this._propInt('col') === table.selectedColumn;\n            }\n        }\n    }\n}\nLayer.prototype.datatable = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new DataTable(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as DataTable from './datatable';\nimport { installWidget } from './make';\nimport { Layer } from '../layer';\nexport class DataList extends DataTable.DataTable {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            // @ts-ignore\n            const tableOpts = opts;\n            if (opts.border !== 'none' && opts.width) {\n                opts.width -= 2;\n            }\n            tableOpts.columns = [Object.assign({}, opts)];\n            if (!opts.header || !opts.header.length) {\n                tableOpts.header = false;\n            }\n            return tableOpts;\n        })());\n    }\n}\ninstallWidget('list', (l, opts) => new DataList(l, opts));\nLayer.prototype.datalist = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new DataList(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\n// import * as Button from './button';\nimport * as Text from './text';\nimport { Layer } from '../layer';\nimport { installWidget } from './make';\nexport class Menu extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Menu.default.tag;\n            opts.class = opts.class || Menu.default.class;\n            return opts;\n        })());\n        if (Array.isArray(opts.buttonClass)) {\n            this.attr('buttonClass', opts.buttonClass.join(' '));\n        }\n        else {\n            this.attr('buttonClass', opts.buttonClass || Menu.default.buttonClass);\n        }\n        this.attr('buttonTag', opts.buttonTag || Menu.default.buttonTag);\n        this.attr('marker', opts.marker || Menu.default.marker);\n        this._initButtons(opts);\n        this.bounds.height = this.children.length;\n        this.on('mouseenter', (_n, _w, e) => {\n            this.children.forEach((c) => {\n                if (!c.contains(e)) {\n                    c.collapse();\n                }\n                else {\n                    c.expand();\n                }\n            });\n            return true;\n        });\n    }\n    _initButtons(opts) {\n        this.children = [];\n        const buttons = opts.buttons;\n        const marker = this._attrStr('marker');\n        const entries = Object.entries(buttons);\n        if (this.bounds.width <= 0) {\n            this.bounds.width = Math.max(opts.minWidth || 0, entries.reduce((out, [key, value]) => {\n                const textLen = GWU.text.length(key) +\n                    (typeof value === 'string' ? 0 : marker.length);\n                return Math.max(out, textLen);\n            }, 0));\n        }\n        entries.forEach(([key, value], i) => {\n            const opts = {\n                x: this.bounds.x,\n                y: this.bounds.y + i,\n                class: this._attrStr('buttonClass'),\n                tag: this._attrStr('buttonTag'),\n                width: this.bounds.width,\n                height: 1,\n                depth: this.depth + 1,\n                buttons: value,\n                text: key,\n            };\n            if (typeof value === 'string') {\n                opts.action = value;\n            }\n            else {\n                opts.text =\n                    GWU.text.padEnd(key, this.bounds.width - marker.length, ' ') + marker;\n            }\n            const menuItem = new MenuButton(this.layer, opts);\n            menuItem.setParent(this);\n            menuItem.on('mouseenter', () => {\n                this._bubbleEvent('change', menuItem);\n                return false;\n            });\n            menuItem.setParent(this);\n        });\n    }\n    collapse() {\n        this.children.forEach((c) => {\n            c.collapse();\n        });\n        return this;\n    }\n}\nMenu.default = {\n    tag: 'menu',\n    class: '',\n    buttonClass: '',\n    buttonTag: 'mi',\n    marker: ' \\u25b6',\n    minWidth: 4,\n};\nexport class MenuButton extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'mi';\n            return opts;\n        })());\n        this.menu = null;\n        this.tag = opts.tag || 'mi';\n        if (typeof opts.buttons !== 'string') {\n            this.menu = this._initMenu(opts);\n            this.on('mouseenter', () => {\n                this.menu.hidden = false;\n                this.menu._bubbleEvent('change', this);\n                return true;\n            });\n            this.on('mouseleave', (_n, _w, e) => {\n                var _a;\n                if ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.contains(e)) {\n                    this.menu.hidden = true;\n                    return true;\n                }\n                return false;\n            });\n            this.on('click', () => {\n                return true; // eat clicks\n            });\n        }\n    }\n    collapse() {\n        if (this.menu) {\n            this.menu.collapse();\n            this.menu.hidden = true;\n        }\n        return this;\n    }\n    expand() {\n        if (this.menu) {\n            this.menu.hidden = false;\n        }\n        return this;\n    }\n    _setMenuPos(xy, opts) {\n        xy.x = this.bounds.x + this.bounds.width;\n        xy.y = this.bounds.y;\n        const height = Object.keys(opts.buttons).length;\n        if (xy.y + height >= this.layer.height) {\n            xy.y = this.layer.height - height - 1;\n        }\n    }\n    _initMenu(opts) {\n        if (typeof opts.buttons === 'string')\n            return null;\n        const menuOpts = {\n            x: this.bounds.x + this.bounds.width,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'mi',\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        };\n        this._setMenuPos(menuOpts, opts);\n        const menu = new Menu(this.layer, menuOpts);\n        menu.hidden = true;\n        menu.setParent(this);\n        return menu;\n    }\n}\ninstallWidget('menu', (l, opts) => new Menu(l, opts));\nLayer.prototype.menu = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Menu(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as Widget from './widget';\nimport { Layer } from '../layer';\nimport { installWidget } from './make';\nimport { Menu } from './menu';\nimport * as Text from './text';\nexport class Menubar extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tabStop = true;\n            opts.tag = opts.tag || 'menu';\n            return opts;\n        })());\n        this._buttons = [];\n        this._selectedIndex = -1;\n        if (opts.buttonClass) {\n            if (Array.isArray(opts.buttonClass)) {\n                this.attr('buttonClass', opts.buttonClass.join(' '));\n            }\n            else {\n                this.attr('buttonClass', opts.buttonClass);\n            }\n        }\n        else {\n            this.attr('buttonClass', Menubar.default.buttonClass);\n        }\n        this.attr('buttonTag', opts.buttonTag || Menubar.default.buttonTag);\n        if (opts.menuClass) {\n            if (Array.isArray(opts.menuClass)) {\n                this.attr('menuClass', opts.menuClass.join(' '));\n            }\n            else {\n                this.attr('menuClass', opts.menuClass);\n            }\n        }\n        else {\n            this.attr('menuClass', Menubar.default.menuClass);\n        }\n        this.attr('menuTag', opts.menuTag || Menubar.default.menuTag);\n        this.attr('prefix', opts.prefix || Menubar.default.prefix);\n        this.attr('separator', opts.separator || Menubar.default.separator);\n        this._initButtons(opts);\n        this.on('click', this._buttonClick.bind(this));\n    }\n    get selectedIndex() {\n        return this._selectedIndex;\n    }\n    set selectedIndex(v) {\n        if (this._selectedIndex >= 0) {\n            this._buttons[this._selectedIndex].prop('focus', false).collapse();\n        }\n        this._selectedIndex = v;\n        if (v >= 0 && v < this._buttons.length) {\n            this._buttons[v].prop('focus', true).expand();\n        }\n        else {\n            this._selectedIndex = -1;\n        }\n    }\n    get selectedButton() {\n        return this._buttons[this._selectedIndex];\n    }\n    focus(reverse = false) {\n        if (reverse) {\n            this.selectedIndex = this._buttons.length - 1;\n        }\n        else {\n            this.selectedIndex = 0;\n        }\n        return super.focus(reverse);\n    }\n    blur(reverse = false) {\n        this.selectedIndex = -1;\n        return super.blur(reverse);\n    }\n    collapse() {\n        return this._buttons.reduce((out, b) => b.collapse() || out, false);\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (!this.focused)\n            return false;\n        if (e.key === 'Tab') {\n            this.selectedIndex += 1;\n            return this._selectedIndex >= 0;\n        }\n        else if (e.key === 'TAB') {\n            this.selectedIndex -= 1;\n            return this._selectedIndex >= 0;\n        }\n        return false;\n    }\n    mousemove(e) {\n        if (!this.contains(e) || !this.focused)\n            return super.mousemove(e);\n        const active = this._buttons.findIndex((c) => c.contains(e));\n        if (active < 0 || active === this._selectedIndex)\n            return false;\n        this.selectedIndex = active;\n        return true;\n    }\n    _initButtons(opts) {\n        this._config = opts.buttons;\n        const entries = Object.entries(this._config);\n        const buttonTag = this._attrStr('buttonTag');\n        const buttonClass = this._attrStr('buttonClass');\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        entries.forEach(([key, value], i) => {\n            const prefix = i == 0 ? this._attrStr('prefix') : this._attrStr('separator');\n            this.layer.text(prefix, { x, y, parent: this });\n            x += prefix.length;\n            const button = new MenubarButton(this.layer, {\n                text: key,\n                x,\n                y,\n                tag: buttonTag,\n                class: buttonClass,\n                depth: this.depth + 1,\n                buttons: value,\n                // data: value,\n            });\n            button.setParent(this);\n            this._buttons.push(button);\n            x += button.bounds.width;\n        });\n    }\n    _buttonClick(_action, button) {\n        if (!button)\n            return false;\n        this.layer.setFocusWidget(this);\n        console.log('clicked = ' + button.text(), button._attrStr('action'));\n        const barButton = button;\n        this.selectedIndex = this._buttons.indexOf(barButton);\n        if (barButton.menu) {\n            barButton.expand();\n        }\n        else {\n            this.collapse();\n        }\n        return true;\n    }\n}\nMenubar.default = {\n    buttonClass: '',\n    buttonTag: 'mi',\n    menuClass: '',\n    menuTag: 'mi',\n    prefix: ' ',\n    separator: ' | ',\n};\ninstallWidget('menubar', (l, opts) => new Menubar(l, opts));\nexport class MenubarButton extends Text.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'mi';\n            if (typeof opts.buttons === 'string') {\n                opts.action = opts.buttons;\n            }\n            return opts;\n        })());\n        this.menu = null;\n        this.tag = opts.tag || 'mi';\n        if (typeof opts.buttons !== 'string') {\n            this.menu = this._initMenu(opts);\n            this.on('mouseenter', () => {\n                this.menu.hidden = false;\n                this.menu._bubbleEvent('change', this);\n                return true;\n            });\n            this.on('mouseleave', (_n, _w, e) => {\n                var _a;\n                if ((_a = this.parent) === null || _a === void 0 ? void 0 : _a.contains(e)) {\n                    this.menu.hidden = true;\n                    return true;\n                }\n                return false;\n            });\n            this.on('click', () => {\n                return true; // eat clicks\n            });\n        }\n    }\n    collapse() {\n        if (!this.menu || this.menu.hidden)\n            return false;\n        this.menu.collapse();\n        this.menu.hidden = true;\n        return true;\n    }\n    expand() {\n        if (this.menu) {\n            this.menu.hidden = false;\n        }\n        return this;\n    }\n    _setMenuPos(xy, opts) {\n        xy.x = this.bounds.x;\n        const height = opts.height || Object.keys(opts.buttons).length;\n        if (this.bounds.y < height) {\n            xy.y = this.bounds.y + 1;\n        }\n        else {\n            xy.y = this.bounds.top - height;\n        }\n    }\n    _initMenu(opts) {\n        if (typeof opts.buttons === 'string')\n            return null;\n        const menuOpts = {\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'mi',\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        };\n        this._setMenuPos(menuOpts, opts);\n        const menu = new Menu(this.layer, menuOpts);\n        menu.hidden = true;\n        menu.setParent(this);\n        return menu;\n    }\n}\nLayer.prototype.menubar = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const menubar = new Menubar(this, options);\n    if (opts.parent) {\n        menubar.setParent(opts.parent, opts);\n    }\n    return menubar;\n};\n// MENU\nexport class MenuViewer extends Widget.Widget {\n    constructor(menubar, buttons) {\n        super(menubar.layer, {\n            tabStop: true,\n            x: 0,\n            y: 0,\n            width: menubar.layer.width,\n            height: menubar.layer.height,\n            // @ts-ignore\n            tag: menubar.attr('menuTag'),\n            // @ts-ignore\n            class: menubar.attr('menuClass'),\n        });\n        this.menubar = menubar;\n        this.mainMenu = this._initMenu(buttons);\n    }\n    contains() {\n        return true;\n    }\n    finish() {\n        this.layer.finish();\n    }\n    _initMenu(buttons) {\n        return new Menu(this.layer, {\n            buttonTag: this.menubar._attrStr('buttonTag'),\n            buttonClass: this.menubar._attrStr('buttonClass'),\n            minWidth: this.menubar.selectedButton.bounds.width,\n            buttons,\n        });\n    }\n    keypress(e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Escape') {\n            this.finish();\n            return true;\n        }\n        else if (e.key === 'Tab') {\n            this.finish();\n            this.menubar.keypress(e);\n            return true;\n        }\n        else if (e.key === 'TAB') {\n            this.finish();\n            this.menubar.keypress(e);\n            return true;\n        }\n        return false;\n    }\n}\n","// import * as GWU from 'gw-utils';\nimport * as Widget from './widget';\nimport * as Menu from './menu';\nimport * as Text from './text';\nimport { Layer } from '../layer';\nimport { installWidget } from './make';\nexport class Select extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.tag = opts.tag || 'select';\n        this._initText(opts);\n        this._initMenu(opts);\n        this.bounds.height = 1; // just the text component\n    }\n    _initText(opts) {\n        this.dropdown = new Text.Text(this.layer, {\n            text: opts.text + ' \\u25bc',\n            x: this.bounds.x,\n            y: this.bounds.y,\n            class: opts.class,\n            tag: opts.tag || 'select',\n            width: this.bounds.width,\n            height: 1,\n            depth: this.depth + 1,\n        }).on('click', () => {\n            this.menu.toggleProp('hidden');\n            return false;\n        });\n        this.dropdown.setParent(this, { beforeIndex: 0 });\n    }\n    _initMenu(opts) {\n        this.menu = new Menu.Menu(this.layer, {\n            x: this.bounds.x,\n            y: this.bounds.y + 1,\n            class: opts.buttonClass,\n            tag: opts.buttonTag || 'select',\n            width: opts.width,\n            minWidth: this.dropdown.bounds.width,\n            height: opts.height,\n            buttons: opts.buttons,\n            depth: this.depth + 1,\n        }).on('click', () => {\n            this.menu.hidden = true;\n            return false;\n        });\n        this.menu.hidden = true;\n        this.menu.setParent(this);\n    }\n}\ninstallWidget('select', (l, opts) => new Select(l, opts));\nLayer.prototype.select = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const list = new Select(this, options);\n    if (opts.parent) {\n        list.setParent(opts.parent, opts);\n    }\n    return list;\n};\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../layer';\nimport * as Text from './text';\nimport * as Widget from './widget';\nimport { drawBorder } from './border';\nimport { DataList } from './datalist';\nexport class Prompt {\n    constructor(question, field = {}) {\n        this._id = null;\n        this._defaultNext = null;\n        this.selection = -1;\n        if (typeof field === 'string') {\n            field = { field };\n        }\n        this._prompt = question;\n        this._field = field.field || '';\n        this._choices = [];\n        this._infos = [];\n        this._values = [];\n        this._next = [];\n        this._defaultNext = field.next || null;\n        this._id = field.id || field.field || '';\n    }\n    reset() {\n        this.selection = -1;\n    }\n    field(v) {\n        if (v === undefined)\n            return this._field;\n        this._field = v;\n        return this;\n    }\n    id(v) {\n        if (v === undefined)\n            return this._id;\n        this._id = v;\n        return this;\n    }\n    prompt(arg) {\n        if (typeof this._prompt === 'string')\n            return this._prompt;\n        return this._prompt(arg);\n    }\n    next(v) {\n        if (v === undefined)\n            return this._next[this.selection] || this._defaultNext;\n        this._defaultNext = v;\n        return this;\n    }\n    choices(choice, info) {\n        if (choice === undefined)\n            return this._choices;\n        if (!Array.isArray(choice)) {\n            info = Object.values(choice);\n            choice = Object.keys(choice);\n        }\n        else if (!Array.isArray(info)) {\n            info = new Array(choice.length).fill('');\n        }\n        info = info.map((i) => {\n            if (typeof i === 'string')\n                return { info: i };\n            return i;\n        });\n        if (choice.length !== info.length)\n            throw new Error('Choices and Infos must have same length.');\n        choice.forEach((c, i) => {\n            this.choice(c, info[i]);\n        });\n        return this;\n    }\n    choice(choice, info = {}) {\n        if (typeof info === 'string') {\n            info = { info: info };\n        }\n        this._choices.push(choice);\n        this._infos.push(info.info || '');\n        this._next.push(info.next || null);\n        this._values.push(info.value || choice);\n        return this;\n    }\n    info(arg) {\n        const i = this._infos[this.selection] || '';\n        if (typeof i === 'string')\n            return i;\n        return i(arg);\n    }\n    choose(n) {\n        this.selection = n;\n        return this;\n    }\n    value() {\n        return this._values[this.selection];\n    }\n    updateResult(res) {\n        if (this.selection < 0)\n            return this;\n        res[this._field] = this.value();\n        return this;\n    }\n}\nexport class Choice extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || Choice.default.tag;\n            return opts;\n        })());\n        this._prompt = null;\n        this._done = null;\n        this.choiceWidth = opts.choiceWidth;\n        this.attr('border', opts.border || Choice.default.border);\n        this.attr('promptTag', opts.promptTag || Choice.default.promptTag);\n        this.attr('promptClass', opts.promptClass || Choice.default.promptClass);\n        this.attr('choiceTag', opts.choiceTag || Choice.default.choiceTag);\n        this.attr('choiceClass', opts.choiceClass || Choice.default.choiceClass);\n        this.attr('infoTag', opts.infoTag || Choice.default.infoTag);\n        this.attr('infoClass', opts.infoClass || Choice.default.infoClass);\n        this._addLegend();\n        this._addList();\n        this._addInfo();\n        if (opts.prompt) {\n            this.showPrompt(opts.prompt);\n        }\n    }\n    showPrompt(prompt, arg) {\n        this._prompt = prompt;\n        prompt.choose(0);\n        this.prompt.text(prompt.prompt(arg));\n        this.list.data(prompt.choices());\n        this.info.text(prompt.info(arg));\n        this._bubbleEvent('input', this, this._prompt);\n        return new Promise((resolve) => (this._done = resolve));\n    }\n    _addList() {\n        this.list = new DataList(this.layer, {\n            height: this.bounds.height - 2,\n            x: this.bounds.x + 1,\n            width: this.choiceWidth,\n            y: this.bounds.y + 1,\n            dataTag: this._attrStr('choiceTag'),\n            dataClass: this._attrStr('choiceClass'),\n            tabStop: true,\n            border: 'none',\n            hover: 'select',\n        });\n        this.list.setParent(this);\n        this.list.on('input', () => {\n            if (!this._prompt)\n                return false;\n            const p = this._prompt;\n            const row = this.list.selectedRow;\n            p.choose(row);\n            this.info.text(p.info());\n            this._bubbleEvent('input', this, p);\n            return true; // I want to eat this event\n        });\n        this.list.on('change', () => {\n            if (!this._prompt)\n                return false;\n            const p = this._prompt;\n            p.choose(this.list.selectedRow);\n            this._bubbleEvent('change', this, p);\n            this._done(p.value());\n            return true; // eat this event\n        });\n        return this;\n    }\n    _addInfo() {\n        this.info = new Text.Text(this.layer, {\n            text: '',\n            x: this.bounds.x + this.choiceWidth + 2,\n            y: this.bounds.y + 1,\n            width: this.bounds.width - this.choiceWidth - 3,\n            height: this.bounds.height - 2,\n            tag: this._attrStr('infoTag'),\n            class: this._attrStr('infoClass'),\n        });\n        this.info.setParent(this);\n        return this;\n    }\n    _addLegend() {\n        this.prompt = new Text.Text(this.layer, {\n            text: '',\n            width: this.bounds.width - 4,\n            x: this.bounds.x + 2,\n            y: this.bounds.y,\n            tag: this._attrStr('promptTag'),\n            class: this._attrStr('promptClass'),\n        });\n        this.prompt.setParent(this);\n        return this;\n    }\n    _draw(buffer) {\n        let w = this.choiceWidth + 2;\n        const h = this.bounds.height;\n        let x = this.bounds.x;\n        const y = this.bounds.y;\n        const ascii = this.attr('border') === 'ascii';\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        w = this.bounds.width - this.choiceWidth - 1;\n        x = this.bounds.x + this.choiceWidth + 1;\n        drawBorder(buffer, x, y, w, h, this._used, ascii);\n        return true;\n    }\n}\nChoice.default = {\n    tag: 'choice',\n    border: 'ascii',\n    promptTag: 'prompt',\n    promptClass: '',\n    choiceTag: 'ci',\n    choiceClass: '',\n    infoTag: 'info',\n    infoClass: '',\n};\nLayer.prototype.choice = function (opts) {\n    const options = Object.assign({}, this._opts, opts);\n    const widget = new Choice(this, options);\n    if (opts.parent) {\n        widget.setParent(opts.parent, opts);\n    }\n    return widget;\n};\n////////////////////////////////////////////////////////////////////////////////\n// INQUIRY\nexport class Inquiry {\n    constructor(widget) {\n        this._prompts = [];\n        this.events = {};\n        this._result = {};\n        this._stack = [];\n        this._current = null;\n        this.widget = widget;\n        this._keypress = this._keypress.bind(this);\n        this._change = this._change.bind(this);\n    }\n    prompts(v, ...args) {\n        if (Array.isArray(v)) {\n            this._prompts = v.slice();\n        }\n        else {\n            args.unshift(v);\n            this._prompts = args;\n        }\n        return this;\n    }\n    _finish() {\n        this.widget.off('keypress', this._keypress);\n        this.widget.off('change', this._change);\n        this._fireEvent('finish', this.widget, this._result);\n    }\n    _cancel() {\n        this.widget.off('keypress', this._keypress);\n        this.widget.off('change', this._change);\n        this._fireEvent('cancel', this.widget);\n    }\n    start() {\n        this._current = this._prompts[0];\n        this._result = {};\n        this.widget.on('keypress', this._keypress);\n        this.widget.on('change', this._change);\n        this.widget.showPrompt(this._current, this._result);\n    }\n    back() {\n        this._current.reset();\n        this._current = this._stack.pop() || null;\n        if (!this._current) {\n            this._cancel();\n        }\n        else {\n            this._current.reset(); // also reset the one we are going back to\n            this._result = {};\n            this._prompts.forEach((p) => p.updateResult(this._result));\n            this.widget.showPrompt(this._current, this._result);\n        }\n    }\n    restart() {\n        this._prompts.forEach((p) => p.reset());\n        this._result = {};\n        this._current = this._prompts[0];\n        this.widget.showPrompt(this._current, this._result);\n    }\n    quit() {\n        this._cancel();\n    }\n    _keypress(_n, _w, e) {\n        if (!e.key)\n            return false;\n        if (e.key === 'Escape') {\n            this.back();\n            return true;\n        }\n        else if (e.key === 'R') {\n            this.restart();\n            return true;\n        }\n        else if (e.key === 'Q') {\n            this.quit();\n            return true;\n        }\n        return false;\n    }\n    _change(_n, _w, p) {\n        p.updateResult(this._result);\n        const next = p.next();\n        if (next) {\n            this._current = this._prompts.find((p) => p.id() === next) || null;\n            if (this._current) {\n                this._stack.push(p);\n                this.widget.showPrompt(this._current, this._result);\n                this._fireEvent('step', this.widget, {\n                    prompt: this._current,\n                    data: this._result,\n                });\n                return true;\n            }\n        }\n        this._finish();\n        return true;\n    }\n    on(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers) {\n            handlers = this.events[event] = [];\n        }\n        if (!handlers.includes(cb)) {\n            handlers.push(cb);\n        }\n        return this;\n    }\n    off(event, cb) {\n        let handlers = this.events[event];\n        if (!handlers)\n            return this;\n        if (cb) {\n            GWU.arrayDelete(handlers, cb);\n        }\n        else {\n            handlers.length = 0; // clear all handlers\n        }\n        return this;\n    }\n    _fireEvent(name, source, args) {\n        const handlers = this.events[name] || [];\n        let handled = handlers.reduce((out, h) => h(name, source || this.widget, args) || out, false);\n        if (!handled) {\n            handled = this.widget._bubbleEvent(name, source || this.widget, args);\n        }\n        return handled;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { Layer } from '../layer';\nLayer.prototype.alert = function (opts, text, args) {\n    if (typeof opts === 'number') {\n        opts = { duration: opts };\n    }\n    if (args) {\n        text = GWU.text.apply(text, args);\n    }\n    opts.class = opts.class || 'alert';\n    opts.border = opts.border || 'ascii';\n    opts.pad = opts.pad || 1;\n    // const width = opts.width || GWU.text.length(text);\n    const layer = this.ui.startNewLayer();\n    // Fade the background\n    const opacity = opts.opacity !== undefined ? opts.opacity : 50;\n    layer.body.style().set('bg', GWU.color.BLACK.alpha(opacity));\n    // create the text widget\n    const textWidget = layer\n        .text(text, {\n        class: opts.textClass || opts.class,\n        width: opts.width,\n        height: opts.height,\n    })\n        .center();\n    Object.assign(opts, {\n        width: textWidget.bounds.width,\n        height: textWidget.bounds.height,\n        x: textWidget.bounds.x,\n        y: textWidget.bounds.y,\n    });\n    const dialog = layer.dialog(opts);\n    textWidget.setParent(dialog);\n    layer.on('click', () => {\n        layer.finish(true);\n        return true;\n    });\n    layer.on('keypress', () => {\n        layer.finish(true);\n        return true;\n    });\n    layer.setTimeout(() => {\n        layer.finish(true);\n    }, opts.duration || 3000);\n    // const textOpts: Widget.TextOptions = {\n    //     fg: opts.fg,\n    //     text,\n    //     x: 0,\n    //     y: 0,\n    //     wrap: width,\n    // };\n    // const textWidget = new Widget.Text('TEXT', textOpts);\n    // const height = textWidget.bounds.height;\n    // const dlg: Widget.Dialog = Widget.buildDialog(this, width, height)\n    //     .with(textWidget, { x: 0, y: 0 })\n    //     .addBox(opts.box)\n    //     .center()\n    //     .done();\n    // dlg.setEventHandlers({\n    //     click: () => dlg.close(true),\n    //     keypress: () => dlg.close(true),\n    //     TIMEOUT: () => dlg.close(false),\n    // });\n    // if (!opts.waitForAck) {\n    //     dlg.setTimeout('TIMEOUT', opts.duration || 3000);\n    // }\n    // return await dlg.show();\n    return layer.promise;\n};\n","import * as GWU from 'gw-utils';\nimport * as Widget from '../widget';\nexport class Messages extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'messages';\n            return opts;\n        })());\n        if (!this.bounds.height)\n            throw new Error('Must provde a height for messages widget.');\n        this.cache = new GWU.message.MessageCache({\n            width: this.bounds.width,\n            length: opts.length || 40,\n            match: (_x, _y) => {\n                this.layer.needsDraw = true;\n                return true;\n            },\n        });\n    }\n    click(e) {\n        if (!this.contains(e))\n            return false;\n        this.showArchive();\n        return true;\n    }\n    draw(buffer) {\n        const isOnTop = this.bounds.y < 10;\n        // black out the message area\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, ' ', this._used.bg, this._used.bg);\n        this.cache.forEach((line, confirmed, i) => {\n            if (i >= this.bounds.height)\n                return;\n            const localY = isOnTop ? this.bounds.height - i - 1 : i;\n            const y = localY + this.bounds.y;\n            buffer.drawText(this.bounds.x, y, line, this._used.fg);\n            if (confirmed && this._used.bg) {\n                buffer.mix(this._used.bg, 50, this.bounds.x, y, this.bounds.width, 1);\n            }\n        });\n        return true;\n    }\n    showArchive() {\n        if (this.cache.length <= this.bounds.height)\n            return;\n        const layer = this.layer.ui.startNewLayer();\n        // @ts-ignore\n        const w = new MessageArchive(layer, this);\n    }\n}\nexport class MessageArchive extends Widget.Widget {\n    constructor(layer, source) {\n        super(layer, {\n            id: 'ARCHIVE',\n            tag: 'messages',\n            class: source.classes.concat('archive'),\n            height: source.bounds.height,\n            width: source.bounds.width,\n            x: 0,\n            y: 0,\n            tabStop: true,\n            depth: 100, // I'm on top\n        });\n        this.mode = 'forward';\n        this.source = source;\n        this.isOnTop = this.source.bounds.y < 10;\n        this.bounds.height = this.isOnTop\n            ? layer.height - source.bounds.y\n            : source.bounds.bottom;\n        this.totalCount = Math.min(source.cache.length, this.isOnTop\n            ? layer.height - this.source.bounds.top\n            : this.source.bounds.bottom);\n        this.shown = source.bounds.height;\n        this.layer.on('FORWARD', this._forward.bind(this));\n        this.layer.on('REVERSE', this._reverse.bind(this));\n        this.layer.setTimeout('FORWARD', 16);\n        // confirm them as they are right now...\n        this.source.cache.confirmAll();\n    }\n    contains() {\n        return true; // Eat all mouse activity\n    }\n    finish() {\n        this.layer.finish();\n    }\n    keypress(e) {\n        if (this.mode === 'ack') {\n            if (e.key === 'Enter' || e.key === ' ') {\n                this.mode = 'reverse';\n                this.layer.needsDraw = true;\n                this.layer.setTimeout('REVERSE', 16);\n            }\n        }\n        else if (this.mode === 'reverse') {\n            this.finish();\n            return true;\n        }\n        else {\n            this.mode = 'ack';\n            this.shown = this.totalCount;\n            this.layer.needsDraw = true;\n        }\n        return false;\n    }\n    click(_e) {\n        if (this.mode === 'ack') {\n            this.mode = 'reverse';\n            this.layer.needsDraw = true;\n            this.layer.setTimeout('REVERSE', 16);\n        }\n        else if (this.mode === 'reverse') {\n            this.finish();\n        }\n        else {\n            this.mode = 'ack';\n            this.shown = this.totalCount;\n            this.layer.needsDraw = true;\n        }\n        return false;\n    }\n    _forward() {\n        ++this.shown;\n        this.layer.needsDraw = true;\n        if (this.shown < this.totalCount) {\n            this.layer.setTimeout('FORWARD', 16);\n        }\n        else {\n            this.mode = 'ack';\n        }\n        return true;\n    }\n    _reverse() {\n        --this.shown;\n        if (this.shown <= this.source.bounds.height) {\n            this.finish();\n        }\n        else {\n            this.layer.needsDraw = true;\n            this.layer.setTimeout('REVERSE', 16);\n        }\n        return true;\n    }\n    _draw(buffer) {\n        let fadePercent = 0;\n        // let reverse = this.mode === 'reverse';\n        // Count the number of lines in the archive.\n        // let totalMessageCount = this.totalCount;\n        const isOnTop = this.isOnTop;\n        const dbuf = buffer;\n        const fg = GWU.color.from(this.source._used.fg);\n        // const dM = reverse ? -1 : 1;\n        // const startM = reverse ? totalMessageCount : this.bounds.height;\n        // const endM = reverse\n        //     ? this.bounds.height + dM + 1\n        //     : totalMessageCount + dM;\n        const startY = isOnTop\n            ? this.shown - 1\n            : this.bounds.bottom - this.shown;\n        const endY = isOnTop ? 0 : this.bounds.bottom - 1;\n        const dy = isOnTop ? -1 : 1;\n        dbuf.fillRect(this.source.bounds.x, Math.min(startY, endY), this.bounds.width, this.shown, ' ', this._used.bg, this._used.bg);\n        this.source.cache.forEach((line, _confirmed, j) => {\n            const y = startY + j * dy;\n            if (isOnTop) {\n                if (y < endY)\n                    return;\n            }\n            else if (y > endY)\n                return;\n            fadePercent = Math.floor((50 * j) / this.shown);\n            const fgColor = fg.mix(this._used.bg, fadePercent);\n            dbuf.drawText(this.source.bounds.x, y, line, fgColor, this._used.bg);\n        });\n        if (this.mode === 'ack') {\n            const y = this.isOnTop ? 0 : dbuf.height - 1;\n            const x = this.source.bounds.x > 8\n                ? this.source.bounds.x - 8 // to left of box\n                : Math.min(this.source.bounds.x + this.bounds.width, // just to right of box\n                dbuf.width - 8 // But definitely on the screen - overwrite some text if necessary\n                );\n            dbuf.wrapText(x, y, 8, '--DONE--', this._used.bg, this._used.fg);\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from '../widget';\nGWU.color.install('flavorText', 50, 40, 90);\nGWU.color.install('flavorPrompt', 100, 90, 20);\nexport class Flavor extends Widget.Text {\n    constructor(layer, opts) {\n        super(layer, (() => {\n            opts.tag = opts.tag || 'flavor';\n            opts.text = '';\n            return opts;\n        })());\n        this.overflow = opts.overflow || false;\n        this.isPrompt = false;\n    }\n    showText(text) {\n        this.text(text);\n        this.removeClass('prompt');\n        return this;\n    }\n    clear() {\n        this.text('');\n        this.removeClass('prompt');\n        return this;\n    }\n    showPrompt(text) {\n        this.showText(text);\n        this.addClass('prompt');\n        return this;\n    }\n    getFlavorText(map, x, y, fov) {\n        const cell = map.cell(x, y); // KNOWLEDGE / MEMORY !!!\n        let buf;\n        // let magicItem;\n        // let standsInTerrain;\n        // let subjectMoving;\n        // let prepositionLocked = false;\n        // let subject;\n        // let verb;\n        // let preposition;\n        let object = '';\n        // let adjective;\n        const isAnyKindOfVisible = fov ? fov.isAnyKindOfVisible(x, y) : true;\n        const isDirectlyVisible = fov ? fov.isDirectlyVisible(x, y) : true;\n        const isRemembered = fov ? fov.isRevealed(x, y) : false;\n        const isMapped = fov ? fov.isMagicMapped(x, y) : false;\n        let intro;\n        if (isDirectlyVisible) {\n            intro = 'You see';\n        }\n        else if (isAnyKindOfVisible) {\n            intro = 'You sense';\n        }\n        else if (isRemembered) {\n            intro = 'You remember';\n        }\n        else if (isMapped) {\n            intro = 'You expect to see';\n        }\n        else {\n            return '';\n        }\n        const actor = cell.hasActor() ? map.actorAt(x, y) : null;\n        // const player = actor?.isPlayer() ? actor : null;\n        const theItem = cell.hasItem() ? map.itemAt(x, y) : null;\n        const standsInTile = cell.hasTileFlag(GWM.flags.Tile.T_STAND_IN_TILE);\n        let needObjectArticle = false;\n        if (actor) {\n            object = actor.getFlavor({\n                color: false,\n                article: true,\n                action: true,\n            });\n            needObjectArticle = true;\n        }\n        else if (theItem) {\n            object = theItem.getFlavor({ color: false, article: true });\n            needObjectArticle = true;\n        }\n        let article = standsInTile ? ' in ' : ' on ';\n        const groundTile = cell.depthTile(GWM.flags.Depth.GROUND) || GWM.tile.tiles.NULL;\n        const surfaceTile = cell.depthTile(GWM.flags.Depth.SURFACE);\n        const liquidTile = cell.depthTile(GWM.flags.Depth.LIQUID);\n        // const gasTile = cell.depthTile(GWM.flags.Depth.GAS);\n        let surface = '';\n        if (surfaceTile) {\n            const tile = surfaceTile;\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' on ';\n            }\n            if (tile.hasTileFlag(GWM.flags.Tile.T_BRIDGE)) {\n                article = ' over ';\n            }\n            surface = surfaceTile.getFlavor() + article;\n        }\n        let liquid = '';\n        if (liquidTile) {\n            liquid = liquidTile.getFlavor() + ' covering ';\n            if (needObjectArticle) {\n                needObjectArticle = false;\n                object += ' in ';\n            }\n        }\n        if (needObjectArticle) {\n            needObjectArticle = false;\n            object += ' on ';\n        }\n        let ground = groundTile.getFlavor({ article: true });\n        buf = GWU.text.apply('§intro§ §text§.', {\n            intro,\n            text: object + surface + liquid + ground,\n        });\n        return buf;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as GWM from 'gw-map';\nimport * as Widget from '../widget';\nGWU.color.install('blueBar', 15, 10, 50);\nGWU.color.install('redBar', 45, 10, 15);\nGWU.color.install('purpleBar', 50, 0, 50);\nGWU.color.install('greenBar', 10, 50, 10);\nexport class EntryBase {\n    constructor() {\n        this.dist = 0;\n        this.priority = 0;\n        this.changed = false;\n        this.sidebarY = -1;\n    }\n    draw(_buffer, _bounds) {\n        return 0;\n    }\n}\nexport class ActorEntry extends EntryBase {\n    constructor(actor) {\n        super();\n        this.actor = actor;\n    }\n    get x() {\n        return this.actor.x;\n    }\n    get y() {\n        return this.actor.y;\n    }\n    draw(buffer, bounds) {\n        return this.actor.drawStatus(buffer, bounds);\n    }\n}\nexport class ItemEntry extends EntryBase {\n    constructor(item) {\n        super();\n        this.item = item;\n    }\n    get x() {\n        return this.item.x;\n    }\n    get y() {\n        return this.item.y;\n    }\n    draw(buffer, bounds) {\n        return this.item.drawStatus(buffer, bounds);\n    }\n}\nexport class CellEntry extends EntryBase {\n    constructor(cell) {\n        super();\n        this.cell = cell;\n    }\n    get x() {\n        return this.cell.x;\n    }\n    get y() {\n        return this.cell.y;\n    }\n    draw(buffer, bounds) {\n        return this.cell.drawStatus(buffer, bounds);\n    }\n}\nexport class Sidebar extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.cellCache = [];\n        this.lastX = -1;\n        this.lastY = -1;\n        this.lastMap = null;\n        this.entries = [];\n        this.subject = null;\n        this.highlight = null;\n    }\n    reset() {\n        this.lastMap = null;\n        this.lastX = -1;\n        this.lastY = -1;\n    }\n    entryAt(e) {\n        return (this.entries.find((entry) => {\n            return entry.sidebarY <= e.y && entry.sidebarY !== -1;\n        }) || null);\n    }\n    mousemove(e) {\n        super.mousemove(e);\n        if (this.contains(e)) {\n            return this.highlightRow(e.y);\n        }\n        return this.clearHighlight();\n    }\n    highlightRow(y) {\n        const last = this.highlight;\n        this.highlight = null;\n        // processed in ascending y order\n        this.entries.forEach((e) => {\n            if (e.sidebarY <= y && e.sidebarY !== -1) {\n                this.highlight = e;\n            }\n        });\n        return this.highlight !== last;\n    }\n    clearHighlight() {\n        const result = !!this.highlight;\n        this.highlight = null;\n        return result;\n    }\n    updateCellCache(map) {\n        if (this.lastMap &&\n            map === this.lastMap &&\n            !map.hasMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED)) {\n            return;\n        }\n        this.lastMap = null; // Force us to regather the entries, even if at same location\n        this.cellCache.length = 0;\n        GWU.xy.forRect(map.width, map.height, (x, y) => {\n            const info = map.cell(x, y);\n            if (info.hasEntityFlag(GWM.flags.Entity.L_LIST_IN_SIDEBAR)) {\n                this.cellCache.push(info);\n            }\n        });\n        map.clearMapFlag(GWM.flags.Map.MAP_SIDEBAR_TILES_CHANGED);\n    }\n    _makeActorEntry(actor) {\n        return new ActorEntry(actor);\n    }\n    _makeItemEntry(item) {\n        return new ItemEntry(item);\n    }\n    _makeCellEntry(cell) {\n        return new CellEntry(cell);\n    }\n    _getPriority(map, x, y, fov) {\n        if (!fov) {\n            return map.cell(x, y).hasCellFlag(GWM.flags.Cell.STABLE_MEMORY)\n                ? 3\n                : 1;\n        }\n        if (fov.isDirectlyVisible(x, y)) {\n            return 1;\n        }\n        else if (fov.isAnyKindOfVisible(x, y)) {\n            return 2;\n        }\n        else if (fov.isRevealed(x, y)) {\n            return 3;\n        }\n        return -1; // not visible, or revealed\n    }\n    _isDim(entry) {\n        if (entry === this.highlight)\n            return false;\n        return entry.priority > 2 || !!this.highlight;\n    }\n    _addActorEntry(actor, map, x, y, fov) {\n        const priority = this._getPriority(map, actor.x, actor.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeActorEntry(actor);\n        entry.dist = GWU.xy.distanceBetween(x, y, actor.x, actor.y);\n        entry.priority = actor.isPlayer() ? 0 : priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addItemEntry(item, map, x, y, fov) {\n        const priority = this._getPriority(map, item.x, item.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeItemEntry(item);\n        entry.dist = GWU.xy.distanceBetween(x, y, item.x, item.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    _addCellEntry(cell, map, x, y, fov) {\n        const priority = this._getPriority(map, cell.x, cell.y, fov);\n        if (priority < 0)\n            return false;\n        const entry = this._makeCellEntry(cell);\n        entry.dist = GWU.xy.distanceBetween(x, y, cell.x, cell.y);\n        entry.priority = priority;\n        this.entries.push(entry);\n        return true;\n    }\n    findEntries(map, cx, cy, fov) {\n        if (map === this.lastMap && cx === this.lastX && cy === this.lastY)\n            return;\n        this.clearHighlight(); // If we are moving around the map, then turn off the highlight\n        this.lastMap = map;\n        this.lastX = cx;\n        this.lastY = cy;\n        this.entries.length = 0;\n        const done = GWU.grid.alloc(map.width, map.height);\n        map.eachActor((a) => {\n            const x = a.x;\n            const y = a.y;\n            if (done[x][y])\n                return;\n            if (this._addActorEntry(a, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        map.eachItem((i) => {\n            const x = i.x;\n            const y = i.y;\n            if (done[x][y])\n                return;\n            if (this._addItemEntry(i, map, cx, cy, fov)) {\n                done[x][y] = 1;\n            }\n        });\n        this.cellCache.forEach((c) => {\n            if (done[c.x][c.y])\n                return;\n            if (this._addCellEntry(c, map, cx, cy, fov)) {\n                done[c.x][c.y] = 1;\n            }\n        });\n        this.entries.sort((a, b) => {\n            if (a.priority != b.priority) {\n                return a.priority - b.priority;\n            }\n            return a.dist - b.dist;\n        });\n        GWU.grid.free(done);\n    }\n    update() {\n        if (!this.subject) {\n            throw new Error('Update requires a subject to follow.');\n        }\n        return this.updateFor(this.subject);\n    }\n    updateFor(subject) {\n        return this.updateAt(subject.memory || subject.map, subject.x, subject.y, subject.fov);\n    }\n    updateAt(map, cx, cy, fov) {\n        this.updateCellCache(map);\n        this.findEntries(map, cx, cy, fov);\n        return true;\n    }\n    draw(buffer) {\n        buffer.fillRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, 0, 0, this._used.bg);\n        // clear the row information\n        this.entries.forEach((e) => (e.sidebarY = -1));\n        const drawBounds = this.bounds.clone();\n        let currentEntry;\n        for (let i = 0; i < this.entries.length && drawBounds.height > 0; ++i) {\n            currentEntry = this.entries[i];\n            currentEntry.sidebarY = drawBounds.y;\n            let usedLines = currentEntry.draw(buffer, drawBounds);\n            if (this._isDim(currentEntry) && this._used.bg) {\n                buffer.mix(this._used.bg, 50, drawBounds.x, drawBounds.y, drawBounds.width, usedLines);\n            }\n            if (usedLines) {\n                ++usedLines; // skip a space\n                drawBounds.y += usedLines;\n                drawBounds.height -= usedLines;\n            }\n        }\n        return true;\n    }\n}\n","import * as GWU from 'gw-utils';\nimport { defaultStyle } from './style';\nimport { Layer } from './layer';\n// export interface AlertOptions extends Widget.WidgetOptions {\n//     duration?: number;\n//     waitForAck?: boolean;\n//     pad?: number;\n//     padX?: number;\n//     padY?: number;\n//     box?: Widget.BoxOptions;\n// }\n// export interface ConfirmOptions extends Widget.WidgetOptions {\n//     allowCancel?: boolean;\n//     pad?: number;\n//     padX?: number;\n//     padY?: number;\n//     buttons?: Widget.ButtonOptions;\n//     ok?: string | Widget.ButtonOptions;\n//     cancel?: string | Widget.ButtonOptions;\n//     box?: Widget.BoxOptions;\n// }\n// export interface InputBoxOptions extends ConfirmOptions {\n//     prompt?: string | Widget.TextOptions;\n//     input?: Widget.InputOptions;\n// }\nexport class UI {\n    constructor(opts = {}) {\n        this.layer = null;\n        this.layers = [];\n        // inDialog = false;\n        this._done = false;\n        this._promise = null;\n        if (!opts.canvas)\n            throw new Error('Need a canvas.');\n        this.canvas = opts.canvas;\n        this.loop = opts.loop || GWU.loop;\n    }\n    get width() {\n        return this.canvas.width;\n    }\n    get height() {\n        return this.canvas.height;\n    }\n    get styles() {\n        return defaultStyle;\n    }\n    // render() {\n    //     this.buffer.render();\n    // }\n    get baseBuffer() {\n        const layer = this.layers[this.layers.length - 2] || null;\n        return layer ? layer.buffer : this.canvas.buffer;\n    }\n    get canvasBuffer() {\n        return this.canvas.buffer;\n    }\n    get buffer() {\n        return this.layer ? this.layer.buffer : this.canvas.buffer;\n    }\n    startNewLayer() {\n        const layer = new Layer(this, {\n            styles: this.layer ? this.layer.styles : this.styles,\n        });\n        this.layers.push(layer);\n        if (!this._promise) {\n            this._promise = this.loop.run(this);\n        }\n        this.layer = layer;\n        return layer;\n    }\n    copyUIBuffer(dest) {\n        const base = this.baseBuffer;\n        dest.copy(base);\n        dest.changed = false; // So you have to draw something to make the canvas render...\n    }\n    finishLayer(layer) {\n        layer._finish();\n        GWU.arrayDelete(this.layers, layer);\n        if (this.layer === layer) {\n            this.layer = this.layers[this.layers.length - 1] || null;\n            this.layer && (this.layer.needsDraw = true);\n        }\n    }\n    stop() {\n        this._done = true;\n        while (this.layer) {\n            this.finishLayer(this.layer);\n        }\n    }\n    // run(): Promise<void> {\n    //     // this._done = false;\n    //     return this.loop.run(this as unknown as GWU.io.IOMap);\n    // }\n    // stop() {\n    //     this._done = true;\n    //     if (this.layer) this.layer.stop();\n    //     this.layers.forEach((l) => l.stop());\n    //     this.layer = null;\n    //     this.layers.length = 0;\n    // }\n    mousemove(e) {\n        if (this.layer)\n            this.layer.mousemove(e);\n        return this._done;\n    }\n    click(e) {\n        if (this.layer)\n            this.layer.click(e);\n        return this._done;\n    }\n    keypress(e) {\n        if (this.layer)\n            this.layer.keypress(e);\n        return this._done;\n    }\n    dir(e) {\n        if (this.layer)\n            this.layer.dir(e);\n        return this._done;\n    }\n    tick(e) {\n        if (this.layer)\n            this.layer.tick(e);\n        return this._done;\n    }\n    draw() {\n        if (this.layer)\n            this.layer.draw();\n    }\n}\n","import * as GWU from 'gw-utils';\nimport * as Widget from '../widget';\nexport class Viewport extends Widget.Widget {\n    constructor(layer, opts) {\n        super(layer, opts);\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this._subject = null;\n        this.attr('snap', opts.snap || false);\n        this.attr('center', opts.center || false);\n        this.filter = opts.filter || null;\n        this.attr('lockX', opts.lock || opts.lockX || false);\n        this.attr('lockY', opts.lock || opts.lockY || false);\n    }\n    get subject() {\n        return this._subject;\n    }\n    set subject(subject) {\n        this.attr('center', !!subject);\n        if (subject) {\n            this.offsetX = subject.x - this.halfWidth();\n            this.offsetY = subject.y - this.halfHeight();\n        }\n        this._subject = subject;\n    }\n    set lock(v) {\n        this.attr('lockX', v);\n        this.attr('lockY', v);\n    }\n    toMapX(x) {\n        return x + this.offsetX - this.bounds.x;\n    }\n    toMapY(y) {\n        return y + this.offsetY - this.bounds.y;\n    }\n    toInnerX(x) {\n        return x - this.bounds.x;\n    }\n    toInnerY(y) {\n        return y - this.bounds.y;\n    }\n    halfWidth() {\n        return Math.floor(this.bounds.width / 2);\n    }\n    halfHeight() {\n        return Math.floor(this.bounds.height / 2);\n    }\n    centerOn(map, x, y) {\n        this.attr('center', true);\n        this.subject = { x, y, map };\n    }\n    showMap(map, x = 0, y = 0) {\n        this.subject = { x, y, map };\n        this.offsetX = x;\n        this.offsetY = y;\n        this.attr('center', false);\n        this.attr('snap', false);\n    }\n    updateOffset() {\n        if (!this._subject) {\n            this.offsetX = 0;\n            this.offsetY = 0;\n            return;\n        }\n        const subject = this._subject;\n        const map = subject.memory || subject.map;\n        const bounds = map;\n        if (subject && map.hasXY(subject.x, subject.y)) {\n            if (this._attrBool('snap')) {\n                let left = this.offsetX;\n                let right = this.offsetX + this.bounds.width;\n                let top = this.offsetY;\n                let bottom = this.offsetY + this.bounds.height;\n                // auto center if outside the viewport\n                if (subject.x < left || subject.x > right) {\n                    left = this.offsetX = subject.x - this.halfWidth();\n                    right = left + this.bounds.width;\n                }\n                if (subject.y < top || subject.y > bottom) {\n                    top = this.offsetY = subject.y - this.halfHeight();\n                    bottom = top + this.bounds.height;\n                }\n                const edgeX = Math.floor(this.bounds.width / 5);\n                const edgeY = Math.floor(this.bounds.height / 5);\n                const thirdW = Math.floor(this.bounds.width / 3);\n                if (left + edgeX >= subject.x) {\n                    this.offsetX = Math.max(0, subject.x + thirdW - this.bounds.width);\n                }\n                else if (right - edgeX <= subject.x) {\n                    this.offsetX = Math.min(subject.x - thirdW, bounds.width - this.bounds.width);\n                }\n                const thirdH = Math.floor(this.bounds.height / 3);\n                if (top + edgeY >= subject.y) {\n                    this.offsetY = Math.max(0, subject.y + thirdH - this.bounds.height);\n                }\n                else if (bottom - edgeY <= subject.y) {\n                    this.offsetY = Math.min(subject.y - thirdH, bounds.height - this.bounds.height);\n                }\n            }\n            else if (this._attrBool('center')) {\n                this.offsetX = subject.x - this.halfWidth();\n                this.offsetY = subject.y - this.halfHeight();\n            }\n            else {\n                this.offsetX = subject.x;\n                this.offsetY = subject.y;\n            }\n        }\n        if (this._attrBool('lockX') && map) {\n            this.offsetX = GWU.clamp(this.offsetX, 0, map.width - this.bounds.width);\n        }\n        if (this._attrBool('lockY') && map) {\n            this.offsetY = GWU.clamp(this.offsetY, 0, map.height - this.bounds.height);\n        }\n    }\n    draw(buffer) {\n        buffer.blackOutRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height, this._used.bg);\n        if (!this._subject) {\n            return false;\n        }\n        this.updateOffset();\n        const map = this._subject.memory || this._subject.map;\n        const fov = this._subject.fov;\n        const mixer = new GWU.sprite.Mixer();\n        for (let x = 0; x < this.bounds.width; ++x) {\n            for (let y = 0; y < this.bounds.height; ++y) {\n                const mapX = x + this.offsetX;\n                const mapY = y + this.offsetY;\n                if (map.hasXY(mapX, mapY)) {\n                    const cell = map.cell(mapX, mapY);\n                    map.drawer.drawCell(mixer, cell, fov);\n                }\n                else {\n                    mixer.draw(' ', this._used.bg, this._used.bg); // blackOut\n                }\n                if (this.filter) {\n                    this.filter(mixer, mapX, mapY, map);\n                }\n                buffer.drawSprite(x + this.bounds.x, y + this.bounds.y, mixer);\n            }\n        }\n        // map.clearMapFlag(GWM.flags.Map.MAP_CHANGED);\n        return true;\n    }\n}\n"],"names":["Selector","constructor","text","this","priority","startsWith","matchFn","_parse","parts","split","map","p","trim","matches","i","length","push","_parentMatch","_ancestorMatch","_matchElement","reduce","out","fn","bind","undefined","GWU","TRUE","next","e","parent","current","re","RegExp","match","exec","_matchTag","_matchId","_matchClass","_matchNot","_matchProp","every","tag","el","cls","classes","includes","prop","_matchFirst","_matchLast","id","attr","children","obj","Style","selector","init","_dirty","set","dirty","v","fg","_fg","bg","_bg","dim","pct","color","from","darken","bright","lighten","invert","align","_align","valign","_valign","get","key","value","setDirty","field","Number","parseInt","Object","entries","forEach","name","unset","clone","other","copy","assign","ComputedStyle","sources","super","sort","a","b","s","some","Sheet","parentSheet","rules","defaultStyle","slice","r","add","props","Error","rule","existing","findIndex","find","remove","splice","computeFor","widget","filter","widgetStyle","style","Widget","term","opts","bounds","xy","Bounds","_depth","events","_style","Style.Style","_parent","_props","_attrs","layer","x","y","width","height","depth","class","c","tabStop","action","disabled","hidden","on","_n","w","_attrStr","_bubbleEvent","attach","updateStyle","sortWidgets","setParent","_removeChild","_addChild","pos","needsDraw","center","centerX","centerY","body","mid","Math","round","h","_attrInt","n","_attrBool","_setProp","_propInt","_propStr","_propBool","toggleProp","incProp","contains","args","addClass","removeClass","arrayDelete","hasClass","all","arrayIncludesAll","toggleClass","focused","focus","reverse","_fireEvent","blur","hovered","_used","styles","draw","buffer","_draw","_drawFill","fillRect","childAt","beforeIndex","resize","mouseenter","over","mousemove","defaultPrevented","mouseleave","click","keypress","dir","tick","event","cb","handlers","off","source","Body","Widget.Widget","blend","Grid","target","_left","_top","_colWidths","_rowHeights","_col","_row","cols","Array","fill","isArray","rows","col","clamp","_setPos","nextCol","row","nextRow","endRow","Layer","ui","result","_attachOrder","_depthOrder","_focusWidget","_hasTabStop","timers","_done","_opts","canvas","Style.Sheet","promise","Promise","resolve","reset","moveTo","move","dx","dy","up","down","left","right","nextLine","prevLine","grid","clear","fadeTo","_color","_duration","index","aw","detach","nextTabStop","widgetAt","focusWidget","setFocusWidget","getWidget","arrayNext","prevTabStop","prev","arrayPrev","setFocus","dt","promises","timer","time","copyUIBuffer","console","log","render","setTimeout","slot","t","clearTimeout","finish","finishLayer","_finish","widgets","installWidget","Text","_text","_lines","_fixedWidth","_fixedHeight","splitIntoLines","line","max","vOffset","floor","drawText","l","prototype","options","list","bottom","Border","ascii","_args","drawBorder","j","forBorder","border","Button","Text.Text","ev","Dialog","default","legend","pad","pv","ph","toPadArray","_adjustBounds","legendTag","legendClass","legendAlign","_addLegend","_innerLeft","padLeft","_innerWidth","padSize","_innerTop","padTop","_innerHeight","textWidth","dialog","Fieldset","Dialog.Dialog","fields","separator","dataTag","dataClass","dataWidth","labelTag","labelClass","_pad","_labelLeft","_dataLeft","_nextY","padBottom","label","format","sep","labelText","padEnd","Field","data","d","f","fieldset","topts","_format","compile","OrderedList","min","_drawBulletFor","_getBullet","bullet","size","UnorderedList","_index","ol","ul","Input","maxLength","minLength","numbersOnly","placeholder","required","isValid","valid","val","textEntryBounds","spliceRaw","_force","show","input","Column","IDENTITY","DataTable","columnWidth","header","headerTag","empty","addHeader","table","rowHeight","addData","TD","addEmpty","select","hover","_data","columns","showHeader","selectedRow","selectedColumn","o","wrap","prefix","selectedData","active","selectNextRow","selectPrevRow","selectNextCol","selectPrevCol","borderAdj","datatable","DataList","DataTable.DataTable","tableOpts","datalist","Menu","buttonClass","join","buttonTag","marker","_initButtons","_w","expand","collapse","buttons","minWidth","textLen","menuItem","MenuButton","menu","_initMenu","_a","_setMenuPos","keys","menuOpts","Menubar","_buttons","_selectedIndex","menuClass","menuTag","_buttonClick","selectedIndex","selectedButton","_config","button","MenubarButton","_action","barButton","indexOf","top","menubar","Select","_initText","dropdown","Menu.Menu","Choice","_prompt","choiceWidth","promptTag","promptClass","choiceTag","choiceClass","infoTag","infoClass","_addList","_addInfo","prompt","showPrompt","arg","choose","choices","info","choice","mainMenu","question","_id","_defaultNext","selection","_field","_choices","_infos","_values","_next","values","updateResult","res","_prompts","_result","_stack","_current","_keypress","_change","prompts","unshift","_cancel","start","back","pop","restart","quit","handled","alert","duration","apply","startNewLayer","opacity","BLACK","alpha","textWidget","textClass","MessageArchive","concat","mode","isOnTop","totalCount","cache","shown","_forward","_reverse","confirmAll","_e","fadePercent","dbuf","startY","endY","_confirmed","fgColor","mix","wrapText","install","EntryBase","dist","changed","sidebarY","_buffer","_bounds","ActorEntry","actor","drawStatus","ItemEntry","item","CellEntry","cell","Widget.Text","overflow","isPrompt","showText","getFlavorText","fov","buf","object","isAnyKindOfVisible","isDirectlyVisible","isRemembered","isRevealed","isMapped","isMagicMapped","intro","hasActor","actorAt","theItem","hasItem","itemAt","standsInTile","hasTileFlag","GWM","flags","Tile","T_STAND_IN_TILE","needObjectArticle","getFlavor","article","groundTile","depthTile","Depth","GROUND","tile","tiles","NULL","surfaceTile","SURFACE","liquidTile","LIQUID","surface","T_BRIDGE","liquid","ground","message","MessageCache","_x","_y","showArchive","confirmed","cellCache","lastX","lastY","lastMap","subject","highlight","entryAt","entry","highlightRow","clearHighlight","last","updateCellCache","hasMapFlag","Map","MAP_SIDEBAR_TILES_CHANGED","forRect","hasEntityFlag","Entity","L_LIST_IN_SIDEBAR","clearMapFlag","_makeActorEntry","_makeItemEntry","_makeCellEntry","_getPriority","hasCellFlag","Cell","STABLE_MEMORY","_isDim","_addActorEntry","distanceBetween","isPlayer","_addItemEntry","_addCellEntry","findEntries","cx","cy","done","alloc","eachActor","eachItem","free","update","updateFor","updateAt","memory","drawBounds","currentEntry","usedLines","layers","_promise","loop","baseBuffer","canvasBuffer","run","dest","base","stop","offsetX","offsetY","_subject","snap","lock","lockX","lockY","halfWidth","halfHeight","toMapX","toMapY","toInnerX","toInnerY","centerOn","showMap","updateOffset","hasXY","edgeX","edgeY","thirdW","thirdH","blackOutRect","mixer","sprite","Mixer","mapX","mapY","drawer","drawCell","drawSprite","baseParts"],"mappings":"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"}