!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gw-utils")):"function"==typeof define&&define.amd?define(["exports","gw-utils"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GWI={},t.GWU)}(this,(function(t,e){"use strict";function i(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var s=i(e);t.Messages=class{constructor(t){const e=t.ui.buffer;this.bounds=new s.xy.Bounds(t.x,t.y,Math.min(t.width||e.width,e.width-t.x),Math.min(t.height||e.height,e.height-t.y)),this.cache=new s.message.MessageCache({width:this.bounds.width,length:e.height}),this.ui=t.ui,this.bg=s.color.from(t.bg||"black"),this.fg=s.color.from(t.fg||"white")}contains(t,e){return this.bounds.contains(t,e)}get needsUpdate(){return this.cache.needsUpdate}get buffer(){return this.ui.buffer}draw(t=!1){if(!t&&!this.cache.needsUpdate)return!1;let e;const i=s.color.make(),h=this.bounds.y<10;return this.buffer.fillRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height," ",0,this.bg),this.cache.forEach(((t,r,o)=>{if(o>=this.bounds.height)return;e=i,e.copy(this.fg),r&&(e.mix(this.bg,50),e.mix(this.bg,75*o/(2*this.bounds.height)));const n=h?this.bounds.height-o-1:o,a=this.toBufferY(n);s.text.eachChar(t,((t,s,h,n)=>{const u=this.toBufferX(n);s&&e!==s&&r&&(s.mix(this.bg,50),s.mix(this.bg,75*o/(2*this.bounds.height))),e=s||i,this.buffer.draw(u,a,t,e,this.bg)}))})),this.cache.needsUpdate=!1,!0}toBufferY(t){return this.bounds.y+t}toBufferX(t){return this.bounds.x+t}async showArchive(){let t,e,i,s=0,h=0;if(this.cache.forEach((()=>++h)),h<=this.bounds.height)return;const r=this.bounds.y<10,o=this.ui.startDialog();for(t=0;t<=1;t++){for(i=!1,s=t?h:this.bounds.height;t?s>=this.bounds.height:s<=h;s+=t?-1:1)this.ui.resetDialogBuffer(o),this.cache.forEach(((t,i,h)=>{if(h>=s||h>=o.height)return;const n=r?h:o.height-h-1;e=Math.floor(50*(s-h)/s);const a=this.fg.clone().mix(this.bg,e);o.wrapText(this.toBufferX(0),n,this.bounds.width,t,a,this.bg)})),o.render(),!i&&await this.ui.loop.pause(t?15:45)&&(i=!0,s=t?this.bounds.height+1:h-1);if(!t){const t=r?0:o.height-1,e=this.bounds.x>8?this.bounds.x-8:Math.min(this.bounds.x+this.bounds.width,this.buffer.width-8);o.wrapText(e,t,8,"--DONE--",this.bg,this.fg),o.render(),await this.ui.loop.waitForAck()}}this.ui.finishDialog(),this.cache.confirmAll(),this.cache.needsUpdate=!0}},t.UI=class{constructor(t={}){if(this.layers=[],this.freeBuffers=[],this.inDialog=!1,this.overlay=null,!t.canvas)throw new Error("Need a canvas.");this.canvas=t.canvas,this.buffer=t.canvas.buffer,this.loop=t.loop||s.loop}startDialog(){this.inDialog=!0;const t=this.overlay||this.buffer;return this.layers.push(t),this.overlay=this.freeBuffers.pop()||new s.canvas.Buffer(this.canvas),this.overlay.copy(t),this.overlay}resetDialogBuffer(t){const e=this.layers[this.layers.length-1]||this.buffer;t.copy(e)}finishDialog(){this.inDialog&&(this.overlay&&this.freeBuffers.push(this.overlay),this.overlay=this.layers.pop()||this.buffer,this.overlay.render(),this.inDialog=this.layers.length>0)}},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gw-ui.min.js.map
